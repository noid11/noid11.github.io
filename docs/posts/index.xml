<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
	<channel>
		<title>Posts on noid11.github.io</title>
		<link>https://noid11.github.io/posts/</link>
		<description>Recent content in Posts on noid11.github.io</description>
		<generator>Hugo -- gohugo.io</generator>
		<language>ja-jp</language>
		<copyright>&amp;#169; noid11</copyright>
		<lastBuildDate>Sun, 14 Feb 2021 19:10:27 +0900</lastBuildDate>
		<atom:link href="https://noid11.github.io/posts/index.xml" rel="self" type="application/rss+xml" />
		
		<item>
			<title>React 公式チュートリアルやったノート</title>
			<link>https://noid11.github.io/posts/react-official-tutorial-note/</link>
			<pubDate>Sun, 14 Feb 2021 19:10:27 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/react-official-tutorial-note/</guid>
			<description>&lt;p&gt;三目並べゲームを作成する &lt;a href=&#34;https://ja.reactjs.org/tutorial/tutorial.html&#34;&gt;React 公式のチュートリアル&lt;/a&gt;を進めたメモ&lt;/p&gt;</description>
			<content type="html"><![CDATA[<p>三目並べゲームを作成する <a href="https://ja.reactjs.org/tutorial/tutorial.html">React 公式のチュートリアル</a>を進めたメモ</p>
<h2 id="振り返りノート">振り返りノート</h2>
<ul>
<li><a href="https://create-react-app.dev/">create-react-app</a> で React を使ったアプリケーションの土台が作れる
<ul>
<li><a href="https://create-react-app.dev/docs/adding-typescript/">TypeScript</a> も使用可能</li>
</ul>
</li>
<li>React では UI を <a href="https://ja.reactjs.org/docs/react-component.html">React.Component</a> サブクラスというコンポーネントとして扱う
<ul>
<li><a href="https://ja.reactjs.org/docs/react-component.html#props">props (properties)</a>
<ul>
<li>React コンポーネントにデータを連携するもの</li>
<li>React では親コンポーネントから子コンポーネントに props を渡すことでアプリ内での情報をやりとりする</li>
<li>JavaScript のクラスでは、サブクラスのコンストラクタを定義する際には常に <a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Operators/super"><code>super()</code></a> を呼ぶ必要がある
<ul>
<li><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Classes/constructor"><code>constructor</code></a> を持つ React コンポーネントでは、全てのコンストラクタを <code>super(props)</code> の呼び出しから始める</li>
</ul>
</li>
</ul>
</li>
<li><a href="https://ja.reactjs.org/docs/react-component.html#render">render</a>
<ul>
<li>React コンポーネントが描画するもの</li>
<li>JSX と呼ばれるシンタックスシュガーで記述可能
<ul>
<li><a href="https://ja.reactjs.org/docs/react-api.html#createelement">React.createElement</a> を使った定義を HTML ライクに書けるというもの</li>
</ul>
</li>
</ul>
</li>
<li><a href="https://ja.reactjs.org/docs/react-component.html#state">state</a>
<ul>
<li>React コンポーネントに持たせる状態を扱うもの
<ul>
<li>その React コンポーネント内でプライベートなデータとして扱う</li>
</ul>
</li>
<li>state は対象 React コンポーネントのコンストラクタ以外では直接変更せず <a href="https://ja.reactjs.org/docs/react-component.html#setstate"><code>setState()</code></a> メソッドによって変更を行う</li>
<li>state の更新は非同期に行われる場合がある
<ul>
<li><code>this.props</code>, <code>this.state</code> は非同期に更新されるため、これらの値に依存するような実装はしない</li>
<li>オブジェクトではなく関数を受け取る <code>setState()</code> を使うと、良い
<ul>
<li>第1引数: 設定する state</li>
<li>第2引数: 更新が適用される時点での props</li>
</ul>
</li>
</ul>
</li>
<li>state の更新はマージされる
<ul>
<li>state に複数の値を使用している場合、複数の値を独立して更新することができる
<ul>
<li>ので state で取り扱う値を変更する場合、全ての値を変更せず、変更したい値だけを変更すれば良い</li>
</ul>
</li>
</ul>
</li>
<li>state のリフトアップ
<ul>
<li>state の管理を親 React コンポーネントに変更すること</li>
<li>複数の子要素からデータを集めたい、または 2つ の子コンポーネントに互いにやりとりさせたい場合、代わりに親コンポーネント内で共有の state を宣言する必要がある
<ul>
<li>親コンポーネントは props を使うことで、子に情報を返すことができる</li>
<li>これによって子コンポーネントが兄弟同士や親との間で、常に同期されるようになる</li>
</ul>
</li>
<li>state を親コンポーネントにリフトアップすることは React コンポーネントのリファクタリングでよくあること</li>
</ul>
</li>
</ul>
</li>
<li><a href="https://ja.reactjs.org/docs/components-and-props.html#function-and-class-components">関数コンポーネント</a>
<ul>
<li><code>render</code> メソッドだけを有して、自分の state を持たないコンポーネントを、よりシンプルに書くための方法</li>
<li><code>React.Component</code> を継承するクラスを定義する代わりに props を入力として受け取り、表示すべき内容を返す関数を定義する</li>
<li>関数コンポーネントはクラスよりも書くのが楽</li>
<li><code>function Welcome(props) { return &lt;h1&gt;Hello, {props.name}&lt;/h1&gt;; }</code></li>
</ul>
</li>
<li><a href="https://ja.reactjs.org/docs/lists-and-keys.html#keys">key</a>
<ul>
<li>React によって予約されているプロパティ</li>
<li>リストアイテムをレンダリングする際に、各アイテムを識別するために指定する ID のようなもの
<ul>
<li><code>&lt;li key={user.id}&gt;{user.name}: {user.taskCount} tasks left&lt;/li&gt;</code></li>
</ul>
</li>
<li>動的なリストを構築する場合には、正しい key を割り当てることが強く推奨されている
<ul>
<li>key はグローバルに一意である必要は無い</li>
<li>コンポーネントと、その兄弟の間で一意であれば十分</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>React Developer Tools
<ul>
<li>React 開発者向けのツールが <a href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi?hl=en">Chrome</a> と <a href="https://addons.mozilla.org/en-US/firefox/addon/react-devtools/">Firefox</a> 向けに公開されている</li>
<li>React を使った開発をする際にはインストールしておこう</li>
</ul>
</li>
<li>immutability の重要性
<ul>
<li>直接データを mutate する
<ul>
<li>配列データを直接変更したり</li>
</ul>
</li>
<li>imutability を保つ
<ul>
<li>配列データを直接変更するのではなく、配列データのコピーを作って操作したり
<ul>
<li><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Array/slice">slice</a>, <a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Array/concat">concat</a>, <a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Array/map">map</a> とか、新しい配列を返すような関数を使う</li>
</ul>
</li>
<li>メリット
<ol>
<li>複雑な機能が簡単に実装できる</li>
<li>変更があったことを検出できる</li>
</ol>
<ul>
<li>immutable object を比較すれば良い</li>
</ul>
<ol>
<li>React の再レンダータイミングの決定</li>
</ol>
<ul>
<li><a href="https://ja.reactjs.org/docs/react-api.html#reactpurecomponent">pure component</a> を構築しやすくなる</li>
<li>イミュータブルなデータは変更があったかどうか簡単に分かるため、コンポーネントをいつ再レンダーすべきなのか決定しやすくなる</li>
<li><a href="https://ja.reactjs.org/docs/optimizing-performance.html#examples">shouldComponentUpdate() および pure component をどのように作成するのかについて</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="ローカル環境で開発する準備">ローカル環境で開発する準備</h2>
<h3 id="create-react-app">create-react-app</h3>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">npx create-react-app react-tutorial
</code></pre></div><ul>
<li><a href="https://create-react-app.dev">create-react-app</a>: React 使ったモダンなアプリケーション開発環境をセットアップしてくれるツール
<ul>
<li><a href="https://create-react-app.dev/docs/folder-structure">ディレクトリ構成</a></li>
<li><a href="https://create-react-app.dev/docs/adding-typescript">TypeScript を使いたい場合</a>:
<ul>
<li><code>npx create-react-app my-app --template typescript</code></li>
<li><code>npm install --save typescript @types/node @types/react @types/react-dom @types/jest</code></li>
<li><a href="https://react-typescript-cheatsheet.netlify.app/">React TypeScript Cheatsheets</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="src-ディレクトリの中身を削除">src ディレクトリの中身を削除</h3>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh"><span class="nb">cd</span> react-tutorial/src
rm -f *
<span class="nb">cd</span> ../
</code></pre></div><h3 id="基本となるファイルを作成">基本となるファイルを作成</h3>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">touch index.css
touch index.js
</code></pre></div><p>index.css</p>
<div class="highlight"><pre class="chroma"><code class="language-css" data-lang="css"><span class="nt">body</span> <span class="p">{</span>
    <span class="k">font</span><span class="p">:</span> <span class="mi">14</span><span class="kt">px</span> <span class="s2">&#34;Century Gothic&#34;</span><span class="p">,</span> <span class="n">Futura</span><span class="p">,</span> <span class="kc">sans-serif</span><span class="p">;</span>
    <span class="k">margin</span><span class="p">:</span> <span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">ol</span><span class="o">,</span> <span class="nt">ul</span> <span class="p">{</span>
    <span class="k">padding-left</span><span class="p">:</span> <span class="mi">30</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">board-row</span><span class="p">:</span><span class="nd">after</span> <span class="p">{</span>
    <span class="k">clear</span><span class="p">:</span> <span class="kc">both</span><span class="p">;</span>
    <span class="k">content</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
    <span class="k">display</span><span class="p">:</span> <span class="kc">table</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">status</span> <span class="p">{</span>
    <span class="k">margin-bottom</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">square</span> <span class="p">{</span>
    <span class="k">background</span><span class="p">:</span> <span class="mh">#fff</span><span class="p">;</span>
    <span class="k">border</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="mh">#999</span><span class="p">;</span>
    <span class="k">float</span><span class="p">:</span> <span class="kc">left</span><span class="p">;</span>
    <span class="k">font-size</span><span class="p">:</span> <span class="mi">24</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">font-weight</span><span class="p">:</span> <span class="kc">bold</span><span class="p">;</span>
    <span class="k">line-height</span><span class="p">:</span> <span class="mi">34</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">height</span><span class="p">:</span> <span class="mi">34</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">margin-right</span><span class="p">:</span> <span class="mi">-1</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">margin-top</span><span class="p">:</span> <span class="mi">-1</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">text-align</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
    <span class="k">width</span><span class="p">:</span> <span class="mi">34</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">square</span><span class="p">:</span><span class="nd">focus</span> <span class="p">{</span>
    <span class="k">outline</span><span class="p">:</span> <span class="kc">none</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">kbd-navigation</span> <span class="p">.</span><span class="nc">square</span><span class="p">:</span><span class="nd">focus</span> <span class="p">{</span>
    <span class="k">background</span><span class="p">:</span> <span class="mh">#ddd</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">game</span> <span class="p">{</span>
    <span class="k">display</span><span class="p">:</span> <span class="kc">flex</span><span class="p">;</span>
    <span class="k">flex-direction</span><span class="p">:</span> <span class="kc">row</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">game-info</span> <span class="p">{</span>
    <span class="k">margin-left</span><span class="p">:</span> <span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>index.js</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">ReactDOM</span> <span class="nx">from</span> <span class="s1">&#39;react-dom&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="s1">&#39;./index.css&#39;</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">Square</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;square&#34;</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="cm">/* TODO */</span><span class="p">}</span>
      <span class="o">&lt;</span><span class="err">/button&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">Board</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">renderSquare</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">Square</span> <span class="o">/&gt;</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">status</span> <span class="o">=</span> <span class="s1">&#39;Next player: X&#39;</span><span class="p">;</span>

    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;status&#34;</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">status</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;board-row&#34;</span><span class="o">&gt;</span>
          <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">renderSquare</span><span class="p">(</span><span class="mi">0</span><span class="p">)}</span>
          <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">renderSquare</span><span class="p">(</span><span class="mi">1</span><span class="p">)}</span>
          <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">renderSquare</span><span class="p">(</span><span class="mi">2</span><span class="p">)}</span>
        <span class="o">&lt;</span><span class="err">/div&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;board-row&#34;</span><span class="o">&gt;</span>
          <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">renderSquare</span><span class="p">(</span><span class="mi">3</span><span class="p">)}</span>
          <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">renderSquare</span><span class="p">(</span><span class="mi">4</span><span class="p">)}</span>
          <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">renderSquare</span><span class="p">(</span><span class="mi">5</span><span class="p">)}</span>
        <span class="o">&lt;</span><span class="err">/div&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;board-row&#34;</span><span class="o">&gt;</span>
          <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">renderSquare</span><span class="p">(</span><span class="mi">6</span><span class="p">)}</span>
          <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">renderSquare</span><span class="p">(</span><span class="mi">7</span><span class="p">)}</span>
          <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">renderSquare</span><span class="p">(</span><span class="mi">8</span><span class="p">)}</span>
        <span class="o">&lt;</span><span class="err">/div&gt;</span>
      <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">Game</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;game&#34;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;game-board&#34;</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">Board</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="err">/div&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;game-info&#34;</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="p">{</span><span class="cm">/* status */</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
          <span class="o">&lt;</span><span class="nx">ol</span><span class="o">&gt;</span><span class="p">{</span><span class="cm">/* TODO */</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/ol&gt;</span>
        <span class="o">&lt;</span><span class="err">/div&gt;</span>
      <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ========================================
</span><span class="c1"></span>
<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">Game</span> <span class="o">/&gt;</span><span class="p">,</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;root&#39;</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div><h3 id="動作確認">動作確認</h3>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">npm start
</code></pre></div><h2 id="react-とは">React とは？</h2>
<ul>
<li>React はユーザインターフェイスを構築するための、宣言型で効率的で柔軟な JavaScript ライブラリ</li>
<li>複雑な UI を、「コンポーネント」と呼ばれる小さく独立した部品から組み立てることができる</li>
<li>まずは React.Component サブクラスというコンポーネントをみていく</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">ShoppingList</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;shopping-list&#34;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Shopping</span> <span class="nx">List</span> <span class="k">for</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/h1&gt;</span>
        <span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span><span class="nx">Instagram</span><span class="o">&lt;</span><span class="err">/li&gt;</span>
          <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span><span class="nx">WhatsApp</span><span class="o">&lt;</span><span class="err">/li&gt;</span>
          <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span><span class="nx">Oculus</span><span class="o">&lt;</span><span class="err">/li&gt;</span>
        <span class="o">&lt;</span><span class="err">/ul&gt;</span>
      <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><ul>
<li>コンポーネントは、 React に何を描画するのか伝えるもの
<ul>
<li>データが変更されると React はコンポーネントを効率よく更新して再度レンダリングを行う</li>
</ul>
</li>
<li><code>ShoppingList</code> は React コンポーネントクラスまたは React コンポーネント型
<ul>
<li>コンポーネントは props (properties の略) を呼ばれるパラメーターを受け取り、 <code>render</code> メソッドを通して、表示するビューの階層構造を返す</li>
</ul>
</li>
<li><code>render</code> メソッドが返すのは画面上に表示するものの説明書き
<ul>
<li>React は説明書きを受け取って画面に描画する
<ul>
<li>具体的には、 <code>render</code> は、描画すべきものの軽量な記述形式である React 要素というものを返す</li>
<li>たいていの React 開発者は、これらの構造を簡単に記述できる <a href="https://ja.reactjs.org/docs/jsx-in-depth.html">JSX</a> と呼ばれる構文を使用する
<ul>
<li><code>&lt;div /&gt;</code> という構文は、ビルド時に <code>React.createElement('div')</code> に変換される</li>
<li><a href="https://ja.reactjs.org/docs/react-api.html#createelement">https://ja.reactjs.org/docs/react-api.html#createelement</a></li>
</ul>
</li>
</ul>
</li>
<li>上記の例は以下のコードと同等</li>
</ul>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">return</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;shopping-list&#39;</span><span class="p">},</span>
  <span class="nx">React</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span> <span class="cm">/* ... h1 children ... */</span><span class="p">),</span>
  <span class="nx">React</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;ul&#39;</span><span class="p">,</span> <span class="cm">/* ... ul children ... */</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div><ul>
<li>JSX では JavaScript のすべての能力を使うことができる
<ul>
<li>どのような JavaScript の式も JSX 内で中括弧に囲んで記入することができる</li>
<li>各 React 要素は、変数に格納したりプログラム内で受け渡ししたりできる JavaScript のオブジェクト</li>
</ul>
</li>
<li>上記の ShoppingList コンポーネントは <code>&lt;div /&gt;</code> や <code>&lt;li /&gt;</code> といった組み込みの DOM コンポーネントのみをレンダーしているが、自分で書いたカスタム React コンポーネントを組み合わせることも可能
<ul>
<li>例えば <code>&lt;ShoppingList /&gt;</code> と書いてショッピングリスト全体を指し示すことができる</li>
<li>それぞれの React のコンポーネントはカプセル化されており、独立して動作する</li>
<li>これにより単純なコンポーネントから複雑な UI を作成することができる</li>
</ul>
</li>
</ul>
<h2 id="スターターコードの中身を確認">スターターコードの中身を確認</h2>
<ul>
<li><code>src/index.js</code> には 3つ の React コンポーネントがある
<ol>
<li>Square: 正方形のマス <code>&lt;button&gt;</code></li>
<li>Borad: 盤面 (3x3 の Square)</li>
<li>Game: Board とゲーム情報</li>
</ol>
</li>
</ul>
<h2 id="データを-props-経由で渡す">データを Props 経由で渡す</h2>
<ul>
<li>Board の <code>renderSquare</code> メソッド内で、 props として value という名前の値を Square に渡すようにコードを変更</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">Boards</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">renderSquare</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">Square</span> <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">i</span><span class="p">}</span><span class="o">&gt;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><ul>
<li>Square の <code>render</code> メソッドで、渡された値を表示するように、<code>{/* TODO */}</code> を <code>{this.props.value}</code> に書き換える</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">Square</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;square&#34;</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">value</span><span class="p">}</span>
      <span class="o">&lt;</span><span class="err">/button&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><ul>
<li>これで親である Board コンポーネントから、子である Square コンポーネントに「props を渡す」ことができた</li>
<li>React では、親から子へと props を渡すことで、アプリ内を情報が流れていく</li>
</ul>
<p><a href="https://codepen.io/gaearon/pen/aWWQOG?editors=0010">この時点でのコード</a></p>
<h2 id="インタラクティブなコンポーネントを作る">インタラクティブなコンポーネントを作る</h2>
<ul>
<li>Square コンポーネントがクリックされたら X と表示するように実装する
<ul>
<li>アロー関数を使う場合 onClick プロパティに渡しているのは関数であることに注意
<ul>
<li>React はクリックされるまでこの関数を実行しない</li>
</ul>
</li>
<li><code>onClick={alert('click')}</code> のように書いてしまうとコンポーネントをレンダリングしなおす度に関数が呼ばれてしまう</li>
</ul>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">Square</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;square&#34;</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">)</span> <span class="p">}}</span><span class="o">&gt;</span>
      <span class="c">&lt;!--</span> <span class="nx">アロー関数を使う場合</span><span class="o">:</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">)}</span> <span class="o">--&gt;</span>

        <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">value</span><span class="p">}</span>
      <span class="o">&lt;</span><span class="err">/button&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><ul>
<li>これで Square をクリックした際にアラートが表示されるはず</li>
<li>コンポーネントに状態を持たせたい場合、 state を使う
<ul>
<li>クリックされたら X にする・・・というのが今回持たせたい状態</li>
<li><a href="https://ja.reactjs.org/docs/state-and-lifecycle.html">https://ja.reactjs.org/docs/state-and-lifecycle.html</a>
<ol>
<li>state はコンストラクタ以外では直接変更せず <code>setState</code> を使う</li>
</ol>
<ul>
<li><a href="https://ja.reactjs.org/docs/react-component.html#setstate">https://ja.reactjs.org/docs/react-component.html#setstate</a></li>
</ul>
<ol start="2">
<li>state の更新は非同期に行われる可能性がある</li>
</ol>
<ul>
<li>React はパフォーマンスのために複数の <code>setState</code> 呼び出しを一度の更新にまとめて処理する場合がある</li>
<li><code>this.props</code> と <code>this.state</code> は非同期に更新されるため state を求める際にはこれらの値に依存するべきではない
<ul>
<li>オブジェクトではなく関数を受け取る <code>setState</code> を使うと、 state を最初の引数として受け取り、更新が適用される時点での props を第2引数として受け取る</li>
</ul>
</li>
</ul>
<ol start="3">
<li>state の更新はマージされる</li>
</ol>
<ul>
<li><code>setState</code> を呼び出した場合 React は与えられたオブジェクトを現在の state にマージする</li>
<li>state に複数の値を使用している場合、複数の値を独立して更新することができる</li>
</ul>
</li>
</ul>
</li>
<li>React コンポーネントはコンストラクタで <code>this.state</code> を設定することで、状態を持つことができるようになる
<ul>
<li><code>this.state</code> は、それが定義されているコンポーネント内でプライベートと見なすべきもの</li>
<li>現在の Square の状態を <code>this.state</code> に保存して、マス目がクリックされた時にそれを変更するようにする</li>
</ul>
</li>
<li>JavaScript のクラスでは、サブクラスのコンストラクタを定義する際には常に <code>super</code> を呼ぶ必要がある
<ul>
<li><code>constructor</code> を持つ React コンポーネントでは、全てのコンストラクタを <code>super(props)</code> の呼び出しから始めるべき</li>
</ul>
</li>
</ul>
<p>クラスにコンストラクタを追加して state を初期化</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">Square</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">value</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span><span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;square&#34;</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">)}</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">value</span><span class="p">}</span>
      <span class="o">&lt;</span><span class="err">/button&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>クリックされたら state が変わるようにする</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">Square</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">value</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">render</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">button</span>
        <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;square&#34;</span>
        <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="nx">value</span><span class="o">:</span> <span class="s1">&#39;X&#39;</span><span class="p">})}</span>
      <span class="o">&gt;</span>
        <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">value</span><span class="p">}</span>
      <span class="o">&lt;</span><span class="err">/button&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><ul>
<li>Square の <code>render</code> メソッド内に書かれた <code>onClick</code> ハンドラ内で <code>this.setState</code> を呼び出すことで、 React に <code>&lt;button&gt;</code> がクリックされたら常に再レンダーするように伝えることができる</li>
<li>データ更新のあと、この Square の <code>this.state.value</code> は <code>X</code> になるので、盤面に X と表示される</li>
<li><code>setState</code> をコンポーネント内で呼び出すと React は内部の子コンポーネントも自動的に更新する</li>
</ul>
<p><a href="https://codepen.io/gaearon/pen/VbbVLg?editors=0010">この時点でのコード</a></p>
<h2 id="react-developer-tools">React Developer Tools</h2>
<ul>
<li>React 開発者向けのツールが <a href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi?hl=en">Chrome</a> と <a href="https://addons.mozilla.org/en-US/firefox/addon/react-devtools/">Firefox</a> 向けに公開されている</li>
<li>ブラウザの開発者向けツールを拡張するもので、 React コンポーネントのツリーを確認することができる</li>
</ul>
<h2 id="ゲームを完成させる">ゲームを完成させる</h2>
<ul>
<li>ここまでの作業で三目並べゲームの基本的な部品が揃った</li>
<li>完全なゲームにするためのタスクは以下
<ul>
<li>盤面に X と O を交互に置けるようにする</li>
<li>どちらのプレイヤーが勝利したのか判定できるようにする</li>
</ul>
</li>
</ul>
<h3 id="state-のリフトアップ">State のリフトアップ</h3>
<ul>
<li>現時点では、それぞれの Square コンポーネントがゲームの状態を保持している
<ul>
<li>どちらのプレイヤーが勝利したのか判定するために 9個 のマス目の値を 1箇所 で管理するようにする
<ul>
<li>Board が各 Square に、現時点の state がどうなっているのか問い合わせればよいだけ？
<ul>
<li>可能ではあるが、コードが難解になり、メンテしづらくなるので非推奨</li>
</ul>
</li>
<li>ゲームの状態を各 Square の代わりに、親となる Board コンポーネントで管理するのがベストな解決策
<ul>
<li>Board コンポーネントは、それぞれの Square に props を渡すことで、何を表示すべきかを伝えられる
<ul>
<li>Square に番号を常時させた時と同じ</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>複数の子要素からデータを集めたい、または 2つ の子コンポーネントに互いにやりとりさせたい場合、代わりに親コンポーネント内で共有の state を宣言する必要がある
<ul>
<li>親コンポーネントは props を使うことで、子に情報を返すことができる</li>
<li>これによって子コンポーネントが兄弟同士や親との間で、常に同期されるようになる</li>
</ul>
</li>
<li>state を親コンポーネントにリフトアップすることは React コンポーネントのリファクタリングでよくあること</li>
</ul>
<p>Board にコンストラクタを追加し、初期 state として 9個 のマス目に対応する 9個 の null 値をセットする</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">Board</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">squares</span><span class="o">:</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">9</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="kc">null</span><span class="p">),</span>
        <span class="p">};</span>
    <span class="p">}</span>

    <span class="nx">renderSquare</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">&lt;</span><span class="nx">Square</span> <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">i</span><span class="p">}</span> <span class="o">/&gt;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">...</span>
</code></pre></div><ul>
<li><code>renderSquare</code> が <code>i</code> を使ってマス目を表示していたが、 X マークを表示するようにしたので、 Board から渡されている <code>value</code> プロパティの値は、現状無視されている</li>
<li>props を渡すメカニズムを使う
<ul>
<li>Board を書き換えて、それぞれの個別の Square に現在の値 (X, O, null) を伝えるようにする</li>
<li><code>squares</code> 配列は Board コンストラクタで定義しているので Board の <code>renderSquare</code> が値を読み込むように書き換える</li>
<li><code>fill</code> メソッド
<ul>
<li><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Array/fill">https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Array/fill</a></li>
<li>配列に対して値を設定するメソッド</li>
<li><code>Array(9).fill(null)</code> は 9つの要素 を持つ配列を作成して、それぞれに null を設定するという意味</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><a href="https://codepen.io/gaearon/pen/gWWQPY?editors=0010">この時点でのコード</a></p>
<ul>
<li>マス目がクリックされたときの挙動を変更する
<ul>
<li>現状、どのマス目に何が入っているのかを管理しているのは Board</li>
<li>Square が Board の state を更新できるようにする必要がある</li>
<li>state は、それを定義しているコンポーネント内でプライベートなものなので、 Square から Board の state を直接書き換えることはできない</li>
<li>Board から Square に関数を渡すことにして、マス目がクリックされた時に Square にその関数を呼んでもらうようにする</li>
</ul>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js">    <span class="nx">renderSquare</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="o">&lt;</span><span class="nx">Square</span> 
                <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">squares</span><span class="p">[</span><span class="nx">i</span><span class="p">]}</span>
                <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleClick</span><span class="p">(</span><span class="nx">i</span><span class="p">)}</span>
            <span class="o">/&gt;</span>
        <span class="p">);</span>
    <span class="p">}</span>
</code></pre></div><ul>
<li>現状 Board から Square には props として 2つ の値を渡している
<ol>
<li>value</li>
<li>onClick</li>
</ol>
<ul>
<li>マス目がクリックされた時に Square が呼び出すためのもの</li>
<li>以下のような実装をしていく
<ul>
<li>Square の <code>render</code> メソッド内の <code>this.state.value</code> を <code>this.props.value</code> に書き換える</li>
<li>Square の <code>render</code> メソッド内の <code>this.setState()</code> を <code>this.props.onClick()</code> に書き換える</li>
<li>Square は、ゲームの状態を管理しないので <code>constuctor</code> を削除</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">Square</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
    <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="o">&lt;</span><span class="nx">button</span> 
                <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;square&#34;</span> 
                <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">onClick</span><span class="p">()}</span>
            <span class="o">&gt;</span>
                <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">value</span><span class="p">}</span>
            <span class="o">&lt;</span><span class="err">/button&gt;</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><ul>
<li>Square がクリックされると Board から渡された <code>onClick</code> 関数がコールされる</li>
<li>流れのおさらい
<ol>
<li>組み込みの DOM コンポーネントである <code>&lt;button&gt;</code> に <code>onClick</code> プロパティが設定されているため、 React がクリックに対するイベントリスナーを設定</li>
</ol>
<ul>
<li>DOM 要素である <code>&lt;button&gt;</code> は組み込みコンポーネントなので <code>onClick</code> 属性は React にとって特別な意味を持っている</li>
<li>Square のようなカスタムコンポーネントでは、名前の付け方は開発者が自由に決めれる</li>
<li>Square の <code>onClick</code> プロパティや Board の <code>handleClick</code> メソッドについては別名を付けたとしても同じように動作する</li>
<li>React の慣習
<ul>
<li>イベントを表す props には <code>on[Event]</code> という名前</li>
<li>イベントを処理するメソッドには <code>handle[Event]</code> という名前</li>
</ul>
</li>
</ul>
<ol start="2">
<li>ボタンがクリックされると React は Square の <code>render()</code> メソッド内に定義されている <code>onClick</code> イベントハンドラをコール</li>
<li>このイベントハンドラが <code>this.props.onClick()</code> をコール</li>
</ol>
<ul>
<li>Square の <code>onClick</code> プロパティは Board から渡されているもの</li>
</ul>
<ol start="4">
<li>Board は Square に <code>onClick={() =&gt; this.handleClick(i)}</code> を渡していたので Square はクリックされた時に <code>this.handleClick(i)</code> を呼び出す</li>
<li>まだ <code>handleClick()</code> を定義していないので、コードがクラッシュする</li>
</ol>
<ul>
<li>Square をクリックすると &ldquo;this.handleClick is not a function&rdquo; といったエラー画面が表示されるハズ</li>
</ul>
</li>
</ul>
<p><code>handleClick</code> を Board クラスに実装する</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">Board</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">squares</span><span class="o">:</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">9</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="kc">null</span><span class="p">),</span>
        <span class="p">};</span>
    <span class="p">}</span>

    <span class="nx">handleClick</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">squares</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">squares</span><span class="p">.</span><span class="nx">slice</span><span class="p">();</span>
        <span class="nx">squares</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;X&#39;</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="nx">squares</span><span class="o">:</span> <span class="nx">squares</span> <span class="p">});</span>
    <span class="p">}</span>

    <span class="nx">renderSquare</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="o">&lt;</span><span class="nx">Square</span> 
                <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">squares</span><span class="p">[</span><span class="nx">i</span><span class="p">]}</span>
                <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleClick</span><span class="p">(</span><span class="nx">i</span><span class="p">)}</span>
            <span class="o">/&gt;</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">...</span>
</code></pre></div><p><a href="https://codepen.io/gaearon/pen/ybbQJX?editors=0010">この時点でのコード</a></p>
<ul>
<li>再びマス目をクリックすることで値が書き込めるようになった
<ul>
<li>状態は個々の Square コンポーネントではなく Board コンポーネント内に保存されている</li>
<li>Board の state が変更になると、個々の Square コンポーネントも自動的に再レンダーされる</li>
<li>全てのマス目の状態を Board コンポーネント内で保持するようにしたことで、この後で勝利者を判定する処理をシンプルに実装できる</li>
</ul>
</li>
<li>Square コンポーネントは自分で state を管理しないので Board コンポーネントから値を受け取って、クリックされた時にはクリックされた事を Board コンポーネントに伝えるだけの存在になった
<ul>
<li>React 用語で表現すると Square コンポーネントは 制御されたコンポーネント (controlled component) になった</li>
</ul>
</li>
<li><code>handleClick</code> 内では <code>squares</code> を直接変更する代わりに <code>slice()</code> を呼び出して配列のコピーを作成している
<ul>
<li><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Array/slice">https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Array/slice</a></li>
</ul>
</li>
</ul>
<h3 id="イミュータビリティは何故重要">イミュータビリティは何故重要？</h3>
<ul>
<li><code>slice()</code> メソッドで <code>squares</code> 配列のコピーを作成し、それを変更する実装とした
<ul>
<li>immutability と重要性について解説</li>
</ul>
</li>
<li>一般的に、変化するデータに対しては 2種類 のアプローチがある
<ol>
<li>データの値を直接操作する mutate</li>
<li>望む変更を加えた新しいデータのコピーで古いデータを置き換える</li>
</ol>
</li>
<li>最終的な結果は同じだが、直接データの mutate をしないことで、以下のメリットが有る
<ul>
<li>複雑な機能が簡単に実装できる
<ul>
<li>ヒストリを保って再利用するとか</li>
</ul>
</li>
<li>変更の検出
<ul>
<li>参照しているイミュータブルオブジェクトが前と別のものであれば変更があったと判定できる</li>
</ul>
</li>
<li>React の再レンダータイミングの決定
<ul>
<li>React で pure component を構築しやすくなる</li>
<li>イミュータブルなデータは変更があったかどうか簡単に分かるため、コンポーネントをいつ再レンダーすべきなのか決定しやすくなる</li>
<li><a href="https://ja.reactjs.org/docs/optimizing-performance.html#examples">shouldComponentUpdate() および pure component をどのように作成するのかについて</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="関数コンポーネント">関数コンポーネント</h3>
<ul>
<li>Square を関数コンポーネントに書き換える</li>
<li>関数コンポーネント
<ul>
<li><code>render</code> メソッドだけを有して自分の state を持たないコンポーネントを、よりシンプルに書くための方法</li>
<li><code>React.Component</code> を継承するクラスを定義する代わりに <code>props</code> を入力として受け取り、表示すべき内容を返す関数を定義する</li>
</ul>
</li>
<li>関数コンポーネントはクラスよりも書くのが楽
<ul>
<li>多くのコンポーネントは関数コンポーネントで書くことができる</li>
</ul>
</li>
<li><code>onClick={() =&gt; this.props.onClick()}</code> をより短い <code>onClick={props.onClick}</code> に書き換える</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">Square</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;square&#34;</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">onClick</span><span class="p">}</span><span class="o">&gt;</span>
            <span class="p">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">value</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="err">/button&gt;</span>
    <span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p><a href="https://codepen.io/gaearon/pen/QvvJOv?editors=0010">この時点でのコード</a></p>
<h3 id="手番の処理">手番の処理</h3>
<ul>
<li>クリックでの書き換えを交互に X と O で切り替えるよう実装していく</li>
<li>デフォルトで先手を X にする
<ul>
<li>Board のコンストラクタで state の初期値を変えれば OK</li>
</ul>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">Board</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">squares</span><span class="o">:</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">9</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="kc">null</span><span class="p">),</span>
            <span class="nx">xIsNext</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="p">};</span>
    <span class="p">}</span>
<span class="p">...</span>
</code></pre></div><ul>
<li>プレイヤーが着手する度に、どちらのプレイヤーの手番なのか決める <code>xIsNext</code> が反転され、ゲームの状態が保存されるようにする</li>
<li>Board の <code>handleClick</code> 関数を書き換えて <code>xIsNext</code> の値を反転させるようにする</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js">    <span class="nx">handleClick</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">squares</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">squares</span><span class="p">.</span><span class="nx">slice</span><span class="p">();</span>
        <span class="nx">squares</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">xIsNext</span> <span class="o">?</span> <span class="s1">&#39;X&#39;</span> <span class="o">:</span> <span class="s1">&#39;O&#39;</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
            <span class="nx">squares</span><span class="o">:</span> <span class="nx">squares</span><span class="p">,</span>
            <span class="nx">xIsNext</span><span class="o">:</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">xIsNext</span><span class="p">,</span>
        <span class="p">});</span>
    <span class="p">}</span>
</code></pre></div><ul>
<li>この変更により X と O が交互に着手できるようになる</li>
<li>Board の <code>render</code> 内にある status も変更して、どちらのプレイヤーの手番なのか表示するように修正する</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js">    <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">status</span> <span class="o">=</span> <span class="s1">&#39;Next player: &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">xIsNext</span> <span class="o">?</span> <span class="s1">&#39;X&#39;</span> <span class="o">:</span> <span class="s1">&#39;O&#39;</span><span class="p">);</span>
<span class="p">...</span>
</code></pre></div><p><a href="https://codepen.io/gaearon/pen/KmmrBy?editors=0010">この時点でのコード</a></p>
<h3 id="ゲーム勝者の判定">ゲーム勝者の判定</h3>
<ul>
<li>ゲームが決着して次の手番がなくなった時に、それを表示する</li>
<li>ヘルパー関数を追加</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">calculateWinner</span><span class="p">(</span><span class="nx">squares</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">lines</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
    <span class="p">];</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">lines</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="p">[</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">]</span> <span class="o">=</span> <span class="nx">lines</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">squares</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">squares</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span> <span class="o">===</span> <span class="nx">squares</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">squares</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span> <span class="o">===</span> <span class="nx">squares</span><span class="p">[</span><span class="nx">c</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">squares</span><span class="p">[</span><span class="nx">a</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><ul>
<li><code>calculateWinner</code> は 9つ の square 配列が与えられると、勝者を判断し X or O or null を返す</li>
<li>Board の <code>render</code> 関数内で <code>calculateWinner(squares)</code> を呼び出して、どのプレイヤーが勝利したか判定する
<ul>
<li>決着が着いた場合は <code>Winner: X</code> or <code>Winner: O</code> のようなテキストを表示する</li>
<li>Borad の <code>render</code> 関数の <code>status</code> 宣言を書き換える</li>
</ul>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js">    <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">winner</span> <span class="o">=</span> <span class="nx">calculateWinner</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">squares</span><span class="p">);</span>
        <span class="kd">let</span> <span class="nx">status</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">winner</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">status</span> <span class="o">=</span> <span class="s1">&#39;Winner: &#39;</span> <span class="o">+</span> <span class="nx">winner</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">status</span> <span class="o">=</span> <span class="s1">&#39;Next player: &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">xIsNext</span> <span class="o">?</span> <span class="s1">&#39;X&#39;</span> <span class="o">:</span> <span class="s1">&#39;O&#39;</span><span class="p">);</span>
        <span class="p">}</span>
<span class="p">...</span>
</code></pre></div><ul>
<li>Board の <code>handleClick</code> を書き換えて、ゲームの決着が既についている場合や、クリックされたマス目が既に埋まっている場合には早期に return するようにする</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js">    <span class="nx">handleClick</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">squares</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">squares</span><span class="p">.</span><span class="nx">slice</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">calculateWinner</span><span class="p">(</span><span class="nx">squares</span><span class="p">)</span> <span class="o">||</span> <span class="nx">squares</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">squares</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">xIsNext</span> <span class="o">?</span> <span class="s1">&#39;X&#39;</span> <span class="o">:</span> <span class="s1">&#39;O&#39;</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
            <span class="nx">squares</span><span class="o">:</span> <span class="nx">squares</span><span class="p">,</span>
            <span class="nx">xIsNext</span><span class="o">:</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">xIsNext</span><span class="p">,</span>
        <span class="p">});</span>
    <span class="p">}</span>
</code></pre></div><p><a href="https://codepen.io/gaearon/pen/LyyXgK?editors=0010">この時点でのコード</a></p>
<h2 id="タイムトラベル機能の追加">タイムトラベル機能の追加</h2>
<ul>
<li>以前の着手まで時間を巻き戻すことができるようにする</li>
</ul>
<h3 id="着手履歴の保存">着手履歴の保存</h3>
<ul>
<li><code>squares</code> 配列をミューテートしていたら、タイムトラベルの実装は困難</li>
<li>しかし、着手がある度に <code>squares</code> のコピーを作り、この配列をイミュータブルなものとして扱う実装をしてきた
<ul>
<li><code>squares</code> の過去バージョンを全て保存しておいて、過去の手番を遡ることができるようになる</li>
</ul>
</li>
<li>過去の <code>squares</code> 配列を <code>history</code> という名前で別配列に保存する
<ul>
<li>この <code>history</code> 配列は初手から最後までの盤面の全ての状態を表現</li>
<li>以下のような構造</li>
</ul>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">history</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1">// Before first move
</span><span class="c1"></span>    <span class="p">{</span>
        <span class="nx">squares</span><span class="o">:</span> <span class="p">[</span>
            <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span>
            <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span>
            <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="c1">// After first move
</span><span class="c1"></span>    <span class="p">{</span>
        <span class="nx">squares</span><span class="o">:</span> <span class="p">[</span>
            <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span>
            <span class="kc">null</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span>
            <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="c1">// After second move
</span><span class="c1"></span>    <span class="p">{</span>
        <span class="nx">squares</span><span class="o">:</span> <span class="p">[</span>
            <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span>
            <span class="kc">null</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span>
            <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="c1">// ...
</span><span class="c1"></span><span class="p">]</span>
</code></pre></div><ul>
<li>この <code>history</code> の状態は、どのコンポーネントが保持するべきか？</li>
</ul>
<h3 id="state-のリフトアップ再び">State のリフトアップ、再び</h3>
<ul>
<li>トップレベルの Game コンポーネント内で、過去の着手履歴を表示する
<ul>
<li>そのため Game コンポーネントが <code>history</code> にアクセスできる必要があるので <code>history</code> という state は Game コンポーネントに置く</li>
</ul>
</li>
<li><code>history</code> state を Game コンポーネント内に置くことで <code>squares</code> の state を、子である Board コンポーネントから取り除くことができる
<ul>
<li>Square コンポーネントにあった state をリフトアップして Board コンポーネントに移動した時と同様に、今度は Board にある state を Game コンポーネントにリフトアップする</li>
<li>これにより Game コンポーネントは Board のデータを完全に制御することになり <code>history</code> 内の過去の手番データを Board にレンダーさせることができるようになる</li>
</ul>
</li>
<li>Game コンポーネントの初期 state をコンストラクタ内でセットする</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">Game</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">history</span><span class="o">:</span> <span class="p">[{</span>
                <span class="nx">squares</span><span class="o">:</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">9</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="kc">null</span><span class="p">),</span>
            <span class="p">}],</span>
            <span class="nx">xIsNext</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="p">};</span>
    <span class="p">}</span>
<span class="p">...</span>
</code></pre></div><ul>
<li>次に Board コンポーネントが <code>squares</code> と <code>onClick</code> プロパティを Game コンポーネントから受け取るようにする
<ul>
<li>Board 内には多数のマス目に対応するクリックハンドラが 1つ だけあるので Square の位置を <code>onClick</code> ハンドラに渡して、どのマス目がクリックされたのかを伝えるようにする</li>
<li>以下の手順で Board コンポーネントを書き換える
<ol>
<li>Board の <code>constructor</code> を削除</li>
<li>Board の <code>renderSquare</code> にある <code>this.state.squares[i]</code> を <code>this.props.squares[i]</code> に置き換える</li>
<li>Board の <code>renderSquare</code> にある <code>this.handleClick(i)</code> を <code>this.props.onClick(i)</code> に置き換える</li>
</ol>
</li>
</ul>
</li>
<li>Board コンポーネントは以下のようになる</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">Board</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
    <span class="nx">handleClick</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">squares</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">squares</span><span class="p">.</span><span class="nx">slice</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">calculateWinner</span><span class="p">(</span><span class="nx">squares</span><span class="p">)</span> <span class="o">||</span> <span class="nx">squares</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">squares</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">xIsNext</span> <span class="o">?</span> <span class="s1">&#39;X&#39;</span> <span class="o">:</span> <span class="s1">&#39;O&#39;</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
            <span class="nx">squares</span><span class="o">:</span> <span class="nx">squares</span><span class="p">,</span>
            <span class="nx">xIsNext</span><span class="o">:</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">xIsNext</span><span class="p">,</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="nx">renderSquare</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="o">&lt;</span><span class="nx">Square</span> 
                <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">squares</span><span class="p">[</span><span class="nx">i</span><span class="p">]}</span>
                <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">onClick</span><span class="p">(</span><span class="nx">i</span><span class="p">)}</span>
            <span class="o">/&gt;</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">...</span>
</code></pre></div><ul>
<li>Game コンポーネントの render 関数を更新して、ゲームのステータステキストの決定や、表示の際に最新の履歴が使われるようにする</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">Game</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">history</span><span class="o">:</span> <span class="p">[{</span>
                <span class="nx">squares</span><span class="o">:</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">9</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="kc">null</span><span class="p">),</span>
            <span class="p">}],</span>
            <span class="nx">xIsNext</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="p">};</span>
    <span class="p">}</span>

    <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">history</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">history</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">history</span><span class="p">[</span><span class="nx">history</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
        <span class="kr">const</span> <span class="nx">winner</span> <span class="o">=</span> <span class="nx">calculateWinner</span><span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">squares</span><span class="p">);</span>
        <span class="kd">let</span> <span class="nx">status</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">winner</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">status</span> <span class="o">=</span> <span class="s1">&#39;Winner: &#39;</span> <span class="o">+</span> <span class="nx">winner</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">status</span> <span class="o">=</span> <span class="s1">&#39;Next player: &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">xIsNext</span> <span class="o">?</span> <span class="s1">&#39;X&#39;</span> <span class="o">:</span> <span class="s1">&#39;O&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;game&#34;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;game-board&#34;</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">Board</span>
                        <span class="nx">squares</span><span class="o">=</span><span class="p">{</span><span class="nx">current</span><span class="p">.</span><span class="nx">squares</span><span class="p">}</span>
                        <span class="nx">onClick</span><span class="o">=</span><span class="p">{(</span><span class="nx">i</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleClick</span><span class="p">(</span><span class="nx">i</span><span class="p">)}</span>
                    <span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="err">/div&gt;</span>
            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;game-info&#34;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">status</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
                <span class="o">&lt;</span><span class="nx">ol</span><span class="o">&gt;</span><span class="p">{</span><span class="cm">/* TODO */</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/ol&gt;</span>
            <span class="o">&lt;</span><span class="err">/div&gt;</span>
            <span class="o">&lt;</span><span class="err">/div&gt;</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><ul>
<li>Game コンポーネントがゲームのステータステキストを表示するようになったので、対応するコードは Board 内 <code>render</code> メソッドから削除できる</li>
<li>このリファクタリングの後で、 Board の <code>render</code> メソッドは以下のようになる</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js">    <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;board-row&#34;</span><span class="o">&gt;</span>
                    <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">renderSquare</span><span class="p">(</span><span class="mi">0</span><span class="p">)}</span>
                    <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">renderSquare</span><span class="p">(</span><span class="mi">1</span><span class="p">)}</span>
                    <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">renderSquare</span><span class="p">(</span><span class="mi">2</span><span class="p">)}</span>
                <span class="o">&lt;</span><span class="err">/div&gt;</span>
                <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;board-row&#34;</span><span class="o">&gt;</span>
                    <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">renderSquare</span><span class="p">(</span><span class="mi">3</span><span class="p">)}</span>
                    <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">renderSquare</span><span class="p">(</span><span class="mi">4</span><span class="p">)}</span>
                    <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">renderSquare</span><span class="p">(</span><span class="mi">5</span><span class="p">)}</span>
                <span class="o">&lt;</span><span class="err">/div&gt;</span>
                <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;board-row&#34;</span><span class="o">&gt;</span>
                    <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">renderSquare</span><span class="p">(</span><span class="mi">6</span><span class="p">)}</span>
                    <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">renderSquare</span><span class="p">(</span><span class="mi">7</span><span class="p">)}</span>
                    <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">renderSquare</span><span class="p">(</span><span class="mi">8</span><span class="p">)}</span>
                <span class="o">&lt;</span><span class="err">/div&gt;</span>
            <span class="o">&lt;</span><span class="err">/div&gt;</span>
        <span class="p">);</span>
    <span class="p">}</span>
</code></pre></div><ul>
<li>最後に <code>handleClick</code> メソッドを Board コンポーネントから Game コンポーネントに移動する
<ul>
<li>Game コンポーネントの state は異なる形で構成されているので、 <code>handleClick</code> の中身も修正する</li>
<li>Game 内の <code>handleClick</code> メソッドで新しい履歴エントリを <code>history</code> に追加する</li>
</ul>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js">    <span class="nx">handleClick</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">history</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">history</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">history</span><span class="p">[</span><span class="nx">history</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
        <span class="kr">const</span> <span class="nx">squares</span> <span class="o">=</span> <span class="nx">current</span><span class="p">.</span><span class="nx">squares</span><span class="p">.</span><span class="nx">slice</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">calculateWinner</span><span class="p">(</span><span class="nx">squares</span><span class="p">)</span> <span class="o">||</span> <span class="nx">squares</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">squares</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">xIsNext</span> <span class="o">?</span> <span class="s1">&#39;X&#39;</span> <span class="o">:</span> <span class="s1">&#39;O&#39;</span><span class="p">;</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
            <span class="nx">history</span><span class="o">:</span> <span class="nx">history</span><span class="p">.</span><span class="nx">concat</span><span class="p">([{</span>
                <span class="nx">squares</span><span class="o">:</span> <span class="nx">squares</span><span class="p">,</span>
            <span class="p">}]),</span>
            <span class="nx">xIsNext</span><span class="o">:</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">xIsNext</span><span class="p">,</span>
        <span class="p">});</span>
    <span class="p">}</span>
</code></pre></div><ul>
<li><code>push()</code> とは異なり <code>concat()</code> は元の配列をミューテートしないため、こちらを利用する
<ul>
<li><code>Array.prototype.concat()</code>
<ul>
<li><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Array/concat">https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Array/concat</a></li>
<li>2つ 以上の配列を結合して、新しい配列を返すメソッド</li>
</ul>
</li>
<li><code>Array.prototype.push()</code>
<ul>
<li><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Array/push">https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Array/push</a></li>
<li>配列の末尾に 1つ 以上の要素を追加し、新しい配列の要素数を返すメソッド</li>
</ul>
</li>
</ul>
</li>
<li>Board コンポーネントに必要なのは <code>renderSquare</code> と <code>render</code> メソッドだけ
<ul>
<li>ゲームの状態と <code>handleClick</code> は Game コンポーネントで管理</li>
</ul>
</li>
</ul>
<p><a href="https://codepen.io/gaearon/pen/EmmOqJ?editors=0010">この時点でのコード</a></p>
<h3 id="過去の着手を表示">過去の着手を表示</h3>
<ul>
<li>三目並べの履歴を記録しているので、これを過去の着手リストとしてプレイヤーに表示することが可能</li>
<li>React 要素は第一級 JavaScript オブジェクトであり、それらをアプリケーション内で受け渡しできる
<ul>
<li>React で複数の要素を描画するには React 要素の配列を使うことができる</li>
</ul>
</li>
<li>JavaScript では配列に <code>map()</code> メソッドが存在しており、これはデータを別のデータにマップするのによく使われる
<ul>
<li><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Array/map">https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Array/map</a></li>
<li>与えられた関数を配列の全要素に対して呼び出して、その結果となる新しい配列を生成する</li>
</ul>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">];</span>
<span class="kr">const</span> <span class="nx">doubled</span> <span class="o">=</span> <span class="nx">numbers</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="p">=&gt;</span> <span class="nx">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">// [2, 4, 6]
</span></code></pre></div><ul>
<li><code>map()</code> を使うことで、着手履歴の配列をマップして画面上のボタンを表現する React 要素を作り出し、過去の手番にジャンプするためのボタンの一覧を表示できる</li>
<li>Game の <code>render</code> メソッド内で <code>history</code> に <code>map()</code> を使う</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js">    <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">history</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">history</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">history</span><span class="p">[</span><span class="nx">history</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
        <span class="kr">const</span> <span class="nx">winner</span> <span class="o">=</span> <span class="nx">calculateWinner</span><span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">squares</span><span class="p">);</span>

        <span class="kr">const</span> <span class="nx">moves</span> <span class="o">=</span> <span class="nx">history</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">step</span><span class="p">,</span> <span class="nx">move</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="kr">const</span> <span class="nx">desc</span> <span class="o">=</span> <span class="nx">move</span> <span class="o">?</span>
                <span class="s1">&#39;Go to move #&#39;</span> <span class="o">+</span> <span class="nx">move</span> <span class="o">:</span>
                <span class="s1">&#39;Go to game start&#39;</span><span class="p">;</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">jumpTo</span><span class="p">(</span><span class="nx">move</span><span class="p">)}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">desc</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/button&gt;</span>
                <span class="o">&lt;</span><span class="err">/li&gt;</span>
            <span class="p">);</span>
        <span class="p">});</span>

        <span class="kd">let</span> <span class="nx">status</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">winner</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">status</span> <span class="o">=</span> <span class="s1">&#39;Winner: &#39;</span> <span class="o">+</span> <span class="nx">winner</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">status</span> <span class="o">=</span> <span class="s1">&#39;Next player: &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">xIsNext</span> <span class="o">?</span> <span class="s1">&#39;X&#39;</span> <span class="o">:</span> <span class="s1">&#39;O&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;game&#34;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;game-board&#34;</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">Board</span>
                        <span class="nx">squares</span><span class="o">=</span><span class="p">{</span><span class="nx">current</span><span class="p">.</span><span class="nx">squares</span><span class="p">}</span>
                        <span class="nx">onClick</span><span class="o">=</span><span class="p">{(</span><span class="nx">i</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleClick</span><span class="p">(</span><span class="nx">i</span><span class="p">)}</span>
                    <span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="err">/div&gt;</span>
            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&#34;game-info&#34;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">status</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
                <span class="o">&lt;</span><span class="nx">ol</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">moves</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/ol&gt;</span>
            <span class="o">&lt;</span><span class="err">/div&gt;</span>
            <span class="o">&lt;</span><span class="err">/div&gt;</span>
        <span class="p">);</span>
    <span class="p">}</span>
</code></pre></div><p><a href="https://codepen.io/gaearon/pen/EmmGEa?editors=0010">この時点でのコード</a></p>
<ul>
<li>ゲーム履歴内にある三目並べの、それぞれの着手に対応して、ボタンを有するリストアイテムを作成
<ul>
<li>ボタンには <code>onClick</code> ハンドラがあり、それは <code>this.jumpTo()</code> メソッドを呼び出す</li>
<li><code>jumpTo()</code> は未だ実装していない</li>
</ul>
</li>
<li>ひとまず、このコードにより、ゲーム内で行われた着手のリストが表示されるようになったが、コンソールに以下の警告が表示されるようになった</li>
</ul>
<pre><code>Warning: Each child in an array or iterator should have a unique “key” prop. Check the render method of “Game”.
</code></pre><ul>
<li>この警告について対策していく</li>
</ul>
<h3 id="key-を選ぶ">key を選ぶ</h3>
<ul>
<li>リストをレンダーする際、リストの項目それぞれについて、 React はとある情報を保持する
<ul>
<li>リストが変更になった場合 React は、どのアイテムが変更になったのかを知る必要がある</li>
<li>リストのアイテムは追加された可能性も、削除された可能性も、並び替えられた可能性も、中身自体が変更になった可能性もある</li>
</ul>
</li>
</ul>
<p>以下のリストが</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Alexa: 7 tasks left<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Ben: 5 tasks left<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
</code></pre></div><p>以下のリストに遷移する場合を考える</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Ben: 9 tasks left<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Claudia: 8 tasks left<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Alexa: 5 tasks left<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
</code></pre></div><ul>
<li>タスクの数も変化しているが、人間が見た場合 Alexa と Ben の順番が変わって、その間に Claudia が追加されていると考える</li>
<li>React はリストの項目それぞれに対して key プロパティを与えることで、兄弟要素の中で、そのアイテムが区別できるようにする必要がある</li>
<li>このケースでは <code>alexa</code>, <code>ben</code>, <code>claudia</code> の文字列を使う方法がある
<ul>
<li>データベースからのデータを表示している場合は、データベースで使用しているそれぞれの項目の ID を Key として使うこともできる</li>
</ul>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="o">&lt;</span><span class="nx">li</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">:</span> <span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">taskCount</span><span class="p">}</span> <span class="nx">tasks</span> <span class="nx">left</span><span class="o">&lt;</span><span class="err">/li&gt;</span>
</code></pre></div><ul>
<li>リストが再レンダーされる際 React はそれぞれのリスト項目の key について、前回のリスト項目内に同じ key を持つものがないか探す
<ul>
<li>もし、以前になかった key がリストに含まれていれば React はコンポーネントを作成する</li>
<li>もし、以前のリストにあった key が新しいリストに含まれていなければ React はコンポーネントを破棄する</li>
<li>もし、 2つ の key がマッチした場合、対応するコンポーネントは移動される</li>
</ul>
</li>
<li>key はそれぞれのコンポーネントの同一性に関する情報を React に与え、それにより React は再レンダー間で state を保持できるようになる
<ul>
<li>もしコンポーネントの key が変化していれば、コンポーネントは破棄されて新しい state で再作成される</li>
</ul>
</li>
<li><code>key</code> は特別なプロパティであり React によって予約されている
<ul>
<li>より応用的な機能である <code>ref</code> も同様</li>
<li>要素が作成される際 React は <code>key</code> プロパティを引き抜いて、返される要素に直接その <code>key</code> を格納する</li>
<li><code>key</code> は <code>props</code> の一部のようにも思えるが <code>this.props.key</code> で参照できない</li>
<li>React は、どの子要素を更新すべきかを決定する際に <code>key</code> を自動的に使用する</li>
<li>コンポーネントが自身の <code>key</code> について確認する方法はない</li>
</ul>
</li>
<li>動的なリストを構築する場合は、正しい key を割り当てることが強く推奨される
<ul>
<li>適切な key が無い場合、データ構造を再構成して、そのような key が存在するようにするべきかも</li>
</ul>
</li>
<li>key が指定されなかった場合 React は警告を表示し、デフォルトで key として配列のインデックスを使用する
<ul>
<li>配列のインデックスを key として使うことは、項目を並べ替えたり挿入・削除する際に問題の原因となる</li>
<li>明示的に <code>key={i}</code> と渡すことで警告を消すことはできるが、配列のインデックスを使う場合と同様な問題が生じるため、殆どの場合は非推奨</li>
</ul>
</li>
<li>key はグローバルに一意である必要は無い
<ul>
<li>コンポーネントと、その兄弟の間で一意であれば十分</li>
</ul>
</li>
</ul>
<h3 id="タイムトラベルの実装">タイムトラベルの実装</h3>
<ul>
<li>三目並べゲームの履歴内においては、全ての着手には、それに関連付けられた一意な ID が存在する
<ul>
<li>着手順の連番数字</li>
</ul>
</li>
<li>着手はゲームの最中に並びがかわったり、削除されたり、挿入されたりすることは無いので、着手のインデックスを key として使うのは安全</li>
<li>Game コンポーネントの <code>render</code> メソッド内で key は <code>&lt;li key={move}&gt;</code> のようにして加えることができ、これで React の key に関する警告は表示されなくなる</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js">        <span class="kr">const</span> <span class="nx">moves</span> <span class="o">=</span> <span class="nx">history</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">step</span><span class="p">,</span> <span class="nx">move</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="kr">const</span> <span class="nx">desc</span> <span class="o">=</span> <span class="nx">move</span> <span class="o">?</span>
                <span class="s1">&#39;Go to move #&#39;</span> <span class="o">+</span> <span class="nx">move</span> <span class="o">:</span>
                <span class="s1">&#39;Go to game start&#39;</span><span class="p">;</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">move</span><span class="p">}</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">jumpTo</span><span class="p">(</span><span class="nx">move</span><span class="p">)}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">desc</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/button&gt;</span>
                <span class="o">&lt;</span><span class="err">/li&gt;</span>
            <span class="p">);</span>
        <span class="p">});</span>
</code></pre></div><p><a href="https://codepen.io/gaearon/pen/PmmXRE?editors=0010">この時点でのコード</a></p>
<ul>
<li>まだ <code>jumpTo</code> メソッドが未定義なので、このリスト項目内のボタンをクリックするとエラーが発生する
<ul>
<li><code>jumpTo</code> を実装する前に Game コンポーネントの state に stepNumber という値を加える</li>
<li>これは、いま何手目の状態を見ているのかを表すのに使う</li>
</ul>
</li>
<li>Game の <code>constructor</code> 内で state の初期値として <code>stepNumber: 0</code> を加える</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">Game</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">history</span><span class="o">:</span> <span class="p">[{</span>
                <span class="nx">squares</span><span class="o">:</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">9</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="kc">null</span><span class="p">),</span>
            <span class="p">}],</span>
            <span class="nx">stepNumber</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nx">xIsNext</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="p">};</span>
    <span class="p">}</span>
<span class="p">...</span>
</code></pre></div><ul>
<li>次に Game 内に <code>jumpTo</code> メソッドを定義してその <code>stepNumber</code> が更新されるようにする</li>
<li>また、更新しようとしている <code>stepNumber</code> の値が偶数だった場合は <code>xIsNext</code> を true に設定する</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js">    <span class="nx">jumpTo</span><span class="p">(</span><span class="nx">step</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
            <span class="nx">stepNumber</span><span class="o">:</span> <span class="nx">step</span><span class="p">,</span>
            <span class="nx">xIsNext</span><span class="o">:</span> <span class="p">(</span><span class="nx">step</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">});</span>
    <span class="p">}</span>
</code></pre></div><ul>
<li>マス目をクリックしたときに実行される Game の <code>handleClick</code> メソッドに、いくつか変更を加える</li>
<li>今加えた state である <code>stepNumber</code> は、現在ユーザーに見せている着手を反映している
<ul>
<li>新しい着手が発生した場合は <code>this.setState</code> の引数の一部として <code>stepNumber: history.length</code> を加えることで <code>stepNumber</code> を更新する必要がある</li>
</ul>
</li>
<li><code>this.state.history</code> から読み取っているところを <code>this.state.history.slice(0, this.state.stepNumber + 1)</code> に書き換える
<ul>
<li>これにより、時間の巻き戻しをしてから、その時点で新しい着手を起こした場合に、そこから見て将来にある履歴を確実に捨て去ることができる</li>
</ul>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js">    <span class="nx">handleClick</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">history</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">stepNumber</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="kr">const</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">history</span><span class="p">[</span><span class="nx">history</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
        <span class="kr">const</span> <span class="nx">squares</span> <span class="o">=</span> <span class="nx">current</span><span class="p">.</span><span class="nx">squares</span><span class="p">.</span><span class="nx">slice</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">calculateWinner</span><span class="p">(</span><span class="nx">squares</span><span class="p">)</span> <span class="o">||</span> <span class="nx">squares</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">squares</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">xIsNext</span> <span class="o">?</span> <span class="s1">&#39;X&#39;</span> <span class="o">:</span> <span class="s1">&#39;O&#39;</span><span class="p">;</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
            <span class="nx">history</span><span class="o">:</span> <span class="nx">history</span><span class="p">.</span><span class="nx">concat</span><span class="p">([{</span>
                <span class="nx">squares</span><span class="o">:</span> <span class="nx">squares</span><span class="p">,</span>
            <span class="p">}]),</span>
            <span class="nx">stepNumber</span><span class="o">:</span> <span class="nx">history</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
            <span class="nx">xIsNext</span><span class="o">:</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">xIsNext</span><span class="p">,</span>
        <span class="p">});</span>
    <span class="p">}</span>
</code></pre></div><ul>
<li>Game コンポーネントの <code>render</code> を書き換えて、常に最後の着手後の状態をレンダーするのではなく、 <code>stepNumber</code> によって現在選択されている着手をレンダーするようにする</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js">    <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">history</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">history</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">history</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">stepNumber</span><span class="p">];</span>
        <span class="kr">const</span> <span class="nx">winner</span> <span class="o">=</span> <span class="nx">calculateWinner</span><span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">squares</span><span class="p">);</span>

        <span class="kr">const</span> <span class="nx">moves</span> <span class="o">=</span> <span class="nx">history</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">step</span><span class="p">,</span> <span class="nx">move</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="kr">const</span> <span class="nx">desc</span> <span class="o">=</span> <span class="nx">move</span> <span class="o">?</span>
                <span class="s1">&#39;Go to move #&#39;</span> <span class="o">+</span> <span class="nx">move</span> <span class="o">:</span>
                <span class="s1">&#39;Go to game start&#39;</span><span class="p">;</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">move</span><span class="p">}</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">jumpTo</span><span class="p">(</span><span class="nx">move</span><span class="p">)}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">desc</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/button&gt;</span>
                <span class="o">&lt;</span><span class="err">/li&gt;</span>
            <span class="p">);</span>
        <span class="p">});</span>
</code></pre></div><ul>
<li>ゲーム内履歴の、どの手番をクリックした場合でも、三目並べの盤面は、該当着手が発生した直後の状態を表示するよう更新される</li>
</ul>
<p><a href="https://codepen.io/gaearon/pen/gWWZgR?editors=0010">この時点でのコード</a></p>
<h2 id="まとめ">まとめ</h2>
<ul>
<li>以下のような機能を有する三目並べゲームが完成した
<ol>
<li>三目並べが遊べる</li>
<li>決着が着いた時に表示ができる</li>
<li>ゲーム進行に合わせて履歴が保存される</li>
<li>着手の履歴の見直しや、顔面の以前の状態が参照できる</li>
</ol>
</li>
</ul>
<p><a href="https://codepen.io/gaearon/pen/gWWZgR?editors=0010">最終結果のコード</a></p>
<ul>
<li>改良アイディア
<ol>
<li>履歴内のそれぞれの着手位置を (col, row) というフォーマットで表示する</li>
<li>着手履歴のリスト中で、現在選択されているアイテムをボールドにする</li>
<li>Board でマス目を並べる部分を、ハードコーディングではなく 2つ のループを使用するように書き換える</li>
<li>着手履歴リストを昇順・降順いずれでも並び替えられるよう、トグルボタンを追加する</li>
<li>どちらかが勝利した際に、勝利に繋がった 3つ のマス目をハイライトする</li>
<li>どちらも勝利しなかった場合、結果が引き分けになったというメッセージを表示する</li>
</ol>
</li>
<li>このチュートリアルを通して 要素, コンポーネント, props, state といった React の概念に触れた
<ul>
<li>これらのトピックについて更に掘り下げた説明はドキュメントの続きを参照
<ul>
<li><a href="https://ja.reactjs.org/docs/hello-world.html">https://ja.reactjs.org/docs/hello-world.html</a></li>
</ul>
</li>
<li>コンポーネントの作成方法について、より詳細に学ぶには React.Component API リファレンスを参照
<ul>
<li><a href="https://ja.reactjs.org/docs/react-component.html">https://ja.reactjs.org/docs/react-component.html</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="この記事を試した環境">この記事を試した環境</h2>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% sw_vers
ProductName:    Mac OS X
ProductVersion: 10.15.7
BuildVersion:   19H512
% node -v
v12.16.1
% npm -v
6.14.11
% npx -v
6.14.11
</code></pre></div><p>package.json</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;react-tutorial&#34;</span><span class="p">,</span>
  <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;0.1.0&#34;</span><span class="p">,</span>
  <span class="nt">&#34;private&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nt">&#34;dependencies&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;@testing-library/jest-dom&#34;</span><span class="p">:</span> <span class="s2">&#34;^5.11.9&#34;</span><span class="p">,</span>
    <span class="nt">&#34;@testing-library/react&#34;</span><span class="p">:</span> <span class="s2">&#34;^11.2.5&#34;</span><span class="p">,</span>
    <span class="nt">&#34;@testing-library/user-event&#34;</span><span class="p">:</span> <span class="s2">&#34;^12.7.0&#34;</span><span class="p">,</span>
    <span class="nt">&#34;react&#34;</span><span class="p">:</span> <span class="s2">&#34;^17.0.1&#34;</span><span class="p">,</span>
    <span class="nt">&#34;react-dom&#34;</span><span class="p">:</span> <span class="s2">&#34;^17.0.1&#34;</span><span class="p">,</span>
    <span class="nt">&#34;react-scripts&#34;</span><span class="p">:</span> <span class="s2">&#34;4.0.2&#34;</span><span class="p">,</span>
    <span class="nt">&#34;web-vitals&#34;</span><span class="p">:</span> <span class="s2">&#34;^1.1.0&#34;</span>
  <span class="p">},</span>
  <span class="nt">&#34;scripts&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;start&#34;</span><span class="p">:</span> <span class="s2">&#34;react-scripts start&#34;</span><span class="p">,</span>
    <span class="nt">&#34;build&#34;</span><span class="p">:</span> <span class="s2">&#34;react-scripts build&#34;</span><span class="p">,</span>
    <span class="nt">&#34;test&#34;</span><span class="p">:</span> <span class="s2">&#34;react-scripts test&#34;</span><span class="p">,</span>
    <span class="nt">&#34;eject&#34;</span><span class="p">:</span> <span class="s2">&#34;react-scripts eject&#34;</span>
  <span class="p">},</span>
  <span class="nt">&#34;eslintConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;extends&#34;</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">&#34;react-app&#34;</span><span class="p">,</span>
      <span class="s2">&#34;react-app/jest&#34;</span>
    <span class="p">]</span>
  <span class="p">},</span>
  <span class="nt">&#34;browserslist&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;production&#34;</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">&#34;&gt;0.2%&#34;</span><span class="p">,</span>
      <span class="s2">&#34;not dead&#34;</span><span class="p">,</span>
      <span class="s2">&#34;not op_mini all&#34;</span>
    <span class="p">],</span>
    <span class="nt">&#34;development&#34;</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">&#34;last 1 chrome version&#34;</span><span class="p">,</span>
      <span class="s2">&#34;last 1 firefox version&#34;</span><span class="p">,</span>
      <span class="s2">&#34;last 1 safari version&#34;</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>]]></content>
		</item>
		
		<item>
			<title>Mac に Ansible をインストールして EC2 に ping するまで</title>
			<link>https://noid11.github.io/posts/how-to-ping-ec2-from-mac-using-ansible/</link>
			<pubDate>Thu, 11 Feb 2021 17:05:07 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/how-to-ping-ec2-from-mac-using-ansible/</guid>
			<description></description>
			<content type="html"><![CDATA[<h2 id="mac-に-ansible-をインストール">Mac に Ansible をインストール</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">brew install ansible
</code></pre></div><p>ansible — Homebrew Formulae<br>
<a href="https://formulae.brew.sh/formula/ansible">https://formulae.brew.sh/formula/ansible</a></p>
<h2 id="ec2-linux-環境を構築">EC2 Linux 環境を構築</h2>
<ul>
<li>EC2 で Linux 環境構築する手順は省略</li>
<li>EC2 インスタンスに ssh 接続できるようにしておく</li>
</ul>
<h2 id="etcansiblehosts-に-ec2-インスタンスを登録">/etc/ansible/hosts に EC2 インスタンスを登録</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">% cat /etc/ansible/hosts 
ec2-xxx-xxx-xxx-xxx.ap-northeast-1.compute.amazonaws.com
</code></pre></div><hr>
<p><code>/etc/ansible/hosts</code> って何？</p>
<ul>
<li>Ansible では、インベントリと呼ばれる単位で、複数のホストに対して操作を行う
<ul>
<li>インベントリを定義したらパターンを使用して Ansible を実行したいホストやグループを指定する</li>
<li>このインベントリのデフォルトの場所が <code>/etc/ansible/hosts</code> となる。</li>
</ul>
</li>
<li>コマンドラインで <code>-i</code> or <code>--inventory</code> or <code>--inventory-file</code> オプションを使用して、任意のインベントリファイルを指定することも可能</li>
</ul>
<p>How to build your inventory — Ansible Documentation<br>
<a href="https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html">https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html</a></p>
<h2 id="ping">ping</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">% ansible --user ec2-user all --module-name ping
<span class="o">[</span>WARNING<span class="o">]</span>: Platform linux on host ec2-xxx-xxx-xxx-xxx.ap-northeast-1.compute.amazonaws.com is using the discovered Python interpreter at /usr/bin/python, but future
installation of another Python interpreter could change the meaning of that path. See https://docs.ansible.com/ansible/2.10/reference_appendices/interpreter_discovery.html
<span class="k">for</span> more information.
ec2-xxx-xxx-xxx-xxx.ap-northeast-1.compute.amazonaws.com <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&#34;ansible_facts&#34;</span>: <span class="o">{</span>
        <span class="s2">&#34;discovered_interpreter_python&#34;</span>: <span class="s2">&#34;/usr/bin/python&#34;</span>
    <span class="o">}</span>,
    <span class="s2">&#34;changed&#34;</span>: false,
    <span class="s2">&#34;ping&#34;</span>: <span class="s2">&#34;pong&#34;</span>
<span class="o">}</span>
</code></pre></div><hr>
<p>この ping って何？</p>
<ul>
<li>Ansible の ping モジュール
<ul>
<li>リモートノードに ssh による通信が可能か、リモートノードで Python が動かくか確認するもの</li>
<li>ICMP での ping ではない</li>
</ul>
</li>
</ul>
<p>ansible.builtin.ping – Try to connect to host, verify a usable python and return pong on success — Ansible Documentation<br>
<a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/ping_module.html#ansible-collections-ansible-builtin-ping-module">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/ping_module.html#ansible-collections-ansible-builtin-ping-module</a></p>
<p>Ansible.Builtin — Ansible Documentation<br>
<a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/</a></p>
<hr>
<p>この警告は何なのか</p>
<ul>
<li>POSIX 環境で実行されるほとんどの Ansible モジュールは、ターゲットホスト上で Python インタプリタを必要としまする</li>
<li>特に設定しない限り Ansible は、 Python モジュールがそのホストで初めて実行されたときに、各ターゲットホスト上で適切な Python インタプリタを検出しようとする
<ul>
<li>この動作を Interpreter Discovery という</li>
<li>Interpreter Discovery を防ぐには2つの方法がある
<ol>
<li>個々のホストやグループに対して ansible_python_interpreter インベントリ変数を設定する</li>
<li>グローバルに ansible.cfg の [defaults] セクションで interpreter_python キーを使用する</li>
</ol>
</li>
<li>グローバルに設定してしまったほうが楽なので、今回は 2. の方法で対処する</li>
</ul>
</li>
</ul>
<p>[小ネタ] Pythonのバージョンを指定してAnsible実行時に表示される警告を消す | DevelopersIO<br>
<a href="https://dev.classmethod.jp/articles/ansible-interpreter-warning/">https://dev.classmethod.jp/articles/ansible-interpreter-warning/</a></p>
<p>Interpreter Discovery — Ansible Documentation<br>
<a href="https://docs.ansible.com/ansible/2.9/reference_appendices/interpreter_discovery.html">https://docs.ansible.com/ansible/2.9/reference_appendices/interpreter_discovery.html</a></p>
<h2 id="警告を消すために-ansiblecfg-を作成">警告を消すために ~/.ansible.cfg を作成</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">% cat ~/.ansible.cfg
<span class="o">[</span>defaults<span class="o">]</span>
<span class="nv">interpreter_python</span><span class="o">=</span>/usr/bin/python
</code></pre></div><hr>
<p><code>~/.ansible.cfg</code> って何？</p>
<ul>
<li>Ansible の設定ファイル</li>
</ul>
<p>Controlling how Ansible behaves: precedence rules — Ansible Documentation<br>
<a href="https://docs.ansible.com/ansible/latest/reference_appendices/general_precedence.html">https://docs.ansible.com/ansible/latest/reference_appendices/general_precedence.html</a></p>
<h2 id="再度-ping">再度 ping</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">% ansible --user ec2-user all --module-name ping
ec2-xxx-xxx-xxx-xxx.ap-northeast-1.compute.amazonaws.com <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&#34;changed&#34;</span>: false,
    <span class="s2">&#34;ping&#34;</span>: <span class="s2">&#34;pong&#34;</span>
<span class="o">}</span>
</code></pre></div><ul>
<li>警告が消えたのでヨシ！</li>
</ul>
<h2 id="この記事を試した環境">この記事を試した環境</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">% sw_vers
ProductName:    Mac OS X
ProductVersion: 10.15.7
BuildVersion:   19H512
% ansible --version
ansible 2.10.5
  config <span class="nv">file</span> <span class="o">=</span> /Users/myname/.ansible.cfg
  configured module search <span class="nv">path</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;/Users/myname/.ansible/plugins/modules&#39;</span>, <span class="s1">&#39;/usr/share/ansible/plugins/modules&#39;</span><span class="o">]</span>
  ansible python module <span class="nv">location</span> <span class="o">=</span> /usr/local/Cellar/ansible/2.10.6/libexec/lib/python3.9/site-packages/ansible
  executable <span class="nv">location</span> <span class="o">=</span> /usr/local/bin/ansible
  python <span class="nv">version</span> <span class="o">=</span> 3.9.1 <span class="o">(</span>default, Feb  <span class="m">3</span> 2021, 07:04:15<span class="o">)</span> <span class="o">[</span>Clang 12.0.0 <span class="o">(</span>clang-1200.0.32.29<span class="o">)]</span>
</code></pre></div>]]></content>
		</item>
		
		<item>
			<title>Cognito User Pool における Lambda Trigger は Federation 時にどう動くのか</title>
			<link>https://noid11.github.io/posts/cognito-user-pool-lambda-trigger-behavior-at-federation/</link>
			<pubDate>Tue, 09 Feb 2021 14:36:09 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/cognito-user-pool-lambda-trigger-behavior-at-federation/</guid>
			<description>&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-identity-federation.html&#34;&gt;Cognito User Pool では Google, Facebook といった外部 IdP を使用したフェデレーションが可能&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;このフェデレーションを行った際に、どう &lt;a href=&#34;https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-identity-pools-working-with-aws-lambda-triggers.html&#34;&gt;Lambda トリガー&lt;/a&gt;が起動するのか気になったので調べたメモ&lt;/li&gt;
&lt;/ul&gt;</description>
			<content type="html"><![CDATA[<ul>
<li><a href="https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-identity-federation.html">Cognito User Pool では Google, Facebook といった外部 IdP を使用したフェデレーションが可能</a></li>
<li>このフェデレーションを行った際に、どう <a href="https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-identity-pools-working-with-aws-lambda-triggers.html">Lambda トリガー</a>が起動するのか気になったので調べたメモ</li>
</ul>
<h2 id="どうやって調べたのか">どうやって調べたのか</h2>
<ul>
<li>各種 Lambda トリガーを User Pool に設定して、実際にフェデレーションしてみて Lambda 関数の起動状況を確認すれば OK</li>
</ul>
<h2 id="初回フェデレーション時のみ起動される-lambda-トリガー">初回フェデレーション時のみ起動される Lambda トリガー</h2>
<h3 id="pre-sign-up-lambda-triggerhttpsdocsawsamazoncomcognitolatestdeveloperguideuser-pool-lambda-pre-sign-uphtml"><a href="https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-pre-sign-up.html">Pre Sign-up Lambda Trigger</a></h3>
<p>Lambda 関数に連携される event 例</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1&#34;</span><span class="p">,</span>
  <span class="nt">&#34;region&#34;</span><span class="p">:</span> <span class="s2">&#34;ap-northeast-1&#34;</span><span class="p">,</span>
  <span class="nt">&#34;userPoolId&#34;</span><span class="p">:</span> <span class="s2">&#34;ap-northeast-1_xxx&#34;</span><span class="p">,</span>
  <span class="nt">&#34;userName&#34;</span><span class="p">:</span> <span class="s2">&#34;IdP_userid&#34;</span><span class="p">,</span>
  <span class="nt">&#34;callerContext&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;awsSdkVersion&#34;</span><span class="p">:</span> <span class="s2">&#34;aws-sdk-unknown-unknown&#34;</span><span class="p">,</span>
    <span class="nt">&#34;clientId&#34;</span><span class="p">:</span> <span class="s2">&#34;xxx&#34;</span>
  <span class="p">},</span>
  <span class="nt">&#34;triggerSource&#34;</span><span class="p">:</span> <span class="s2">&#34;PreSignUp_ExternalProvider&#34;</span><span class="p">,</span>
  <span class="nt">&#34;request&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;userAttributes&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;email_verified&#34;</span><span class="p">:</span> <span class="s2">&#34;false&#34;</span><span class="p">,</span>
      <span class="nt">&#34;cognito:email_alias&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
      <span class="nt">&#34;cognito:phone_number_alias&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
      <span class="nt">&#34;email&#34;</span><span class="p">:</span> <span class="s2">&#34;sample@example.com&#34;</span>
    <span class="p">},</span>
    <span class="nt">&#34;validationData&#34;</span><span class="p">:</span> <span class="p">{}</span>
  <span class="p">},</span>
  <span class="nt">&#34;response&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;autoConfirmUser&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">&#34;autoVerifyEmail&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">&#34;autoVerifyPhone&#34;</span><span class="p">:</span> <span class="kc">false</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="post-confirmation-lambda-triggerhttpsdocsawsamazoncomcognitolatestdeveloperguideuser-pool-lambda-post-confirmationhtml"><a href="https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-post-confirmation.html">Post Confirmation Lambda Trigger</a></h3>
<p>Lambda 関数に連携される event 例</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1&#34;</span><span class="p">,</span>
  <span class="nt">&#34;region&#34;</span><span class="p">:</span> <span class="s2">&#34;ap-northeast-1&#34;</span><span class="p">,</span>
  <span class="nt">&#34;userPoolId&#34;</span><span class="p">:</span> <span class="s2">&#34;ap-northeast-1_xxx&#34;</span><span class="p">,</span>
  <span class="nt">&#34;userName&#34;</span><span class="p">:</span> <span class="s2">&#34;IdP_userid&#34;</span><span class="p">,</span>
  <span class="nt">&#34;callerContext&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;awsSdkVersion&#34;</span><span class="p">:</span> <span class="s2">&#34;aws-sdk-unknown-unknown&#34;</span><span class="p">,</span>
    <span class="nt">&#34;clientId&#34;</span><span class="p">:</span> <span class="s2">&#34;xxx&#34;</span>
  <span class="p">},</span>
  <span class="nt">&#34;triggerSource&#34;</span><span class="p">:</span> <span class="s2">&#34;PostConfirmation_ConfirmSignUp&#34;</span><span class="p">,</span>
  <span class="nt">&#34;request&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;userAttributes&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;sub&#34;</span><span class="p">:</span> <span class="s2">&#34;3c6fcb0d-b156-4d9b-8dd3-77a8fd9a8954&#34;</span><span class="p">,</span>
      <span class="nt">&#34;identities&#34;</span><span class="p">:</span> <span class="s2">&#34;[{\&#34;userId\&#34;:\&#34;userid\&#34;,\&#34;providerName\&#34;:\&#34;IdP\&#34;,\&#34;providerType\&#34;:\&#34;XXX\&#34;,\&#34;issuer\&#34;:null,\&#34;primary\&#34;:true,\&#34;dateCreated\&#34;:1611313260723}]&#34;</span><span class="p">,</span>
      <span class="nt">&#34;cognito:user_status&#34;</span><span class="p">:</span> <span class="s2">&#34;EXTERNAL_PROVIDER&#34;</span><span class="p">,</span>
      <span class="nt">&#34;email_verified&#34;</span><span class="p">:</span> <span class="s2">&#34;false&#34;</span><span class="p">,</span>
      <span class="nt">&#34;email&#34;</span><span class="p">:</span> <span class="s2">&#34;sample@example.com&#34;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&#34;response&#34;</span><span class="p">:</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></div><h2 id="初回以降のフェデレーション時のみ起動される-lambda-トリガー">初回以降のフェデレーション時のみ起動される Lambda トリガー</h2>
<h3 id="pre-authentication-lambda-triggerhttpsdocsawsamazoncomcognitolatestdeveloperguideuser-pool-lambda-pre-authenticationhtml"><a href="https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-pre-authentication.html">Pre Authentication Lambda Trigger</a></h3>
<p>Lambda 関数に連携される event 例</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1&#34;</span><span class="p">,</span>
  <span class="nt">&#34;region&#34;</span><span class="p">:</span> <span class="s2">&#34;ap-northeast-1&#34;</span><span class="p">,</span>
  <span class="nt">&#34;userPoolId&#34;</span><span class="p">:</span> <span class="s2">&#34;ap-northeast-1_xxx&#34;</span><span class="p">,</span>
  <span class="nt">&#34;userName&#34;</span><span class="p">:</span> <span class="s2">&#34;IdP_userid&#34;</span><span class="p">,</span>
  <span class="nt">&#34;callerContext&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;awsSdkVersion&#34;</span><span class="p">:</span> <span class="s2">&#34;aws-sdk-unknown-unknown&#34;</span><span class="p">,</span>
    <span class="nt">&#34;clientId&#34;</span><span class="p">:</span> <span class="s2">&#34;xxx&#34;</span>
  <span class="p">},</span>
  <span class="nt">&#34;triggerSource&#34;</span><span class="p">:</span> <span class="s2">&#34;PreAuthentication_Authentication&#34;</span><span class="p">,</span>
  <span class="nt">&#34;request&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;userAttributes&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;sub&#34;</span><span class="p">:</span> <span class="s2">&#34;3c6fcb0d-b156-4d9b-8dd3-77a8fd9a8954&#34;</span><span class="p">,</span>
      <span class="nt">&#34;email_verified&#34;</span><span class="p">:</span> <span class="s2">&#34;false&#34;</span><span class="p">,</span>
      <span class="nt">&#34;cognito:user_status&#34;</span><span class="p">:</span> <span class="s2">&#34;EXTERNAL_PROVIDER&#34;</span><span class="p">,</span>
      <span class="nt">&#34;identities&#34;</span><span class="p">:</span> <span class="s2">&#34;[{\&#34;userId\&#34;:\&#34;userid\&#34;,\&#34;providerName\&#34;:\&#34;IdP\&#34;,\&#34;providerType\&#34;:\&#34;XXX\&#34;,\&#34;issuer\&#34;:null,\&#34;primary\&#34;:true,\&#34;dateCreated\&#34;:1611313260723}]&#34;</span><span class="p">,</span>
      <span class="nt">&#34;email&#34;</span><span class="p">:</span> <span class="s2">&#34;sample@example.com&#34;</span>
    <span class="p">},</span>
    <span class="nt">&#34;validationData&#34;</span><span class="p">:</span> <span class="p">{}</span>
  <span class="p">},</span>
  <span class="nt">&#34;response&#34;</span><span class="p">:</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></div><h3 id="post-authentication-lambda-triggerhttpsdocsawsamazoncomcognitolatestdeveloperguideuser-pool-lambda-post-authenticationhtml"><a href="https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-post-authentication.html">Post Authentication Lambda Trigger</a></h3>
<p>Lambda 関数に連携される event 例</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1&#34;</span><span class="p">,</span>
  <span class="nt">&#34;region&#34;</span><span class="p">:</span> <span class="s2">&#34;ap-northeast-1&#34;</span><span class="p">,</span>
  <span class="nt">&#34;userPoolId&#34;</span><span class="p">:</span> <span class="s2">&#34;ap-northeast-1_xxx&#34;</span><span class="p">,</span>
  <span class="nt">&#34;userName&#34;</span><span class="p">:</span> <span class="s2">&#34;IdP_userid&#34;</span><span class="p">,</span>
  <span class="nt">&#34;callerContext&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;awsSdkVersion&#34;</span><span class="p">:</span> <span class="s2">&#34;aws-sdk-unknown-unknown&#34;</span><span class="p">,</span>
    <span class="nt">&#34;clientId&#34;</span><span class="p">:</span> <span class="s2">&#34;xxx&#34;</span>
  <span class="p">},</span>
  <span class="nt">&#34;triggerSource&#34;</span><span class="p">:</span> <span class="s2">&#34;PostAuthentication_Authentication&#34;</span><span class="p">,</span>
  <span class="nt">&#34;request&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;userAttributes&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;sub&#34;</span><span class="p">:</span> <span class="s2">&#34;3c6fcb0d-b156-4d9b-8dd3-77a8fd9a8954&#34;</span><span class="p">,</span>
      <span class="nt">&#34;identities&#34;</span><span class="p">:</span> <span class="s2">&#34;[{\&#34;userId\&#34;:\&#34;userid\&#34;,\&#34;providerName\&#34;:\&#34;IdP\&#34;,\&#34;providerType\&#34;:\&#34;XXX\&#34;,\&#34;issuer\&#34;:null,\&#34;primary\&#34;:true,\&#34;dateCreated\&#34;:1611313260723}]&#34;</span><span class="p">,</span>
      <span class="nt">&#34;cognito:user_status&#34;</span><span class="p">:</span> <span class="s2">&#34;EXTERNAL_PROVIDER&#34;</span><span class="p">,</span>
      <span class="nt">&#34;email_verified&#34;</span><span class="p">:</span> <span class="s2">&#34;false&#34;</span><span class="p">,</span>
      <span class="nt">&#34;email&#34;</span><span class="p">:</span> <span class="s2">&#34;sample@example.com&#34;</span>
    <span class="p">},</span>
    <span class="nt">&#34;newDeviceUsed&#34;</span><span class="p">:</span> <span class="kc">false</span>
  <span class="p">},</span>
  <span class="nt">&#34;response&#34;</span><span class="p">:</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></div><h2 id="note">NOTE</h2>
<ul>
<li>なぜ初回と初回以降で起動する Lambda トリガーが異なるのか？
<ul>
<li>Cognito User Pool でフェデレーションすると、フェデレーションしたユーザー情報が User Pool に作成される
<ul>
<li>初回のフェデレーション時のみ、このユーザー作成が行われるため、呼び出される Lambda トリガーが異なるのだと思われる
<ul>
<li>Pre Sign-up と Post Confirmation が暗黙的に呼び出される</li>
</ul>
</li>
<li>初回以降は既にユーザー情報が作成済みであり、 Cognito User Pool としてはユーザー作成ではなく認証が行われるものとして扱われているのだと思われる
<ul>
<li>Pre Authentication, Post Authentication が呼び出される</li>
</ul>
</li>
<li>ちなみにユーザーが作成されてから意図的に該当ユーザーを削除し、再度フェデレーションするとユーザーは再作成される
<ul>
<li>つまりフェデレーション時のユーザー作成は PUT 的な処理なのだと思われる</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>何に使えるのか？
<ul>
<li>例えばフェデレーションする際でも許可したユーザーのみ利用を許可したい場合、 Pre Sign-up Lambda Trigger でメールアドレス等のユーザー情報をチェックして、所定のユーザー以外がフェデレーションしてきたらブロックする・・・みたいな構成ができそう</li>
</ul>
</li>
</ul>]]></content>
		</item>
		
		<item>
			<title>個人的な vscode の使い方 TIPS</title>
			<link>https://noid11.github.io/posts/my-vscode-tips/</link>
			<pubDate>Tue, 09 Feb 2021 14:35:24 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/my-vscode-tips/</guid>
			<description></description>
			<content type="html"><![CDATA[<h2 id="document">document</h2>
<p>Documentation for Visual Studio Code<br>
<a href="https://code.visualstudio.com/docs">https://code.visualstudio.com/docs</a></p>
<h2 id="cheatsheet">cheatsheet</h2>
<p>Windows<br>
<a href="https://code.visualstudio.com/shortcuts/keyboard-shortcuts-windows.pdf">https://code.visualstudio.com/shortcuts/keyboard-shortcuts-windows.pdf</a></p>
<p>macOS<br>
<a href="https://code.visualstudio.com/shortcuts/keyboard-shortcuts-macos.pdf">https://code.visualstudio.com/shortcuts/keyboard-shortcuts-macos.pdf</a></p>
<p>Linux<br>
<a href="https://code.visualstudio.com/shortcuts/keyboard-shortcuts-linux.pdf">https://code.visualstudio.com/shortcuts/keyboard-shortcuts-linux.pdf</a></p>
<h2 id="shortcuts">shortcuts</h2>
<ul>
<li><code>command + shift + P</code>: コマンドパレット</li>
<li><code>command + P</code>: ファイル名で検索</li>
<li><code>command + shift + F</code>: ファイルの中身で検索</li>
</ul>]]></content>
		</item>
		
		<item>
			<title>AWS アカウントのセットアップ TIPS</title>
			<link>https://noid11.github.io/posts/my-aws-account-setup-tips/</link>
			<pubDate>Tue, 09 Feb 2021 05:54:16 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/my-aws-account-setup-tips/</guid>
			<description>&lt;ul&gt;
&lt;li&gt;個人的に使っている AWS アカウントの管理とかセットアップに関する TIPS&lt;/li&gt;
&lt;/ul&gt;</description>
			<content type="html"><![CDATA[<ul>
<li>個人的に使っている AWS アカウントの管理とかセットアップに関する TIPS</li>
</ul>
<h2 id="aws-アカウントの管理には-control-tower-を使う">AWS アカウントの管理には Control Tower を使う</h2>
<ul>
<li><a href="https://aws.amazon.com/jp/controltower/">AWS Control Tower</a> はマルチアカウント環境をセキュアに管理・構築してくれるサービス</li>
<li>複数の AWS アカウントの管理と言えば <a href="https://aws.amazon.com/jp/organizations/">AWS Organizations</a> や <a href="https://aws.amazon.com/jp/single-sign-on/">AWS Single Sign-On</a> といったサービスがメジャーな気がするが、 Control Tower はこれらをまとめて管理してくれる</li>
<li>特に便利なのが <a href="https://aws.amazon.com/jp/servicecatalog/">AWS Service Catalog</a> を使用した AWS アカウント作成で、一々 AWS アカウントのサインアップをする必要がなくなるので大変便利
<ul>
<li>何か検証が必要になったら検証用の AWS アカウントを作成する・・・みたいな事が手軽にできるようになる</li>
</ul>
</li>
</ul>
<p>Provision and manage accounts with Account Factory - AWS Control Tower<br>
<a href="https://docs.aws.amazon.com/controltower/latest/userguide/account-factory.html">https://docs.aws.amazon.com/controltower/latest/userguide/account-factory.html</a></p>
<h2 id="aws-cli-v2-の-sso-設定をしておく">AWS CLI v2 の SSO 設定をしておく</h2>
<ul>
<li>AWS CLI v2 からは AWS SSO に対応したプロファイル設定が可能</li>
<li>特定の AWS アカウントに対して AWS CLI で操作したい場面は割とあるので、 AWS アカウントの作成時にセットアップしておくと良い
<ul>
<li>サクッと実行する分には AWS SSO でマネジメントコンソールにアクセスして CloudShell から AWS CLI を実行する・・・という方法でも良い</li>
</ul>
</li>
</ul>
<p>Configuring the AWS CLI to use AWS Single Sign-On - AWS Command Line Interface<br>
<a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-sso.html">https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-sso.html</a></p>
<h2 id="aws-から送信されるマーケティングメールの登録を解除しておく">AWS から送信されるマーケティングメールの登録を解除しておく</h2>
<p>AWS Email Preference Center<br>
<a href="https://pages.awscloud.com/jp/communication-preferences.html?languages=japanese">https://pages.awscloud.com/jp/communication-preferences.html?languages=japanese</a></p>
<ul>
<li>作成した AWS アカウントのメールアドレスに同じお知らせメールが届くので、基本的には速攻解除しておくのが吉
<ul>
<li>油断してメンテナンスのお知らせとか気付けないとヤバいことになる可能性もある</li>
</ul>
</li>
</ul>]]></content>
		</item>
		
		<item>
			<title>ファイルの圧縮や展開関連のコマンド</title>
			<link>https://noid11.github.io/posts/file-compress-and-decompress-commands/</link>
			<pubDate>Mon, 08 Feb 2021 23:56:05 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/file-compress-and-decompress-commands/</guid>
			<description>&lt;ul&gt;
&lt;li&gt;オプションとか関連コマンドが多く、とても覚えきれないのでメモ&lt;/li&gt;
&lt;/ul&gt;</description>
			<content type="html"><![CDATA[<ul>
<li>オプションとか関連コマンドが多く、とても覚えきれないのでメモ</li>
</ul>
<h2 id="zip">zip</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># ファイル圧縮</span>
zip myzip.zip sample.txt

<span class="c1"># ディレクトリ圧縮</span>
zip -r myzip.zip /path/to/dir

<span class="c1"># 展開</span>
unzip myzip.zip
</code></pre></div><p>Manpage of ZIP<br>
<a href="http://linux.math.tifr.res.in/manuals/man/zip.html">http://linux.math.tifr.res.in/manuals/man/zip.html</a></p>
<p>zip(1)<br>
<a href="https://www.freebsd.org/cgi/man.cgi?query=zip&amp;apropos=0&amp;sektion=1">https://www.freebsd.org/cgi/man.cgi?query=zip&amp;apropos=0&amp;sektion=1</a></p>
<h2 id="unix-compress">UNIX Compress</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 圧縮</span>
compress sample.txt

<span class="c1"># 展開</span>
uncompress sample.txt.Z
</code></pre></div><p>compress(1p) - Linux manual page<br>
<a href="https://man7.org/linux/man-pages/man1/compress.1p.html">https://man7.org/linux/man-pages/man1/compress.1p.html</a></p>
<p>compress(1)<br>
<a href="https://www.freebsd.org/cgi/man.cgi?query=compress&amp;sektion=1">https://www.freebsd.org/cgi/man.cgi?query=compress&amp;sektion=1</a></p>
<h2 id="gzip">gzip</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># ファイル圧縮 (sample.txt が sample.txt.gz になる)</span>
gzip sample.txt

<span class="c1"># ディレクトリに含まれるファイルを圧縮 </span>
<span class="c1"># ./midir/ 配下のファイルが全て .gz となる</span>
gzip -r ./mydir

<span class="c1"># ファイル展開</span>
gunzip sample.txt.gz

<span class="c1"># ディレクトリに含まれるファイルを展開</span>
<span class="c1"># ./midir/ 配下の .gz ファイルが全て展開される</span>
gunzip -r ./mydir

<span class="c1"># gzip 圧縮されたファイルを展開せずに見る</span>
gzcat sample.txt.gz <span class="c1"># Linux では gzcat ではなく zcat を使う</span>
zless sample.txt.gz
zmore sample.txt.gz
</code></pre></div><p>GNU Gzip<br>
<a href="https://www.gnu.org/software/gzip/manual/gzip.html">https://www.gnu.org/software/gzip/manual/gzip.html</a></p>
<p>gzip<br>
<a href="https://www.freebsd.org/cgi/man.cgi?query=gzip&amp;sektion=&amp;n=1">https://www.freebsd.org/cgi/man.cgi?query=gzip&amp;sektion=&amp;n=1</a></p>
<p>gzcat(1)<br>
<a href="https://www.freebsd.org/cgi/man.cgi?query=gzcat&amp;sektion=1&amp;n=1">https://www.freebsd.org/cgi/man.cgi?query=gzcat&amp;sektion=1&amp;n=1</a></p>
<h2 id="bzip2">bzip2</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># ファイル圧縮 (sample.txt が sample.txt.bz2 になる)</span>
bzip2 sample.txt

<span class="c1"># ディレクトリに含まれるファイルを圧縮 </span>
<span class="c1"># -r オプションが無いので find コマンド等と組み合わせる必要がある</span>
find ./mydir -type f -exec bzip2 <span class="o">{}</span> +

<span class="c1"># ファイル展開</span>
bunzip2 sample.txt.bz2

<span class="c1"># ディレクトリに含まれるファイルを展開</span>
<span class="c1"># -r オプションが無いので find コマンド等と組み合わせる必要がある</span>
find ./mydir -type f -exec bunzip2 <span class="o">{}</span> +

<span class="c1"># bzip2 圧縮されたファイルを展開せずに見る</span>
bzcat sample.txt.bz2
</code></pre></div><p>bzip2(1): block-sorting file compressor - Linux man page<br>
<a href="https://linux.die.net/man/1/bzip2">https://linux.die.net/man/1/bzip2</a></p>
<p>bzip2(1)<br>
<a href="https://www.freebsd.org/cgi/man.cgi?query=bzip2&amp;sektion=1">https://www.freebsd.org/cgi/man.cgi?query=bzip2&amp;sektion=1</a></p>
<h2 id="xz">xz</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 圧縮</span>
xz sample.txt

<span class="c1"># 圧縮されたデータを展開せずに確認</span>
xzcat sample.txt.xz

<span class="c1"># 展開</span>
unxz sample.txt.xz
</code></pre></div><p>xz(1): Compress/decompress .xz/.lzma files - Linux man page<br>
<a href="https://linux.die.net/man/1/xz">https://linux.die.net/man/1/xz</a></p>
<p>xz(1)<br>
<a href="https://www.freebsd.org/cgi/man.cgi?xz(1)">https://www.freebsd.org/cgi/man.cgi?xz(1)</a></p>
<h2 id="tar">tar</h2>
<p>tar.Z</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># ディレクトリを指定して tar にしてから UNIX Compress</span>
tar cZvf my.tar.Z /path/to/dir

<span class="c1"># 展開</span>
tar xvf my.tar.Z
</code></pre></div><hr>
<p>tar.gz</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># ディレクトリを指定して tar にしてから gzip</span>
tar czvf my.tar.gz /path/to/dir

<span class="c1"># 展開</span>
tar xvf my.tar.gz
</code></pre></div><hr>
<p>tar.bz2</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># ディレクトリを指定して tar にしてから bzip2</span>
tar jcvf my.tar.bz2 /path/to/dir

<span class="c1"># 展開</span>
tar xvf my.tar.bz2
</code></pre></div><hr>
<p>tar.xz</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># ディレクトリ指定して tar にしてから xz</span>
tar Jcvf my.tar.xz /path/to/dir

<span class="c1"># 展開</span>
tar xvf my.tar.xz
</code></pre></div><p>tar(1) - Linux manual page<br>
<a href="https://man7.org/linux/man-pages/man1/tar.1.html">https://man7.org/linux/man-pages/man1/tar.1.html</a></p>
<p>tar(1)<br>
<a href="https://www.freebsd.org/cgi/man.cgi?tar(1)">https://www.freebsd.org/cgi/man.cgi?tar(1)</a></p>
<h2 id="ファイル形式あれこれ">ファイル形式あれこれ</h2>
<ul>
<li>zip
<ul>
<li><a href="https://support.pkware.com/home/pkzip/developer-tools/appnote">https://support.pkware.com/home/pkzip/developer-tools/appnote</a></li>
<li><a href="https://www.iso.org/standard/60101.html">https://www.iso.org/standard/60101.html</a></li>
<li>一般的。 Windows でも使われる</li>
</ul>
</li>
<li>UNIX Compress
<ul>
<li><a href="https://en.wikipedia.org/wiki/Compress">https://en.wikipedia.org/wiki/Compress</a></li>
<li>昔よく使われていたもの</li>
</ul>
</li>
<li>gzip: GNU zip
<ul>
<li><a href="https://www.gzip.org/">https://www.gzip.org/</a></li>
<li><a href="https://www.gnu.org/software/gzip/">https://www.gnu.org/software/gzip/</a></li>
<li>現代の主流</li>
</ul>
</li>
<li>bzip2
<ul>
<li><a href="https://www.sourceware.org/bzip2/">https://www.sourceware.org/bzip2/</a></li>
<li>gzip よりも圧縮効率が高いと言われている。一方で圧縮や展開に必要となるリソースが大きめ、かつ時間がかかる</li>
</ul>
</li>
<li>xz
<ul>
<li><a href="https://tukaani.org/xz/format.html">https://tukaani.org/xz/format.html</a></li>
<li>bzip2 より更に圧縮効率が高いと言われているが、より CPU やメモリや時間を使用する</li>
</ul>
</li>
<li>tar
<ul>
<li>tar 自体は圧縮ではなく tape archives, tarball 等と呼ばれるファイルアーカイブフォーマット</li>
<li>複数のファイルに対して圧縮を行うよりも、複数のファイルを tar として1つのファイルにアーカイブして圧縮した方がシーケンシャルなデータになるので、一般的に圧縮効率が良い
<ul>
<li>.tar.Z: tar したあとに UNIX Compress したもの。 .taz とも表記される</li>
<li>.tar.gz: tar したあとに gzip したもの。 .tgz とも表記される</li>
<li>.tar.bz2: tar したあとに bzip2 したもの。</li>
<li>.tar.xz: tar したあとに xz したもの。</li>
</ul>
</li>
<li>ファイルが一部破損したら破損箇所以降のファイルを取り出すことができないというデメリットもある</li>
</ul>
</li>
<li>圧縮効率が高いといっても、必ずしも他よりファイルサイズを小さくできる訳ではない
<ul>
<li>圧縮対象のファイル内容にも依存する。テキストファイルは得意だけど、動画ファイルは苦手とか。</li>
<li>ちゃんと検討するならば具体的なサンプルファイルをいくつか用意して、それぞれの圧縮方式について検証した方が良い</li>
</ul>
</li>
</ul>
<h2 id="この記事を試した環境">この記事を試した環境</h2>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% sw_vers
ProductName:    Mac OS X
ProductVersion: 10.15.7
BuildVersion:   19H114
</code></pre></div>]]></content>
		</item>
		
		<item>
			<title>個人的な AWS Cloud9 の使い方 TIPS</title>
			<link>https://noid11.github.io/posts/my-cloud9-tips/</link>
			<pubDate>Sun, 07 Feb 2021 19:37:56 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/my-cloud9-tips/</guid>
			<description>AWS Cloud9 を稀に使うのでセットアップ方法メモ セットアップ SSH key 作成 ssh-keygen -t rsa -b 4096 -C &amp;#34;Cloud9 環境の ARN&amp;#34; あとは GitHub に登録したり https://github.com/settings/keys ssh-keygen manual -t: アルゴリズム -b: bit 数 -C: コメント ユニ</description>
			<content type="html"><![CDATA[<ul>
<li><a href="https://aws.amazon.com/jp/cloud9/">AWS Cloud9</a> を稀に使うのでセットアップ方法メモ</li>
</ul>
<h2 id="セットアップ">セットアップ</h2>
<h3 id="ssh-key-作成">SSH key 作成</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">ssh-keygen -t rsa -b <span class="m">4096</span> -C <span class="s2">&#34;Cloud9 環境の ARN&#34;</span>
</code></pre></div><ul>
<li>あとは GitHub に登録したり
<ul>
<li><a href="https://github.com/settings/keys">https://github.com/settings/keys</a></li>
</ul>
</li>
<li><a href="https://man.openbsd.org/ssh-keygen">ssh-keygen manual</a>
<ul>
<li><code>-t</code>: アルゴリズム</li>
<li><code>-b</code>: bit 数</li>
<li><code>-C</code>: コメント
<ul>
<li>ユニークな値のほうが後から思い出しやすいので Cloud9 環境の ARN にしている</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="authorized-keys-登録">Authorized keys 登録</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">curl -s https://github.com/noid11.keys &gt;&gt; ~/.ssh/authorized_keys
</code></pre></div><ul>
<li>Cloud9 として使用している EC2 インスタンスに SSH 接続したくなる場合が稀にある
<ul>
<li><a href="https://docs.aws.amazon.com/ja_jp/systems-manager/latest/userguide/session-manager.html">AWS Systems Manager のセッションマネージャーで SSH 接続も出来る</a>ので、基本的にはこっちを使ったほうが良い</li>
</ul>
</li>
<li><code>~/.ssh/authorized_keys</code> には既に Cloud9 環境が使う SSH Key が登録されているっぽいので、ファイルの上書きではなく <code>&gt;&gt;</code> で追記する</li>
</ul>
<h2 id="使い方">使い方</h2>
<h3 id="しばらく使わないと思ったら環境を削除">しばらく使わないと思ったら環境を削除</h3>
<ul>
<li><a href="https://aws.amazon.com/jp/cloud9/pricing/">Cloud9 の利用そのものには料金が発生しない</a>ものの、 EC2 インスタンスと EBS の料金は発生する
<ul>
<li><a href="https://aws.amazon.com/jp/ec2/pricing/on-demand/">停止中の EC2 インスタンスは課金されない</a>が、 <a href="https://aws.amazon.com/jp/premiumsupport/knowledge-center/ebs-charge-stopped-instance/">EBS ボリュームは EC2 インスタンスが停止中でも料金が発する</a></li>
<li><a href="https://aws.amazon.com/jp/ebs/pricing/">EBS の料金は 1GB / 月という単位で計算される</a>ので、 Cloud9 環境を1ヶ月以上放置すると無駄に EBS の料金が発生する</li>
</ul>
</li>
<li>Cloud9 で使用するデータとは多くの場合、自分が読み書きするソースコード
<ul>
<li>大体の場合 GitHub, GitLab, CodeCommit などのリモートリポジトリがあるハズ</li>
<li>もうしばらく使わ無さそうだな・・・と思ったら <code>git push</code> するなりして EBS スナップショット等はとらずに Cloud9 環境毎削除してしまって、また読み書きする際に Cloud9 環境を作成した方が良い</li>
</ul>
</li>
<li>定期的にミドルウェア等のパッケージをアップデートするのも面倒</li>
</ul>
<h2 id="注意点">注意点</h2>
<h3 id="linux-環境">Linux 環境</h3>
<ul>
<li>当たり前だけど普段 Mac 使ってると、コマンドが GNU と BSD でオプション違うみたいなパターンあるので注意</li>
</ul>
<h3 id="現状-aws-cli-が-v1">現状 AWS CLI が v1</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ aws --version
aws-cli/1.18.217 Python/2.7.18 Linux/4.14.209-160.339.amzn2.x86_64 botocore/1.19.57
</code></pre></div><ul>
<li>AWS CLI v2 が使いたい場合には自前でインストールする
<ul>
<li><a href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-linux.html">https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-linux.html</a></li>
</ul>
</li>
</ul>
<h2 id="cloud9-の好きな所">Cloud9 の好きな所</h2>
<ul>
<li>使っている自分の PC スペックが低い場合や、ネットワーク環境が悪い場合、そこそこスペックの高い EC2 インスタンスを使うことでソコソコ快適な開発環境が手に入る
<ul>
<li><a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/what-is-sam.html">AWS SAM CLI</a> を使いたい場合等、結構 Docker イメージの容量が大きかったりするのでツラくなったりする</li>
</ul>
</li>
<li><a href="https://docs.aws.amazon.com/cloud9/latest/user-guide/language-support.html">様々なプログラミング言語を動かせる環境</a>が揃っている
<ul>
<li>一々自分でセットアップするのも面倒なのでデフォルトでインストールされているのは楽
<ul>
<li>特定のバージョンで試したい！みたいな場合には頑張る必要あり</li>
</ul>
</li>
</ul>
</li>
<li>EC2 インスタンス上で動作する
<ul>
<li>CloudShell のように透過的に動いて欲しい気もするが、 EC2 インスタンスが見れるので <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/viewing_metrics_with_cloudwatch.html">CloudWatch メトリクスで負荷状況を確認できる</a>
<ul>
<li>アプリのビルドや実行で、このくらいリソース使うんだな〜みたいなのが分かって良い</li>
<li><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using_cloudwatch_ebs.html">EBS Volume のメトリクス</a>も見れる</li>
</ul>
</li>
</ul>
</li>
<li>Cloud9 環境を他の人と共有できる
<ul>
<li><a href="https://aws.amazon.com/jp/cloud9/faqs/#Environment_Sharing">現状同じ AWS アカウント内の IAM ユーザーのみ共有可能</a>なので注意</li>
<li>まぁ共有したくなったら CloudFormation なり CDK なりで IAM ユーザー作成して連携すれば良い</li>
</ul>
</li>
</ul>
<h2 id="この記事を試した環境">この記事を試した環境</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ cat /etc/system-release
Amazon Linux release <span class="m">2</span> <span class="o">(</span>Karoo<span class="o">)</span>
$ sudo yum list installed
Loaded plugins: extras_suggestions, langpacks, priorities, update-motd
<span class="m">224</span> packages excluded due to repository priority protections
Installed Packages
GeoIP.x86_64                                 1.5.0-11.amzn2.0.2                     installed                          
PyYAML.x86_64                                3.10-11.amzn2.0.2                      installed                          
acl.x86_64                                   2.2.51-14.amzn2                        installed                          
acpid.x86_64                                 2.0.19-9.amzn2.0.1                     installed                          
amazon-linux-extras.noarch                   1.6.13-1.amzn2                         @amzn2-core                        
amazon-linux-extras-yum-plugin.noarch        1.6.13-1.amzn2                         @amzn2-core                        
amazon-ssm-agent.x86_64                      3.0.161.0-1.amzn2                      @amzn2-core                        
apr.x86_64                                   1.6.3-5.amzn2.0.2                      @amzn2-core                        
apr-util.x86_64                              1.6.1-5.amzn2.0.2                      @amzn2-core                        
apr-util-bdb.x86_64                          1.6.1-5.amzn2.0.2                      @amzn2-core                        
at.x86_64                                    3.1.13-24.amzn2                        installed                          
attr.x86_64                                  2.4.46-12.amzn2.0.2                    installed                          
audit.x86_64                                 2.8.1-3.amzn2.1                        installed                          
audit-libs.x86_64                            2.8.1-3.amzn2.1                        installed                          
authconfig.x86_64                            6.2.8-30.amzn2.0.2                     installed                          
autoconf.noarch                              2.69-11.amzn2                          @amzn2-core                        
automake.noarch                              1.13.4-3.1.amzn2                       @amzn2-core                        
avahi-libs.x86_64                            0.6.31-20.amzn2                        @amzn2-core                        
aws-cfn-bootstrap.noarch                     1.4-34.amzn2                           @amzn2-core                        
awscli.noarch                                1.18.147-1.amzn2.0.1                   @amzn2-core                        
basesystem.noarch                            10.0-7.amzn2.0.1                       installed                          
bash.x86_64                                  4.2.46-34.amzn2                        @amzn2-core                        
bash-completion.noarch                       1:2.1-6.amzn2                          installed                          
bc.x86_64                                    1.06.95-13.amzn2.0.2                   installed                          
bind-export-libs.x86_64                      32:9.11.4-26.P2.amzn2.2                @amzn2-core                        
bind-libs.x86_64                             32:9.11.4-26.P2.amzn2.2                @amzn2-core                        
bind-libs-lite.x86_64                        32:9.11.4-26.P2.amzn2.2                @amzn2-core                        
bind-license.noarch                          32:9.11.4-26.P2.amzn2.2                @amzn2-core                        
bind-utils.x86_64                            32:9.11.4-26.P2.amzn2.2                @amzn2-core                        
binutils.x86_64                              2.29.1-30.amzn2                        @amzn2-core                        
bison.x86_64                                 3.0.4-6.amzn2.0.2                      @amzn2-core                        
blktrace.x86_64                              1.0.5-9.amzn2                          installed                          
boost-date-time.x86_64                       1.53.0-27.amzn2.0.3                    installed                          
boost-system.x86_64                          1.53.0-27.amzn2.0.3                    installed                          
boost-thread.x86_64                          1.53.0-27.amzn2.0.3                    installed                          
bridge-utils.x86_64                          1.5-9.amzn2.0.2                        installed                          
byacc.x86_64                                 1.9.20130304-3.amzn2.0.2               @amzn2-core                        
bzip2.x86_64                                 1.0.6-13.amzn2.0.2                     installed                          
bzip2-libs.x86_64                            1.0.6-13.amzn2.0.2                     installed                          
ca-certificates.noarch                       2019.2.32-76.amzn2.0.3                 @amzn2-core                        
chkconfig.x86_64                             1.7.4-1.amzn2.0.2                      installed                          
chrony.x86_64                                3.5.1-1.amzn2.0.1                      @amzn2-core                        
cloud-init.noarch                            19.3-4.amzn2                           @amzn2-core                        
cloud-utils-growpart.noarch                  0.31-2.amzn2                           installed                          
containerd.x86_64                            1.4.1-2.amzn2                          @amzn2extra-docker                 
coreutils.x86_64                             8.22-24.amzn2                          installed                          
cpio.x86_64                                  2.11-28.amzn2                          @amzn2-core                        
cpp.x86_64                                   7.3.1-12.amzn2                         @amzn2-core                        
cracklib.x86_64                              2.9.0-11.amzn2.0.2                     installed                          
cracklib-dicts.x86_64                        2.9.0-11.amzn2.0.2                     installed                          
cronie.x86_64                                1.4.11-23.amzn2                        installed                          
cronie-anacron.x86_64                        1.4.11-23.amzn2                        installed                          
crontabs.noarch                              1.11-6.20121102git.amzn2               installed                          
cryptsetup.x86_64                            1.7.4-4.amzn2                          installed                          
cryptsetup-libs.x86_64                       1.7.4-4.amzn2                          installed                          
cscope.x86_64                                15.8-10.amzn2.0.2                      @amzn2-core                        
ctags.x86_64                                 5.8-13.amzn2.0.2                       @amzn2-core                        
curl.x86_64                                  7.61.1-12.amzn2.0.2                    @amzn2-core                        
cyrus-sasl-lib.x86_64                        2.1.26-23.amzn2                        installed                          
cyrus-sasl-plain.x86_64                      2.1.26-23.amzn2                        installed                          
dbus.x86_64                                  1:1.10.24-7.amzn2                      installed                          
dbus-libs.x86_64                             1:1.10.24-7.amzn2                      installed                          
dejavu-fonts-common.noarch                   2.33-6.amzn2                           @amzn2-core                        
dejavu-sans-fonts.noarch                     2.33-6.amzn2                           @amzn2-core                        
device-mapper.x86_64                         7:1.02.146-4.amzn2.0.2                 installed                          
device-mapper-event.x86_64                   7:1.02.146-4.amzn2.0.2                 installed                          
device-mapper-event-libs.x86_64              7:1.02.146-4.amzn2.0.2                 installed                          
device-mapper-libs.x86_64                    7:1.02.146-4.amzn2.0.2                 installed                          
device-mapper-persistent-data.x86_64         0.7.3-3.amzn2                          installed                          
dhclient.x86_64                              12:4.2.5-77.amzn2.1.1                  installed                          
dhcp-common.x86_64                           12:4.2.5-77.amzn2.1.1                  installed                          
dhcp-libs.x86_64                             12:4.2.5-77.amzn2.1.1                  installed                          
diffstat.x86_64                              1.57-4.amzn2.0.2                       @amzn2-core                        
diffutils.x86_64                             3.3-5.amzn2                            installed                          
dmidecode.x86_64                             1:3.0-5.amzn2.0.2                      installed                          
dmraid.x86_64                                1.0.0.rc16-28.amzn2.0.2                installed                          
dmraid-events.x86_64                         1.0.0.rc16-28.amzn2.0.2                installed                          
docker.x86_64                                19.03.13ce-1.amzn2                     @amzn2extra-docker                 
dosfstools.x86_64                            3.0.20-10.amzn2                        installed                          
doxygen.x86_64                               1:1.8.5-4.amzn2                        @amzn2-core                        
dracut.x86_64                                033-535.amzn2.1.3                      installed                          
dracut-config-generic.x86_64                 033-535.amzn2.1.3                      installed                          
dwz.x86_64                                   0.11-3.amzn2.0.2                       @amzn2-core                        
dyninst.x86_64                               9.3.1-3.amzn2                          @amzn2-core                        
e2fsprogs.x86_64                             1.42.9-19.amzn2                        @amzn2-core                        
e2fsprogs-libs.x86_64                        1.42.9-19.amzn2                        @amzn2-core                        
ec2-hibinit-agent.noarch                     1.0.2-3.amzn2                          @amzn2-core                        
ec2-instance-connect.noarch                  1.1-13.amzn2                           @amzn2-core                        
ec2-net-utils.noarch                         1.4-3.amzn2                            @amzn2-core                        
ec2-utils.noarch                             1.2-3.amzn2                            @amzn2-core                        
ed.x86_64                                    1.9-4.amzn2.0.2                        installed                          
efivar-libs.x86_64                           31-4.amzn2.0.4                         @amzn2-core                        
elfutils.x86_64                              0.176-2.amzn2                          @amzn2-core                        
elfutils-default-yama-scope.noarch           0.176-2.amzn2                          installed                          
elfutils-libelf.x86_64                       0.176-2.amzn2                          installed                          
elfutils-libelf-devel.x86_64                 0.176-2.amzn2                          @amzn2-core                        
elfutils-libs.x86_64                         0.176-2.amzn2                          installed                          
emacs-filesystem.noarch                      1:25.3-3.amzn2.0.2                     @amzn2-core                        
epel-release.noarch                          7-11                                   @amzn2extra-epel                   
ethtool.x86_64                               2:4.8-10.amzn2                         @amzn2-core                        
expat.x86_64                                 2.1.0-12.amzn2                         @amzn2-core                        
file.x86_64                                  5.11-36.amzn2.0.1                      @amzn2-core                        
file-libs.x86_64                             5.11-36.amzn2.0.1                      @amzn2-core                        
filesystem.x86_64                            3.2-25.amzn2.0.4                       installed                          
findutils.x86_64                             1:4.5.11-6.amzn2                       @amzn2-core                        
fipscheck.x86_64                             1.4.1-6.amzn2.0.2                      installed                          
fipscheck-lib.x86_64                         1.4.1-6.amzn2.0.2                      installed                          
flex.x86_64                                  2.5.37-3.amzn2.0.3                     @amzn2-core                        
fontconfig.x86_64                            2.13.0-4.3.amzn2                       @amzn2-core                        
fontpackages-filesystem.noarch               1.44-8.amzn2                           @amzn2-core                        
freetype.x86_64                              2.8-14.amzn2.1                         @amzn2-core                        
gawk.x86_64                                  4.0.2-4.amzn2.1.2                      installed                          
gcc.x86_64                                   7.3.1-12.amzn2                         @amzn2-core                        
gcc-c++.x86_64                               7.3.1-12.amzn2                         @amzn2-core                        
gcc-gfortran.x86_64                          7.3.1-12.amzn2                         @amzn2-core                        
gdb.x86_64                                   8.0.1-30.amzn2.0.3                     @amzn2-core                        
gdb-gdbserver.x86_64                         8.0.1-30.amzn2.0.3                     @amzn2-core                        
gdbm.x86_64                                  1:1.13-6.amzn2.0.2                     installed                          
gdisk.x86_64                                 0.8.10-3.amzn2                         @amzn2-core                        
generic-logos.noarch                         18.0.0-4.amzn2                         installed                          
generic-logos-httpd.noarch                   18.0.0-4.amzn2                         @amzn2-core                        
gettext.x86_64                               0.19.8.1-3.amzn2                       @amzn2-core                        
gettext-common-devel.noarch                  0.19.8.1-3.amzn2                       @amzn2-core                        
gettext-devel.x86_64                         0.19.8.1-3.amzn2                       @amzn2-core                        
gettext-libs.x86_64                          0.19.8.1-3.amzn2                       @amzn2-core                        
git.x86_64                                   2.23.3-1.amzn2.0.1                     @amzn2-core                        
git-core.x86_64                              2.23.3-1.amzn2.0.1                     @amzn2-core                        
git-core-doc.noarch                          2.23.3-1.amzn2.0.1                     @amzn2-core                        
glib2.x86_64                                 2.56.1-7.amzn2.0.1                     @amzn2-core                        
glibc.x86_64                                 2.26-39.amzn2                          @amzn2-core                        
glibc-all-langpacks.x86_64                   2.26-39.amzn2                          @amzn2-core                        
glibc-common.x86_64                          2.26-39.amzn2                          @amzn2-core                        
glibc-devel.x86_64                           2.26-39.amzn2                          @amzn2-core                        
glibc-headers.x86_64                         2.26-39.amzn2                          @amzn2-core                        
glibc-locale-source.x86_64                   2.26-39.amzn2                          @amzn2-core                        
glibc-minimal-langpack.x86_64                2.26-39.amzn2                          @amzn2-core                        
gmp.x86_64                                   1:6.0.0-15.amzn2.0.2                   installed                          
gnupg2.x86_64                                2.0.22-5.amzn2.0.4                     @amzn2-core                        
gnutls.x86_64                                3.3.29-9.amzn2                         @amzn2-core                        
golang.x86_64                                1.15.5-1.amzn2.0.2                     @amzn2-core                        
golang-bin.x86_64                            1.15.5-1.amzn2.0.2                     @amzn2-core                        
golang-src.noarch                            1.15.5-1.amzn2.0.2                     @amzn2-core                        
gpgme.x86_64                                 1.3.2-5.amzn2.0.2                      installed                          
gpm-libs.x86_64                              1.20.7-15.amzn2.0.2                    installed                          
grep.x86_64                                  2.20-3.amzn2.0.2                       installed                          
groff-base.x86_64                            1.22.2-8.amzn2.0.2                     installed                          
grub2.x86_64                                 1:2.02-35.amzn2.0.4                    installed                          
grub2-common.noarch                          1:2.02-35.amzn2.0.4                    installed                          
grub2-pc.x86_64                              1:2.02-35.amzn2.0.4                    installed                          
grub2-pc-modules.noarch                      1:2.02-35.amzn2.0.4                    installed                          
grub2-tools.x86_64                           1:2.02-35.amzn2.0.4                    installed                          
grub2-tools-extra.x86_64                     1:2.02-35.amzn2.0.4                    installed                          
grub2-tools-minimal.x86_64                   1:2.02-35.amzn2.0.4                    installed                          
grubby.x86_64                                8.28-23.amzn2.0.1                      installed                          
gssproxy.x86_64                              0.7.0-17.amzn2                         installed                          
gzip.x86_64                                  1.5-10.amzn2                           installed                          
hardlink.x86_64                              1:1.3-3.amzn2                          installed                          
hibagent.noarch                              1.1.0-5.amzn2                          installed                          
hostname.x86_64                              3.13-3.amzn2.0.2                       installed                          
httpd.x86_64                                 2.4.46-1.amzn2                         @amzn2-core                        
httpd-filesystem.noarch                      2.4.46-1.amzn2                         @amzn2-core                        
httpd-tools.x86_64                           2.4.46-1.amzn2                         @amzn2-core                        
hunspell.x86_64                              1.3.2-16.amzn2                         @amzn2-core                        
hunspell-en.noarch                           0.20121024-6.amzn2.0.1                 installed                          
hunspell-en-GB.noarch                        0.20121024-6.amzn2.0.1                 installed                          
hunspell-en-US.noarch                        0.20121024-6.amzn2.0.1                 installed                          
hwdata.x86_64                                0.252-9.3.amzn2                        @amzn2-core                        
indent.x86_64                                2.2.11-13.amzn2.0.2                    @amzn2-core                        
info.x86_64                                  5.1-5.amzn2                            installed                          
initscripts.x86_64                           9.49.47-1.amzn2.0.1                    installed                          
intltool.noarch                              0.50.2-7.amzn2                         @amzn2-core                        
iproute.x86_64                               4.15.0-1.amzn2.0.4                     @amzn2-core                        
iptables.x86_64                              1.8.4-10.amzn2.1.2                     @amzn2-core                        
iptables-libs.x86_64                         1.8.4-10.amzn2.1.2                     @amzn2-core                        
iputils.x86_64                               20160308-10.amzn2.0.2                  installed                          
irqbalance.x86_64                            2:1.5.0-4.amzn2.0.1                    installed                          
jansson.x86_64                               2.10-1.amzn2.0.2                       installed                          
java-11-amazon-corretto-headless.x86_64      1:11.0.9+12-1.amzn2                    @amzn2-core                        
javapackages-tools.noarch                    3.4.1-11.amzn2                         @amzn2-core                        
jbigkit-libs.x86_64                          2.0-11.amzn2.0.2                       installed                          
json-c.x86_64                                0.11-4.amzn2.0.4                       @amzn2-core                        
kbd.x86_64                                   1.15.5-15.amzn2                        @amzn2-core                        
kbd-legacy.noarch                            1.15.5-15.amzn2                        @amzn2-core                        
kbd-misc.noarch                              1.15.5-15.amzn2                        @amzn2-core                        
kernel.x86_64                                4.14.165-131.185.amzn2                 installed                          
kernel.x86_64                                4.14.209-160.339.amzn2                 @amzn2-core                        
kernel.x86_64                                4.14.214-160.339.amzn2                 @amzn2-core                        
kernel-devel.x86_64                          4.14.209-160.339.amzn2                 @amzn2-core                        
kernel-devel.x86_64                          4.14.214-160.339.amzn2                 @amzn2-core                        
kernel-headers.x86_64                        4.14.214-160.339.amzn2                 @amzn2-core                        
kernel-tools.x86_64                          4.14.214-160.339.amzn2                 @amzn2-core                        
keyutils.x86_64                              1.5.8-3.amzn2.0.2                      installed                          
keyutils-libs.x86_64                         1.5.8-3.amzn2.0.2                      installed                          
keyutils-libs-devel.x86_64                   1.5.8-3.amzn2.0.2                      @amzn2-core                        
kmod.x86_64                                  25-3.amzn2.0.2                         installed                          
kmod-libs.x86_64                             25-3.amzn2.0.2                         installed                          
kpartx.x86_64                                0.4.9-127.amzn2                        @amzn2-core                        
kpatch-runtime.noarch                        0.8.0-4.amzn2                          @amzn2-core                        
krb5-devel.x86_64                            1.15.1-37.amzn2.2.2                    @amzn2-core                        
krb5-libs.x86_64                             1.15.1-37.amzn2.2.2                    installed                          
langtable.noarch                             0.0.31-4.amzn2                         @amzn2-core                        
langtable-data.noarch                        0.0.31-4.amzn2                         @amzn2-core                        
langtable-python.noarch                      0.0.31-4.amzn2                         @amzn2-core                        
less.x86_64                                  458-9.amzn2.0.2                        installed                          
libacl.x86_64                                2.2.51-14.amzn2                        installed                          
libaio.x86_64                                0.3.109-13.amzn2.0.2                   installed                          
libassuan.x86_64                             2.1.0-3.amzn2.0.2                      installed                          
libatomic.x86_64                             7.3.1-12.amzn2                         @amzn2-core                        
libattr.x86_64                               2.4.46-12.amzn2.0.2                    installed                          
libbasicobjects.x86_64                       0.1.1-29.amzn2                         installed                          
libblkid.x86_64                              2.30.2-2.amzn2.0.4                     installed                          
libcap.x86_64                                2.22-9.amzn2.0.2                       installed                          
libcap-ng.x86_64                             0.7.5-4.amzn2.0.4                      installed                          
libcgroup.x86_64                             0.41-21.amzn2                          @amzn2-core                        
libcilkrts.x86_64                            7.3.1-12.amzn2                         @amzn2-core                        
libcollection.x86_64                         0.7.0-29.amzn2                         installed                          
libcom_err.x86_64                            1.42.9-19.amzn2                        @amzn2-core                        
libcom_err-devel.x86_64                      1.42.9-19.amzn2                        @amzn2-core                        
libconfig.x86_64                             1.4.9-5.amzn2.0.2                      installed                          
libcroco.x86_64                              0.6.12-6.amzn2                         @amzn2-core                        
libcrypt.x86_64                              2.26-39.amzn2                          @amzn2-core                        
libcurl.x86_64                               7.61.1-12.amzn2.0.2                    @amzn2-core                        
libdaemon.x86_64                             0.14-7.amzn2.0.2                       installed                          
libdb.x86_64                                 5.3.21-24.amzn2.0.3                    installed                          
libdb-utils.x86_64                           5.3.21-24.amzn2.0.3                    installed                          
libdrm.x86_64                                2.4.97-2.amzn2                         @amzn2-core                        
libdwarf.x86_64                              20130207-4.amzn2.0.2                   installed                          
libedit.x86_64                               3.0-12.20121213cvs.amzn2.0.2           installed                          
libestr.x86_64                               0.1.9-2.amzn2.0.2                      installed                          
libevent.x86_64                              2.0.21-4.amzn2.0.3                     installed                          
libfastjson.x86_64                           0.99.4-3.amzn2                         @amzn2-core                        
libfdisk.x86_64                              2.30.2-2.amzn2.0.4                     installed                          
libffi.x86_64                                3.0.13-18.amzn2.0.2                    installed                          
libffi-devel.x86_64                          3.0.13-18.amzn2.0.2                    @amzn2-core                        
libgcc.x86_64                                7.3.1-12.amzn2                         @amzn2-core                        
libgcrypt.x86_64                             1.5.3-14.amzn2.0.2                     installed                          
libgfortran.x86_64                           7.3.1-12.amzn2                         @amzn2-core                        
libgomp.x86_64                               7.3.1-12.amzn2                         @amzn2-core                        
libgpg-error.x86_64                          1.12-3.amzn2.0.3                       installed                          
libicu.x86_64                                50.2-4.amzn2                           @amzn2-core                        
libidn.x86_64                                1.28-4.amzn2.0.2                       installed                          
libidn2.x86_64                               2.3.0-1.amzn2                          installed                          
libini_config.x86_64                         1.3.1-29.amzn2                         installed                          
libitm.x86_64                                7.3.1-12.amzn2                         @amzn2-core                        
libjpeg-turbo.x86_64                         1.2.90-6.amzn2.0.3                     installed                          
libkadm5.x86_64                              1.15.1-37.amzn2.2.2                    @amzn2-core                        
libmetalink.x86_64                           0.1.3-13.amzn2                         @amzn2-core                        
libmnl.x86_64                                1.0.3-7.amzn2.0.2                      installed                          
libmodman.x86_64                             2.0.1-8.amzn2.0.2                      @amzn2-core                        
libmount.x86_64                              2.30.2-2.amzn2.0.4                     installed                          
libmpc.x86_64                                1.0.1-3.amzn2.0.2                      @amzn2-core                        
libmpx.x86_64                                7.3.1-12.amzn2                         @amzn2-core                        
libnetfilter_conntrack.x86_64                1.0.6-1.amzn2.0.2                      installed                          
libnfnetlink.x86_64                          1.0.1-4.amzn2.0.2                      installed                          
libnfsidmap.x86_64                           0.25-19.amzn2                          installed                          
libnghttp2.x86_64                            1.41.0-1.amzn2                         @amzn2-core                        
libnl3.x86_64                                3.2.28-4.amzn2.0.1                     installed                          
libnl3-cli.x86_64                            3.2.28-4.amzn2.0.1                     installed                          
libpath_utils.x86_64                         0.2.1-29.amzn2                         installed                          
libpcap.x86_64                               14:1.5.3-11.amzn2                      installed                          
libpciaccess.x86_64                          0.14-1.amzn2                           installed                          
libpipeline.x86_64                           1.2.3-3.amzn2.0.2                      installed                          
libpng.x86_64                                2:1.5.13-8.amzn2                       @amzn2-core                        
libproxy.x86_64                              0.4.11-10.amzn2.0.3                    @amzn2-core                        
libpwquality.x86_64                          1.2.3-5.amzn2                          installed                          
libquadmath.x86_64                           7.3.1-12.amzn2                         @amzn2-core                        
libref_array.x86_64                          0.1.5-29.amzn2                         installed                          
libsanitizer.x86_64                          7.3.1-12.amzn2                         @amzn2-core                        
libseccomp.x86_64                            2.4.1-1.amzn2                          installed                          
libsecret.x86_64                             0.18.5-2.amzn2.0.2                     @amzn2-core                        
libselinux.x86_64                            2.5-12.amzn2.0.2                       installed                          
libselinux-devel.x86_64                      2.5-12.amzn2.0.2                       @amzn2-core                        
libselinux-utils.x86_64                      2.5-12.amzn2.0.2                       installed                          
libsemanage.x86_64                           2.5-11.amzn2                           installed                          
libsepol.x86_64                              2.5-8.1.amzn2.0.2                      installed                          
libsepol-devel.x86_64                        2.5-8.1.amzn2.0.2                      @amzn2-core                        
libsmartcols.x86_64                          2.30.2-2.amzn2.0.4                     installed                          
libss.x86_64                                 1.42.9-19.amzn2                        @amzn2-core                        
libssh2.x86_64                               1.4.3-12.amzn2.2.3                     @amzn2-core                        
libsss_idmap.x86_64                          1.16.4-21.amzn2                        installed                          
libsss_nss_idmap.x86_64                      1.16.4-21.amzn2                        installed                          
libstdc++.x86_64                             7.3.1-12.amzn2                         @amzn2-core                        
libstoragemgmt.x86_64                        1.6.1-2.amzn2                          installed                          
libstoragemgmt-python.noarch                 1.6.1-2.amzn2                          installed                          
libstoragemgmt-python-clibs.x86_64           1.6.1-2.amzn2                          installed                          
libsysfs.x86_64                              2.1.0-16.amzn2.0.2                     installed                          
libtasn1.x86_64                              4.10-1.amzn2.0.2                       installed                          
libteam.x86_64                               1.27-9.amzn2                           @amzn2-core                        
libtiff.x86_64                               4.0.3-35.amzn2                         @amzn2-core                        
libtirpc.x86_64                              0.2.4-0.16.amzn2                       @amzn2-core                        
libtool.x86_64                               2.4.2-22.2.amzn2.0.2                   @amzn2-core                        
libunistring.x86_64                          0.9.3-9.amzn2.0.2                      installed                          
libuser.x86_64                               0.60-9.amzn2                           installed                          
libutempter.x86_64                           1.1.6-4.amzn2.0.2                      installed                          
libuuid.x86_64                               2.30.2-2.amzn2.0.4                     installed                          
libuv.x86_64                                 1:1.39.0-1.amzn2                       @amzn2-core                        
libverto.x86_64                              0.2.5-4.amzn2.0.2                      installed                          
libverto-devel.x86_64                        0.2.5-4.amzn2.0.2                      @amzn2-core                        
libverto-libevent.x86_64                     0.2.5-4.amzn2.0.2                      installed                          
libwebp.x86_64                               0.3.0-7.amzn2                          installed                          
libxml2.x86_64                               2.9.1-6.amzn2.5.1                      @amzn2-core                        
libxml2-python.x86_64                        2.9.1-6.amzn2.5.1                      @amzn2-core                        
libxslt.x86_64                               1.1.28-6.amzn2                         @amzn2-core                        
libyaml.x86_64                               0.1.4-11.amzn2.0.2                     installed                          
libyaml-devel.x86_64                         0.1.4-11.amzn2.0.2                     @amzn2-core                        
lm_sensors-libs.x86_64                       3.4.0-8.20160601gitf9185e5.amzn2       @amzn2-core                        
logrotate.x86_64                             3.8.6-15.amzn2                         installed                          
lsof.x86_64                                  4.87-6.amzn2                           @amzn2-core                        
lua.x86_64                                   5.1.4-15.amzn2.0.2                     installed                          
lvm2.x86_64                                  7:2.02.177-4.amzn2.0.2                 installed                          
lvm2-libs.x86_64                             7:2.02.177-4.amzn2.0.2                 installed                          
lz4.x86_64                                   1.7.5-2.amzn2.0.1                      installed                          
m4.x86_64                                    1.4.16-10.amzn2.0.2                    @amzn2-core                        
mailcap.noarch                               2.1.41-2.amzn2                         @amzn2-core                        
make.x86_64                                  1:3.82-24.amzn2                        @amzn2-core                        
man-db.x86_64                                2.6.3-9.amzn2.0.3                      installed                          
man-pages.noarch                             3.53-5.amzn2                           installed                          
man-pages-overrides.x86_64                   7.5.2-1.amzn2                          installed                          
mariadb.x86_64                               3:10.2.10-2.amzn2.0.3                  @amzn2extra-lamp-mariadb10.2-php7.2
mariadb-common.x86_64                        3:10.2.10-2.amzn2.0.3                  @amzn2extra-lamp-mariadb10.2-php7.2
mariadb-config.x86_64                        3:10.2.10-2.amzn2.0.3                  @amzn2extra-lamp-mariadb10.2-php7.2
mariadb-libs.x86_64                          3:10.2.10-2.amzn2.0.3                  @amzn2extra-lamp-mariadb10.2-php7.2
mdadm.x86_64                                 4.0-5.amzn2.0.2                        installed                          
mercurial.x86_64                             2.6.2-10.amzn2                         @amzn2-core                        
microcode_ctl.x86_64                         2:2.1-47.amzn2.0.7                     @amzn2-core                        
mlocate.x86_64                               0.26-8.amzn2                           installed                          
mod_http2.x86_64                             1.15.14-2.amzn2                        @amzn2-core                        
mokutil.x86_64                               1:0.3.0-10.amzn2.0.1                   @amzn2-core                        
mpfr.x86_64                                  3.1.1-4.amzn2.0.2                      @amzn2-core                        
mtr.x86_64                                   2:0.92-2.amzn2                         installed                          
nano.x86_64                                  2.9.8-2.amzn2.0.1                      installed                          
ncurses.x86_64                               6.0-8.20170212.amzn2.1.3               installed                          
ncurses-base.noarch                          6.0-8.20170212.amzn2.1.3               installed                          
ncurses-c++-libs.x86_64                      6.0-8.20170212.amzn2.1.3               @amzn2-core                        
ncurses-devel.x86_64                         6.0-8.20170212.amzn2.1.3               @amzn2-core                        
ncurses-libs.x86_64                          6.0-8.20170212.amzn2.1.3               installed                          
neon.x86_64                                  0.30.0-3.amzn2.0.2                     @amzn2-core                        
net-tools.x86_64                             2.0-0.22.20131004git.amzn2.0.2         installed                          
nettle.x86_64                                2.7.1-8.amzn2.0.2                      @amzn2-core                        
newt.x86_64                                  0.52.15-4.amzn2.0.2                    installed                          
newt-python.x86_64                           0.52.15-4.amzn2.0.2                    installed                          
nfs-utils.x86_64                             1:1.3.0-0.54.amzn2.0.2                 installed                          
nodejs.x86_64                                1:6.17.1-1.el7                         @epel                              
npm.x86_64                                   1:3.10.10-1.6.17.1.1.el7               @epel                              
nspr.x86_64                                  4.25.0-2.amzn2                         @amzn2-core                        
nss.x86_64                                   3.53.1-3.amzn2                         @amzn2-core                        
nss-pem.x86_64                               1.0.3-5.amzn2                          installed                          
nss-softokn.x86_64                           3.53.1-6.amzn2                         @amzn2-core                        
nss-softokn-freebl.x86_64                    3.53.1-6.amzn2                         @amzn2-core                        
nss-sysinit.x86_64                           3.53.1-3.amzn2                         @amzn2-core                        
nss-tools.x86_64                             3.53.1-3.amzn2                         @amzn2-core                        
nss-util.x86_64                              3.53.1-1.amzn2                         @amzn2-core                        
ntsysv.x86_64                                1.7.4-1.amzn2.0.2                      installed                          
numactl-libs.x86_64                          2.0.9-7.amzn2                          installed                          
openldap.x86_64                              2.4.44-22.amzn2                        @amzn2-core                        
openssh.x86_64                               7.4p1-21.amzn2.0.1                     installed                          
openssh-clients.x86_64                       7.4p1-21.amzn2.0.1                     installed                          
openssh-server.x86_64                        7.4p1-21.amzn2.0.1                     installed                          
openssl.x86_64                               1:1.0.2k-19.amzn2.0.4                  @amzn2-core                        
openssl-devel.x86_64                         1:1.0.2k-19.amzn2.0.4                  @amzn2-core                        
openssl-libs.x86_64                          1:1.0.2k-19.amzn2.0.4                  @amzn2-core                        
os-prober.x86_64                             1.58-9.amzn2.0.2                       installed                          
p11-kit.x86_64                               0.23.22-1.amzn2.0.1                    @amzn2-core                        
p11-kit-trust.x86_64                         0.23.22-1.amzn2.0.1                    @amzn2-core                        
pakchois.x86_64                              0.4-10.amzn2.0.2                       @amzn2-core                        
pam.x86_64                                   1.1.8-23.amzn2.0.1                     @amzn2-core                        
parted.x86_64                                3.1-29.amzn2                           installed                          
passwd.x86_64                                0.79-5.amzn2                           @amzn2-core                        
patch.x86_64                                 2.7.1-12.amzn2.0.2                     @amzn2-core                        
patchutils.x86_64                            0.3.3-4.amzn2.0.1                      @amzn2-core                        
pciutils.x86_64                              3.5.1-3.amzn2                          installed                          
pciutils-libs.x86_64                         3.5.1-3.amzn2                          installed                          
pcre.x86_64                                  8.32-17.amzn2.0.2                      installed                          
pcre-devel.x86_64                            8.32-17.amzn2.0.2                      @amzn2-core                        
pcre2.x86_64                                 10.23-2.amzn2.0.2                      installed                          
perl.x86_64                                  4:5.16.3-294.amzn2                     installed                          
perl-Carp.noarch                             1.26-244.amzn2                         installed                          
perl-Data-Dumper.x86_64                      2.145-3.amzn2.0.2                      @amzn2-core                        
perl-Encode.x86_64                           2.51-7.amzn2.0.2                       installed                          
perl-Error.noarch                            1:0.17020-2.amzn2                      @amzn2-core                        
perl-Exporter.noarch                         5.68-3.amzn2                           installed                          
perl-File-Path.noarch                        2.09-2.amzn2                           installed                          
perl-File-Temp.noarch                        0.23.01-3.amzn2                        installed                          
perl-Filter.x86_64                           1.49-3.amzn2.0.2                       installed                          
perl-Getopt-Long.noarch                      2.40-3.amzn2                           installed                          
perl-Git.noarch                              2.23.3-1.amzn2.0.1                     @amzn2-core                        
perl-HTTP-Tiny.noarch                        0.033-3.amzn2                          installed                          
perl-PathTools.x86_64                        3.40-5.amzn2.0.2                       installed                          
perl-Pod-Escapes.noarch                      1:1.04-294.amzn2                       installed                          
perl-Pod-Perldoc.noarch                      3.20-4.amzn2                           installed                          
perl-Pod-Simple.noarch                       1:3.28-4.amzn2                         installed                          
perl-Pod-Usage.noarch                        1.63-3.amzn2                           installed                          
perl-Scalar-List-Utils.x86_64                1.27-248.amzn2.0.2                     installed                          
perl-Socket.x86_64                           2.010-4.amzn2.0.2                      installed                          
perl-Storable.x86_64                         2.45-3.amzn2.0.2                       installed                          
perl-TermReadKey.x86_64                      2.30-20.amzn2.0.2                      @amzn2-core                        
perl-Test-Harness.noarch                     3.28-3.amzn2                           @amzn2-core                        
perl-Text-ParseWords.noarch                  3.29-4.amzn2                           installed                          
perl-Thread-Queue.noarch                     3.02-2.amzn2                           @amzn2-core                        
perl-Time-HiRes.x86_64                       4:1.9725-3.amzn2.0.2                   installed                          
perl-Time-Local.noarch                       1.2300-2.amzn2                         installed                          
perl-XML-Parser.x86_64                       2.41-10.amzn2.0.2                      @amzn2-core                        
perl-constant.noarch                         1.27-2.amzn2.0.1                       installed                          
perl-libs.x86_64                             4:5.16.3-294.amzn2                     installed                          
perl-macros.x86_64                           4:5.16.3-294.amzn2                     installed                          
perl-parent.noarch                           1:0.225-244.amzn2.0.1                  installed                          
perl-podlators.noarch                        2.5.1-3.amzn2.0.1                      installed                          
perl-srpm-macros.noarch                      1-8.amzn2.0.1                          @amzn2-core                        
perl-threads.x86_64                          1.87-4.amzn2.0.2                       installed                          
perl-threads-shared.x86_64                   1.43-6.amzn2.0.2                       installed                          
php-cli.x86_64                               7.2.24-1.amzn2.0.1                     @amzn2extra-lamp-mariadb10.2-php7.2
php-common.x86_64                            7.2.24-1.amzn2.0.1                     @amzn2extra-lamp-mariadb10.2-php7.2
php-devel.x86_64                             7.2.24-1.amzn2.0.1                     @amzn2extra-lamp-mariadb10.2-php7.2
php-fpm.x86_64                               7.2.24-1.amzn2.0.1                     @amzn2extra-lamp-mariadb10.2-php7.2
php-json.x86_64                              7.2.24-1.amzn2.0.1                     @amzn2extra-lamp-mariadb10.2-php7.2
php-mysqlnd.x86_64                           7.2.24-1.amzn2.0.1                     @amzn2extra-lamp-mariadb10.2-php7.2
php-pdo.x86_64                               7.2.24-1.amzn2.0.1                     @amzn2extra-lamp-mariadb10.2-php7.2
php-pear.noarch                              1:1.10.12-4.amzn2.0.1                  @amzn2-core                        
php-process.x86_64                           7.2.24-1.amzn2.0.1                     @amzn2extra-lamp-mariadb10.2-php7.2
php-xml.x86_64                               7.2.24-1.amzn2.0.1                     @amzn2extra-lamp-mariadb10.2-php7.2
pigz.x86_64                                  2.3.4-1.amzn2.0.1                      @amzn2-core                        
pinentry.x86_64                              0.8.1-17.amzn2.0.2                     installed                          
pkgconfig.x86_64                             1:0.27.1-4.amzn2.0.2                   installed                          
plymouth.x86_64                              0.8.9-0.28.20140113.amzn2.0.2          installed                          
plymouth-core-libs.x86_64                    0.8.9-0.28.20140113.amzn2.0.2          installed                          
plymouth-scripts.x86_64                      0.8.9-0.28.20140113.amzn2.0.2          installed                          
pm-utils.x86_64                              1.4.1-27.amzn2.0.1                     installed                          
policycoreutils.x86_64                       2.5-22.amzn2                           installed                          
popt.x86_64                                  1.13-16.amzn2.0.2                      installed                          
postfix.x86_64                               2:2.10.1-6.amzn2.0.3                   installed                          
procps-ng.x86_64                             3.3.10-26.amzn2                        installed                          
psacct.x86_64                                6.6.1-13.amzn2.0.2                     installed                          
psmisc.x86_64                                22.20-15.amzn2.0.2                     installed                          
pth.x86_64                                   2.0.7-23.amzn2.0.2                     installed                          
pygpgme.x86_64                               0.3-9.amzn2.0.2                        installed                          
pyliblzma.x86_64                             0.5.3-11.amzn2.0.2                     installed                          
pystache.noarch                              0.5.3-2.amzn2                          installed                          
python.x86_64                                2.7.18-1.amzn2.0.2                     @amzn2-core                        
python-babel.noarch                          0.9.6-8.amzn2.0.1                      installed                          
python-backports.x86_64                      1.0-8.amzn2.0.2                        installed                          
python-backports-ssl_match_hostname.noarch   3.5.0.1-1.amzn2                        installed                          
python-cffi.x86_64                           1.6.0-5.amzn2.0.2                      installed                          
python-chardet.noarch                        2.2.1-1.amzn2                          installed                          
python-colorama.noarch                       0.3.2-3.amzn2                          installed                          
python-configobj.noarch                      4.7.2-7.amzn2                          installed                          
python-daemon.noarch                         1.6-4.amzn2                            installed                          
python-devel.x86_64                          2.7.18-1.amzn2.0.2                     @amzn2-core                        
python-docutils.noarch                       0.12-0.2.20140510svn7747.amzn2         installed                          
python-enum34.noarch                         1.0.4-1.amzn2                          installed                          
python-idna.noarch                           2.4-1.amzn2                            installed                          
python-iniparse.noarch                       0.4-9.amzn2                            installed                          
python-ipaddress.noarch                      1.0.16-2.amzn2                         installed                          
python-javapackages.noarch                   3.4.1-11.amzn2                         @amzn2-core                        
python-jinja2.noarch                         2.7.2-3.amzn2                          installed                          
python-jsonpatch.noarch                      1.2-4.amzn2                            installed                          
python-jsonpointer.noarch                    1.9-2.amzn2                            installed                          
python-jwcrypto.noarch                       0.4.2-1.amzn2                          installed                          
python-kitchen.noarch                        1.1.1-5.amzn2                          installed                          
python-libs.x86_64                           2.7.18-1.amzn2.0.2                     @amzn2-core                        
python-lxml.x86_64                           3.2.1-4.amzn2.0.2                      @amzn2-core                        
python-markupsafe.x86_64                     0.11-10.amzn2.0.2                      installed                          
python-pillow.x86_64                         2.0.0-21.gitd1c6db8.amzn2.0.1          @amzn2-core                        
python-ply.noarch                            3.4-11.amzn2                           installed                          
python-pycparser.noarch                      2.14-1.amzn2                           installed                          
python-pycurl.x86_64                         7.19.0-19.amzn2.0.2                    installed                          
python-repoze-lru.noarch                     0.4-3.amzn2                            installed                          
python-requests.noarch                       2.6.0-7.amzn2                          installed                          
python-six.noarch                            1.9.0-2.amzn2                          installed                          
python-urlgrabber.noarch                     3.10-9.amzn2.0.1                       installed                          
python-urllib3.noarch                        1.25.7-1.amzn2.0.1                     @amzn2-core                        
python2-botocore.noarch                      1.18.6-1.amzn2.0.1                     @amzn2-core                        
python2-cryptography.x86_64                  1.7.2-2.amzn2                          installed                          
python2-dateutil.noarch                      1:2.6.0-3.amzn2.0.1                    installed                          
python2-futures.noarch                       3.0.5-1.amzn2                          installed                          
python2-jmespath.noarch                      0.9.3-1.amzn2.0.1                      installed                          
python2-jsonschema.noarch                    2.5.1-3.amzn2.0.1                      installed                          
python2-lockfile.noarch                      1:0.11.0-17.el7                        @epel                              
python2-oauthlib.noarch                      2.0.1-8.amzn2.0.1                      installed                          
python2-pip.noarch                           9.0.3-1.amzn2.0.2                      @amzn2-core                        
python2-pyasn1.noarch                        0.1.9-7.amzn2.0.1                      installed                          
python2-rpm.x86_64                           4.11.3-40.amzn2.0.5                    @amzn2-core                        
python2-rsa.noarch                           3.4.1-1.amzn2.0.1                      @amzn2-core                        
python2-s3transfer.noarch                    0.3.3-1.amzn2.0.1                      @amzn2-core                        
python2-setuptools.noarch                    38.4.0-3.amzn2.0.6                     installed                          
python2-simplejson.x86_64                    3.10.0-2.el7                           @epel                              
python3.x86_64                               3.7.9-1.amzn2.0.1                      @amzn2-core                        
python3-devel.x86_64                         3.7.9-1.amzn2.0.1                      @amzn2-core                        
python3-libs.x86_64                          3.7.9-1.amzn2.0.1                      @amzn2-core                        
python3-pip.noarch                           9.0.3-1.amzn2.0.2                      @amzn2-core                        
python3-rpm-macros.noarch                    3-23.amzn2                             @amzn2-core                        
python3-setuptools.noarch                    38.4.0-3.amzn2.0.6                     @amzn2-core                        
pyxattr.x86_64                               0.5.1-5.amzn2.0.2                      installed                          
qrencode-libs.x86_64                         3.4.1-3.amzn2.0.2                      installed                          
quota.x86_64                                 1:4.01-17.amzn2                        installed                          
quota-nls.noarch                             1:4.01-17.amzn2                        installed                          
rcs.x86_64                                   5.9.0-5.amzn2.0.2                      @amzn2-core                        
rdate.x86_64                                 1.4-25.amzn2.0.1                       installed                          
readline.x86_64                              6.2-10.amzn2.0.2                       installed                          
readline-devel.x86_64                        6.2-10.amzn2.0.2                       @amzn2-core                        
rng-tools.x86_64                             6.8-3.amzn2.0.4                        @amzn2-core                        
rootfiles.noarch                             8.1-11.amzn2                           installed                          
rpcbind.x86_64                               0.2.0-44.amzn2                         installed                          
rpm.x86_64                                   4.11.3-40.amzn2.0.5                    @amzn2-core                        
rpm-build.x86_64                             4.11.3-40.amzn2.0.5                    @amzn2-core                        
rpm-build-libs.x86_64                        4.11.3-40.amzn2.0.5                    @amzn2-core                        
rpm-libs.x86_64                              4.11.3-40.amzn2.0.5                    @amzn2-core                        
rpm-plugin-systemd-inhibit.x86_64            4.11.3-40.amzn2.0.5                    @amzn2-core                        
rpm-sign.x86_64                              4.11.3-40.amzn2.0.5                    @amzn2-core                        
rsync.x86_64                                 3.1.2-4.amzn2                          installed                          
rsyslog.x86_64                               8.24.0-52.amzn2                        @amzn2-core                        
ruby.x86_64                                  2.0.0.648-36.amzn2.0.1                 @amzn2-core                        
ruby-irb.noarch                              2.0.0.648-36.amzn2.0.1                 @amzn2-core                        
ruby-libs.x86_64                             2.0.0.648-36.amzn2.0.1                 @amzn2-core                        
rubygem-bigdecimal.x86_64                    1.2.0-36.amzn2.0.1                     @amzn2-core                        
rubygem-io-console.x86_64                    0.4.2-36.amzn2.0.1                     @amzn2-core                        
rubygem-json.x86_64                          1.7.7-36.amzn2.0.1                     @amzn2-core                        
rubygem-psych.x86_64                         2.0.0-36.amzn2.0.1                     @amzn2-core                        
rubygem-rdoc.noarch                          4.0.0-36.amzn2.0.1                     @amzn2-core                        
rubygems.noarch                              2.0.14.1-36.amzn2.0.1                  @amzn2-core                        
runc.x86_64                                  1.0.0-0.1.20200826.gitff819c7.amzn2    @amzn2extra-docker                 
scl-utils.x86_64                             20130529-18.amzn2.0.1                  installed                          
screen.x86_64                                4.1.0-0.25.20120314git3c2946.amzn2     installed                          
sed.x86_64                                   4.2.2-5.amzn2.0.2                      installed                          
selinux-policy.noarch                        3.13.1-192.amzn2.6.5                   @amzn2-core                        
selinux-policy-targeted.noarch               3.13.1-192.amzn2.6.5                   @amzn2-core                        
setserial.x86_64                             2.17-33.amzn2.0.1                      installed                          
setup.noarch                                 2.8.71-10.amzn2.0.1                    @amzn2-core                        
setuptool.x86_64                             1.19.11-8.amzn2.0.1                    installed                          
sgpio.x86_64                                 1.2.0.10-13.amzn2.0.1                  installed                          
shadow-utils.x86_64                          2:4.1.5.1-24.amzn2.0.2                 installed                          
shared-mime-info.x86_64                      1.8-4.amzn2                            installed                          
slang.x86_64                                 2.2.4-11.amzn2.0.2                     installed                          
sqlite.x86_64                                3.7.17-8.amzn2.1.1                     @amzn2-core                        
sqlite-devel.x86_64                          3.7.17-8.amzn2.1.1                     @amzn2-core                        
sssd-client.x86_64                           1.16.4-21.amzn2                        installed                          
strace.x86_64                                4.26-1.amzn2.0.1                       @amzn2-core                        
subversion.x86_64                            1.7.14-16.amzn2.0.1                    @amzn2-core                        
subversion-libs.x86_64                       1.7.14-16.amzn2.0.1                    @amzn2-core                        
sudo.x86_64                                  1.8.23-4.amzn2.2.1                     @amzn2-core                        
swig.x86_64                                  3.0.12-11.amzn2.0.3                    @amzn2-core                        
sysctl-defaults.noarch                       1.0-2.amzn2                            installed                          
sysstat.x86_64                               10.1.5-18.amzn2.0.1                    installed                          
system-release.x86_64                        1:2-13.amzn2                           @amzn2-core                        
system-rpm-config.noarch                     9.1.0-76.amzn2.0.10                    @amzn2-core                        
systemd.x86_64                               219-57.amzn2.0.12                      installed                          
systemd-libs.x86_64                          219-57.amzn2.0.12                      installed                          
systemd-sysv.x86_64                          219-57.amzn2.0.12                      installed                          
systemtap.x86_64                             4.2-1.amzn2.0.1                        @amzn2-core                        
systemtap-client.x86_64                      4.2-1.amzn2.0.1                        @amzn2-core                        
systemtap-devel.x86_64                       4.2-1.amzn2.0.1                        @amzn2-core                        
systemtap-runtime.x86_64                     4.2-1.amzn2.0.1                        installed                          
sysvinit-tools.x86_64                        2.88-14.dsf.amzn2.0.2                  installed                          
tar.x86_64                                   2:1.26-35.amzn2                        @amzn2-core                        
tcp_wrappers.x86_64                          7.6-77.amzn2.0.2                       installed                          
tcp_wrappers-libs.x86_64                     7.6-77.amzn2.0.2                       installed                          
tcpdump.x86_64                               14:4.9.2-4.amzn2.1                     installed                          
tcsh.x86_64                                  6.18.01-15.amzn2.0.2                   installed                          
teamd.x86_64                                 1.27-9.amzn2                           @amzn2-core                        
terraform.x86_64                             0.14.5-1                               @hashicorp                         
time.x86_64                                  1.7-45.amzn2.0.2                       installed                          
traceroute.x86_64                            3:2.0.22-2.amzn2.0.1                   installed                          
trousers.x86_64                              0.3.14-2.amzn2.0.2                     @amzn2-core                        
tzdata.noarch                                2020d-2.amzn2                          @amzn2-core                        
unzip.x86_64                                 6.0-21.amzn2                           @amzn2-core                        
update-motd.noarch                           1.1.2-2.amzn2                          installed                          
usermode.x86_64                              1.111-5.amzn2.0.2                      installed                          
ustr.x86_64                                  1.0.4-16.amzn2.0.3                     installed                          
util-linux.x86_64                            2.30.2-2.amzn2.0.4                     installed                          
vim-common.x86_64                            2:8.1.1602-1.amzn2                     installed                          
vim-enhanced.x86_64                          2:8.1.1602-1.amzn2                     installed                          
vim-filesystem.noarch                        2:8.1.1602-1.amzn2                     installed                          
vim-minimal.x86_64                           2:8.1.1602-1.amzn2                     installed                          
virt-what.x86_64                             1.18-4.amzn2                           installed                          
wget.x86_64                                  1.14-18.amzn2.1                        installed                          
which.x86_64                                 2.20-7.amzn2.0.2                       installed                          
words.noarch                                 3.0-22.amzn2                           installed                          
xfsdump.x86_64                               3.1.8-6.amzn2                          installed                          
xfsprogs.x86_64                              4.5.0-18.amzn2.0.1                     installed                          
xz.x86_64                                    5.2.2-1.amzn2.0.2                      installed                          
xz-libs.x86_64                               5.2.2-1.amzn2.0.2                      installed                          
yajl.x86_64                                  2.0.4-4.amzn2.0.1                      installed                          
yum.noarch                                   3.4.3-158.amzn2.0.4                    @amzn2-core                        
yum-cron.noarch                              3.4.3-158.amzn2.0.4                    @amzn2-core                        
yum-langpacks.noarch                         0.4.2-7.amzn2                          installed                          
yum-metadata-parser.x86_64                   1.1.4-10.amzn2.0.2                     installed                          
yum-plugin-priorities.noarch                 1.1.31-46.amzn2.0.1                    installed                          
yum-utils.noarch                             1.1.31-46.amzn2.0.1                    installed                          
zip.x86_64                                   3.0-11.amzn2.0.2                       installed                          
zlib.x86_64                                  1.2.7-18.amzn2                         @amzn2-core                        
zlib-devel.x86_64                            1.2.7-18.amzn2                         @amzn2-core  
</code></pre></div>]]></content>
		</item>
		
		<item>
			<title>bash, zsh で環境変数を使う方法</title>
			<link>https://noid11.github.io/posts/how-to-use-envrionment-variables-at-bash-and-zsh/</link>
			<pubDate>Sat, 06 Feb 2021 15:12:57 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/how-to-use-envrionment-variables-at-bash-and-zsh/</guid>
			<description>&lt;ul&gt;
&lt;li&gt;&lt;code&gt;export&lt;/code&gt; で設定&lt;/li&gt;
&lt;li&gt;&lt;code&gt;printenv&lt;/code&gt; で確認&lt;/li&gt;
&lt;li&gt;&lt;code&gt;unset&lt;/code&gt; で削除
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;export -n&lt;/code&gt; でも削除できるが、これは多分 bash でしか使えないので &lt;code&gt;unset&lt;/code&gt; 使ったほうが良い&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;コマンド例&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-zsh&#34; data-lang=&#34;zsh&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;MYVALUE&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;HOGE&amp;#34;&lt;/span&gt;
printenv MYVALUE
&lt;span class=&#34;nb&#34;&gt;unset&lt;/span&gt; MYVALUE
printenv MYVALUE
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;実行例&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-zsh&#34; data-lang=&#34;zsh&#34;&gt;% &lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;MYVALUE&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;HOGE&amp;#34;&lt;/span&gt;
% printenv MYVALUE
HOGE
% &lt;span class=&#34;nb&#34;&gt;unset&lt;/span&gt; MYVALUE
% printenv MYVALUE
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
			<content type="html"><![CDATA[<ul>
<li><code>export</code> で設定</li>
<li><code>printenv</code> で確認</li>
<li><code>unset</code> で削除
<ul>
<li><code>export -n</code> でも削除できるが、これは多分 bash でしか使えないので <code>unset</code> 使ったほうが良い</li>
</ul>
</li>
</ul>
<p>コマンド例</p>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh"><span class="nb">export</span> <span class="nv">MYVALUE</span><span class="o">=</span><span class="s2">&#34;HOGE&#34;</span>
printenv MYVALUE
<span class="nb">unset</span> MYVALUE
printenv MYVALUE
</code></pre></div><p>実行例</p>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% <span class="nb">export</span> <span class="nv">MYVALUE</span><span class="o">=</span><span class="s2">&#34;HOGE&#34;</span>
% printenv MYVALUE
HOGE
% <span class="nb">unset</span> MYVALUE
% printenv MYVALUE
</code></pre></div><h2 id="export-unset-manual">export, unset manual</h2>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% man <span class="nb">export</span>
BUILTIN<span class="o">(</span>1<span class="o">)</span>                BSD General Commands Manual               BUILTIN<span class="o">(</span>1<span class="o">)</span>

NAME
     builtin, !, %, ., :, @, <span class="o">{</span>, <span class="o">}</span>, alias, alloc, bg, bind, bindkey, break, breaksw, builtins, <span class="k">case</span>, cd, chdir, command, complete, <span class="k">continue</span>, default, dirs,
     <span class="k">do</span>, <span class="k">done</span>, echo, echotc, <span class="k">elif</span>, <span class="k">else</span>, end, endif, endsw, <span class="k">esac</span>, eval, exec, exit, export, false, fc, fg, filetest, <span class="k">fi</span>, <span class="k">for</span>, foreach, getopts, glob, goto,
     hash, hashstat, history, hup, <span class="k">if</span>, jobid, jobs, kill, limit, local, log, login, logout, ls-F, nice, nohup, notify, onintr, popd, printenv, pushd, pwd,
     read, readonly, rehash, repeat, <span class="k">return</span>, sched, set, setenv, settc, setty, setvar, shift, source, stop, suspend, switch, telltc, test, <span class="k">then</span>, time,
     times, trap, true, type, ulimit, umask, unalias, uncomplete, unhash, unlimit, unset, unsetenv, <span class="k">until</span>, wait, where, which, <span class="k">while</span> -- shell built-in com-
     mands

SYNOPSIS
     <span class="nb">builtin</span> <span class="o">[</span>-options<span class="o">]</span> <span class="o">[</span>args ...<span class="o">]</span>

DESCRIPTION
     Shell <span class="nb">builtin</span> commands are commands that can be executed within the running shell<span class="se">\&#39;</span>s process.
     Note that, in the <span class="k">case</span> of csh<span class="o">(</span>1<span class="o">)</span> <span class="nb">builtin</span> commands, the <span class="nb">command</span> is executed in a subshell <span class="k">if</span> it occurs as any component of a pipeline except the last.

     If a <span class="nb">command</span> specified to the shell contains a slash <span class="sb">``</span>/<span class="s1">&#39;&#39;</span>, the shell will not execute a <span class="nb">builtin</span> command, even <span class="k">if</span> the last component of the specified <span class="nb">command</span> matches the name of a <span class="nb">builtin</span> command.  Thus, <span class="k">while</span> specifying <span class="sb">``</span>echo<span class="s1">&#39;&#39;</span> causes a <span class="nb">builtin</span> <span class="nb">command</span> to be executed under shells that support the <span class="nb">echo</span> <span class="nb">builtin</span> command, specifying <span class="sb">``</span>/bin/echo<span class="s1">&#39;&#39;</span> or <span class="sb">``</span>./echo<span class="s1">&#39;&#39;</span> does not.

     While some <span class="nb">builtin</span> commands may exist in more than one shell, their operation may be different under each shell which supports them.
     Below is a table which lists shell <span class="nb">builtin</span> commands, the standard shells that support them and whether they exist as standalone utilities.

     Only <span class="nb">builtin</span> commands <span class="k">for</span> the csh<span class="o">(</span>1<span class="o">)</span> and sh<span class="o">(</span>1<span class="o">)</span> shells are listed here.
     Consult a shell<span class="se">\&#39;</span>s manual page <span class="k">for</span> details on the operation of its <span class="nb">builtin</span> commands.
     Beware that the sh<span class="o">(</span>1<span class="o">)</span> manual page, at least, calls some of these commands <span class="sb">``</span>built-in commands<span class="s1">&#39;&#39;</span> and some of them <span class="sb">``</span>reserved words<span class="s1">&#39;&#39;</span>.
     Users of other shells may need to consult an info<span class="o">(</span>1<span class="o">)</span> page or other sources of documentation.

     Commands marked <span class="sb">``</span>No**<span class="s1">&#39;&#39;</span> under External <span class="k">do</span> exist externally, but are implemented as scripts using a <span class="nb">builtin</span> <span class="nb">command</span> of the same name.

           Command       External    csh<span class="o">(</span>1<span class="o">)</span>    sh<span class="o">(</span>1<span class="o">)</span>
           !             No          No        Yes
           %             No          Yes       No
           .             No          No        Yes
           :             No          Yes       Yes
           @             No          Yes       Yes
           <span class="o">{</span>             No          No        Yes
           <span class="o">}</span>             No          No        Yes
           <span class="nb">alias</span>         No**        Yes       Yes
           alloc         No          Yes       No
           <span class="nb">bg</span>            No**        Yes       Yes
           <span class="nb">bind</span>          No          No        Yes
           bindkey       No          Yes       No
           <span class="nb">break</span>         No          Yes       Yes
           breaksw       No          Yes       No
           <span class="nb">builtin</span>       No          No        Yes
           builtins      No          Yes       No
           <span class="k">case</span>          No          Yes       Yes
           <span class="nb">cd</span>            No**        Yes       Yes
           chdir         No          Yes       Yes
           <span class="nb">command</span>       No**        No        Yes
           <span class="nb">complete</span>      No          Yes       No
           <span class="k">continue</span>      No          Yes       Yes
           default       No          Yes       No
           <span class="nb">dirs</span>          No          Yes       No
           <span class="k">do</span>            No          No        Yes
           <span class="k">done</span>          No          No        Yes
           <span class="nb">echo</span>          Yes         Yes       Yes
           echotc        No          Yes       No
           <span class="k">elif</span>          No          No        Yes
           <span class="k">else</span>          No          Yes       Yes
           end           No          Yes       No
           endif         No          Yes       No
           endsw         No          Yes       No
           <span class="k">esac</span>          No          No        Yes
           <span class="nb">eval</span>          No          Yes       Yes
           <span class="nb">exec</span>          No          Yes       Yes
           <span class="nb">exit</span>          No          Yes       Yes
           <span class="nb">export</span>        No          No        Yes
           <span class="nb">false</span>         Yes         No        Yes
           <span class="nb">fc</span>            No**        No        Yes
           <span class="nb">fg</span>            No**        Yes       Yes
           filetest      No          Yes       No
           <span class="k">fi</span>            No          No        Yes
           <span class="k">for</span>           No          No        Yes
           foreach       No          Yes       No
           <span class="nb">getopts</span>       No**        No        Yes
           glob          No          Yes       No
           goto          No          Yes       No
           <span class="nb">hash</span>          No          No        Yes
           hashstat      No          Yes       No
           <span class="nb">history</span>       No          Yes       No
           hup           No          Yes       No
           <span class="k">if</span>            No          Yes       Yes
           jobid         No          No        Yes
           <span class="nb">jobs</span>          No**        Yes       Yes
           <span class="nb">kill</span>          Yes         Yes       No
           limit         No          Yes       No
           <span class="nb">local</span>         No          No        Yes
           log           No          Yes       No
           login         Yes         Yes       No
           <span class="nb">logout</span>        No          Yes       No
           ls-F          No          Yes       No
           nice          Yes         Yes       No
           nohup         Yes         Yes       No
           notify        No          Yes       No
           onintr        No          Yes       No
           <span class="nb">popd</span>          No          Yes       No
           printenv      Yes         Yes       No
           <span class="nb">pushd</span>         No          Yes       No
           <span class="nb">pwd</span>           Yes         No        Yes
           <span class="nb">read</span>          No**        No        Yes
           <span class="nb">readonly</span>      No          No        Yes
           rehash        No          Yes       No
           repeat        No          Yes       No
           <span class="k">return</span>        No          No        Yes
           sched         No          Yes       No
           <span class="nb">set</span>           No          Yes       Yes
           setenv        No          Yes       No
           settc         No          Yes       No
           setty         No          Yes       No
           setvar        No          No        Yes
           <span class="nb">shift</span>         No          Yes       Yes
           <span class="nb">source</span>        No          Yes       No
           stop          No          Yes       No
           <span class="nb">suspend</span>       No          Yes       No
           switch        No          Yes       No
           telltc        No          Yes       No
           <span class="nb">test</span>          Yes         No        Yes
           <span class="k">then</span>          No          No        Yes
           <span class="nb">time</span>          Yes         Yes       No
           <span class="nb">times</span>         No          No        Yes
           <span class="nb">trap</span>          No          No        Yes
           <span class="nb">true</span>          Yes         No        Yes
           <span class="nb">type</span>          No          No        Yes
           <span class="nb">ulimit</span>        No          No        Yes
           <span class="nb">umask</span>         No**        Yes       Yes
           <span class="nb">unalias</span>       No**        Yes       Yes
           uncomplete    No          Yes       No
           unhash        No          Yes       No
           unlimit       No          Yes       No
           <span class="nb">unset</span>         No          Yes       Yes
           unsetenv      No          Yes       No
           <span class="k">until</span>         No          No        Yes
           <span class="nb">wait</span>          No**        Yes       Yes
           where         No          Yes       No
           which         Yes         Yes       No
           <span class="k">while</span>         No          Yes       Yes

SEE ALSO
     csh<span class="o">(</span>1<span class="o">)</span>, dash<span class="o">(</span>1<span class="o">)</span>, echo<span class="o">(</span>1<span class="o">)</span>, false<span class="o">(</span>1<span class="o">)</span>, info<span class="o">(</span>1<span class="o">)</span>, kill<span class="o">(</span>1<span class="o">)</span>, login<span class="o">(</span>1<span class="o">)</span>, nice<span class="o">(</span>1<span class="o">)</span>, nohup<span class="o">(</span>1<span class="o">)</span>, printenv<span class="o">(</span>1<span class="o">)</span>, pwd<span class="o">(</span>1<span class="o">)</span>, sh<span class="o">(</span>1<span class="o">)</span>, test<span class="o">(</span>1<span class="o">)</span>, time<span class="o">(</span>1<span class="o">)</span>, true<span class="o">(</span>1<span class="o">)</span>, which<span class="o">(</span>1<span class="o">)</span>,
     zsh<span class="o">(</span>1<span class="o">)</span>

HISTORY
     The <span class="nb">builtin</span> manual page first appeared in FreeBSD 3.4.

AUTHORS
     This manual page was written by Sheldon Hearn &lt;sheldonh@FreeBSD.org&gt;.

BSD                            February 23, <span class="m">2005</span>                           BSD
</code></pre></div><h2 id="printenv-manual">printenv manual</h2>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% man printenv
PRINTENV<span class="o">(</span>1<span class="o">)</span>               BSD General Commands Manual              PRINTENV<span class="o">(</span>1<span class="o">)</span>

NAME
     printenv -- print out the environment

SYNOPSIS
     printenv <span class="o">[</span>name<span class="o">]</span>

DESCRIPTION
     The printenv utility prints out the names and values of the variables in the environment, with one name/value pair per line.  
     If name is specified, only its value is printed.

     Some shells may provide a <span class="nb">builtin</span> printenv <span class="nb">command</span> which is similar or identical to this utility.  
     Consult the builtin<span class="o">(</span>1<span class="o">)</span> manual page.

EXIT STATUS
     The printenv utility exits <span class="m">0</span> on success, and &gt;0 <span class="k">if</span> an error occurs.

SEE ALSO
     csh<span class="o">(</span>1<span class="o">)</span>, env<span class="o">(</span>1<span class="o">)</span>, sh<span class="o">(</span>1<span class="o">)</span>, environ<span class="o">(</span>7<span class="o">)</span>

STANDARDS
     The printenv utility is provided <span class="k">for</span> compatibility with earlier BSD and FreeBSD releases and is not specified by any standards.  
     The functionality of printenv can be duplicated with the echo<span class="o">(</span>1<span class="o">)</span> and env<span class="o">(</span>1<span class="o">)</span> utilities.

HISTORY
     The printenv <span class="nb">command</span> appeared in 3.0BSD.

BSD                              May 12, <span class="m">2003</span>                              BSD
</code></pre></div><h2 id="この記事を試した環境">この記事を試した環境</h2>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% sw_vers
ProductName:    Mac OS X
ProductVersion: 10.15.7
BuildVersion:   19H114
</code></pre></div>]]></content>
		</item>
		
		<item>
			<title>AWS 上に Proxy 環境を構築するメモ</title>
			<link>https://noid11.github.io/posts/how-to-build-proxy-env-on-aws/</link>
			<pubDate>Tue, 02 Feb 2021 22:07:44 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/how-to-build-proxy-env-on-aws/</guid>
			<description>これは何？ AWS 上に HTTP Proxy を構築して検証する機会があったので、構築手順をメモしておく 大まかな流れ [事前準備] VPC と public subnet, private subnet を用意しておく public subnet は Internet Gateway を</description>
			<content type="html"><![CDATA[<h2 id="これは何">これは何？</h2>
<ul>
<li>AWS 上に HTTP Proxy を構築して検証する機会があったので、構築手順をメモしておく</li>
</ul>
<h2 id="大まかな流れ">大まかな流れ</h2>
<ul>
<li>[事前準備] VPC と public subnet, private subnet を用意しておく
<ul>
<li>public subnet は Internet Gateway を使ってインターネット接続できるようにしておく</li>
<li>private subnet は public subnet に構築する proxy を経由してインターネット接続するので NAT Gateway, NAT インスタンスは不要</li>
</ul>
</li>
<li>public subnet に EC2 インスタンスを作成して <a href="http://www.squid-cache.org/">Squid</a> をインストールして動かす</li>
<li>private subnet に EC2 インスタンスを作成して Proxy 設定を行い、動作を確認する</li>
<li>各 EC2 インスタンスでは OS として Amazon Linux 2 を使用する</li>
</ul>
<h2 id="各-subnet-に-ec2-インスタンスを構築して-ssh-接続">各 subnet に EC2 インスタンスを構築して SSH 接続</h2>
<ul>
<li>public subnet に関してはセキュリティグループで ssh のポートを開放しておけば良い</li>
<li>private subnet については <a href="https://dev.classmethod.jp/articles/direct-ssh-by-proxycommand/">public subnet に構築した EC2 インスタンスを踏み台として SSH 接続</a>する
<ul>
<li><a href="https://dev.classmethod.jp/articles/private-subnet-instance-ssm-ssh/">SSH を直接使用せず AWS Systems Manager の Session Manager を使って private subnet の EC2 インスタンスに接続する方法</a>もあるものの、 VPC エンドポイントの設定等が必要となり、検証の邪魔になる可能性を考慮して使用を控えた</li>
</ul>
</li>
</ul>
<p>ssh コマンドを使った接続例</p>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh"><span class="c1"># シェル変数のセットアップ</span>
<span class="nv">PUBLIC_HOST</span><span class="o">=</span>ec2-x-x-x-x.ap-northeast-1.compute.amazonaws.com
<span class="nv">PUBLIC_HOST_USER</span><span class="o">=</span>ec2-user
<span class="nv">PROVATE_HOST</span><span class="o">=</span>ip-172-31-200-153.ap-northeast-1.compute.internal
<span class="nv">PROVATE_HOST_USER</span><span class="o">=</span>ec2-user

<span class="c1"># public subnet host への接続</span>
ssh <span class="nv">$PUBLIC_HOST_USER</span>@<span class="nv">$PUBLIC_HOST</span>

<span class="c1"># private subnet host への接続</span>
ssh -o <span class="nv">ProxyCommand</span><span class="o">=</span><span class="s2">&#34;ssh -W %h:%p </span><span class="nv">$PUBLIC_HOST_USER</span><span class="s2">@</span><span class="nv">$PUBLIC_HOST</span><span class="s2">&#34;</span> <span class="nv">$PROVATE_HOST_USER</span>@<span class="nv">$PROVATE_HOST</span>
</code></pre></div><ul>
<li><code>-o</code>: ssh config で使用される形式でオプションを指定する
<ul>
<li><a href="https://man.openbsd.org/ssh#o">https://man.openbsd.org/ssh#o</a></li>
</ul>
</li>
<li><code>ProxyCommand</code>: サーバーに接続するためのコマンドを指定する
<ul>
<li><a href="https://man.openbsd.org/ssh_config.5#ProxyCommand">https://man.openbsd.org/ssh_config.5#ProxyCommand</a></li>
<li>別途定義されているトークンを使用することが可能
<ul>
<li><a href="https://man.openbsd.org/ssh_config.5#TOKENS">https://man.openbsd.org/ssh_config.5#TOKENS</a></li>
<li><code>%h</code>: リモートホストネーム</li>
<li><code>%p</code>: リモートポート</li>
</ul>
</li>
</ul>
</li>
<li><code>-W</code>: クライアントの標準入力と標準出力を、セキュリティで保護されたチャネルを介してポート上のホストに転送するようリクエストする
<ul>
<li><a href="https://man.openbsd.org/ssh#W">https://man.openbsd.org/ssh#W</a></li>
</ul>
</li>
</ul>
<h2 id="public-subnet-に-squid-を構築">public subnet に Squid を構築</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">sudo yum update
sudo yum install squid
squid -v
sudo systemctl <span class="nb">enable</span> squid
sudo systemctl restart squid
sudo lsof -i:3128
</code></pre></div><ul>
<li>これで Squid をインストールして 3128 ポートで動作することが確認できる</li>
<li>ログを確認したい場合、以下のようにして確認できる
<ul>
<li>プロキシを経由したアクセスを行っていない状態ではログが出力されないためログファイル自体が存在しない場合があるので注意</li>
</ul>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">sudo -s
less /var/log/squid/access.log
less /var/log/squid/cache.log
</code></pre></div><h2 id="private-subnet-で-proxy-設定を行い接続を試す">private subnet で Proxy 設定を行い接続を試す</h2>
<h3 id="aws-cli">AWS CLI</h3>
<ul>
<li>HTTP_PROXY, HTTPS_PROXY 環境変数を設定すれば良い
<ul>
<li><a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-proxy.html">https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-proxy.html</a></li>
<li>EC2 インスタンスで IAM Role を使用する場合、インスタンスメタデータにアクセスが行われるため <code>NO_PROXY=169.254.169.254</code> が必要と記載があるが、 NOPROXY を設定しなくても動作が確認できたのでスキップしている</li>
</ul>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># Squid を設定した EC2 インスタンスのプライベート IP アドレスが 172.31.28.104 だとする</span>
<span class="nb">export</span> <span class="nv">HTTP_PROXY</span><span class="o">=</span>http://172.31.28.104:3128
<span class="nb">export</span> <span class="nv">HTTPS_PROXY</span><span class="o">=</span>http://172.31.28.104:3128
</code></pre></div><p>動作検証</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">aws sts get-caller-identity
</code></pre></div><p>HTTP Proxy 設定を消す場合</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">export</span> -n HTTP_PROXY
<span class="nb">export</span> -n HTTPS_PROXY
</code></pre></div><h3 id="curl">curl</h3>
<ul>
<li><code>~/.curlrc</code> にプロキシ設定を記述する or <code>--proxy</code> オプションでプロキシを指定する
<ul>
<li><code>--proxy</code> オプションで指定するのが楽</li>
<li><a href="https://curl.se/docs/manual.html">https://curl.se/docs/manual.html</a></li>
<li><a href="https://curl.se/docs/manpage.html#-x">https://curl.se/docs/manpage.html#-x</a></li>
</ul>
</li>
</ul>
<p>curl コマンドの動作確認</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">curl --proxy http://172.31.28.104:3128 -I http://example.com
curl --proxy http://172.31.28.104:3128 -I https://example.com
</code></pre></div><h3 id="wget">wget</h3>
<ul>
<li><code>/etc/wgetrc</code> にプロキシ設定を記述する or http_proxy, https_proxy 環境変数を設定する
<ul>
<li>環境変数は case sensitive なので AWS CLI で設定した環境変数とは異なるので注意</li>
<li><a href="https://www.gnu.org/software/wget/manual/wget.html#Proxies">https://www.gnu.org/software/wget/manual/wget.html#Proxies</a></li>
</ul>
</li>
<li>環境変数使う方法のほうがファイル操作が不要なので個人的にセットアップが楽</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">export</span> <span class="nv">http_proxy</span><span class="o">=</span>http://172.31.28.104:3128
<span class="nb">export</span> <span class="nv">https_proxy</span><span class="o">=</span>http://172.31.28.104:3128
</code></pre></div><p>動作確認</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">wget http://example.com
wget https://example.com
</code></pre></div><p>HTTP Proxy 設定を消す場合</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">export</span> -n http_proxy
<span class="nb">export</span> -n https_proxy
</code></pre></div><h3 id="yum">yum</h3>
<ul>
<li><code>/etc/yum.conf</code> にプロキシ設定を記述する必要がある
<ul>
<li><a href="https://man7.org/linux/man-pages/man5/yum.conf.5.html">https://man7.org/linux/man-pages/man5/yum.conf.5.html</a></li>
</ul>
</li>
</ul>
<p><code>/etc/yum.conf</code> 設定例</p>
<pre><code>proxy=http://172.31.28.104:3128
</code></pre><p>動作確認</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">sudo yum update
</code></pre></div><h2 id="参考">参考</h2>
<p>Squidで検証用のプロキシを作ってみた | Developers.IO<br>
<a href="https://dev.classmethod.jp/articles/squid-proxy-setup/">https://dev.classmethod.jp/articles/squid-proxy-setup/</a></p>
<h2 id="この記事を試した環境">この記事を試した環境</h2>
<p>クライアント</p>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% sw_vers
ProductName:    Mac OS X
ProductVersion: 10.15.7
BuildVersion:   19H114
% ssh -V
OpenSSH_8.1p1, LibreSSL 2.7.3
</code></pre></div><p>EC2 インスタンスとして使用した Amazon Linux 2</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="o">[</span>ec2-user@ip-172-31-28-104 ~<span class="o">]</span>$ uname -a
Linux ip-172-31-28-104.ap-northeast-1.compute.internal 4.14.214-160.339.amzn2.x86_64 <span class="c1">#1 SMP Sun Jan 10 05:53:05 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux</span>
<span class="o">[</span>ec2-user@ip-172-31-28-104 ~<span class="o">]</span>$ cat /etc/os-release 
<span class="nv">NAME</span><span class="o">=</span><span class="s2">&#34;Amazon Linux&#34;</span>
<span class="nv">VERSION</span><span class="o">=</span><span class="s2">&#34;2&#34;</span>
<span class="nv">ID</span><span class="o">=</span><span class="s2">&#34;amzn&#34;</span>
<span class="nv">ID_LIKE</span><span class="o">=</span><span class="s2">&#34;centos rhel fedora&#34;</span>
<span class="nv">VERSION_ID</span><span class="o">=</span><span class="s2">&#34;2&#34;</span>
<span class="nv">PRETTY_NAME</span><span class="o">=</span><span class="s2">&#34;Amazon Linux 2&#34;</span>
<span class="nv">ANSI_COLOR</span><span class="o">=</span><span class="s2">&#34;0;33&#34;</span>
<span class="nv">CPE_NAME</span><span class="o">=</span><span class="s2">&#34;cpe:2.3:o\:amazon:amazon_linux:2&#34;</span>
<span class="nv">HOME_URL</span><span class="o">=</span><span class="s2">&#34;https://amazonlinux.com/&#34;</span>
<span class="o">[</span>ec2-user@ip-172-31-28-104 ~<span class="o">]</span>$ ssh -V
OpenSSH_7.4p1, OpenSSL 1.0.2k-fips  <span class="m">26</span> Jan <span class="m">2017</span>
<span class="o">[</span>ec2-user@ip-172-31-28-104 ~<span class="o">]</span>$ squid -v <span class="p">|</span> head -n <span class="m">2</span>
Squid Cache: Version 3.5.20
Service Name: squid
<span class="o">[</span>ec2-user@ip-172-31-28-104 ~<span class="o">]</span>$ aws --version
aws-cli/1.18.147 Python/2.7.18 Linux/4.14.214-160.339.amzn2.x86_64 botocore/1.18.6
<span class="o">[</span>ec2-user@ip-172-31-28-104 ~<span class="o">]</span>$ curl --version
curl 7.61.1 <span class="o">(</span>x86_64-koji-linux-gnu<span class="o">)</span> libcurl/7.61.1 OpenSSL/1.0.2k zlib/1.2.7 libidn2/2.3.0 libssh2/1.4.3 nghttp2/1.41.0
Release-Date: 2018-09-05
Protocols: dict file ftp ftps gopher http https imap imaps ldap ldaps pop3 pop3s rtsp scp sftp smb smbs smtp smtps telnet tftp 
Features: AsynchDNS IDN IPv6 Largefile GSS-API Kerberos SPNEGO NTLM NTLM_WB SSL libz HTTP2 UnixSockets HTTPS-proxy Metalink
<span class="o">[</span>ec2-user@ip-172-31-28-104 ~<span class="o">]</span>$ wget --version <span class="p">|</span> head -n <span class="m">1</span>
GNU Wget 1.14 built on linux-gnu.
<span class="o">[</span>ec2-user@ip-172-31-28-104 ~<span class="o">]</span>$ yum --version <span class="p">|</span> head -n <span class="m">1</span>
3.4.3
</code></pre></div>]]></content>
		</item>
		
		<item>
			<title>AWS STS における GetCallerIdentity API に許可は必要ないという話</title>
			<link>https://noid11.github.io/posts/no-need-permission-sts-get-caller-identity/</link>
			<pubDate>Mon, 01 Feb 2021 21:47:26 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/no-need-permission-sts-get-caller-identity/</guid>
			<description>&lt;ul&gt;
&lt;li&gt;AWS STS には GetCallerIdentity API という、使用しているクレデンシャルから AWS アカウントや IAM User, IAM Role 情報を取得する API がある&lt;/li&gt;
&lt;li&gt;この API は自分が想定した IAM User, IAM Role のクレデンシャルを取得できているのか確認するのに便利だが、使用する IAM Policy に sts:GetCallerIdentity アクションを Allow しなくても使用することが可能&lt;/li&gt;
&lt;li&gt;API Reference に書いてある&lt;/li&gt;
&lt;/ul&gt;</description>
			<content type="html"><![CDATA[<ul>
<li>AWS STS には GetCallerIdentity API という、使用しているクレデンシャルから AWS アカウントや IAM User, IAM Role 情報を取得する API がある</li>
<li>この API は自分が想定した IAM User, IAM Role のクレデンシャルを取得できているのか確認するのに便利だが、使用する IAM Policy に sts:GetCallerIdentity アクションを Allow しなくても使用することが可能</li>
<li>API Reference に書いてある</li>
</ul>
<h2 id="api-reference-を確認">API Reference を確認</h2>
<p>GetCallerIdentity - AWS Security Token Service<br>
<a href="https://docs.aws.amazon.com/STS/latest/APIReference/API_GetCallerIdentity.html">https://docs.aws.amazon.com/STS/latest/APIReference/API_GetCallerIdentity.html</a></p>
<blockquote>
<p>No permissions are required to perform this operation.<br>
If an administrator adds a policy to your IAM user or role that explicitly denies access to the sts:GetCallerIdentity action, you can still perform this operation.<br>
Permissions are not required because the same information is returned when an IAM user or role is denied access.</p>
</blockquote>
<ul>
<li>この操作を実行するために権限は必要ない</li>
<li>管理者が明示的な拒否ポリシーを設定した場合においても sts:GetCallerIdentity の呼び出しは可能</li>
<li>IAM User, IAM Role のアクセスが拒否された場合でも同じ情報が返されるため、アクセス許可が不要</li>
</ul>
<h2 id="note">Note</h2>
<ul>
<li>明示的な許可が不要なのは便利である反面、明示的もできない点に注意</li>
<li>例えば Cognito ID Pool 等を用いて一時的なクレデンシャルを発行するようなアプリケーションでは、そのクレデンシャルを使って GetCallerIdentity を呼び出すことによって、ゲストユーザーであっても AWS アカウント ID や IAM Role の ARN を取得することができてしまう
<ul>
<li>具体的な実害があるかは思いつかないが、ちょっとしたリスクではある</li>
</ul>
</li>
<li>GetCallerIdentity による情報取得を防ぎたい場合、エンドユーザーに対して一時的なクレデンシャルを発行するようなアーキテクチャは避けたほうが良いかもしれない</li>
</ul>]]></content>
		</item>
		
		<item>
			<title>Go で作成した Web アプリを EB CLI を使ってデプロイする方法</title>
			<link>https://noid11.github.io/posts/how-to-deploy-goapp-by-eb-cli/</link>
			<pubDate>Tue, 26 Jan 2021 02:40:20 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/how-to-deploy-goapp-by-eb-cli/</guid>
			<description>&lt;ul&gt;
&lt;li&gt;ほぼほぼ&lt;a href=&#34;https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/go-tutorial.html&#34;&gt;公式のチュートリアル&lt;/a&gt;をなぞっただけ&lt;/li&gt;
&lt;li&gt;良い点
&lt;ul&gt;
&lt;li&gt;とりあえず Go で Web アプリ作って動かしたいような場合に便利
&lt;ul&gt;
&lt;li&gt;ミドルウェアの事とか考えなくて良い&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;5分程度でインターネット経由でアクセス出来る環境にデプロイできる&lt;/li&gt;
&lt;li&gt;大体の場合、&lt;a href=&#34;https://aws.amazon.com/jp/free/&#34;&gt;12ヶ月間無料枠&lt;/a&gt;で済む
&lt;ul&gt;
&lt;li&gt;新しく始めるプロジェクトの PoC やプロトタイプを動かすようなシナリオに相性が良い&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;やる気になれば&lt;a href=&#34;https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/eb3-logs.html&#34;&gt;ログを確認&lt;/a&gt;したり、&lt;a href=&#34;https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/eb3-ssh.html&#34;&gt;アプリケーションが動作する EC2 インスタンスに SSH 接続したり&lt;/a&gt;できる&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;注意点
&lt;ul&gt;
&lt;li&gt;HTTPS ではなく HTTP でのアクセスとなる&lt;/li&gt;
&lt;li&gt;デフォルトでは EC2 インスタンスロールを設定しないので AWS SDK を使いたい場合には工夫が必要
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;eb create&lt;/code&gt; するときに &lt;code&gt;--instance_profile&lt;/code&gt; で指定しておくとか&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;簡易的な設定で動作するため、複雑な要件が必要なプロダクション環境には向かないかも
&lt;ul&gt;
&lt;li&gt;ちゃんと設定内容を精査して調整した方が良い&lt;/li&gt;
&lt;li&gt;複雑な要件が必要なら EB CLI, EB ではない方法で管理した方が良いかもしれない&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;</description>
			<content type="html"><![CDATA[<ul>
<li>ほぼほぼ<a href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/go-tutorial.html">公式のチュートリアル</a>をなぞっただけ</li>
<li>良い点
<ul>
<li>とりあえず Go で Web アプリ作って動かしたいような場合に便利
<ul>
<li>ミドルウェアの事とか考えなくて良い</li>
</ul>
</li>
<li>5分程度でインターネット経由でアクセス出来る環境にデプロイできる</li>
<li>大体の場合、<a href="https://aws.amazon.com/jp/free/">12ヶ月間無料枠</a>で済む
<ul>
<li>新しく始めるプロジェクトの PoC やプロトタイプを動かすようなシナリオに相性が良い</li>
</ul>
</li>
<li>やる気になれば<a href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/eb3-logs.html">ログを確認</a>したり、<a href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/eb3-ssh.html">アプリケーションが動作する EC2 インスタンスに SSH 接続したり</a>できる</li>
</ul>
</li>
<li>注意点
<ul>
<li>HTTPS ではなく HTTP でのアクセスとなる</li>
<li>デフォルトでは EC2 インスタンスロールを設定しないので AWS SDK を使いたい場合には工夫が必要
<ul>
<li><code>eb create</code> するときに <code>--instance_profile</code> で指定しておくとか</li>
</ul>
</li>
<li>簡易的な設定で動作するため、複雑な要件が必要なプロダクション環境には向かないかも
<ul>
<li>ちゃんと設定内容を精査して調整した方が良い</li>
<li>複雑な要件が必要なら EB CLI, EB ではない方法で管理した方が良いかもしれない</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="手順">手順</h2>
<p>プロジェクトディレクトリを作成し <code>application.go</code> として Go のコードを書く</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">mkdir eb-go <span class="o">&amp;&amp;</span> <span class="nb">cd</span> eb-go
touch application.go
</code></pre></div><hr>
<p>application.go</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;net/http&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">handler</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span> <span class="o">==</span> <span class="s">&#34;/&#34;</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">&#34;Hello World! Append a name to the URL to say hello. For example, use %s/Mary to say hello to Mary.&#34;</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">Host</span><span class="p">)</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">&#34;Hello, %s!&#34;</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">http</span><span class="p">.</span><span class="nf">HandleFunc</span><span class="p">(</span><span class="s">&#34;/&#34;</span><span class="p">,</span> <span class="nx">handler</span><span class="p">)</span>
	<span class="nx">http</span><span class="p">.</span><span class="nf">ListenAndServe</span><span class="p">(</span><span class="s">&#34;:5000&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><hr>
<p>アプリケーションをローカルで動かす</p>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">go run application.go

<span class="c1"># 別のターミナルやブラウザで http://localhost:5000 にアクセスすれば OK</span>
<span class="c1"># EB 環境にデプロイする際にはポート 80 で公開される</span>
curl http://localhost:5000
</code></pre></div><hr>
<p>Elastic Beanstalk 環境の構築・デプロイ</p>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">eb init --platform go go-tutorial --region ap-northeast-1

<span class="c1"># ここで EB 環境に用いる EC2 インスタンスやらのリソースが CloudFormation 経由でプロビジョニングされるため、 5分 程度の時間がかかる</span>
eb create go-env
</code></pre></div><hr>
<p>デプロイされた Web アプリをブラウザで開く</p>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">eb open
</code></pre></div><hr>
<p>クリーンアップ</p>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">eb terminate
</code></pre></div><h2 id="実行ログ例">実行ログ例</h2>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% eb init -p go go-tutorial --region ap-northeast-1
Application go-tutorial has been created.
% eb create go-env
Creating application version archive <span class="s2">&#34;app-210126_023350&#34;</span>.
Uploading go-tutorial/app-210126_023350.zip to S3. This may take a <span class="k">while</span>.
Upload Complete.
Environment details <span class="k">for</span>: go-env
  Application name: go-tutorial
  Region: ap-northeast-1
  Deployed Version: app-210126_023350
  Environment ID: e-mhb6jbhawa
  Platform: arn:aws:elasticbeanstalk:ap-northeast-1::platform/Go <span class="m">1</span> running on 64bit Amazon Linux/2.17.2
  Tier: WebServer-Standard-1.0
  CNAME: UNKNOWN
  Updated: 2021-01-25 17:33:52.752000+00:00
Printing Status:
2021-01-25 17:33:51    INFO    createEnvironment is starting.
2021-01-25 17:33:52    INFO    Using elasticbeanstalk-ap-northeast-1-123456789012 as Amazon S3 storage bucket <span class="k">for</span> environment data.
2021-01-25 17:34:14    INFO    Created load balancer named: awseb-e-m-AWSEBLoa-1QR55QWY2AVZX
2021-01-25 17:34:14    INFO    Created security group named: awseb-e-mhb6jbhawa-stack-AWSEBSecurityGroup-1WRY5JQKP69QQ
2021-01-25 17:34:17    INFO    Created Auto Scaling launch configuration named: awseb-e-mhb6jbhawa-stack-AWSEBAutoScalingLaunchConfiguration-GOVWI86F79E3
2021-01-25 17:35:20    INFO    Created Auto Scaling group named: awseb-e-mhb6jbhawa-stack-AWSEBAutoScalingGroup-MW08E9EZ94AT
2021-01-25 17:35:20    INFO    Waiting <span class="k">for</span> EC2 instances to launch. This may take a few minutes.
2021-01-25 17:35:20    INFO    Created Auto Scaling group policy named: arn:aws:autoscaling:ap-northeast-1:123456789012:scalingPolicy:9f066c87-60b4-407f-a339-70b0517dcd2a:autoScalingGroupName/awseb-e-mhb6jbhawa-stack-AWSEBAutoScalingGroup-MW08E9EZ94AT:policyName/awseb-e-mhb6jbhawa-stack-AWSEBAutoScalingScaleUpPolicy-1KC69AR7HGIY7
2021-01-25 17:35:20    INFO    Created Auto Scaling group policy named: arn:aws:autoscaling:ap-northeast-1:123456789012:scalingPolicy:f7442ed6-3f7e-456d-9338-941e85f4057b:autoScalingGroupName/awseb-e-mhb6jbhawa-stack-AWSEBAutoScalingGroup-MW08E9EZ94AT:policyName/awseb-e-mhb6jbhawa-stack-AWSEBAutoScalingScaleDownPolicy-82YZ8T3H24VQ
2021-01-25 17:35:36    INFO    Created CloudWatch alarm named: awseb-e-mhb6jbhawa-stack-AWSEBCloudwatchAlarmHigh-Z3HRCDA02JTS
2021-01-25 17:35:36    INFO    Created CloudWatch alarm named: awseb-e-mhb6jbhawa-stack-AWSEBCloudwatchAlarmLow-8WILR7PPYF5F
2021-01-25 17:36:36    INFO    Application available at go-env.eba-psw5vsuv.ap-northeast-1.elasticbeanstalk.com.
2021-01-25 17:36:37    INFO    Successfully launched environment: go-env
% eb terminate
The environment <span class="s2">&#34;go-env&#34;</span> and all associated instances will be terminated.
To confirm, <span class="nb">type</span> the environment name: go-env
2021-01-25 17:39:05    INFO    terminateEnvironment is starting.
2021-01-25 17:39:23    INFO    Deleted CloudWatch alarm named: awseb-e-mhb6jbhawa-stack-AWSEBCloudwatchAlarmHigh-Z3HRCDA02JTS 
2021-01-25 17:39:23    INFO    Deleted CloudWatch alarm named: awseb-e-mhb6jbhawa-stack-AWSEBCloudwatchAlarmLow-8WILR7PPYF5F 
2021-01-25 17:39:23    INFO    Deleted Auto Scaling group policy named: arn:aws:autoscaling:ap-northeast-1:123456789012:scalingPolicy:9f066c87-60b4-407f-a339-70b0517dcd2a:autoScalingGroupName/awseb-e-mhb6jbhawa-stack-AWSEBAutoScalingGroup-MW08E9EZ94AT:policyName/awseb-e-mhb6jbhawa-stack-AWSEBAutoScalingScaleUpPolicy-1KC69AR7HGIY7
2021-01-25 17:39:23    INFO    Deleted Auto Scaling group policy named: arn:aws:autoscaling:ap-northeast-1:123456789012:scalingPolicy:f7442ed6-3f7e-456d-9338-941e85f4057b:autoScalingGroupName/awseb-e-mhb6jbhawa-stack-AWSEBAutoScalingGroup-MW08E9EZ94AT:policyName/awseb-e-mhb6jbhawa-stack-AWSEBAutoScalingScaleDownPolicy-82YZ8T3H24VQ
2021-01-25 17:39:23    INFO    Waiting <span class="k">for</span> EC2 instances to terminate. This may take a few minutes.
2021-01-25 17:41:25    INFO    Deleted Auto Scaling group named: awseb-e-mhb6jbhawa-stack-AWSEBAutoScalingGroup-MW08E9EZ94AT
2021-01-25 17:41:25    INFO    Deleted load balancer named: awseb-e-m-AWSEBLoa-1QR55QWY2AVZX
2021-01-25 17:41:25    INFO    Deleted Auto Scaling launch configuration named: awseb-e-mhb6jbhawa-stack-AWSEBAutoScalingLaunchConfiguration-GOVWI86F79E3
2021-01-25 17:41:25    INFO    Deleted security group named: awseb-e-mhb6jbhawa-stack-AWSEBSecurityGroup-1WRY5JQKP69QQ
2021-01-25 17:41:30    INFO    Deleting SNS topic <span class="k">for</span> environment go-env.
2021-01-25 17:41:32    INFO    terminateEnvironment completed successfully.
</code></pre></div><h2 id="この記事を試した環境">この記事を試した環境</h2>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% sw_vers
ProductName:    Mac OS X
ProductVersion: 10.15.7
BuildVersion:   19H114
% go version
go version go1.15.6 darwin/amd64
% eb --version
EB CLI 3.19.3 <span class="o">(</span>Python 3.9.1<span class="o">)</span>
</code></pre></div>]]></content>
		</item>
		
		<item>
			<title>EB CLI v3 のヘルプを読んだメモ</title>
			<link>https://noid11.github.io/posts/read-eb-cli-v3-help/</link>
			<pubDate>Tue, 26 Jan 2021 01:44:20 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/read-eb-cli-v3-help/</guid>
			<description>&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/aws/aws-elastic-beanstalk-cli&#34;&gt;Elastic Beanstalk CLI v3&lt;/a&gt; の詳細なヘルプがネット上に無さそうだったので読んだメモ
&lt;ul&gt;
&lt;li&gt;基本的な使い方なら&lt;a href=&#34;https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/eb-cli3-getting-started.html&#34;&gt;ドキュメント&lt;/a&gt;がある&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;と思ったら &lt;a href=&#34;https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/eb3-cmd-commands.html&#34;&gt;reference&lt;/a&gt; あった・・・&lt;/li&gt;
&lt;/ul&gt;</description>
			<content type="html"><![CDATA[<ul>
<li><a href="https://github.com/aws/aws-elastic-beanstalk-cli">Elastic Beanstalk CLI v3</a> の詳細なヘルプがネット上に無さそうだったので読んだメモ
<ul>
<li>基本的な使い方なら<a href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/eb-cli3-getting-started.html">ドキュメント</a>がある</li>
</ul>
</li>
<li>と思ったら <a href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/eb3-cmd-commands.html">reference</a> あった・・・</li>
</ul>
<h2 id="eb-help">eb help</h2>
<ul>
<li><code>abort</code>: environment の更新または deployment をキャンセルする</li>
<li><code>appversion</code>: アプリケーションバージョンの一覧表示と管理</li>
<li><code>clone</code>: environment をクローンする</li>
<li><code>codesource</code>: EB CLI デフォルトで使用するコードソースを設定</li>
<li><code>config</code>: environment 設定の変更。サブコマンドを使用して保存された設定を管理</li>
<li><code>console</code>: EB environment のマネジメントコンソールを開く</li>
<li><code>create</code>: 新しい environment を作成する</li>
<li><code>deploy</code>: ソースコードを environment にデプロイする</li>
<li><code>events</code>: 最近の events を取得する</li>
<li><code>health</code>: environment health の詳細を表示</li>
<li><code>init</code>: ディレクトリを初期化してアプリケーションを作成する</li>
<li><code>labs</code>: 追加の実験用コマンド</li>
<li><code>list</code>: 全ての environment を表示</li>
<li><code>local</code>: ローカルマシンでコマンドを実行する</li>
<li><code>logs</code>: 最新のログを取得</li>
<li><code>open</code>: アプリケーション URL をブラウザで開く</li>
<li><code>platform</code>: プラットフォームを管理するコマンド</li>
<li><code>printenv</code>: 環境変数を表示</li>
<li><code>restore</code>: terminate した environment を復元</li>
<li><code>scale</code>: 実行中の EC2 インスタンス数を変更</li>
<li><code>setenv</code>: 環境変数を設定</li>
<li><code>ssh</code>: EC2 インスタンスに接続する SSH クライアントを開く</li>
<li><code>status</code>: environment 情報とステータスを取得</li>
<li><code>swap</code>: 2つの environment CNAME を入れ替える</li>
<li><code>tags</code>: environment のタグを追加・削除・更新・一覧表示する</li>
<li><code>terminate</code>: environment を terminate する</li>
<li><code>upgrade</code>: environment の platform version を最新にアップデートする</li>
<li><code>use</code>: デフォルト environment を設定</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% eb --help     
usage: eb <span class="o">(</span>sub-commands ...<span class="o">)</span> <span class="o">[</span>options ...<span class="o">]</span> <span class="o">{</span>arguments ...<span class="o">}</span>

Welcome to the Elastic Beanstalk Command Line Interface <span class="o">(</span>EB CLI<span class="o">)</span>. 
For more information on a specific command, <span class="nb">type</span> <span class="s2">&#34;eb {cmd} --help&#34;</span>.

commands:
  abort        Cancels an environment update or deployment.
  appversion   Listing and managing application versions
  clone        Clones an environment.
  codesource   Configures the code <span class="nb">source</span> <span class="k">for</span> the EB CLI to use by default.
  config       Modify an environment<span class="se">\&#39;</span>s configuration. Use subcommands to manage saved configurations.
  console      Opens the environment in the AWS Elastic Beanstalk Management Console.
  create       Creates a new environment.
  deploy       Deploys your <span class="nb">source</span> code to the environment.
  events       Gets recent events.
  health       Shows detailed environment health.
  init         Initializes your directory with the EB CLI. Creates the application.
  labs         Extra experimental commands.
  list         Lists all environments.
  <span class="nb">local</span>        Runs commands on your <span class="nb">local</span> machine.
  logs         Gets recent logs.
  open         Opens the application URL in a browser.
  platform     Commands <span class="k">for</span> managing platforms.
  printenv     Shows the environment variables.
  restore      Restores a terminated environment.
  scale        Changes the number of running instances.
  setenv       Sets environment variables.
  ssh          Opens the SSH client to connect to an instance.
  status       Gets environment information and status.
  swap         Swaps two environment CNAMEs with each other.
  tags         Allows adding, deleting, updating, and listing of environment tags.
  terminate    Terminates the environment.
  upgrade      Updates the environment to the most recent platform version.
  use          Sets default environment.

optional arguments:
  -h, --help            show this <span class="nb">help</span> message and <span class="nb">exit</span>
  --debug               toggle debug output
  --quiet               suppress all output
  -v, --verbose         toggle verbose output
  --profile PROFILE     use a specific profile from your credential file
  -r REGION, --region REGION
                        use a specific region
  --no-verify-ssl       don<span class="se">\&#39;</span>t verify AWS SSL certificates
  --version             show application/version info

To get started <span class="nb">type</span> <span class="s2">&#34;eb init&#34;</span>. Then <span class="nb">type</span> <span class="s2">&#34;eb create&#34;</span> and <span class="s2">&#34;eb open&#34;</span>
</code></pre></div><h2 id="この記事を試した環境">この記事を試した環境</h2>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% sw_vers
ProductName:    Mac OS X
ProductVersion: 10.15.7
BuildVersion:   19H114
% eb --version
EB CLI 3.19.3 <span class="o">(</span>Python 3.9.1<span class="o">)</span>
</code></pre></div>]]></content>
		</item>
		
		<item>
			<title>AWS CLI コマンドを利用可能な全てのリージョンに対して実行する方法</title>
			<link>https://noid11.github.io/posts/how-to-aws-cli-command-to-available-regions/</link>
			<pubDate>Mon, 25 Jan 2021 14:42:12 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/how-to-aws-cli-command-to-available-regions/</guid>
			<description>&lt;ul&gt;
&lt;li&gt;&lt;code&gt;aws ec2 describe-regions&lt;/code&gt; と &lt;code&gt;jq&lt;/code&gt; によって利用可能な全てのリージョンを取得し、 &lt;code&gt;xargs&lt;/code&gt; コマンドで全てのリージョンに対して任意の AWS CLI コマンドを実行すれば OK&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;全リージョンに対して &lt;code&gt;ec2 describe-instances&lt;/code&gt; を実行する例&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;aws ec2 describe-regions &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq --raw-output &lt;span class=&#34;s2&#34;&gt;&amp;#34;.Regions[].RegionName&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; xargs -n &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; -I&lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt; -P &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt; aws --region &lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt; ec2 describe-instances
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
			<content type="html"><![CDATA[<ul>
<li><code>aws ec2 describe-regions</code> と <code>jq</code> によって利用可能な全てのリージョンを取得し、 <code>xargs</code> コマンドで全てのリージョンに対して任意の AWS CLI コマンドを実行すれば OK</li>
</ul>
<p>全リージョンに対して <code>ec2 describe-instances</code> を実行する例</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">aws ec2 describe-regions <span class="p">|</span> jq --raw-output <span class="s2">&#34;.Regions[].RegionName&#34;</span> <span class="p">|</span> xargs -n <span class="m">1</span> -I<span class="o">{}</span> -P <span class="m">5</span> aws --region <span class="o">{}</span> ec2 describe-instances
</code></pre></div><h2 id="利用可能な-aws-リージョンの取得">利用可能な AWS リージョンの取得</h2>
<ul>
<li>EC2 で提供されている <a href="https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DescribeRegions.html">DescribeRegions API</a> でリージョン情報を取得できる</li>
<li>AWS CLI の場合 <a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/ec2/describe-regions.html"><code>ec2 describe-regions</code> コマンド</a></li>
<li>厳密に全ての AWS リージョンを取得する場合 <code>--all-regions</code> オプションを指定する必要があるが、これは使用するためにオプトインが必要なリージョンがあり、どの AWS アカウントでも全てのリージョンが利用可能では無いので注意</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">aws ec2 describe-regions
</code></pre></div><hr>
<ul>
<li><code>xargs</code> コマンドに連携するためにリージョン情報を改行された raw text に整形するため <code>jq</code> を使う</li>
<li><a href="https://stedolan.github.io/jq/manual/"><code>jq</code> マニュアル</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">aws ec2 describe-regions <span class="p">|</span> jq --raw-output <span class="s2">&#34;.Regions[].RegionName&#34;</span>
</code></pre></div><h2 id="xargs-あれこれ">xargs あれこれ</h2>
<ul>
<li><code>xargs</code> は標準入力で受け取った文字列を使って任意のコマンドを実行できる
<ul>
<li>この任意のコマンドはマルチプロセスで動かすことも可能なので、複数の処理が必要な場合に便利</li>
</ul>
</li>
<li>オプション
<ul>
<li><code>-n</code>: 1コマンドラインが受け取る最大引数の個数</li>
<li><code>-P</code>: 最大プロセス数。 0 を指定すると可能な限り多くのプロセスを使う
<ul>
<li>しかし Mac 環境で 0 指定すると <code>xargs: max. processes must be &gt;0</code> というエラーが発生する。 BSD というより Mac 独自の制約かもしれない。</li>
</ul>
</li>
<li><code>-I</code>: 入力内容の置換
<ul>
<li><code>-I{}</code> と指定することで、任意のコマンドを実行する際に <code>{}</code> を使い、入力を挿入することができる</li>
<li>標準入力関係なく、あるコマンドをマルチプロセスで実行したいような場合 <code>seq 10 | xargs -n 1 -P 5 -I{} uuidgen</code> という感じで <code>seq</code> コマンドで回数指定しつつ <code>-I{}</code> の <code>{}</code> を使わないことで特定コマンドを任意の回数、マルチプロセスで動かせる
<ul>
<li>マルチプロセスで SQS にメッセージ投入する例: <code>seq 100 | xargs -n 1 -P 0 -I{} aws sqs send-message --queue-url $QUEUE_URL --message-body mybody</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">xargs -n <span class="m">1</span> -I<span class="o">{}</span> -P <span class="m">3</span> aws --region <span class="o">{}</span> ec2 describe-instances
</code></pre></div><hr>
<p>■ <code>-P</code> 調整例</p>
<p><code>-P</code>: 1</p>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% <span class="nb">time</span> aws ec2 describe-regions <span class="p">|</span> jq --raw-output <span class="s2">&#34;.Regions[].RegionName&#34;</span> <span class="p">|</span> xargs -n <span class="m">1</span> -I<span class="o">{}</span> -P <span class="m">1</span> aws --region <span class="o">{}</span> ec2 describe-instances
...
aws ec2 describe-regions  0.65s user 0.24s system 87% cpu 1.009 total
jq --raw-output <span class="s2">&#34;.Regions[].RegionName&#34;</span>  0.03s user 0.01s system 3% cpu 1.008 total
xargs -n <span class="m">1</span> -I<span class="o">{}</span> -P <span class="m">1</span> aws --region <span class="o">{}</span> ec2 describe-instances  11.51s user 4.33s system 44% cpu 35.704 total
</code></pre></div><p><code>-P</code>: 5</p>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% <span class="nb">time</span> aws ec2 describe-regions <span class="p">|</span> jq --raw-output <span class="s2">&#34;.Regions[].RegionName&#34;</span> <span class="p">|</span> xargs -n <span class="m">1</span> -I<span class="o">{}</span> -P <span class="m">5</span> aws --region <span class="o">{}</span> ec2 describe-instances
...
aws ec2 describe-regions  0.73s user 0.32s system 65% cpu 1.600 total
jq --raw-output <span class="s2">&#34;.Regions[].RegionName&#34;</span>  0.03s user 0.00s system 2% cpu 1.599 total
xargs -n <span class="m">1</span> -I<span class="o">{}</span> -P <span class="m">5</span> aws --region <span class="o">{}</span> ec2 describe-instances  15.39s user 5.32s system 148% cpu 13.934 total
</code></pre></div><h2 id="この記事を試した環境">この記事を試した環境</h2>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% sw_vers
ProductName:    Mac OS X
ProductVersion: 10.15.7
BuildVersion:   19H114
% aws --version
aws-cli/2.1.6 Python/3.7.4 Darwin/19.6.0 exe/x86_64 prompt/off
% jq --version
jq-1.6
</code></pre></div><ul>
<li><code>xargs</code> はバージョン表示する機能が見当たらなかったが Mac に標準でインストールされているものを使用した</li>
</ul>]]></content>
		</item>
		
		<item>
			<title>Apache Bench ノート</title>
			<link>https://noid11.github.io/posts/apache-bench-note/</link>
			<pubDate>Mon, 25 Jan 2021 01:01:38 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/apache-bench-note/</guid>
			<description>&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ab&lt;/code&gt;: Apache Bench について調べたノート&lt;/li&gt;
&lt;li&gt;基本形
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ab -c 10 -n 10 http://example.com/&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;オプション
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-A&lt;/code&gt;: Basic 認証での user/password 指定&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-c&lt;/code&gt;: concurrency. 並行実行するコネクション数&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-C&lt;/code&gt;: Cookie 指定&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-H&lt;/code&gt;: 任意の HTTP リクエストヘッダー指定&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-k&lt;/code&gt;: HTTP KeepAlive を有効化&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-m&lt;/code&gt;: HTTP Method を指定&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-n&lt;/code&gt;: 生成する HTTP リクエスト数&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-p&lt;/code&gt;: POST file&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-s&lt;/code&gt;: タイムアウト設定。デフォルト 30 秒&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-t&lt;/code&gt;: ベンチマークのタイムリミット。デフォルトでは無制限&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-T&lt;/code&gt;: POST, PUT メソッドを使用する場合の Content-Type ヘッダー値。デフォルトでは text/plain だが application/x-www-form-urlencoded 等を指定できる&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;実行結果
&lt;ul&gt;
&lt;li&gt;1秒 あたりに行ったリクエスト数が知りたい: &lt;code&gt;Requests per second&lt;/code&gt; を確認&lt;/li&gt;
&lt;li&gt;失敗したリクエストを知りたい: &lt;code&gt;Non-2xx responses&lt;/code&gt; を確認&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;</description>
			<content type="html"><![CDATA[<ul>
<li><code>ab</code>: Apache Bench について調べたノート</li>
<li>基本形
<ul>
<li><code>ab -c 10 -n 10 http://example.com/</code></li>
</ul>
</li>
<li>オプション
<ul>
<li><code>-A</code>: Basic 認証での user/password 指定</li>
<li><code>-c</code>: concurrency. 並行実行するコネクション数</li>
<li><code>-C</code>: Cookie 指定</li>
<li><code>-H</code>: 任意の HTTP リクエストヘッダー指定</li>
<li><code>-k</code>: HTTP KeepAlive を有効化</li>
<li><code>-m</code>: HTTP Method を指定</li>
<li><code>-n</code>: 生成する HTTP リクエスト数</li>
<li><code>-p</code>: POST file</li>
<li><code>-s</code>: タイムアウト設定。デフォルト 30 秒</li>
<li><code>-t</code>: ベンチマークのタイムリミット。デフォルトでは無制限</li>
<li><code>-T</code>: POST, PUT メソッドを使用する場合の Content-Type ヘッダー値。デフォルトでは text/plain だが application/x-www-form-urlencoded 等を指定できる</li>
</ul>
</li>
<li>実行結果
<ul>
<li>1秒 あたりに行ったリクエスト数が知りたい: <code>Requests per second</code> を確認</li>
<li>失敗したリクエストを知りたい: <code>Non-2xx responses</code> を確認</li>
</ul>
</li>
</ul>
<h2 id="基本的な使い方">基本的な使い方</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">ab -c <span class="m">10</span> -n <span class="m">10</span> http://example.com/
</code></pre></div><hr>
<p>実行例</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ab -c <span class="m">10</span> -n <span class="m">10</span> http://example.com/
This is ApacheBench, Version 2.3 &lt;<span class="nv">$Revision</span>: <span class="m">1879490</span> $&gt;
Copyright <span class="m">1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

Benchmarking example.com <span class="o">(</span>be patient<span class="o">)</span>.....done


Server Software:        ECS
Server Hostname:        example.com
Server Port:            <span class="m">80</span>

Document Path:          /
Document Length:        <span class="m">1256</span> bytes

Concurrency Level:      <span class="m">10</span>
Time taken <span class="k">for</span> tests:   0.466 seconds
Complete requests:      <span class="m">10</span>
Failed requests:        <span class="m">0</span>
Total transferred:      <span class="m">16159</span> bytes
HTML transferred:       <span class="m">12560</span> bytes
Requests per second:    21.46 <span class="o">[</span><span class="c1">#/sec] (mean)</span>
Time per request:       465.913 <span class="o">[</span>ms<span class="o">]</span> <span class="o">(</span>mean<span class="o">)</span>
Time per request:       46.591 <span class="o">[</span>ms<span class="o">]</span> <span class="o">(</span>mean, across all concurrent requests<span class="o">)</span>
Transfer rate:          33.87 <span class="o">[</span>Kbytes/sec<span class="o">]</span> received

Connection Times <span class="o">(</span>ms<span class="o">)</span>
              min  mean<span class="o">[</span>+/-sd<span class="o">]</span> median   max
Connect:      <span class="m">106</span>  <span class="m">112</span>   5.6    <span class="m">110</span>     <span class="m">124</span>
Processing:   <span class="m">106</span>  <span class="m">112</span>   5.6    <span class="m">110</span>     <span class="m">124</span>
Waiting:      <span class="m">106</span>  <span class="m">112</span>   5.6    <span class="m">110</span>     <span class="m">124</span>
Total:        <span class="m">212</span>  <span class="m">224</span>  11.2    <span class="m">220</span>     <span class="m">248</span>

Percentage of the requests served within a certain <span class="nb">time</span> <span class="o">(</span>ms<span class="o">)</span>
  50%    <span class="m">220</span>
  66%    <span class="m">224</span>
  75%    <span class="m">232</span>
  80%    <span class="m">234</span>
  90%    <span class="m">248</span>
  95%    <span class="m">248</span>
  98%    <span class="m">248</span>
  99%    <span class="m">248</span>
 100%    <span class="m">248</span> <span class="o">(</span>longest request<span class="o">)</span>
</code></pre></div><h2 id="post-リクエストをベンチマークする">POST リクエストをベンチマークする</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">ab -c <span class="m">10</span> -n <span class="m">10</span> -p ./sample.json -T application/json https://httpbin.org/post
</code></pre></div><hr>
<p>実行例</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ cat ./sample.json 
<span class="o">{</span>
    <span class="s2">&#34;key&#34;</span>: <span class="s2">&#34;value&#34;</span>
<span class="o">}</span>
$ ab -c <span class="m">10</span> -n <span class="m">10</span> -p ./sample.json -T application/json https://httpbin.org/post
This is ApacheBench, Version 2.3 &lt;<span class="nv">$Revision</span>: <span class="m">1879490</span> $&gt;
Copyright <span class="m">1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

Benchmarking httpbin.org <span class="o">(</span>be patient<span class="o">)</span>.....done


Server Software:        gunicorn/19.9.0
Server Hostname:        httpbin.org
Server Port:            <span class="m">443</span>
SSL/TLS Protocol:       TLSv1.2,ECDHE-RSA-AES128-GCM-SHA256,2048,128
Server Temp Key:        ECDH P-256 <span class="m">256</span> bits
TLS Server Name:        httpbin.org

Document Path:          /post
Document Length:        <span class="m">439</span> bytes

Concurrency Level:      <span class="m">10</span>
Time taken <span class="k">for</span> tests:   1.358 seconds
Complete requests:      <span class="m">10</span>
Failed requests:        <span class="m">0</span>
Total transferred:      <span class="m">6640</span> bytes
Total body sent:        <span class="m">1580</span>
HTML transferred:       <span class="m">4390</span> bytes
Requests per second:    7.36 <span class="o">[</span><span class="c1">#/sec] (mean)</span>
Time per request:       1358.083 <span class="o">[</span>ms<span class="o">]</span> <span class="o">(</span>mean<span class="o">)</span>
Time per request:       135.808 <span class="o">[</span>ms<span class="o">]</span> <span class="o">(</span>mean, across all concurrent requests<span class="o">)</span>
Transfer rate:          4.77 <span class="o">[</span>Kbytes/sec<span class="o">]</span> received
                        1.14 kb/s sent
                        5.91 kb/s total

Connection Times <span class="o">(</span>ms<span class="o">)</span>
              min  mean<span class="o">[</span>+/-sd<span class="o">]</span> median   max
Connect:      <span class="m">495</span>  <span class="m">502</span>   6.4    <span class="m">500</span>     <span class="m">512</span>
Processing:   <span class="m">167</span>  <span class="m">172</span>   8.1    <span class="m">169</span>     <span class="m">194</span>
Waiting:      <span class="m">167</span>  <span class="m">172</span>   8.2    <span class="m">169</span>     <span class="m">194</span>
Total:        <span class="m">662</span>  <span class="m">674</span>   9.8    <span class="m">672</span>     <span class="m">690</span>

Percentage of the requests served within a certain <span class="nb">time</span> <span class="o">(</span>ms<span class="o">)</span>
  50%    <span class="m">672</span>
  66%    <span class="m">681</span>
  75%    <span class="m">682</span>
  80%    <span class="m">684</span>
  90%    <span class="m">690</span>
  95%    <span class="m">690</span>
  98%    <span class="m">690</span>
  99%    <span class="m">690</span>
 100%    <span class="m">690</span> <span class="o">(</span>longest request<span class="o">)</span>
</code></pre></div><h2 id="help">help</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ab
ab: wrong number of arguments
Usage: ab <span class="o">[</span>options<span class="o">]</span> <span class="o">[</span>http<span class="o">[</span>s<span class="o">]</span>://<span class="o">]</span>hostname<span class="o">[</span>:port<span class="o">]</span>/path
Options are:
    -n requests     Number of requests to perform
    -c concurrency  Number of multiple requests to make at a <span class="nb">time</span>
    -t timelimit    Seconds to max. to spend on benchmarking This implies -n <span class="m">50000</span>
    -s timeout      Seconds to max. <span class="nb">wait</span> <span class="k">for</span> each response Default is <span class="m">30</span> seconds
    -b windowsize   Size of TCP send/receive buffer, in bytes
    -B address      Address to <span class="nb">bind</span> to when making outgoing connections
    -p postfile     File containing data to POST. Remember also to <span class="nb">set</span> -T
    -u putfile      File containing data to PUT. Remember also to <span class="nb">set</span> -T
    -T content-type Content-type header to use <span class="k">for</span> POST/PUT data, eg. <span class="s1">&#39;application/x-www-form-urlencoded&#39;</span> Default is <span class="s1">&#39;text/plain&#39;</span>
    -v verbosity    How much troubleshooting info to print
    -w              Print out results in HTML tables
    -i              Use HEAD instead of GET
    -x attributes   String to insert as table attributes
    -y attributes   String to insert as tr attributes
    -z attributes   String to insert as td or th attributes
    -C attribute    Add cookie, eg. <span class="s1">&#39;Apache=1234&#39;</span>. <span class="o">(</span>repeatable<span class="o">)</span>
    -H attribute    Add Arbitrary header line, eg. <span class="s1">&#39;Accept-Encoding: gzip&#39;</span> Inserted after all normal header lines. <span class="o">(</span>repeatable<span class="o">)</span>
    -A attribute    Add Basic WWW Authentication, the attributes are a colon separated username and password.
    -P attribute    Add Basic Proxy Authentication, the attributes are a colon separated username and password.
    -X proxy:port   Proxyserver and port number to use
    -V              Print version number and <span class="nb">exit</span>
    -k              Use HTTP KeepAlive feature
    -d              Do not show percentiles served table.
    -S              Do not show confidence estimators and warnings.
    -q              Do not show progress when doing more than <span class="m">150</span> requests
    -l              Accept variable document length <span class="o">(</span>use this <span class="k">for</span> dynamic pages<span class="o">)</span>
    -g filename     Output collected data to gnuplot format file.
    -e filename     Output CSV file with percentages served
    -r              Don<span class="se">\&#39;</span>t <span class="nb">exit</span> on socket receive errors.
    -m method       Method name
    -h              Display usage information <span class="o">(</span>this message<span class="o">)</span>
    -I              Disable TLS Server Name Indication <span class="o">(</span>SNI<span class="o">)</span> extension
    -Z ciphersuite  Specify SSL/TLS cipher suite <span class="o">(</span>See openssl ciphers<span class="o">)</span>
    -f protocol     Specify SSL/TLS protocol <span class="o">(</span>SSL3, TLS1, TLS1.1, TLS1.2 or ALL<span class="o">)</span>
    -E certfile     Specify optional client certificate chain and private key
</code></pre></div><h2 id="manual">manual</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">AB<span class="o">(</span>1<span class="o">)</span>                                                                             ab                                                                            AB<span class="o">(</span>1<span class="o">)</span>

NAME
       ab - Apache HTTP server benchmarking tool

SYNOPSIS
       ab  <span class="o">[</span>  -A  auth-username:password <span class="o">]</span> <span class="o">[</span> -b windowsize <span class="o">]</span> <span class="o">[</span> -B local-address <span class="o">]</span> <span class="o">[</span> -c concurrency <span class="o">]</span> <span class="o">[</span> -C cookie-name<span class="o">=</span>value <span class="o">]</span> <span class="o">[</span> -d <span class="o">]</span> <span class="o">[</span> -e csv-file <span class="o">]</span> <span class="o">[</span> -E client-cer‐tificate file <span class="o">]</span> <span class="o">[</span> -f protocol <span class="o">]</span> <span class="o">[</span> -g gnuplot-file <span class="o">]</span> <span class="o">[</span> -h <span class="o">]</span> <span class="o">[</span> -H custom-header <span class="o">]</span> <span class="o">[</span> -i <span class="o">]</span> <span class="o">[</span> -k <span class="o">]</span> <span class="o">[</span> -l <span class="o">]</span> <span class="o">[</span> -m HTTP-method <span class="o">]</span> <span class="o">[</span> -n requests <span class="o">]</span> <span class="o">[</span> -p POST-file <span class="o">]</span> <span class="o">[</span> -P proxy-auth-username:password  <span class="o">]</span>  <span class="o">[</span>  -q  <span class="o">]</span> <span class="o">[</span> -r <span class="o">]</span> <span class="o">[</span> -s timeout <span class="o">]</span> <span class="o">[</span> -S <span class="o">]</span> <span class="o">[</span> -t timelimit <span class="o">]</span> <span class="o">[</span> -T content-type <span class="o">]</span> <span class="o">[</span> -u PUT-file <span class="o">]</span> <span class="o">[</span> -v verbosity<span class="o">]</span> <span class="o">[</span> -V <span class="o">]</span> <span class="o">[</span> -w <span class="o">]</span> <span class="o">[</span> -x &lt;table&gt;-attributes <span class="o">]</span> <span class="o">[</span> -X proxy<span class="o">[</span>:port<span class="o">]</span> <span class="o">]</span> <span class="o">[</span> -y &lt;tr&gt;-attributes <span class="o">]</span> <span class="o">[</span> -z &lt;td&gt;-attributes <span class="o">]</span> <span class="o">[</span> -Z ciphersuite <span class="o">]</span> <span class="o">[</span>http<span class="o">[</span>s<span class="o">]</span>://<span class="o">]</span>hostname<span class="o">[</span>:port<span class="o">]</span>/path

SUMMARY
       ab is a tool <span class="k">for</span> benchmarking your Apache Hypertext Transfer Protocol <span class="o">(</span>HTTP<span class="o">)</span> server. 
       It is designed to give you an impression of how your current Apache installation performs. 
       This especially shows you how many requests per second your Apache installation is capable of serving.

OPTIONS
       -A auth-username:password
              Supply  BASIC  Authentication credentials to the server. 
              The username and password are separated by a single : and sent on the wire base64 encoded. 
              The string is sent regardless of whether the server needs it <span class="o">(</span>i.e., has sent an <span class="m">401</span> authentication needed<span class="o">)</span>.

       -b windowsize
              Size of TCP send/receive buffer, in bytes.

       -B local-address
              Address to <span class="nb">bind</span> to when making outgoing connections.

       -c concurrency
              Number of multiple requests to perform at a time. 
              Default is one request at a time.

       -C cookie-name<span class="o">=</span>value
              Add a Cookie: line to the request. 
              The argument is typically in the form of a <span class="nv">name</span><span class="o">=</span>value pair. 
              This field is repeatable.

       -d     Do not display the <span class="s2">&#34;percentage served within XX [ms] table&#34;</span>. <span class="o">(</span>legacy support<span class="o">)</span>.

       -e csv-file
              Write a Comma separated value <span class="o">(</span>CSV<span class="o">)</span> file which contains <span class="k">for</span> each percentage <span class="o">(</span>from 1% to 100%<span class="o">)</span> the <span class="nb">time</span> <span class="o">(</span>in milliseconds<span class="o">)</span> it took to serve that percentage of the requests. 
              This is usually more useful than the <span class="s1">&#39;gnuplot&#39;</span> file<span class="p">;</span> as the results are already <span class="s1">&#39;binned&#39;</span>.

       -E client-certificate-file
              When connecting to an SSL website, use the provided client certificate in PEM format to authenticate with the server. 
              The file is expected to contain the client certificate, followed by intermediate certificates, followed by the private key. Available in 2.4.36 and later.

       -f protocol
              Specify SSL/TLS protocol <span class="o">(</span>SSL2, SSL3, TLS1, TLS1.1, TLS1.2, or ALL<span class="o">)</span>. TLS1.1 and TLS1.2 support available in 2.4.4 and later.

       -g gnuplot-file
              Write all measured values out as a <span class="s1">&#39;gnuplot&#39;</span> or TSV <span class="o">(</span>Tab separate values<span class="o">)</span> file. 
              This file can easily be imported into packages like Gnuplot, IDL, Mathematica, Igor or even Excel. 
              The labels are on the first line of the file.

       -h     Display usage information.

       -H custom-header
              Append extra headers to the request. 
              The argument is typically in the form of a valid header line, containing a colon-separated field-value pair <span class="o">(</span>i.e., <span class="s2">&#34;Accept-Encoding: zip/zop;8bit&#34;</span><span class="o">)</span>.

       -i     Do HEAD requests instead of GET.

       -k     Enable the HTTP KeepAlive feature, i.e., perform multiple requests within one HTTP session. Default is no KeepAlive.

       -l     Do not report errors <span class="k">if</span> the length of the responses is not constant. This can be useful <span class="k">for</span> dynamic pages. Available in 2.4.7 and later.

       -m HTTP-method
              Custom HTTP method <span class="k">for</span> the requests. Available in 2.4.10 and later.

       -n requests
              Number of requests to perform <span class="k">for</span> the benchmarking session. 
              The default is to just perform a single request which usually leads to non-representative benchmarking results.

       -p POST-file
              File containing data to POST. Remember to also <span class="nb">set</span> -T.

       -P proxy-auth-username:password
              Supply BASIC Authentication credentials to a proxy en-route. 
              The username and password are separated by a single : and sent on the wire base64 encoded.
              The string is sent regardless of whether the proxy needs it <span class="o">(</span>i.e., has sent an <span class="m">407</span> proxy authentication needed<span class="o">)</span>.

       -q     When processing more than <span class="m">150</span> requests, ab outputs a progress count on stderr every 10% or <span class="m">100</span> requests or so. 
              The -q flag will suppress these messages.

       -r     Don<span class="se">\&#39;</span>t <span class="nb">exit</span> on socket receive errors.

       -s timeout
              Maximum number of seconds to <span class="nb">wait</span> before the socket <span class="nb">times</span> out. 
              Default is <span class="m">30</span> seconds. 
              Available in 2.4.4 and later.

       -S     Do  not  display  the median and standard deviation values, nor display the warning/error messages when the average and median are more than one or two <span class="nb">times</span> the standard deviation apart. 
              And default to the min/avg/max values. <span class="o">(</span>legacy support<span class="o">)</span>.

       -t timelimit
              Maximum number of seconds to spend <span class="k">for</span> benchmarking. This implies a -n <span class="m">50000</span> internally. 
              Use this to benchmark the server within a fixed total amount of time. 
              Per default there is no timelimit.

       -T content-type
              Content-type header to use <span class="k">for</span> POST/PUT data, eg. application/x-www-form-urlencoded. Default is text/plain.

       -u PUT-file
              File containing data to PUT. Remember to also <span class="nb">set</span> -T.

       -v verbosity
              Set verbosity level - <span class="m">4</span> and above prints information on headers, <span class="m">3</span> and above prints response codes <span class="o">(</span>404, 200, etc.<span class="o">)</span>, <span class="m">2</span> and above prints warnings and info.

       -V     Display version number and exit.

       -w     Print out results in HTML tables. Default table is two columns wide, with a white background.

       -x &lt;table&gt;-attributes
              String to use as attributes <span class="k">for</span> &lt;table&gt;. Attributes are inserted &lt;table here&gt;.

       -X proxy<span class="o">[</span>:port<span class="o">]</span>
              Use a proxy server <span class="k">for</span> the requests.

       -y &lt;tr&gt;-attributes
              String to use as attributes <span class="k">for</span> &lt;tr&gt;.

       -z &lt;td&gt;-attributes
              String to use as attributes <span class="k">for</span> &lt;td&gt;.

       -Z ciphersuite
              Specify SSL/TLS cipher suite <span class="o">(</span>See openssl ciphers<span class="o">)</span>

OUTPUT
       The following list describes the values returned by ab:

       Server Software
              The value, <span class="k">if</span> any, returned in the server HTTP header of the first successful response. 
              This includes all characters in the header from beginning to the point a character with decimal value of <span class="m">32</span> <span class="o">(</span>most notably: a space or CR/LF<span class="o">)</span> is detected.

       Server Hostname
              The DNS or IP address given on the <span class="nb">command</span> line

       Server Port
              The port to which ab is connecting. 
              If no port is given on the <span class="nb">command</span> line, this will default to <span class="m">80</span> <span class="k">for</span> http and <span class="m">443</span> <span class="k">for</span> https.

       SSL/TLS Protocol
              The protocol parameters negotiated between the client and server. 
              This will only be printed <span class="k">if</span> SSL is used.

       Document Path
              The request URI parsed from the <span class="nb">command</span> line string.

       Document Length
              This is the size in bytes of the first successfully returned document. 
              If the document length changes during testing, the response is considered an error.

       Concurrency Level
              The number of concurrent clients used during the <span class="nb">test</span>

       Time taken <span class="k">for</span> tests
              This is the <span class="nb">time</span> taken from the moment the first socket connection is created to the moment the last response is received

       Complete requests
              The number of successful responses received

       Failed requests
              The number of requests that were considered a failure. 
              If the number is greater than zero, another line will be printed showing the number of requests that failed due to connecting, reading, incorrect content length, or exceptions.

       Write errors
              The number of errors that failed during write <span class="o">(</span>broken pipe<span class="o">)</span>.

       Non-2xx responses
              The number of responses that were not in the <span class="m">200</span> series of response codes. If all responses were 200, this field is not printed.

       Keep-Alive requests
              The number of connections that resulted in Keep-Alive requests

       Total body sent
              If  configured  to  send  data  as part of the test, this is the total number of bytes sent during the tests. 
              This field is omitted <span class="k">if</span> the <span class="nb">test</span> did not include a body to send.

       Total transferred
              The total number of bytes received from the server. 
              This number is essentially the number of bytes sent over the wire.

       HTML transferred
              The total number of document bytes received from the server. 
              This number excludes bytes received in HTTP headers

       Requests per second
              This is the number of requests per second. 
              This value is the result of dividing the number of requests by the total <span class="nb">time</span> taken

       Time per request
              The average <span class="nb">time</span> spent per request. 
              The first value is calculated with the formula concurrency * timetaken * <span class="m">1000</span> / <span class="k">done</span> <span class="k">while</span> the second value is calculated with the formula timetaken * <span class="m">1000</span> / <span class="k">done</span>

       Transfer rate
              The rate of transfer as calculated by the formula totalread / <span class="m">1024</span> / timetaken

BUGS
       There are  various  statically  declared buffers of fixed length. 
       Combined with the lazy parsing of the <span class="nb">command</span> line arguments, the response headers from the server and other external inputs, this might bite you.

       It does not implement HTTP/1.x fully<span class="p">;</span> only accepts some <span class="s1">&#39;expected&#39;</span> forms of responses. 
       The rather heavy use of strstr<span class="o">(</span>3<span class="o">)</span> shows up top in profile, which might indicate a performance problem<span class="p">;</span> i.e., you would measure the ab performance rather than the server<span class="se">\&#39;</span>s.

Apache HTTP Server                                                            2018-10-10                                                                        AB<span class="o">(</span>1<span class="o">)</span>
</code></pre></div><h2 id="official-web-info">Official Web Info</h2>
<p>ab - Apache HTTP server benchmarking tool - Apache HTTP Server Version 2.4<br>
<a href="https://httpd.apache.org/docs/2.4/programs/ab.html">https://httpd.apache.org/docs/2.4/programs/ab.html</a></p>
<h2 id="この記事を試した環境">この記事を試した環境</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ cat /etc/os-release 
<span class="nv">NAME</span><span class="o">=</span><span class="s2">&#34;Amazon Linux&#34;</span>
<span class="nv">VERSION</span><span class="o">=</span><span class="s2">&#34;2&#34;</span>
<span class="nv">ID</span><span class="o">=</span><span class="s2">&#34;amzn&#34;</span>
<span class="nv">ID_LIKE</span><span class="o">=</span><span class="s2">&#34;centos rhel fedora&#34;</span>
<span class="nv">VERSION_ID</span><span class="o">=</span><span class="s2">&#34;2&#34;</span>
<span class="nv">PRETTY_NAME</span><span class="o">=</span><span class="s2">&#34;Amazon Linux 2&#34;</span>
<span class="nv">ANSI_COLOR</span><span class="o">=</span><span class="s2">&#34;0;33&#34;</span>
<span class="nv">CPE_NAME</span><span class="o">=</span><span class="s2">&#34;cpe:2.3:o\:amazon:amazon_linux:2&#34;</span>
<span class="nv">HOME_URL</span><span class="o">=</span><span class="s2">&#34;https://amazonlinux.com/&#34;</span>
$ uname --kernel-name --kernel-release --kernel-version --machine
Linux 4.14.209-160.339.amzn2.x86_64 <span class="c1">#1 SMP Wed Dec 16 22:44:04 UTC 2020 x86_64</span>
$ ab -V
This is ApacheBench, Version 2.3 &lt;<span class="nv">$Revision</span>: <span class="m">1879490</span> $&gt;
Copyright <span class="m">1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/
</code></pre></div>]]></content>
		</item>
		
		<item>
			<title>Using Amazon SQS dead-letter queues to replay messages 読んだメモ</title>
			<link>https://noid11.github.io/posts/read-using-amazon-sqs-dead-letter-queues-to-replay-messages/</link>
			<pubDate>Sun, 24 Jan 2021 16:50:17 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/read-using-amazon-sqs-dead-letter-queues-to-replay-messages/</guid>
			<description>&lt;p&gt;以下のブログ記事を読んだメモ&lt;/p&gt;
&lt;p&gt;Using Amazon SQS dead-letter queues to replay messages | AWS Compute Blog&lt;br&gt;
&lt;a href=&#34;https://aws.amazon.com/jp/blogs/compute/using-amazon-sqs-dead-letter-queues-to-replay-messages/&#34;&gt;https://aws.amazon.com/jp/blogs/compute/using-amazon-sqs-dead-letter-queues-to-replay-messages/&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SQS の DLQ を扱う方法として、 DLQ を 2つ 使う構成&lt;/li&gt;
&lt;li&gt;1つめの DLQ は Lambda 関数のトリガーとして設定し、アプリケーションで処理されなかったメッセージを Lambda 関数によって再処理する
&lt;ul&gt;
&lt;li&gt;この Lambda 関数で処理できなかったものに関しては SQS メッセージ属性にて再試行回数をカウントして、所定のリトライ回数を超えたら 2つめ の DLQ にメッセージを送信し、あとは手動で処理する&lt;/li&gt;
&lt;li&gt;Lambda 関数による DLQ のリトライではメッセージ属性を使ってエクスポネンシャルバックオフによる間隔調整を行う&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;</description>
			<content type="html"><![CDATA[<p>以下のブログ記事を読んだメモ</p>
<p>Using Amazon SQS dead-letter queues to replay messages | AWS Compute Blog<br>
<a href="https://aws.amazon.com/jp/blogs/compute/using-amazon-sqs-dead-letter-queues-to-replay-messages/">https://aws.amazon.com/jp/blogs/compute/using-amazon-sqs-dead-letter-queues-to-replay-messages/</a></p>
<ul>
<li>SQS の DLQ を扱う方法として、 DLQ を 2つ 使う構成</li>
<li>1つめの DLQ は Lambda 関数のトリガーとして設定し、アプリケーションで処理されなかったメッセージを Lambda 関数によって再処理する
<ul>
<li>この Lambda 関数で処理できなかったものに関しては SQS メッセージ属性にて再試行回数をカウントして、所定のリトライ回数を超えたら 2つめ の DLQ にメッセージを送信し、あとは手動で処理する</li>
<li>Lambda 関数による DLQ のリトライではメッセージ属性を使ってエクスポネンシャルバックオフによる間隔調整を行う</li>
</ul>
</li>
</ul>
<h2 id="introduction">Introduction</h2>
<ul>
<li>SQS はフルマネージドなキューイングサービス
<ul>
<li>マイクロサービス、分散システム、サーバーレスアプリケーションを分離して拡張できる</li>
<li>SQS の一般的に使用される機能は、デッドレターキュー
<ul>
<li>DLQ: Dead Letter Queue は、正常に処理（消費）できないメッセージを格納するために使用する</li>
</ul>
</li>
</ul>
</li>
<li>この記事では、既存の SQS キューに自動復元機能を追加する方法を解説
<ul>
<li>DLQ を監視し、メッセージをメインキューに戻して、再度処理できるかどうかを確認する
<ul>
<li>特定のアルゴリズムを使用して、これが永久に繰り返されないようにする</li>
<li>メッセージの再処理を試みるたびに、メッセージが最終的に無効と見なされるまで、再生時間が長くなる</li>
</ul>
</li>
</ul>
</li>
<li>SQS DLQ, AWS Lambda, および特定のアルゴリズムを使用して、失敗したメッセージの再試行率を下げる
<ul>
<li>このサーバーレスソリューションはパッケージ化して AWS サーバーレスアプリケーションリポジトリに公開している</li>
</ul>
</li>
</ul>
<h2 id="dead-letter-queues-and-message-replay">Dead-letter queues and message replay</h2>
<ul>
<li>DLQ の主なタスクは、メッセージの失敗を処理すること
<ul>
<li>これにより、未処理のメッセージを脇に置いて分離し、処理が失敗した理由を判別できる</li>
<li>多くの場合、これらの失敗したメッセージはアプリケーションエラーが原因で発生する
<ul>
<li>たとえば、コンシューマアプリケーションがメッセージを正しく解析できず、未処理の例外をスローするとする</li>
<li>この例外により、メッセージを DLQ に送信するエラーレスポンスがトリガーされる</li>
</ul>
</li>
</ul>
</li>
<li>失敗したメッセージを処理するために、エクスポネンシャルバックオフアルゴリズムを実装して再試行メカニズムを構築する
<ul>
<li>エクスポネンシャルバックオフの背後にある考え方は、連続するエラーレスポンスを再試行するまでの待機時間を徐々に長くすること</li>
<li>ほとんどのエクスポネンシャルバックオフアルゴリズムは、ジッター（ランダム化された遅延）を使用して、連続する衝突を防ぐ
<ul>
<li>これにより、メッセージの再試行が時間全体でより均等に分散され、より効率的に処理できるようになる</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="solution-overview">Solution overview</h2>
<p><img src="/images/read-using-amazon-sqs-dead-letter-queues-to-replay-messages/sqs-newarch.png" alt="sqs-newarch.png"></p>
<ul>
<li>プロデューサーから SQS に送信されるメッセージのフロー
<ol>
<li>プロデューサーはメッセージを SQS キューに送信</li>
<li>コンシューマーが同じ SQS キュー内のメッセージの処理に失敗</li>
<li>メッセージは、コンポーネントの設定に従って、メインの SQS キューからデフォルトのデッドレターキューに移動される</li>
<li>Lambda 関数は SQS メインデッドレターキューをイベントソースとして設定</li>
</ol>
<ul>
<li>メッセージを受信して元のキューに送り返し、メッセージタイマーを追加</li>
</ul>
<ol start="5">
<li>メッセージタイマーは、エクスポネンシャルバックオフおよびジッターアルゴリズムによって定義される</li>
<li>再試行の回数を制限</li>
</ol>
<ul>
<li>メッセージがこの制限を超えると、メッセージは 2番目 の DLQ に移動され、オペレーターが手動で処理する</li>
</ul>
</li>
</ul>
<h2 id="how-the-replay-function-works">How the replay function works</h2>
<ul>
<li>SQS DLQ がメッセージを受信するたびに Lambda がトリガーされて再生機能が実行される</li>
<li>リプレイコードは SQS メッセージ属性 <code>sqs-dlq-replay-nb</code> を、現在試行されている再試行回数の永続的なカウンターとして使用する
<ul>
<li>再試行の回数は、（アプリケーション構成ファイルで定義されている）最大回数と比較する
<ul>
<li>最大値を超えると、メッセージは人間が操作するキューに移動する</li>
<li>そうでない場合、この関数は AWS Lambda イベントデータを使用して SQS メインキューの新しいメッセージを作成する</li>
<li>最後に、再試行カウンターを更新し、メッセージに新しいメッセージタイマーを追加して、メッセージをメインキューに送り返す</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="s2">&#34;&#34;&#34;Lambda function handler.&#34;&#34;&#34;</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">]:</span>
        <span class="n">nbReplay</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># number of replay</span>
        <span class="k">if</span> <span class="s1">&#39;sqs-dlq-replay-nb&#39;</span> <span class="ow">in</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;messageAttributes&#39;</span><span class="p">]:</span>
            <span class="n">nbReplay</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s1">&#39;messageAttributes&#39;</span><span class="p">][</span><span class="s1">&#39;sqs-dlq-replay-nb&#39;</span><span class="p">][</span><span class="s2">&#34;stringValue&#34;</span><span class="p">])</span>

        <span class="n">nbReplay</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">nbReplay</span> <span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">MAX_ATTEMPS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MaxAttempsError</span><span class="p">(</span><span class="n">replay</span><span class="o">=</span><span class="n">nbReplay</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">MAX_ATTEMPS</span><span class="p">)</span>

        <span class="c1"># SQS attributes</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;messageAttributes&#39;</span><span class="p">]</span>
        <span class="n">attributes</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;sqs-dlq-replay-nb&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;StringValue&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">nbReplay</span><span class="p">),</span> <span class="s1">&#39;DataType&#39;</span><span class="p">:</span> <span class="s1">&#39;Number&#39;</span><span class="p">}})</span>

        <span class="n">_sqs_attributes_cleaner</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>

        <span class="c1"># Backoff</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">backoff</span><span class="o">.</span><span class="n">ExpoBackoffFullJitter</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">BACKOFF_RATE</span><span class="p">,</span> <span class="n">cap</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">MESSAGE_RETENTION_PERIOD</span><span class="p">)</span>
        <span class="n">delaySeconds</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">backoff</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">nbReplay</span><span class="p">))</span>

        <span class="c1"># SQS</span>
        <span class="n">SQS</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span>
            <span class="n">QueueUrl</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">SQS_MAIN_URL</span><span class="p">,</span>
            <span class="n">MessageBody</span><span class="o">=</span><span class="n">record</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">],</span>
            <span class="n">DelaySeconds</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">delaySeconds</span><span class="p">),</span>
            <span class="n">MessageAttributes</span><span class="o">=</span><span class="n">record</span><span class="p">[</span><span class="s1">&#39;messageAttributes&#39;</span><span class="p">]</span>
        <span class="p">)</span>
</code></pre></div><h2 id="how-to-use-the-application">How to use the application</h2>
<ul>
<li>このサーバーレスアプリケーションは、次の方法で使用できる
<ul>
<li>Lambda コンソール:「サーバーレスアプリリポジトリの参照」オプションを選択して関数を作成</li>
<li>パブリックアプリケーションリポジトリで amazon-sqs-dlq-replay-backoff アプリケーションを選択
<ul>
<li>デフォルトの SQS パラメーターとリプレイ機能パラメーターを使用してアプリケーションを設定</li>
<li>このブログ投稿で YanCui によって説明されている、サーバーレスフレームワーク</li>
<li><code>AWS::ServerlessRepo::Application</code> リソースを使用した CloudFormation テンプレート</li>
</ul>
</li>
</ul>
</li>
<li>AWS サーバーレスアプリケーションリポジトリアプリケーションを使用した CloudFormation テンプレートの例</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">AWSTemplateFormatVersion</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;2010-09-09&#39;</span><span class="w">
</span><span class="w"></span><span class="nt">Transform</span><span class="p">:</span><span class="w"> </span><span class="l">AWS::Serverless-2016-10-31</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="nt">Resources</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">ReplaySqsQueue</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l">AWS::Serverless::Application</span><span class="w">
</span><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">Location</span><span class="p">:</span><span class="w"> 
</span><span class="w">        </span><span class="nt">ApplicationId</span><span class="p">:</span><span class="w"> </span><span class="l">arn:aws:serverlessrepo:eu-west-1:1234123412:applications~sqs-dlq-replay</span><span class="w">
</span><span class="w">        </span><span class="nt">SemanticVersion</span><span class="p">:</span><span class="w"> </span><span class="m">1.0.0</span><span class="w">
</span><span class="w">      </span><span class="nt">Parameters</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">BackoffRate</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2&#34;</span><span class="w">
</span><span class="w">        </span><span class="nt">MaxAttempts</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;3&#34;</span><span class="w">
</span></code></pre></div><h2 id="conclusion">Conclusion</h2>
<ul>
<li>エクスポネンシャルバックオフアルゴリズム（ジッターあり）が SQS キューのメッセージ処理機能をどのように強化するかについて説明
<ul>
<li>これで amazon-sqs-dlq-replay-backoff アプリケーションが AWS サーバーレスアプリケーションリポジトリにある
<ul>
<li>GitHub リポジトリでも公開している: <a href="https://github.com/aws-samples/amazon-sqs-dlq-replay-backoff">https://github.com/aws-samples/amazon-sqs-dlq-replay-backoff</a></li>
</ul>
</li>
</ul>
</li>
<li>SQS のデッドレターキューの使用を開始するには、以下
<ul>
<li><a href="http://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-dead-letter-queues.html">http://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-dead-letter-queues.html</a></li>
<li><a href="http://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/MonitorSQSwithCloudWatch.html">http://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/MonitorSQSwithCloudWatch.html</a></li>
</ul>
</li>
<li>再生メカニズムを実装するには、以下を参照
<ul>
<li><a href="https://aws.amazon.com/blogs/architecture/exponential-backoff-and-jitter/">https://aws.amazon.com/blogs/architecture/exponential-backoff-and-jitter/</a></li>
<li><a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-message-timers.html">https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-message-timers.html</a></li>
</ul>
</li>
<li>サーバーレス学習リソースの詳細については http:////serverlessland.com</li>
</ul>]]></content>
		</item>
		
		<item>
			<title>AWS CLI v2 を使って CloudWatch Logs を `tail -f` っぽく見る方法</title>
			<link>https://noid11.github.io/posts/how-to-cloudwatch-logs-tail-follow-by-aws-cli-v2/</link>
			<pubDate>Sat, 23 Jan 2021 14:33:50 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/how-to-cloudwatch-logs-tail-follow-by-aws-cli-v2/</guid>
			<description>&lt;ul&gt;
&lt;li&gt;AWS Lambda を動かしている時にマネジメントコンソールを開かなくてもログを確認できて便利&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;nv&#34;&gt;LOG_GROUP&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/aws/lambda/myfunc
aws logs tail &lt;span class=&#34;nv&#34;&gt;$LOG_GROUP&lt;/span&gt; --follow
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
			<content type="html"><![CDATA[<ul>
<li>AWS Lambda を動かしている時にマネジメントコンソールを開かなくてもログを確認できて便利</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nv">LOG_GROUP</span><span class="o">=</span>/aws/lambda/myfunc
aws logs tail <span class="nv">$LOG_GROUP</span> --follow
</code></pre></div><h2 id="help">help</h2>
<p><a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/logs/tail.html">https://awscli.amazonaws.com/v2/documentation/api/latest/reference/logs/tail.html</a></p>
<ul>
<li><code>trail -f</code> のような形式じゃなくても、過去 1時間 のログデータを取得するような使い方も可能
<ul>
<li><code>aws logs tail $LOG_GROUP --since 1h</code></li>
</ul>
</li>
<li><code>--format</code> を <code>short</code> と設定することで、ログストリーム名やタイムスタンプのミリ秒単位を省略して表示できる
<ul>
<li><code>aws logs tail $LOG_GROUP --follow --format short</code></li>
</ul>
</li>
<li><code>--filter-pattern</code> を指定することで、表示内容をフィルタできる
<ul>
<li>特定 Lambda 関数における、過去1週間の Duration や Max Memory Used を確認したい場合・・・
<ul>
<li><code>aws logs tail $LOG_GROUP --since 7d --filter-pattern &quot;?REPORT&quot;</code></li>
</ul>
</li>
<li>特定リクエスト ID でフィルタしたい場合・・・
<ul>
<li><code>aws logs tail $LOG_GROUP --since 2d --filter-pattern '&quot;my-request-id&quot;'</code>
<ul>
<li>CloudWatch Logs におけるフィルタパターンで完全一致はダブルクォーテーションで囲む必要があるので <code>'&quot;hoge&quot;'</code> のような指定が必要</li>
</ul>
</li>
</ul>
</li>
<li>フィルタパターンとして指定できる構文については CloudWatch Logs のドキュメントを参照
<ul>
<li><a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/FilterAndPatternSyntax.html">https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/FilterAndPatternSyntax.html</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% aws logs tail <span class="nb">help</span>
TAIL<span class="o">()</span>                                                                  TAIL<span class="o">()</span>



NAME
       tail -

DESCRIPTION
       Tails the logs <span class="k">for</span> a CloudWatch Logs group. 
       By default, the <span class="nb">command</span> returns logs from all associated CloudWatch Logs streams during the past ten minutes. 
       Note that there is no guarantee <span class="k">for</span> exact timestamp ordering of logs.

       See <span class="s1">&#39;aws help&#39;</span> <span class="k">for</span> descriptions of global parameters.

SYNOPSIS
            tail
          group_name &lt;value&gt;
          <span class="o">[</span>--since &lt;value&gt;<span class="o">]</span>
          <span class="o">[</span>--follow<span class="o">]</span>
          <span class="o">[</span>--format &lt;value&gt;<span class="o">]</span>
          <span class="o">[</span>--filter-pattern &lt;value&gt;<span class="o">]</span>

OPTIONS
       group_name <span class="o">(</span>string<span class="o">)</span> The name of the CloudWatch Logs group.

       --since <span class="o">(</span>string<span class="o">)</span> From what <span class="nb">time</span> to begin displaying logs.  
       By  default, logs will be displayed starting from ten minutes in the past. 
       The value provided can be an ISO <span class="m">8601</span> timestamp or a relative time. 
       For relative times, provide a number and a single unit. 
       Supported units include:

          o s - seconds
          o m - minutes
          o h - hours
          o d - days
          o w - weeks

          For  example, a value of 5m would indicate to display logs starting
          five minutes in the past.
          Note that multiple units are not supported <span class="o">(</span>i.e. 5h30m<span class="o">)</span>

       --follow <span class="o">(</span>boolean<span class="o">)</span> Whether to continuously poll <span class="k">for</span> new logs. 
       By default, the <span class="nb">command</span> will <span class="nb">exit</span> once there are no more logs to display.
       To <span class="nb">exit</span> from this mode, use Control-C.

       --format <span class="o">(</span>string<span class="o">)</span> The format to display the logs. 
       The following formats are supported:

          o detailed - This the default format. 
            It prints  out  the  timestamp with millisecond precision and timezones, the log stream name, and the log message.

          o short - A shortened format. 
            It prints out the a shortened timestamp and the log message.

       --filter-pattern <span class="o">(</span>string<span class="o">)</span> The filter pattern to use. 
       See Filter and Pattern Syntax <span class="k">for</span> details. 
       If not provided, all the events are matched

       See <span class="s1">&#39;aws help&#39;</span> <span class="k">for</span> descriptions of global parameters.



                                                                        TAIL<span class="o">()</span>
</code></pre></div><h2 id="この記事を試した環境">この記事を試した環境</h2>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% sw_vers
ProductName:	Mac OS X
ProductVersion:	10.15.7
BuildVersion:	19H114
% aws --version
aws-cli/2.1.6 Python/3.7.4 Darwin/19.6.0 exe/x86_64 prompt/off
</code></pre></div>]]></content>
		</item>
		
		<item>
			<title>Mac に Docker Machine をインストールする方法</title>
			<link>https://noid11.github.io/posts/how-to-install-docker-machine-to-mac/</link>
			<pubDate>Fri, 22 Jan 2021 09:30:07 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/how-to-install-docker-machine-to-mac/</guid>
			<description>&lt;p&gt;ググっても公式情報がヒットしづらかったのでメモ&lt;/p&gt;</description>
			<content type="html"><![CDATA[<p>ググっても公式情報がヒットしづらかったのでメモ</p>
<ul>
<li><a href="https://docs.docker.com/machine/">Docker Machine</a> は <a href="https://docs.docker.com/docker-for-mac/install/">Docker Desktop on Mac</a> に含まれなくなったので別途個別にインストールが必要</li>
<li>インストール方法は<a href="https://docs.docker.com/machine/install-machine/">公式ドキュメント</a>に全て書いてある</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># インストール</span>
<span class="nv">base</span><span class="o">=</span>https://github.com/docker/machine/releases/download/v0.16.0 <span class="o">&amp;&amp;</span> curl -L <span class="nv">$base</span>/docker-machine-<span class="k">$(</span>uname -s<span class="k">)</span>-<span class="k">$(</span>uname -m<span class="k">)</span> &gt;/usr/local/bin/docker-machine <span class="o">&amp;&amp;</span> chmod +x /usr/local/bin/docker-machine

<span class="c1"># インストールできたか確認</span>
docker-machine version
</code></pre></div><hr>
<p>この記事を試した環境</p>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% sw_vers
ProductName:    Mac OS X
ProductVersion: 10.15.7
BuildVersion:   19H114
% docker-machine version
docker-machine version 0.16.0, build 702c267f
</code></pre></div>]]></content>
		</item>
		
		<item>
			<title>xmllint コマンドで XML を整形して出力する</title>
			<link>https://noid11.github.io/posts/pretty-print-xml-by-xmllint/</link>
			<pubDate>Thu, 21 Jan 2021 10:26:45 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/pretty-print-xml-by-xmllint/</guid>
			<description>&lt;p&gt;XML をファイルとして保存して、 &lt;code&gt;--format&lt;/code&gt; オプションで整形できる&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;xmllint --format ./myfile.xml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
			<content type="html"><![CDATA[<p>XML をファイルとして保存して、 <code>--format</code> オプションで整形できる</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">xmllint --format ./myfile.xml
</code></pre></div><h2 id="manual">manual</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">XMLLINT<span class="o">(</span>1<span class="o">)</span>                                                             xmllint Manual                                                            XMLLINT<span class="o">(</span>1<span class="o">)</span>

NAME
       xmllint - <span class="nb">command</span> line XML tool

SYNOPSIS
       xmllint <span class="o">[</span>--version <span class="p">|</span> --debug <span class="p">|</span> --shell <span class="p">|</span> --xpath <span class="s2">&#34;XPath_expression&#34;</span> <span class="p">|</span> --debugent <span class="p">|</span> --copy <span class="p">|</span> --recover <span class="p">|</span> --noent <span class="p">|</span> --noout <span class="p">|</span> --nonet <span class="p">|</span>
               --path <span class="s2">&#34;PATH(S)&#34;</span> <span class="p">|</span> --load-trace <span class="p">|</span> --htmlout <span class="p">|</span> --nowrap <span class="p">|</span> --valid <span class="p">|</span> --postvalid <span class="p">|</span> --dtdvalid URL <span class="p">|</span> --dtdvalidfpi FPI <span class="p">|</span> --timing <span class="p">|</span>
               --output FILE <span class="p">|</span> --repeat <span class="p">|</span> --insert <span class="p">|</span> --compress <span class="p">|</span> --html <span class="p">|</span> --xmlout <span class="p">|</span> --push <span class="p">|</span> --memory <span class="p">|</span> --maxmem NBBYTES <span class="p">|</span> --nowarning <span class="p">|</span> --noblanks <span class="p">|</span>
               --nocdata <span class="p">|</span> --format <span class="p">|</span> --encode ENCODING <span class="p">|</span> --dropdtd <span class="p">|</span> --nsclean <span class="p">|</span> --testIO <span class="p">|</span> --catalogs <span class="p">|</span> --nocatalogs <span class="p">|</span> --auto <span class="p">|</span> --xinclude <span class="p">|</span>
               --noxincludenode <span class="p">|</span> --loaddtd <span class="p">|</span> --dtdattr <span class="p">|</span> --stream <span class="p">|</span> --walker <span class="p">|</span> --pattern PATTERNVALUE <span class="p">|</span> --chkregister <span class="p">|</span> --relaxng SCHEMA <span class="p">|</span> --schema SCHEMA
               <span class="p">|</span> --c14n<span class="o">]</span> <span class="o">{</span>XML-FILE<span class="o">(</span>S<span class="o">)</span>... <span class="p">|</span> -<span class="o">}</span>

       xmllint --help

DESCRIPTION
       The xmllint program parses one or more XML files, specified on the <span class="nb">command</span> line as XML-FILE <span class="o">(</span>or the standard input <span class="k">if</span> the filename provided is - <span class="o">)</span>.
       It prints various types of output, depending upon the options selected. It is useful <span class="k">for</span> detecting errors both in XML code and in the XML parser itself.

       xmllint is included in libxml<span class="o">(</span>3<span class="o">)</span>.

OPTIONS
       xmllint accepts the following options <span class="o">(</span>in alphabetical order<span class="o">)</span>:

       --auto
           Generate a small document <span class="k">for</span> testing purposes.

       --catalogs
           Use the SGML catalog<span class="o">(</span>s<span class="o">)</span> from SGML_CATALOG_FILES. Otherwise XML catalogs starting from /etc/xml/catalog are used by default.

       --chkregister
           Turn on node registration. Useful <span class="k">for</span> developers testing libxml<span class="o">(</span>3<span class="o">)</span> node tracking code.

       --compress
           Turn on gzip<span class="o">(</span>1<span class="o">)</span> compression of output.

       --copy
           Test the internal copy implementation.

       --c14n
           Use the W3C XML Canonicalisation <span class="o">(</span>C14N<span class="o">)</span> to serialize the result of parsing to stdout. It keeps comments in the result.

       --dtdvalid URL
           Use the DTD specified by an URL <span class="k">for</span> validation.

       --dtdvalidfpi FPI
           Use the DTD specified by a Formal Public Identifier FPI <span class="k">for</span> validation, note that this will require a catalog exporting that Formal Public Identifier to work.

       --debug
           Parse a file and output an annotated tree of the in-memory version of the document.

       --debugent
           Debug the entities defined in the document.

       --dropdtd
           Remove DTD from output.

       --dtdattr
           Fetch external DTD and populate the tree with inherited attributes.

       --encode ENCODING
           Output in the given encoding. Note that this works <span class="k">for</span> full document not fragments or result from XPath queries.

       --format
           Reformat and reindent the output. The XMLLINT_INDENT environment variable controls the indentation. The default value is two spaces <span class="s2">&#34; &#34;</span><span class="o">)</span>.

       --help
           Print out a short usage summary <span class="k">for</span> xmllint.

       --html
           Use the HTML parser.

       --htmlout
           Output results as an HTML file. 
           This causes xmllint to output the necessary HTML tags surrounding the result tree output so the results can be displayed/viewed in a browser.

       --insert
           Test <span class="k">for</span> valid insertions.

       --loaddtd
           Fetch an external DTD.

       --load-trace
           Display all the documents loaded during the processing to stderr.

       --maxmem NNBYTES
           Test the parser memory support.  
           NNBYTES is the maximum number of bytes the library is allowed to allocate. 
           This can also be used to make sure batch processing of XML files will not exhaust the virtual memory of the server running them.

       --memory
           Parse from memory.

       --noblanks
           Drop ignorable blank spaces.

       --nocatalogs
           Do not use any catalogs.

       --nocdata
           Substitute CDATA section by equivalent text nodes.

       --noent
           Substitute entity values <span class="k">for</span> entity references. By default, xmllint leaves entity references in place.

       --nonet
           Do not use the Internet to fetch DTDs or entities.

       --noout
           Suppress output. By default, xmllint outputs the result tree.

       --nowarning
           Do not emit warnings from the parser and/or validator.

       --nowrap
           Do not output HTML doc wrapper.

       --noxincludenode
           Do XInclude processing but <span class="k">do</span> not generate XInclude start and end nodes.

       --nsclean
           Remove redundant namespace declarations.

       --output FILE
           Define a file path where xmllint will save the result of parsing. 
           Usually the programs build a tree and save it on stdout, with this option the result XML instance will be saved onto a file.

       --path <span class="s2">&#34;PATH(S)&#34;</span>
           Use the <span class="o">(</span>space- or colon-separated<span class="o">)</span> list of filesystem paths specified by PATHS to load DTDs or entities. 
           Enclose space-separated lists by quotation marks.

       --pattern PATTERNVALUE
           Used to exercise the pattern recognition engine, which can be used with the reader interface to the parser. 
           It allows to <span class="k">select</span> some nodes in the document based on an XPath <span class="o">(</span>subset<span class="o">)</span> expression. Used <span class="k">for</span> debugging.

       --postvalid
           Validate after parsing has completed.

       --push
           Use the push mode of the parser.

       --recover
           Output any parsable portions of an invalid document.

       --relaxng SCHEMA
           Use RelaxNG file named SCHEMA <span class="k">for</span> validation.

       --repeat
           Repeat <span class="m">100</span> times, <span class="k">for</span> timing or profiling.

       --schema SCHEMA
           Use a W3C XML Schema file named SCHEMA <span class="k">for</span> validation.

       --shell
           Run a navigating shell. Details on available commands in shell mode are below <span class="o">(</span>see the section called <span class="s2">&#34;SHELL COMMANDS&#34;</span><span class="o">)</span>.

       --xpath <span class="s2">&#34;XPath_expression&#34;</span>
           Run an XPath expression given as argument and print the result. 
           In <span class="k">case</span> of a nodeset result, each node in the node <span class="nb">set</span> is serialized in full in the output. 
           In <span class="k">case</span> of an empty node <span class="nb">set</span> the <span class="s2">&#34;XPath set is empty&#34;</span> result will be shown and an error <span class="nb">exit</span> code will be returned.

       --stream
           Use streaming API - useful when used in combination with --relaxng or --valid options <span class="k">for</span> validation of files that are too large to be held in memory.

       --testIO
           Test user input/output support.

       --timing
           Output information about the <span class="nb">time</span> it takes xmllint to perform the various steps.

       --valid
           Determine <span class="k">if</span> the document is a valid instance of the included Document Type Definition <span class="o">(</span>DTD<span class="o">)</span>. 
           A DTD to be validated against also can be specified at the <span class="nb">command</span> line using the --dtdvalid option. 
           By default, xmllint also checks to determine <span class="k">if</span> the document is well-formed.

       --version
           Display the version of libxml<span class="o">(</span>3<span class="o">)</span> used.

       --walker
           Test the walker module, which is a reader interface but <span class="k">for</span> a document tree, instead of using the reader API on an unparsed document it works on an existing in-memory tree. 
           Used <span class="k">for</span> debugging.

       --xinclude
           Do XInclude processing.

       --xmlout
           Used in conjunction with --html. 
           Usually when HTML is parsed the document is saved with the HTML serializer. 
           But with this option the resulting document is saved with the XML serializer. 
           This is primarily used to generate XHTML from HTML input.

SHELL COMMANDS
       xmllint offers an interactive shell mode invoked with the --shell command. Available commands in shell mode include <span class="o">(</span>in alphabetical order<span class="o">)</span>:

       base
           Display XML base of the node.

       bye
           Leave the shell.

       cat NODE
           Display the given node or the current one.

       <span class="nb">cd</span> PATH
           Change the current node to the given path <span class="o">(</span><span class="k">if</span> unique<span class="o">)</span> or root <span class="k">if</span> no argument is given.

       dir PATH
           Dumps information about the node <span class="o">(</span>namespace, attributes, content<span class="o">)</span>.

       du PATH
           Show the structure of the subtree under the given path or the current node.

       <span class="nb">exit</span>
           Leave the shell.

       <span class="nb">help</span>
           Show this help.

       free
           Display memory usage.

       load FILENAME
           Load a new document with the given filename.

       ls PATH
           List contents of the given path or the current directory.

       <span class="nb">pwd</span>
           Display the path to the current node.

       quit
           Leave the shell.

       save FILENAME
           Save the current document to the given filename or to the original name.

       validate
           Check the document <span class="k">for</span> errors.

       write FILENAME
           Write the current node to the given filename.

ENVIRONMENT
       SGML_CATALOG_FILES
           SGML catalog behavior can be changed by redirecting queries to the user<span class="s1">&#39;s own set of catalogs. 
</span><span class="s1">           This can be done by setting the SGML_CATALOG_FILES environment variable to a list of catalogs. 
</span><span class="s1">           An empty one should deactivate loading the default /etc/sgml/catalog catalog.
</span><span class="s1">
</span><span class="s1">       XML_CATALOG_FILES
</span><span class="s1">           XML catalog behavior can be changed by redirecting queries to the user&#39;</span>s own <span class="nb">set</span> of catalogs. 
           This can be <span class="k">done</span> by setting the XML_CATALOG_FILES environment variable to a list of catalogs. 
           An empty one should deactivate loading the default /etc/xml/catalog catalog.

       XML_DEBUG_CATALOG
           Setting the environment variable XML_DEBUG_CATALOG to non-zero using the <span class="nb">export</span> <span class="nb">command</span> outputs debugging information related to catalog operations.

       XMLLINT_INDENT
           Setting the environment variable XMLLINT_INDENT controls the indentation. The default value is two spaces <span class="s2">&#34; &#34;</span>.

DIAGNOSTICS
       xmllint <span class="k">return</span> codes provide information that can be used when calling it from scripts.

       <span class="m">0</span>
           No error

       <span class="m">1</span>
           Unclassified

       <span class="m">2</span>
           Error in DTD

       <span class="m">3</span>
           Validation error

       <span class="m">4</span>
           Validation error

       <span class="m">5</span>
           Error in schema compilation

       <span class="m">6</span>
           Error writing output

       <span class="m">7</span>
           Error in pattern <span class="o">(</span>generated when --pattern option is used<span class="o">)</span>

       <span class="m">8</span>
           Error in Reader registration <span class="o">(</span>generated when --chkregister option is used<span class="o">)</span>

       <span class="m">9</span>
           Out of memory error

SEE ALSO
       libxml<span class="o">(</span>3<span class="o">)</span>

       More information can be found at

       o   libxml<span class="o">(</span>3<span class="o">)</span> web page http://www.xmlsoft.org/

       o   W3C XSLT page http://www.w3.org/TR/xslt

AUTHORS
       John Fleck &lt;jfleck@inkstain.net&gt;
           Author.

       Ziying Sherwin &lt;sherwin@nlm.nih.gov&gt;
           Author.

       Heiko Rupp &lt;hwr@pilhuhn.de&gt;
           Author.

COPYRIGHT
       Copyright <span class="o">(</span>C<span class="o">)</span> 2001, <span class="m">2004</span>

libxml2                                                                    <span class="nv">$Date</span>$                                                                XMLLINT<span class="o">(</span>1<span class="o">)</span>
</code></pre></div><h2 id="実行例">実行例</h2>
<ul>
<li><a href="https://samltool.io/">https://samltool.io/</a> で公開されている SAML レスポンスを <code>saml.xml</code> として保存</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% xmllint --format ./saml.xml 
&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">&#34;1.0&#34;</span>?&gt;
&lt;samlp:Response xmlns:samlp<span class="o">=</span><span class="s2">&#34;urn:oasis:names:tc:SAML:2.0:protocol&#34;</span> <span class="nv">ID</span><span class="o">=</span><span class="s2">&#34;_621c4c4ae5d60c768cc2&#34;</span> <span class="nv">Version</span><span class="o">=</span><span class="s2">&#34;2.0&#34;</span> <span class="nv">IssueInstant</span><span class="o">=</span><span class="s2">&#34;2014-10-14T14:32:17Z&#34;</span> <span class="nv">Destination</span><span class="o">=</span><span class="s2">&#34;https://app.auth0.com/tester/samlp&#34;</span>&gt;
  &lt;saml:Issuer xmlns:saml<span class="o">=</span><span class="s2">&#34;urn:oasis:names:tc:SAML:2.0:assertion&#34;</span>&gt;urn:matugit.auth0.com&lt;/saml:Issuer&gt;
  &lt;samlp:Status&gt;
    &lt;samlp:StatusCode <span class="nv">Value</span><span class="o">=</span><span class="s2">&#34;urn:oasis:names:tc:SAML:2.0:status:Success&#34;</span>/&gt;
  &lt;/samlp:Status&gt;
  &lt;saml:Assertion xmlns:saml<span class="o">=</span><span class="s2">&#34;urn:oasis:names:tc:SAML:2.0:assertion&#34;</span> <span class="nv">Version</span><span class="o">=</span><span class="s2">&#34;2.0&#34;</span> <span class="nv">ID</span><span class="o">=</span><span class="s2">&#34;_5VK7LT7FliUkkaQuW6r4brF0DG5E3X76&#34;</span> <span class="nv">IssueInstant</span><span class="o">=</span><span class="s2">&#34;2014-10-14T14:32:17.251Z&#34;</span>&gt;
    &lt;saml:Issuer&gt;urn:matugit.auth0.com&lt;/saml:Issuer&gt;
    &lt;Signature <span class="nv">xmlns</span><span class="o">=</span><span class="s2">&#34;http://www.w3.org/2000/09/xmldsig#&#34;</span>&gt;
      &lt;SignedInfo&gt;
        &lt;CanonicalizationMethod <span class="nv">Algorithm</span><span class="o">=</span><span class="s2">&#34;http://www.w3.org/2001/10/xml-exc-c14n#&#34;</span>/&gt;
        &lt;SignatureMethod <span class="nv">Algorithm</span><span class="o">=</span><span class="s2">&#34;http://www.w3.org/2000/09/xmldsig#rsa-sha1&#34;</span>/&gt;
        &lt;Reference <span class="nv">URI</span><span class="o">=</span><span class="s2">&#34;#_5VK7LT7FliUkkaQuW6r4brF0DG5E3X76&#34;</span>&gt;
          &lt;Transforms&gt;
            &lt;Transform <span class="nv">Algorithm</span><span class="o">=</span><span class="s2">&#34;http://www.w3.org/2000/09/xmldsig#enveloped-signature&#34;</span>/&gt;
            &lt;Transform <span class="nv">Algorithm</span><span class="o">=</span><span class="s2">&#34;http://www.w3.org/2001/10/xml-exc-c14n#&#34;</span>/&gt;
          &lt;/Transforms&gt;
          &lt;DigestMethod <span class="nv">Algorithm</span><span class="o">=</span><span class="s2">&#34;http://www.w3.org/2000/09/xmldsig#sha1&#34;</span>/&gt;
          &lt;DigestValue&gt;ZDkfGO3H1Tu50hawzQVjsACzJwc<span class="o">=</span>&lt;/DigestValue&gt;
        &lt;/Reference&gt;
      &lt;/SignedInfo&gt;
      &lt;SignatureValue&gt;1Fgpt7AaHcME2gTA158achvGQVqDwHSHsHF3/a5s7djeO1AaZ84Gz5eiWD+cdIz6hoT1j2v/7Qtfj5bsMNxulBnSzfL4TT4++AK/zFO4ad2mwABFjMMNiogwwT3tzy3aRwjgSfl3VKESoz3Zp8KL/JNm/TRKz95TD7H6WnfKZoLwErGzNw6gVs1y9XYxIEg46GzUb07g23TFmrv3wHlx2TpKUN/ne4Z28KAQzXqVyykJVaKQ/gbBNC/8AQKlol8fLGSheOKQ0vgEE1vFnVVCEmp30YapdKeWW2qcqHb7Oqdm+9b2mOUkqbaxH5ixBbYaqZaQCt5WF4P5BxnMe4Bp8w<span class="o">==</span>&lt;/SignatureValue&gt;
      &lt;KeyInfo&gt;
        &lt;X509Data&gt;
          &lt;X509Certificate&gt;MIIDODCCAiCgAwIBAgIJAN7O9hef05RJMA0GCSqGSIb3DQEBBQUAMBwxGjAYBgNVBAMTEW1hdHVnaXQuYXV0aDAuY29tMB4XDTEzMDYxNjEzMjQwNloXDTI3MDIyMzEzMjQwNlowHDEaMBgGA1UEAxMRbWF0dWdpdC5hdXRoMC5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQD8kEfEcLiyMK0q4E4xT/mglcXsf9oCWdTjB0vswFXQPCDgUk5daJmO4oRrCIuWgtChDyMc5M5MTexqrCntQlKpnexkzDxCvPX/IRJstjJDSH+WXljRYDbXTgAZAjjjAKqDBIeUWaw1FcUy3SOmQVtyUdfjXNqLzxKS8SUWYY3Ia6PT/uoUjUFmUuJEFpBlB79GW+Tv/ZidY53gHyhEYOBzm1vKZS1vtPfxxpBqu7Vkf+5lq3RYjuoVUYN03TIJveaa7BBL0je8z7UvvOGgrGuodSKHneq7ueex4OCscCJZbK7MlfbmFiuSniVCg/yMrx/okDme38sOXH1A/zJu2lYpAgMBAAGjfTB7MB0GA1UdDgQWBBQL3cuDXNXu4USrpv44dzfGyHIXDTBMBgNVHSMERTBDgBQL3cuDXNXu4USrpv44dzfGyHIXDaEgpB4wHDEaMBgGA1UEAxMRbWF0dWdpdC5hdXRoMC5jb22CCQDezvYXn9OUSTAMBgNVHRMEBTADAQH/MA0GCSqGSIb3DQEBBQUAA4IBAQCAtAmKHoX7OerzFUQ0Ojrg9C1uzT6fOLIlXyaDswk2tLE6ftFhSiVzT1TtgTFv2o6IA47tW6bqL7t6Z5JN/L8cno+kxeKOgPz2CvbUTJmtROvFV/TDkFsYmFJZ8+6nZOAtXRZPWFpa6KE4Lc5+7J94sX2AiYPFCnXRvZGMhJ6qtc+jh54QEIlxZtkxWUBGs2fhOQm+Ux0uy1qxSzhp3lmvNa79KdvmQirSitDovyidalpwX750WGNfQoISe94e3clWa4uKXgZ7AYmhd1w4kNs7seFdtvCcqQJrKYT2cBTINztL6SeqeF/xC//lGDo9UJic4pcrqj1P3WGHYIslOWBQ&lt;/X509Certificate&gt;
        &lt;/X509Data&gt;
      &lt;/KeyInfo&gt;
    &lt;/Signature&gt;
    &lt;saml:Subject&gt;
      &lt;saml:NameID <span class="nv">Format</span><span class="o">=</span><span class="s2">&#34;urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified&#34;</span>&gt;github<span class="p">|</span>175880&lt;/saml:NameID&gt;
      &lt;saml:SubjectConfirmation <span class="nv">Method</span><span class="o">=</span><span class="s2">&#34;urn:oasis:names:tc:SAML:2.0:cm:bearer&#34;</span>&gt;
        &lt;saml:SubjectConfirmationData <span class="nv">NotOnOrAfter</span><span class="o">=</span><span class="s2">&#34;2014-10-14T15:32:17.251Z&#34;</span> <span class="nv">Recipient</span><span class="o">=</span><span class="s2">&#34;https://app.auth0.com/tester/samlp&#34;</span>/&gt;
      &lt;/saml:SubjectConfirmation&gt;
    &lt;/saml:Subject&gt;
    &lt;saml:Conditions <span class="nv">NotBefore</span><span class="o">=</span><span class="s2">&#34;2014-10-14T14:32:17.251Z&#34;</span> <span class="nv">NotOnOrAfter</span><span class="o">=</span><span class="s2">&#34;2014-10-14T15:32:17.251Z&#34;</span>&gt;
      &lt;saml:AudienceRestriction&gt;
        &lt;saml:Audience&gt;urn:foo&lt;/saml:Audience&gt;
      &lt;/saml:AudienceRestriction&gt;
    &lt;/saml:Conditions&gt;
    &lt;saml:AttributeStatement xmlns:xs<span class="o">=</span><span class="s2">&#34;http://www.w3.org/2001/XMLSchema&#34;</span> xmlns:xsi<span class="o">=</span><span class="s2">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>&gt;
      &lt;saml:Attribute <span class="nv">Name</span><span class="o">=</span><span class="s2">&#34;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier&#34;</span>&gt;
        &lt;saml:AttributeValue xsi:type<span class="o">=</span><span class="s2">&#34;xs:anyType&#34;</span>&gt;github<span class="p">|</span>175880&lt;/saml:AttributeValue&gt;
      &lt;/saml:Attribute&gt;
      &lt;saml:Attribute <span class="nv">Name</span><span class="o">=</span><span class="s2">&#34;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress&#34;</span>&gt;
        &lt;saml:AttributeValue xsi:type<span class="o">=</span><span class="s2">&#34;xs:anyType&#34;</span>&gt;matiasw@gmail.com&lt;/saml:AttributeValue&gt;
      &lt;/saml:Attribute&gt;
      &lt;saml:Attribute <span class="nv">Name</span><span class="o">=</span><span class="s2">&#34;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name&#34;</span>&gt;
        &lt;saml:AttributeValue xsi:type<span class="o">=</span><span class="s2">&#34;xs:anyType&#34;</span>&gt;Matias Woloski&lt;/saml:AttributeValue&gt;
      &lt;/saml:Attribute&gt;
      &lt;saml:Attribute <span class="nv">Name</span><span class="o">=</span><span class="s2">&#34;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn&#34;</span>&gt;
        &lt;saml:AttributeValue xsi:type<span class="o">=</span><span class="s2">&#34;xs:anyType&#34;</span>&gt;matiasw@gmail.com&lt;/saml:AttributeValue&gt;
      &lt;/saml:Attribute&gt;
      &lt;saml:Attribute <span class="nv">Name</span><span class="o">=</span><span class="s2">&#34;http://schemas.auth0.com/identities/default/access_token&#34;</span>&gt;
        &lt;saml:AttributeValue xsi:type<span class="o">=</span><span class="s2">&#34;xs:anyType&#34;</span>&gt;3a7d0dfeffe12812c37112daa830abef570089b4&lt;/saml:AttributeValue&gt;
      &lt;/saml:Attribute&gt;
      &lt;saml:Attribute <span class="nv">Name</span><span class="o">=</span><span class="s2">&#34;http://schemas.auth0.com/identities/default/provider&#34;</span>&gt;
        &lt;saml:AttributeValue xsi:type<span class="o">=</span><span class="s2">&#34;xs:anyType&#34;</span>&gt;github&lt;/saml:AttributeValue&gt;
      &lt;/saml:Attribute&gt;
      &lt;saml:Attribute <span class="nv">Name</span><span class="o">=</span><span class="s2">&#34;http://schemas.auth0.com/identities/default/connection&#34;</span>&gt;
        &lt;saml:AttributeValue xsi:type<span class="o">=</span><span class="s2">&#34;xs:anyType&#34;</span>&gt;github&lt;/saml:AttributeValue&gt;
      &lt;/saml:Attribute&gt;
      &lt;saml:Attribute <span class="nv">Name</span><span class="o">=</span><span class="s2">&#34;http://schemas.auth0.com/identities/default/isSocial&#34;</span>&gt;
        &lt;saml:AttributeValue xsi:type<span class="o">=</span><span class="s2">&#34;xs:anyType&#34;</span>&gt;true&lt;/saml:AttributeValue&gt;
      &lt;/saml:Attribute&gt;
    &lt;/saml:AttributeStatement&gt;
    &lt;saml:AuthnStatement <span class="nv">AuthnInstant</span><span class="o">=</span><span class="s2">&#34;2014-10-14T14:32:17.251Z&#34;</span>&gt;
      &lt;saml:AuthnContext&gt;
        &lt;saml:AuthnContextClassRef&gt;urn:oasis:names:tc:SAML:2.0:ac:classes:unspecified&lt;/saml:AuthnContextClassRef&gt;
      &lt;/saml:AuthnContext&gt;
    &lt;/saml:AuthnStatement&gt;
  &lt;/saml:Assertion&gt;
&lt;/samlp:Response&gt;
</code></pre></div><h2 id="この記事を試した環境">この記事を試した環境</h2>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% sw_vers
ProductName:    Mac OS X
ProductVersion: 10.15.7
BuildVersion:   19H114
% xmllint --version
xmllint: using libxml version <span class="m">20904</span>
   compiled with: Threads Tree Output Push Reader Patterns Writer SAXv1 FTP HTTP DTDValid HTML Legacy C14N Catalog XPath XPointer XInclude ICU ISO8859X Unicode Regexps Automata Expr Schemas Schematron Modules Debug Zlib 
</code></pre></div>]]></content>
		</item>
		
		<item>
			<title>tidy コマンドで XML を整形して出力する</title>
			<link>https://noid11.github.io/posts/pretty-print-xml-by-tidy/</link>
			<pubDate>Thu, 21 Jan 2021 09:58:15 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/pretty-print-xml-by-tidy/</guid>
			<description>&lt;p&gt;XML をファイルとして保存して、 &lt;code&gt;-xml&lt;/code&gt;, &lt;code&gt;-indent&lt;/code&gt; オプションで整形できる&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;tidy -xml -indent ./myfile.xml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
			<content type="html"><![CDATA[<p>XML をファイルとして保存して、 <code>-xml</code>, <code>-indent</code> オプションで整形できる</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">tidy -xml -indent ./myfile.xml
</code></pre></div><h2 id="-xml-オプション"><code>-xml</code> オプション</h2>
<ul>
<li>input するファイルのフォーマットが XML であることを指定</li>
</ul>
<h2 id="-indent-オプション"><code>-indent</code> オプション</h2>
<ul>
<li>各要素をインデントして出力する</li>
</ul>
<h2 id="manual">manual</h2>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">TIDY<span class="o">(</span>1<span class="o">)</span>                                                                                                                                             TIDY<span class="o">(</span>1<span class="o">)</span>

NAME
       tidy - validate, correct, and pretty-print HTML files

SYNOPSIS
       tidy <span class="o">[</span>option ...<span class="o">]</span> <span class="o">[</span>file ...<span class="o">]</span> <span class="o">[</span>option ...<span class="o">]</span> <span class="o">[</span>file ...<span class="o">]</span>

DESCRIPTION
       Tidy  reads HTML, XHTML and XML files and writes cleaned up markup.  
       For HTML varians, it detects and corrects many common coding errors and strives to produce visually equivalent markup that is both W3C complaint and works on most browsers.  
       A common use of Tidy is to convert plain HTML to XHTML.  
       For generic XML files, Tidy is limited to correcting basic well-formedness errors and pretty printing.

       If no markup file is specified, Tidy reads the standard input.  
       If no output file is specified, Tidy writes markup to the standard output.  
       If no error file is specified, Tidy writes messages to the standard error.

OPTIONS
       Processing directives

       -indent or -i  to indent element content

       -omit          to omit optional end tags

       -wrap &lt;column&gt; to wrap text at the specified &lt;column&gt; <span class="o">(</span>default is 68<span class="o">)</span>

       -upper or -u   to force tags to upper <span class="k">case</span> <span class="o">(</span>default is lower <span class="k">case</span><span class="o">)</span>

       -clean or -c   to replace FONT, NOBR and CENTER tags by CSS

       -bare or -b    to strip out smart quotes and em dashes, etc.

       -numeric or -n to output numeric rather than named entities

       -errors or -e  to only show errors

       -quiet or -q   to suppress nonessential output

       -xml           to specify the input is well formed XML

       -asxml         to convert HTML to well formed XHTML

       -asxhtml       to convert HTML to well formed XHTML

       -ashtml        to force XHTML to well formed HTML

       -access &lt;level&gt;
                      to <span class="k">do</span> additional accessibility checks <span class="o">(</span>&lt;level&gt; <span class="o">=</span> 1, 2, 3<span class="o">)</span>

       Character encodings

       -raw           to output values above <span class="m">127</span> without conversion to entities

       -ascii         to use US-ASCII <span class="k">for</span> output, ISO-8859-1 <span class="k">for</span> input

       -latin1        to use ISO-8859-1 <span class="k">for</span> both input and output

       -iso2022       to use ISO-2022 <span class="k">for</span> both input and output

       -utf8          to use UTF-8 <span class="k">for</span> both input and output

       -mac           to use MacRoman <span class="k">for</span> input, US-ASCII <span class="k">for</span> output

       -utf16le       to use UTF-16LE <span class="k">for</span> both input and output

       -utf16be       to use UTF-16BE <span class="k">for</span> both input and output

       -utf16         to use UTF-16 <span class="k">for</span> both input and output

       -win1252       to use Windows-1252 <span class="k">for</span> input, US-ASCII <span class="k">for</span> output

       -big5          to use Big5 <span class="k">for</span> both input and output

       -shiftjis      to use Shift_JIS <span class="k">for</span> both input and output

       -language &lt;lang&gt;
                      to <span class="nb">set</span> the two-letter language code &lt;lang&gt; <span class="o">(</span><span class="k">for</span> future use<span class="o">)</span>

       File manipulation

       -output or -o &lt;file&gt;
                      to write output to the specified &lt;file&gt;

       -f &lt;file&gt;      to write errors to the specified &lt;file&gt;

       -config &lt;file&gt; to <span class="nb">set</span> configuration options from the specified &lt;file&gt;

       -modify or -m  to modify the original input files

       Miscellaneous

       -version or -v to show the version of Tidy

       -help, -h or -?
                      to list the <span class="nb">command</span> line options

       -help-config   to list all configuration options

       -show-config   to list the current configuration settings


USAGE
       Use --blah blarg <span class="k">for</span> any configuration option <span class="s2">&#34;blah&#34;</span> with argument <span class="s2">&#34;blarg&#34;</span>

       Input/Output default to stdin/stdout respectively Single letter options apart from -f and -o may be combined as in:  tidy -f errs.txt -imu  foo.html
       For further info on HTML see http://www.w3.org/MarkUp

       For more information about HTML Tidy, visit the project home page at http://tidy.sourceforge.net.  Here, you will find links to documentation, mail-
       ing lists <span class="o">(</span>with searchable archives<span class="o">)</span> and links to report bugs.

ENVIRONMENT
       HTML_TIDY      Name of the default configuration file.  This should be an absolute path, since you will probably invoke tidy from different directo-
                      ries.   The value of HTML_TIDY will be parsed after the compiled-in default <span class="o">(</span>defined with -DCONFIG_FILE<span class="o">)</span>, but before any of the files
                      specified using -config.

EXIT STATUS
       <span class="m">0</span>      All input files were processed successfully.

       <span class="m">1</span>      There were warnings.

       <span class="m">2</span>      There were errors.

SEE ALSO
       HTML Tidy Project Page at http://tidy.sourceforge.net

       Dave Raggett<span class="err">&#39;</span>s Tidy Overview at http://www.w3.org/People/Raggett/tidy/

       Tidy Quick Reference at http://tidy.sourceforge.net/docs/quickref.html

       For information about TidyLib, see http://tidy.sourceforge.net/libintro.html

AUTHORS
       Dave Raggett &lt;dsr@w3.org&gt;.

       Terry Teague &lt;terry_teague@users.sourceforge.net&gt;.

       Bjoern Hoehrmann &lt;bjoern@hoehrmann.de&gt;

       Charles Reitzel &lt;creitzel@rcn.com&gt;

       This manual page was written by Matej Vela &lt;vela@debian.org&gt; and updated by Charles Reitzel.

                                                                      December 1, <span class="m">2002</span>                                                              TIDY<span class="o">(</span>1<span class="o">)</span>
</code></pre></div><h2 id="実行例">実行例</h2>
<ul>
<li><a href="https://samltool.io/">https://samltool.io/</a> で公開されている SAML レスポンスを <code>saml.xml</code> として保存</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% tidy -xml -indent ./saml.xml 
No warnings or errors were found.

&lt;samlp:Response xmlns:samlp<span class="o">=</span><span class="s2">&#34;urn:oasis:names:tc:SAML:2.0:protocol&#34;</span>
<span class="nv">ID</span><span class="o">=</span><span class="s2">&#34;_621c4c4ae5d60c768cc2&#34;</span> <span class="nv">Version</span><span class="o">=</span><span class="s2">&#34;2.0&#34;</span>
<span class="nv">IssueInstant</span><span class="o">=</span><span class="s2">&#34;2014-10-14T14:32:17Z&#34;</span>
<span class="nv">Destination</span><span class="o">=</span><span class="s2">&#34;https://app.auth0.com/tester/samlp&#34;</span>&gt;
  &lt;saml:Issuer xmlns:saml<span class="o">=</span><span class="s2">&#34;urn:oasis:names:tc:SAML:2.0:assertion&#34;</span>&gt;
  urn:matugit.auth0.com&lt;/saml:Issuer&gt;
  &lt;samlp:Status&gt;
    &lt;samlp:StatusCode <span class="nv">Value</span><span class="o">=</span><span class="s2">&#34;urn:oasis:names:tc:SAML:2.0:status:Success&#34;</span> /&gt;
  &lt;/samlp:Status&gt;
  &lt;saml:Assertion xmlns:saml<span class="o">=</span><span class="s2">&#34;urn:oasis:names:tc:SAML:2.0:assertion&#34;</span>
  <span class="nv">Version</span><span class="o">=</span><span class="s2">&#34;2.0&#34;</span> <span class="nv">ID</span><span class="o">=</span><span class="s2">&#34;_5VK7LT7FliUkkaQuW6r4brF0DG5E3X76&#34;</span>
  <span class="nv">IssueInstant</span><span class="o">=</span><span class="s2">&#34;2014-10-14T14:32:17.251Z&#34;</span>&gt;
    &lt;saml:Issuer&gt;urn:matugit.auth0.com&lt;/saml:Issuer&gt;
    &lt;Signature <span class="nv">xmlns</span><span class="o">=</span><span class="s2">&#34;http://www.w3.org/2000/09/xmldsig#&#34;</span>&gt;
      &lt;SignedInfo&gt;
        &lt;CanonicalizationMethod <span class="nv">Algorithm</span><span class="o">=</span><span class="s2">&#34;http://www.w3.org/2001/10/xml-exc-c14n#&#34;</span> /&gt;
        &lt;SignatureMethod <span class="nv">Algorithm</span><span class="o">=</span><span class="s2">&#34;http://www.w3.org/2000/09/xmldsig#rsa-sha1&#34;</span> /&gt;
        &lt;Reference <span class="nv">URI</span><span class="o">=</span><span class="s2">&#34;#_5VK7LT7FliUkkaQuW6r4brF0DG5E3X76&#34;</span>&gt;
          &lt;Transforms&gt;
            &lt;Transform <span class="nv">Algorithm</span><span class="o">=</span><span class="s2">&#34;http://www.w3.org/2000/09/xmldsig#enveloped-signature&#34;</span> /&gt;
            &lt;Transform <span class="nv">Algorithm</span><span class="o">=</span><span class="s2">&#34;http://www.w3.org/2001/10/xml-exc-c14n#&#34;</span> /&gt;
          &lt;/Transforms&gt;
          &lt;DigestMethod <span class="nv">Algorithm</span><span class="o">=</span><span class="s2">&#34;http://www.w3.org/2000/09/xmldsig#sha1&#34;</span> /&gt;
          &lt;DigestValue&gt;ZDkfGO3H1Tu50hawzQVjsACzJwc<span class="o">=</span>&lt;/DigestValue&gt;
        &lt;/Reference&gt;
      &lt;/SignedInfo&gt;
      &lt;SignatureValue&gt;
      1Fgpt7AaHcME2gTA158achvGQVqDwHSHsHF3/a5s7djeO1AaZ84Gz5eiWD+cdIz6hoT1j2v/7Qtfj5bsMNxulBnSzfL4TT4++AK/zFO4ad2mwABFjMMNiogwwT3tzy3aRwjgSfl3VKESoz3Zp8KL/JNm/TRKz95TD7H6WnfKZoLwErGzNw6gVs1y9XYxIEg46GzUb07g23TFmrv3wHlx2TpKUN/ne4Z28KAQzXqVyykJVaKQ/gbBNC/8AQKlol8fLGSheOKQ0vgEE1vFnVVCEmp30YapdKeWW2qcqHb7Oqdm+9b2mOUkqbaxH5ixBbYaqZaQCt5WF4P5BxnMe4Bp8w<span class="o">==</span>&lt;/SignatureValue&gt;
      &lt;KeyInfo&gt;
        &lt;X509Data&gt;
          &lt;X509Certificate&gt;
          MIIDODCCAiCgAwIBAgIJAN7O9hef05RJMA0GCSqGSIb3DQEBBQUAMBwxGjAYBgNVBAMTEW1hdHVnaXQuYXV0aDAuY29tMB4XDTEzMDYxNjEzMjQwNloXDTI3MDIyMzEzMjQwNlowHDEaMBgGA1UEAxMRbWF0dWdpdC5hdXRoMC5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQD8kEfEcLiyMK0q4E4xT/mglcXsf9oCWdTjB0vswFXQPCDgUk5daJmO4oRrCIuWgtChDyMc5M5MTexqrCntQlKpnexkzDxCvPX/IRJstjJDSH+WXljRYDbXTgAZAjjjAKqDBIeUWaw1FcUy3SOmQVtyUdfjXNqLzxKS8SUWYY3Ia6PT/uoUjUFmUuJEFpBlB79GW+Tv/ZidY53gHyhEYOBzm1vKZS1vtPfxxpBqu7Vkf+5lq3RYjuoVUYN03TIJveaa7BBL0je8z7UvvOGgrGuodSKHneq7ueex4OCscCJZbK7MlfbmFiuSniVCg/yMrx/okDme38sOXH1A/zJu2lYpAgMBAAGjfTB7MB0GA1UdDgQWBBQL3cuDXNXu4USrpv44dzfGyHIXDTBMBgNVHSMERTBDgBQL3cuDXNXu4USrpv44dzfGyHIXDaEgpB4wHDEaMBgGA1UEAxMRbWF0dWdpdC5hdXRoMC5jb22CCQDezvYXn9OUSTAMBgNVHRMEBTADAQH/MA0GCSqGSIb3DQEBBQUAA4IBAQCAtAmKHoX7OerzFUQ0Ojrg9C1uzT6fOLIlXyaDswk2tLE6ftFhSiVzT1TtgTFv2o6IA47tW6bqL7t6Z5JN/L8cno+kxeKOgPz2CvbUTJmtROvFV/TDkFsYmFJZ8+6nZOAtXRZPWFpa6KE4Lc5+7J94sX2AiYPFCnXRvZGMhJ6qtc+jh54QEIlxZtkxWUBGs2fhOQm+Ux0uy1qxSzhp3lmvNa79KdvmQirSitDovyidalpwX750WGNfQoISe94e3clWa4uKXgZ7AYmhd1w4kNs7seFdtvCcqQJrKYT2cBTINztL6SeqeF/xC//lGDo9UJic4pcrqj1P3WGHYIslOWBQ&lt;/X509Certificate&gt;
        &lt;/X509Data&gt;
      &lt;/KeyInfo&gt;
    &lt;/Signature&gt;
    &lt;saml:Subject&gt;
      &lt;saml:NameID <span class="nv">Format</span><span class="o">=</span><span class="s2">&#34;urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified&#34;</span>&gt;
      github<span class="p">|</span>175880&lt;/saml:NameID&gt;
      &lt;saml:SubjectConfirmation <span class="nv">Method</span><span class="o">=</span><span class="s2">&#34;urn:oasis:names:tc:SAML:2.0:cm:bearer&#34;</span>&gt;

        &lt;saml:SubjectConfirmationData <span class="nv">NotOnOrAfter</span><span class="o">=</span><span class="s2">&#34;2014-10-14T15:32:17.251Z&#34;</span>
        <span class="nv">Recipient</span><span class="o">=</span><span class="s2">&#34;https://app.auth0.com/tester/samlp&#34;</span> /&gt;
      &lt;/saml:SubjectConfirmation&gt;
    &lt;/saml:Subject&gt;
    &lt;saml:Conditions <span class="nv">NotBefore</span><span class="o">=</span><span class="s2">&#34;2014-10-14T14:32:17.251Z&#34;</span>
    <span class="nv">NotOnOrAfter</span><span class="o">=</span><span class="s2">&#34;2014-10-14T15:32:17.251Z&#34;</span>&gt;
      &lt;saml:AudienceRestriction&gt;
        &lt;saml:Audience&gt;urn:foo&lt;/saml:Audience&gt;
      &lt;/saml:AudienceRestriction&gt;
    &lt;/saml:Conditions&gt;
    &lt;saml:AttributeStatement xmlns:xs<span class="o">=</span><span class="s2">&#34;http://www.w3.org/2001/XMLSchema&#34;</span>
    xmlns:xsi<span class="o">=</span><span class="s2">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>&gt;
      &lt;saml:Attribute <span class="nv">Name</span><span class="o">=</span><span class="s2">&#34;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier&#34;</span>&gt;

        &lt;saml:AttributeValue xsi:type<span class="o">=</span><span class="s2">&#34;xs:anyType&#34;</span>&gt;
        github<span class="p">|</span>175880&lt;/saml:AttributeValue&gt;
      &lt;/saml:Attribute&gt;
      &lt;saml:Attribute <span class="nv">Name</span><span class="o">=</span><span class="s2">&#34;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress&#34;</span>&gt;

        &lt;saml:AttributeValue xsi:type<span class="o">=</span><span class="s2">&#34;xs:anyType&#34;</span>&gt;
        matiasw@gmail.com&lt;/saml:AttributeValue&gt;
      &lt;/saml:Attribute&gt;
      &lt;saml:Attribute <span class="nv">Name</span><span class="o">=</span><span class="s2">&#34;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name&#34;</span>&gt;

        &lt;saml:AttributeValue xsi:type<span class="o">=</span><span class="s2">&#34;xs:anyType&#34;</span>&gt;Matias
        Woloski&lt;/saml:AttributeValue&gt;
      &lt;/saml:Attribute&gt;
      &lt;saml:Attribute <span class="nv">Name</span><span class="o">=</span><span class="s2">&#34;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn&#34;</span>&gt;

        &lt;saml:AttributeValue xsi:type<span class="o">=</span><span class="s2">&#34;xs:anyType&#34;</span>&gt;
        matiasw@gmail.com&lt;/saml:AttributeValue&gt;
      &lt;/saml:Attribute&gt;
      &lt;saml:Attribute <span class="nv">Name</span><span class="o">=</span><span class="s2">&#34;http://schemas.auth0.com/identities/default/access_token&#34;</span>&gt;

        &lt;saml:AttributeValue xsi:type<span class="o">=</span><span class="s2">&#34;xs:anyType&#34;</span>&gt;
        3a7d0dfeffe12812c37112daa830abef570089b4&lt;/saml:AttributeValue&gt;
      &lt;/saml:Attribute&gt;
      &lt;saml:Attribute <span class="nv">Name</span><span class="o">=</span><span class="s2">&#34;http://schemas.auth0.com/identities/default/provider&#34;</span>&gt;

        &lt;saml:AttributeValue xsi:type<span class="o">=</span><span class="s2">&#34;xs:anyType&#34;</span>&gt;
        github&lt;/saml:AttributeValue&gt;
      &lt;/saml:Attribute&gt;
      &lt;saml:Attribute <span class="nv">Name</span><span class="o">=</span><span class="s2">&#34;http://schemas.auth0.com/identities/default/connection&#34;</span>&gt;

        &lt;saml:AttributeValue xsi:type<span class="o">=</span><span class="s2">&#34;xs:anyType&#34;</span>&gt;
        github&lt;/saml:AttributeValue&gt;
      &lt;/saml:Attribute&gt;
      &lt;saml:Attribute <span class="nv">Name</span><span class="o">=</span><span class="s2">&#34;http://schemas.auth0.com/identities/default/isSocial&#34;</span>&gt;

        &lt;saml:AttributeValue xsi:type<span class="o">=</span><span class="s2">&#34;xs:anyType&#34;</span>&gt;
        true&lt;/saml:AttributeValue&gt;
      &lt;/saml:Attribute&gt;
    &lt;/saml:AttributeStatement&gt;
    &lt;saml:AuthnStatement <span class="nv">AuthnInstant</span><span class="o">=</span><span class="s2">&#34;2014-10-14T14:32:17.251Z&#34;</span>&gt;
      &lt;saml:AuthnContext&gt;
        &lt;saml:AuthnContextClassRef&gt;
        urn:oasis:names:tc:SAML:2.0:ac:classes:unspecified&lt;/saml:AuthnContextClassRef&gt;
      &lt;/saml:AuthnContext&gt;
    &lt;/saml:AuthnStatement&gt;
  &lt;/saml:Assertion&gt;
&lt;/samlp:Response&gt;

To learn more about HTML Tidy see http://tidy.sourceforge.net
Please send bug reports to html-tidy@w3.org
HTML and CSS specifications are available from http://www.w3.org/
Lobby your company to join W3C, see http://www.w3.org/Consortium
</code></pre></div><h2 id="この記事を試した環境">この記事を試した環境</h2>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% sw_vers
ProductName:    Mac OS X
ProductVersion: 10.15.7
BuildVersion:   19H114
% tidy -version 
HTML Tidy <span class="k">for</span> Mac OS X released on <span class="m">31</span> October <span class="m">2006</span> - Apple Inc. build 17.2
</code></pre></div>]]></content>
		</item>
		
		<item>
			<title>AWS CLI を使って Amazon Connect Tasks を作成・削除する</title>
			<link>https://noid11.github.io/posts/how-to-control-connect-tasks-by-aws-cli/</link>
			<pubDate>Wed, 20 Jan 2021 19:54:25 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/how-to-control-connect-tasks-by-aws-cli/</guid>
			<description></description>
			<content type="html"><![CDATA[<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nv">REGION</span><span class="o">=</span>ap-northeast-1
<span class="nv">INSTANCE_ID</span><span class="o">=</span>xxx
<span class="nv">CONTACT_FLOW_ID</span><span class="o">=</span>yyy
<span class="nv">TASK_NAME</span><span class="o">=</span>mytask
<span class="nv">CONTACT_ID</span><span class="o">=</span><span class="k">$(</span>aws --region <span class="nv">$REGION</span> connect start-task-contact --instance-id <span class="nv">$INSTANCE_ID</span> --contact-flow-id <span class="nv">$CONTACT_FLOW_ID</span> --name <span class="nv">$TASK_NAME</span> --query ContactId --output text<span class="k">)</span>
aws --region <span class="nv">$REGION</span> connect stop-contact --contact-id <span class="nv">$CONTACT_ID</span> --instance-id <span class="nv">$INSTANCE_ID</span>
</code></pre></div><h2 id="amazon-connect-tasks-とは">Amazon Connect Tasks とは</h2>
<ul>
<li>Amazon Connect を使用している各エージェントに対して「タスク」を与える機能<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></li>
<li>タスクとは、雑に言うと ToDo リストみたいなもの
<ul>
<li>コールと同じようにエージェントにルーティングされて、エージェントが承諾したら特定のタスクに取り組む・・・といった感じで使う
<ul>
<li>Salesforce 等の外部サービスと連携することも出来るらしい<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup></li>
</ul>
</li>
<li>ドキュメントには以下のようなユースケースが書いてある<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>
<ul>
<li>Salesforce 等の CRM: Customer Relationship Management ソリューションと連携したカスタマーへのフォローアップ</li>
<li>コールを使用したカスタマーへのフォローアップ
<ul>
<li>タスクを確認して、エージェントから特定のカスタマーにアウトバウンドコールする的な</li>
</ul>
</li>
<li>カスタマーに関連して行うビジネス固有のアクション</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="aws-cli-でタスクを作成">AWS CLI でタスクを作成</h2>
<p><a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/connect/start-task-contact.html">start-task-contact</a> コマンドを使う<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup></p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nv">REGION</span><span class="o">=</span>ap-northeast-1
<span class="nv">INSTANCE_ID</span><span class="o">=</span>xxx
<span class="nv">CONTACT_FLOW_ID</span><span class="o">=</span>yyy
<span class="nv">TASK_NAME</span><span class="o">=</span>mytask
aws --region <span class="nv">$REGION</span> connect start-task-contact --instance-id <span class="nv">$INSTANCE_ID</span> --contact-flow-id <span class="nv">$CONTACT_FLOW_ID</span> --name <span class="nv">$TASK_NAME</span>
</code></pre></div><h2 id="aws-cli-でタスクを削除">AWS CLI でタスクを削除</h2>
<p><a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/connect/stop-contact.html">stop-contact</a> コマンドを使う<sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup></p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nv">REGION</span><span class="o">=</span>ap-northeast-1
<span class="nv">INSTANCE_ID</span><span class="o">=</span>xxx
<span class="nv">CONTACT_ID</span><span class="o">=</span>yyy
aws --region <span class="nv">$REGION</span> connect stop-contact --contact-id <span class="nv">$CONTACT_ID</span> --instance-id <span class="nv">$INSTANCE_ID</span>
</code></pre></div><h2 id="この記事を試した環境">この記事を試した環境</h2>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% sw_vers
ProductName:    Mac OS X
ProductVersion: 10.15.7
BuildVersion:   19H114
% aws --version
aws-cli/2.1.6 Python/3.7.4 Darwin/19.6.0 exe/x86_64 prompt/off
</code></pre></div><section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>Amazon Connect Tasks (エージェントのタスクを自動化、追跡、管理) | AWS<br>
<a href="https://aws.amazon.com/jp/connect/tasks/">https://aws.amazon.com/jp/connect/tasks/</a> <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p>Amazon Connect – よりスマートになり、サードパーティーツールとの統合が向上 | Amazon Web Services ブログ<br>
<a href="https://aws.amazon.com/jp/blogs/news/amazon-connect-smarter-and-more-integrated/">https://aws.amazon.com/jp/blogs/news/amazon-connect-smarter-and-more-integrated/</a> <a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3" role="doc-endnote">
<p>Tasks - Amazon Connect<br>
<a href="https://docs.aws.amazon.com/connect/latest/adminguide/tasks.html">https://docs.aws.amazon.com/connect/latest/adminguide/tasks.html</a> <a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4" role="doc-endnote">
<p>StartTaskContact - Amazon Connect Service<br>
<a href="https://docs.aws.amazon.com/connect/latest/APIReference/API_StartTaskContact.html">https://docs.aws.amazon.com/connect/latest/APIReference/API_StartTaskContact.html</a> <a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5" role="doc-endnote">
<p>StopContact - Amazon Connect Service<br>
<a href="https://docs.aws.amazon.com/connect/latest/APIReference/API_StopContact.html">https://docs.aws.amazon.com/connect/latest/APIReference/API_StopContact.html</a> <a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>]]></content>
		</item>
		
		<item>
			<title>RDP を使って Mac から Windows にファイルをコピーする方法</title>
			<link>https://noid11.github.io/posts/how-to-file-copy-to-windows-from-mac-by-rdp/</link>
			<pubDate>Tue, 19 Jan 2021 22:16:16 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/how-to-file-copy-to-windows-from-mac-by-rdp/</guid>
			<description>クリップボードにコピーして貼り付るのが手軽で良い Mac 側でコピーしたいファイルを選択し、クリップボードにコピー RDP で Windows に接続し、ファイルを送信した</description>
			<content type="html"><![CDATA[<ul>
<li>クリップボードにコピーして貼り付るのが手軽で良い
<ol>
<li>Mac 側でコピーしたいファイルを選択し、クリップボードにコピー</li>
<li>RDP で Windows に接続し、ファイルを送信したいディレクトリをよしなに選択してペースト</li>
</ol>
</li>
<li>RDP 設定の <code>Devices &amp; Audio</code> で <code>Clipboard</code> にチェックが入っていることを確認すること</li>
</ul>
<p><img src="/images/how-to-file-copy-to-windows-from-mac-by-rdp/rdp-setting.png" alt="rdp-setting"></p>
<h2 id="この記事を試した環境">この記事を試した環境</h2>
<p>Mac</p>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% sw_vers
ProductName:    Mac OS X
ProductVersion: 10.15.7
BuildVersion:   19H114
</code></pre></div><hr>
<p>Microsoft Remote Desktop</p>
<ul>
<li>Version 10.4.0 (1811)</li>
<li>Download:
<ul>
<li><a href="https://apps.apple.com/jp/app/microsoft-remote-desktop/id1295203466">https://apps.apple.com/jp/app/microsoft-remote-desktop/id1295203466</a></li>
<li><a href="https://install.appcenter.ms/orgs/rdmacios-k2vy/apps/microsoft-remote-desktop-for-mac/distribution_groups/all-users-of-microsoft-remote-desktop-for-mac">https://install.appcenter.ms/orgs/rdmacios-k2vy/apps/microsoft-remote-desktop-for-mac/distribution_groups/all-users-of-microsoft-remote-desktop-for-mac</a></li>
</ul>
</li>
<li>Release Notes:
<ul>
<li><a href="https://docs.microsoft.com/ja-jp/windows-server/remote/remote-desktop-services/clients/mac-whatsnew">https://docs.microsoft.com/ja-jp/windows-server/remote/remote-desktop-services/clients/mac-whatsnew</a></li>
</ul>
</li>
</ul>
<hr>
<p>Windows</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nb">PS </span><span class="n">C:</span><span class="p">\</span><span class="n">Users</span><span class="p">\</span><span class="n">Administrator</span><span class="p">&gt;</span> <span class="nb">Get-WmiObject</span> <span class="n">Win32_OperatingSystem</span>


<span class="n">SystemDirectory</span> <span class="err">:</span> <span class="n">C:</span><span class="p">\</span><span class="n">Windows</span><span class="p">\</span><span class="n">system32</span>
<span class="n">Organization</span>    <span class="err">:</span> <span class="n">Amazon</span><span class="p">.</span><span class="n">com</span>
<span class="n">BuildNumber</span>     <span class="err">:</span> <span class="n">17763</span>
<span class="n">RegisteredUser</span>  <span class="err">:</span> <span class="n">EC2</span>
<span class="n">SerialNumber</span>    <span class="err">:</span> <span class="n">00430</span><span class="p">-</span><span class="n">00000</span><span class="p">-</span><span class="n">00000-AA379</span>
<span class="n">Version</span>         <span class="err">:</span> <span class="n">10</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">17763</span>
</code></pre></div>]]></content>
		</item>
		
		<item>
			<title>PowerShell を使って Windows アカウントユーザーのパスワード失効を無効化する方法</title>
			<link>https://noid11.github.io/posts/enable-user-password-never-expires-at-windows/</link>
			<pubDate>Tue, 19 Jan 2021 16:11:20 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/enable-user-password-never-expires-at-windows/</guid>
			<description>&lt;ul&gt;
&lt;li&gt;Windows Server で特定ユーザーのパスワード失効を無効化したい場合に便利&lt;/li&gt;
&lt;li&gt;デフォルトでは一定期間でローテートするような設定なので、セキュリティに注意した上で使おう&lt;/li&gt;
&lt;/ul&gt;</description>
			<content type="html"><![CDATA[<ul>
<li>Windows Server で特定ユーザーのパスワード失効を無効化したい場合に便利</li>
<li>デフォルトでは一定期間でローテートするような設定なので、セキュリティに注意した上で使おう</li>
</ul>
<h2 id="コマンド">コマンド</h2>
<ul>
<li>Administrator ユーザーのパスワード失効を無効化する例
<ul>
<li>コマンド的には、パスワード有効期限を無期限とする設定を有効化する感じ</li>
</ul>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nb">Set-LocalUser</span> <span class="n">-Name</span> <span class="s2">&#34;Administrator&#34;</span> <span class="n">-PasswordNeverExpires</span> <span class="nv">$true</span>
</code></pre></div><h2 id="set-localuser-コマンド">Set-LocalUser コマンド</h2>
<p>Set-LocalUser (Microsoft.PowerShell.LocalAccounts) - PowerShell | Microsoft Docs<br>
<a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.localaccounts/set-localuser">https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.localaccounts/set-localuser</a></p>
<blockquote>
<p>The Set-LocalUser cmdlet modifies a local user account. This cmdlet can reset the password of a local user account.</p>
</blockquote>
<ul>
<li>ローカルユーザーアカウントの変更を行うコマンド</li>
<li><code>-Name</code>
<ul>
<li>対象となるローカルユーザーアカウントの名前</li>
</ul>
</li>
<li><code>-PasswordNeverExpires</code>
<ul>
<li>パスワード有効期限を無期限とする設定を有効化・無効化する</li>
</ul>
</li>
</ul>
<h2 id="net-user-コマンド">Net user コマンド</h2>
<p>Net user | Microsoft Docs<br>
<a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/cc771865(v=ws.11)">https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/cc771865(v=ws.11)</a></p>
<blockquote>
<p>Adds or modifies user accounts, or displays user account information.</p>
</blockquote>
<ul>
<li>ユーザーアカウントの追加・変更や、ユーザーアカウント情報を表示するコマンド</li>
<li><code>Set-LocalUser</code> コマンドを実行する前後で使用することで、変更内容を確認できる</li>
</ul>
<h2 id="実行例">実行例</h2>
<ul>
<li><code>Password expires</code> が <code>Never</code> になれば OK</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nb">PS </span><span class="n">C:</span><span class="p">\</span><span class="n">Users</span><span class="p">\</span><span class="n">Administrator</span><span class="p">&gt;</span> <span class="n">net</span> <span class="n">user</span> <span class="n">Administrator</span>
<span class="n">User</span> <span class="n">name</span>                    <span class="n">Administrator</span>
<span class="n">Full</span> <span class="n">Name</span>
<span class="n">Comment</span>                      <span class="n">Built-in</span> <span class="n">account</span> <span class="k">for</span> <span class="n">administering</span> <span class="n">the</span> <span class="n">computer</span><span class="p">/</span><span class="n">domain</span>
<span class="n">User</span> <span class="n">s</span> <span class="n">comment</span>
<span class="n">Country</span><span class="p">/</span><span class="n">region</span> <span class="n">code</span>          <span class="n">000</span> <span class="p">(</span><span class="n">System</span> <span class="k">Default</span><span class="p">)</span>
<span class="n">Account</span> <span class="n">active</span>               <span class="n">Yes</span>
<span class="n">Account</span> <span class="n">expires</span>              <span class="n">Never</span>

<span class="n">Password</span> <span class="n">last</span> <span class="nb">set </span>           <span class="n">1</span><span class="p">/</span><span class="n">19</span><span class="p">/</span><span class="n">2021</span> <span class="n">4</span><span class="err">:</span><span class="n">27</span><span class="err">:</span><span class="n">36</span> <span class="n">AM</span>
<span class="n">Password</span> <span class="n">expires</span>             <span class="n">3</span><span class="p">/</span><span class="n">2</span><span class="p">/</span><span class="n">2021</span> <span class="n">4</span><span class="err">:</span><span class="n">27</span><span class="err">:</span><span class="n">36</span> <span class="n">AM</span>
<span class="n">Password</span> <span class="n">changeable</span>          <span class="n">1</span><span class="p">/</span><span class="n">19</span><span class="p">/</span><span class="n">2021</span> <span class="n">4</span><span class="err">:</span><span class="n">27</span><span class="err">:</span><span class="n">36</span> <span class="n">AM</span>
<span class="n">Password</span> <span class="n">required</span>            <span class="n">Yes</span>
<span class="n">User</span> <span class="n">may</span> <span class="n">change</span> <span class="n">password</span>     <span class="n">Yes</span>

<span class="n">Workstations</span> <span class="n">allowed</span>         <span class="n">All</span>
<span class="n">Logon</span> <span class="n">script</span>
<span class="n">User</span> <span class="n">profile</span>
<span class="n">Home</span> <span class="n">directory</span>
<span class="n">Last</span> <span class="n">logon</span>                   <span class="n">1</span><span class="p">/</span><span class="n">19</span><span class="p">/</span><span class="n">2021</span> <span class="n">4</span><span class="err">:</span><span class="n">41</span><span class="err">:</span><span class="n">50</span> <span class="n">AM</span>

<span class="n">Logon</span> <span class="n">hours</span> <span class="n">allowed</span>          <span class="n">All</span>

<span class="n">Local</span> <span class="nb">Group </span><span class="n">Memberships</span>      <span class="p">*</span><span class="n">Administrators</span>
<span class="n">Global</span> <span class="nb">Group </span><span class="n">memberships</span>     <span class="p">*</span><span class="n">None</span>
<span class="n">The</span> <span class="n">command</span> <span class="n">completed</span> <span class="n">successfully</span><span class="p">.</span>
<span class="nb">PS </span><span class="n">C:</span><span class="p">\</span><span class="n">Users</span><span class="p">\</span><span class="n">Administrator</span><span class="p">&gt;</span> <span class="nb">Set-LocalUser</span> <span class="n">-Name</span> <span class="s2">&#34;Administrator&#34;</span> <span class="n">-PasswordNeverExpires</span> <span class="nv">$true</span>
<span class="nb">PS </span><span class="n">C:</span><span class="p">\</span><span class="n">Users</span><span class="p">\</span><span class="n">Administrator</span><span class="p">&gt;</span> <span class="n">net</span> <span class="n">user</span> <span class="n">Administrator</span>
<span class="n">User</span> <span class="n">name</span>                    <span class="n">Administrator</span>
<span class="n">Full</span> <span class="n">Name</span>
<span class="n">Comment</span>                      <span class="n">Built-in</span> <span class="n">account</span> <span class="k">for</span> <span class="n">administering</span> <span class="n">the</span> <span class="n">computer</span><span class="p">/</span><span class="n">domain</span>
<span class="n">User</span> <span class="n">s</span> <span class="n">comment</span>
<span class="n">Country</span><span class="p">/</span><span class="n">region</span> <span class="n">code</span>          <span class="n">000</span> <span class="p">(</span><span class="n">System</span> <span class="k">Default</span><span class="p">)</span>
<span class="n">Account</span> <span class="n">active</span>               <span class="n">Yes</span>
<span class="n">Account</span> <span class="n">expires</span>              <span class="n">Never</span>

<span class="n">Password</span> <span class="n">last</span> <span class="nb">set </span>           <span class="n">1</span><span class="p">/</span><span class="n">19</span><span class="p">/</span><span class="n">2021</span> <span class="n">4</span><span class="err">:</span><span class="n">27</span><span class="err">:</span><span class="n">36</span> <span class="n">AM</span>
<span class="n">Password</span> <span class="n">expires</span>             <span class="n">Never</span>
<span class="n">Password</span> <span class="n">changeable</span>          <span class="n">1</span><span class="p">/</span><span class="n">19</span><span class="p">/</span><span class="n">2021</span> <span class="n">4</span><span class="err">:</span><span class="n">27</span><span class="err">:</span><span class="n">36</span> <span class="n">AM</span>
<span class="n">Password</span> <span class="n">required</span>            <span class="n">Yes</span>
<span class="n">User</span> <span class="n">may</span> <span class="n">change</span> <span class="n">password</span>     <span class="n">Yes</span>

<span class="n">Workstations</span> <span class="n">allowed</span>         <span class="n">All</span>
<span class="n">Logon</span> <span class="n">script</span>
<span class="n">User</span> <span class="n">profile</span>
<span class="n">Home</span> <span class="n">directory</span>
<span class="n">Last</span> <span class="n">logon</span>                   <span class="n">1</span><span class="p">/</span><span class="n">19</span><span class="p">/</span><span class="n">2021</span> <span class="n">4</span><span class="err">:</span><span class="n">41</span><span class="err">:</span><span class="n">50</span> <span class="n">AM</span>

<span class="n">Logon</span> <span class="n">hours</span> <span class="n">allowed</span>          <span class="n">All</span>

<span class="n">Local</span> <span class="nb">Group </span><span class="n">Memberships</span>      <span class="p">*</span><span class="n">Administrators</span>
<span class="n">Global</span> <span class="nb">Group </span><span class="n">memberships</span>     <span class="p">*</span><span class="n">None</span>
<span class="n">The</span> <span class="n">command</span> <span class="n">completed</span> <span class="n">successfully</span><span class="p">.</span>
</code></pre></div><h2 id="この記事を試した環境">この記事を試した環境</h2>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nb">PS </span><span class="n">C:</span><span class="p">\</span><span class="n">Users</span><span class="p">\</span><span class="n">Administrator</span><span class="p">&gt;</span> <span class="nb">Get-WmiObject</span> <span class="n">Win32_OperatingSystem</span>


<span class="n">SystemDirectory</span> <span class="err">:</span> <span class="n">C:</span><span class="p">\</span><span class="n">Windows</span><span class="p">\</span><span class="n">system32</span>
<span class="n">Organization</span>    <span class="err">:</span> <span class="n">Amazon</span><span class="p">.</span><span class="n">com</span>
<span class="n">BuildNumber</span>     <span class="err">:</span> <span class="n">17763</span>
<span class="n">RegisteredUser</span>  <span class="err">:</span> <span class="n">EC2</span>
<span class="n">SerialNumber</span>    <span class="err">:</span> <span class="n">00430</span><span class="p">-</span><span class="n">00000</span><span class="p">-</span><span class="n">00000-AA379</span>
<span class="n">Version</span>         <span class="err">:</span> <span class="n">10</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">17763</span>

<span class="nb">PS </span><span class="n">C:</span><span class="p">\</span><span class="n">Users</span><span class="p">\</span><span class="n">Administrator</span><span class="p">&gt;</span> <span class="nv">$PSVersionTable</span>

<span class="n">Name</span>                           <span class="n">Value</span>
<span class="p">----</span>                           <span class="p">-----</span>
<span class="n">PSVersion</span>                      <span class="n">5</span><span class="p">.</span><span class="n">1</span><span class="p">.</span><span class="n">17763</span><span class="p">.</span><span class="n">1490</span>
<span class="n">PSEdition</span>                      <span class="n">Desktop</span>
<span class="n">PSCompatibleVersions</span>           <span class="p">{</span><span class="n">1</span><span class="p">.</span><span class="n">0</span><span class="p">,</span> <span class="n">2</span><span class="p">.</span><span class="n">0</span><span class="p">,</span> <span class="n">3</span><span class="p">.</span><span class="n">0</span><span class="p">,</span> <span class="n">4</span><span class="p">.</span><span class="n">0</span><span class="p">...}</span>
<span class="n">BuildVersion</span>                   <span class="n">10</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">17763</span><span class="p">.</span><span class="n">1490</span>
<span class="n">CLRVersion</span>                     <span class="n">4</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">30319</span><span class="p">.</span><span class="n">42000</span>
<span class="n">WSManStackVersion</span>              <span class="n">3</span><span class="p">.</span><span class="n">0</span>
<span class="n">PSRemotingProtocolVersion</span>      <span class="n">2</span><span class="p">.</span><span class="n">3</span>
<span class="n">SerializationVersion</span>           <span class="n">1</span><span class="p">.</span><span class="n">1</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">1</span>
</code></pre></div>]]></content>
		</item>
		
		<item>
			<title>PowerShell を使って Google Chrome をインストールする方法</title>
			<link>https://noid11.github.io/posts/chrome-install-by-powershell/</link>
			<pubDate>Tue, 19 Jan 2021 15:12:28 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/chrome-install-by-powershell/</guid>
			<description>&lt;p&gt;Windows Server 構築で毎回 Internet Explorer の設定を変える・・・みたいな作業が減るので便利&lt;/p&gt;</description>
			<content type="html"><![CDATA[<p>Windows Server 構築で毎回 Internet Explorer の設定を変える・・・みたいな作業が減るので便利</p>
<h2 id="コマンド">コマンド</h2>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$Path</span> <span class="p">=</span> <span class="nv">$env:TEMP</span><span class="p">;</span> <span class="nv">$Installer</span> <span class="p">=</span> <span class="s2">&#34;chrome_installer.exe&#34;</span><span class="p">;</span> <span class="nb">Invoke-WebRequest</span> <span class="s2">&#34;https://dl.google.com/tag/s/appguid%3D%7B8A69D345-D564-463C-AFF1-A69D9E530F96%7D%26browser%3D0%26usagestats%3D1%26appname%3DGoogle%2520Chrome%26needsadmin%3Dprefers%26brand%3DGTPM/update2/installers/ChromeSetup.exe&#34;</span> <span class="n">-OutFile</span> <span class="nv">$Path</span><span class="p">\</span><span class="nv">$Installer</span><span class="p">;</span> <span class="nb">Start-Process</span> <span class="n">-FilePath</span> <span class="nv">$Path</span><span class="p">\</span><span class="nv">$Installer</span> <span class="n">-Args</span> <span class="s2">&#34;/silent /install&#34;</span> <span class="n">-Verb</span> <span class="n">RunAs</span> <span class="n">-Wait</span><span class="p">;</span> <span class="nb">Remove-Item</span> <span class="nv">$Path</span><span class="p">\</span><span class="nv">$Installer</span>
</code></pre></div><h2 id="何をしているのか">何をしているのか</h2>
<p><code>;</code> はコマンドの区切りなので、実質以下のようなコマンドを連続して実行している</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$Path</span> <span class="p">=</span> <span class="nv">$env:TEMP</span>
<span class="nv">$Installer</span> <span class="p">=</span> <span class="s2">&#34;chrome_installer.exe&#34;</span>
<span class="nb">Invoke-WebRequest</span> <span class="s2">&#34;https://dl.google.com/tag/s/appguid%3D%7B8A69D345-D564-463C-AFF1-A69D9E530F96%7D%26browser%3D0%26usagestats%3D1%26appname%3DGoogle%2520Chrome%26needsadmin%3Dprefers%26brand%3DGTPM/update2/installers/ChromeSetup.exe&#34;</span> <span class="n">-OutFile</span> <span class="nv">$Path</span><span class="p">\</span><span class="nv">$Installer</span>
<span class="nb">Start-Process</span> <span class="n">-FilePath</span> <span class="nv">$Path</span><span class="p">\</span><span class="nv">$Installer</span> <span class="n">-Args</span> <span class="s2">&#34;/silent /install&#34;</span> <span class="n">-Verb</span> <span class="n">RunAs</span> <span class="n">-Wait</span>
<span class="nb">Remove-Item</span> <span class="nv">$Path</span><span class="p">\</span><span class="nv">$Installer</span>
</code></pre></div><ol>
<li><code>$Path = $env:TEMP</code>
<ul>
<li>Google Chrome のインストーラーを保存する一時ディレクトリの定義</li>
</ul>
</li>
<li><code>$Installer = &quot;chrome_installer.exe&quot;</code>
<ul>
<li>Google Chrome のインストーラーを保存する際のファイル名</li>
</ul>
</li>
<li><code>Invoke-WebRequest &quot;https://dl.google.com/tag/s/appguid%3D%7B8A69D345-D564-463C-AFF1-A69D9E530F96%7D%26browser%3D0%26usagestats%3D1%26appname%3DGoogle%2520Chrome%26needsadmin%3Dprefers%26brand%3DGTPM/update2/installers/ChromeSetup.exe&quot; -OutFile $Path\$Installer</code>
<ul>
<li><code>Invoke-WebRequest</code>
<ul>
<li>HTTP, HTTPS リクエストを行うコマンド</li>
<li><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/invoke-webrequest">https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/invoke-webrequest</a></li>
</ul>
</li>
<li><code>https://dl.google.com/...</code>
<ul>
<li>Google Chrome インストーラーがホストされている URL</li>
<li>直接ダウンロードできるリンクについては Google 公式の情報は発見できなかった</li>
</ul>
</li>
<li><code>-OutFile $Path\$Installer</code>
<ul>
<li>HTTP, HTTPS レスポンス内容をファイルに出力するオプション</li>
<li><code>$Path\$Installer</code> は前に定義した一時ディレクトリとファイル名</li>
</ul>
</li>
</ul>
</li>
<li><code>Start-Process -FilePath $Path\$Installer -Args &quot;/silent /install&quot; -Verb RunAs -Wait</code>
<ul>
<li><code>Start-Process</code>
<ul>
<li>新しいプロセスを開始するコマンド</li>
<li><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/start-process">https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/start-process</a></li>
</ul>
</li>
<li><code>-FilePath $Path\$Installer</code>
<ul>
<li>プロセスとして実行するファイルのパス</li>
</ul>
</li>
<li><code>-Args &quot;/silent /install&quot;</code>
<ul>
<li><code>-ArgumentList</code> のエイリアス</li>
<li>プロセスを開始するときの引数</li>
<li>そのため <code>&quot;/silent /install&quot;</code> は Google Chrome インストーラーに対して指定するオプション
<ul>
<li>サイレントインストールのためのオプションだと思われるが、 Google Chrome のインストーラーで使用できるオプションについては情報を発見できなかった</li>
</ul>
</li>
</ul>
</li>
<li><code>-Verb RunAs</code>
<ul>
<li>ファイルを動作するときの verb を指定するオプション
<ul>
<li>verb は実行するアクション的な意味合い</li>
</ul>
</li>
<li>指定可能な verb は、実行するファイルの拡張子によって異なる</li>
<li><code>RunAs</code> は <code>.exe</code> 形式のファイルに指定できる verb
<ul>
<li>要するに管理者権限でプロセスを実行するということ。 <code>sudo</code> に似ている</li>
</ul>
</li>
</ul>
</li>
<li><code>-Wait</code>
<ul>
<li>実行するプロセスと、その子孫となるプロセスが完了するのを待つオプション</li>
</ul>
</li>
</ul>
</li>
<li><code>Remove-Item $Path\$Installer</code>
<ul>
<li>ファイルを削除するコマンド
<ul>
<li><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/remove-item">https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/remove-item</a></li>
</ul>
</li>
<li><code>Start-Process ... -Wait</code> と合わせて、イントールプロセス完了後にインストーラーを削除する</li>
</ul>
</li>
</ol>
<h2 id="参考">参考</h2>
<p>コマンドでWindowsにChromeをインストールする - Qiita<br>
<a href="https://qiita.com/Arahabica/items/04f8469842f29550b831">https://qiita.com/Arahabica/items/04f8469842f29550b831</a></p>
<p>Install Google Chrome with Powershell command-line - YouTube<br>
<a href="https://www.youtube.com/watch?v=M0qX46M3mnE">https://www.youtube.com/watch?v=M0qX46M3mnE</a></p>
<h2 id="この記事を試した環境">この記事を試した環境</h2>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nb">PS </span><span class="n">C:</span><span class="p">\</span><span class="n">Users</span><span class="p">\</span><span class="n">Administrator</span><span class="p">&gt;</span> <span class="nb">Get-WmiObject</span> <span class="n">Win32_OperatingSystem</span>


<span class="n">SystemDirectory</span> <span class="err">:</span> <span class="n">C:</span><span class="p">\</span><span class="n">Windows</span><span class="p">\</span><span class="n">system32</span>
<span class="n">Organization</span>    <span class="err">:</span> <span class="n">Amazon</span><span class="p">.</span><span class="n">com</span>
<span class="n">BuildNumber</span>     <span class="err">:</span> <span class="n">17763</span>
<span class="n">RegisteredUser</span>  <span class="err">:</span> <span class="n">EC2</span>
<span class="n">SerialNumber</span>    <span class="err">:</span> <span class="n">00430</span><span class="p">-</span><span class="n">00000</span><span class="p">-</span><span class="n">00000-AA379</span>
<span class="n">Version</span>         <span class="err">:</span> <span class="n">10</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">17763</span>

<span class="nb">PS </span><span class="n">C:</span><span class="p">\</span><span class="n">Users</span><span class="p">\</span><span class="n">Administrator</span><span class="p">&gt;</span> <span class="nv">$PSVersionTable</span>

<span class="n">Name</span>                           <span class="n">Value</span>
<span class="p">----</span>                           <span class="p">-----</span>
<span class="n">PSVersion</span>                      <span class="n">5</span><span class="p">.</span><span class="n">1</span><span class="p">.</span><span class="n">17763</span><span class="p">.</span><span class="n">1490</span>
<span class="n">PSEdition</span>                      <span class="n">Desktop</span>
<span class="n">PSCompatibleVersions</span>           <span class="p">{</span><span class="n">1</span><span class="p">.</span><span class="n">0</span><span class="p">,</span> <span class="n">2</span><span class="p">.</span><span class="n">0</span><span class="p">,</span> <span class="n">3</span><span class="p">.</span><span class="n">0</span><span class="p">,</span> <span class="n">4</span><span class="p">.</span><span class="n">0</span><span class="p">...}</span>
<span class="n">BuildVersion</span>                   <span class="n">10</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">17763</span><span class="p">.</span><span class="n">1490</span>
<span class="n">CLRVersion</span>                     <span class="n">4</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">30319</span><span class="p">.</span><span class="n">42000</span>
<span class="n">WSManStackVersion</span>              <span class="n">3</span><span class="p">.</span><span class="n">0</span>
<span class="n">PSRemotingProtocolVersion</span>      <span class="n">2</span><span class="p">.</span><span class="n">3</span>
<span class="n">SerializationVersion</span>           <span class="n">1</span><span class="p">.</span><span class="n">1</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">1</span>
</code></pre></div>]]></content>
		</item>
		
		<item>
			<title>Windows の情報を PowerShell から確認する方法</title>
			<link>https://noid11.github.io/posts/view-windows-info/</link>
			<pubDate>Tue, 19 Jan 2021 14:24:03 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/view-windows-info/</guid>
			<description>&lt;p&gt;Windows Server のバージョン情報を PowerShell から確認する方法を調べたメモ&lt;/p&gt;</description>
			<content type="html"><![CDATA[<p>Windows Server のバージョン情報を PowerShell から確認する方法を調べたメモ</p>
<h2 id="get-wmiobject-win32_operatingsystem">Get-WmiObject Win32_OperatingSystem</h2>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nb">Get-WmiObject</span> <span class="n">Win32_OperatingSystem</span>
</code></pre></div><h2 id="実行例">実行例</h2>
<p>EC2 で Windows Server を構築した例</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nb">PS </span><span class="n">C:</span><span class="p">\</span><span class="n">Users</span><span class="p">\</span><span class="n">Administrator</span><span class="p">&gt;</span> <span class="nb">Get-WmiObject</span> <span class="n">Win32_OperatingSystem</span>


<span class="n">SystemDirectory</span> <span class="err">:</span> <span class="n">C:</span><span class="p">\</span><span class="n">Windows</span><span class="p">\</span><span class="n">system32</span>
<span class="n">Organization</span>    <span class="err">:</span> <span class="n">Amazon</span><span class="p">.</span><span class="n">com</span>
<span class="n">BuildNumber</span>     <span class="err">:</span> <span class="n">17763</span>
<span class="n">RegisteredUser</span>  <span class="err">:</span> <span class="n">EC2</span>
<span class="n">SerialNumber</span>    <span class="err">:</span> <span class="n">00430</span><span class="p">-</span><span class="n">00000</span><span class="p">-</span><span class="n">00000-AA379</span>
<span class="n">Version</span>         <span class="err">:</span> <span class="n">10</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">17763</span>
</code></pre></div><ul>
<li>SystemDirectory:
<ul>
<li>OS のシステムディレクトリ</li>
<li>System directory of the operating system.</li>
</ul>
</li>
<li>Organization:
<ul>
<li>OS 登録ユーザーの会社名</li>
<li>Company name for the registered user of the operating system.</li>
</ul>
</li>
<li>BuildNumber:
<ul>
<li>OS のビルド番号。製品のリリースバージョン番号よりも正確なバージョン情報として使用できる</li>
<li>Build number of an operating system. It can be used for more precise version information than product release version numbers.</li>
</ul>
</li>
<li>RegisteredUser:
<ul>
<li>OS の登録ユーザー名</li>
<li>Name of the registered user of the operating system.</li>
</ul>
</li>
<li>SerialNumber:
<ul>
<li>OS のシリアル ID 番号</li>
<li>Operating system product serial identification number.</li>
</ul>
</li>
<li>Version:
<ul>
<li>OS のバージョン</li>
<li>Version number of the operating system.</li>
</ul>
</li>
</ul>
<p>Win32_OperatingSystem class - Win32 apps | Microsoft Docs<br>
<a href="https://docs.microsoft.com/en-us/windows/win32/cimwin32prov/win32-operatingsystem">https://docs.microsoft.com/en-us/windows/win32/cimwin32prov/win32-operatingsystem</a></p>
<h2 id="get-wmiobject-とは">Get-WmiObject とは</h2>
<p>Get-WmiObject (Microsoft.PowerShell.Management) - PowerShell | Microsoft Docs<br>
<a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-wmiobject">https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-wmiobject</a></p>
<blockquote>
<p>Gets instances of Windows Management Instrumentation (WMI) classes or information about the available classes.</p>
</blockquote>
<p>WMI: Windows Managemtn Instrumentation クラスまたは利用可能なクラス情報のインスタンス情報を取得するコマンド</p>
<h2 id="wmi-windows-managemtn-instrumentation-とは">WMI: Windows Managemtn Instrumentation とは</h2>
<p>Windows Management Instrumentation - Win32 apps | Microsoft Docs<br>
<a href="https://docs.microsoft.com/ja-jp/windows/win32/wmisdk/wmi-start-page">https://docs.microsoft.com/ja-jp/windows/win32/wmisdk/wmi-start-page</a></p>
<blockquote>
<p>Windows Management Instrumentation (WMI) is the infrastructure for management data and operations on Windows-based operating systems. You can write WMI scripts or applications to automate administrative tasks on remote computers but WMI also supplies management data to other parts of the operating system and products, for example System Center Operations Manager, formerly Microsoft Operations Manager (MOM), or Windows Remote Management (WinRM).</p>
</blockquote>
<p>Windows Management Instrumentation (WMI) は Windows ベース OS におけるデータ管理と操作のためのインフラ</p>
<h2 id="win32_operatingsystem-とは">Win32_OperatingSystem とは</h2>
<p>Win32_OperatingSystem class - Win32 apps | Microsoft Docs<br>
<a href="https://docs.microsoft.com/en-us/windows/win32/cimwin32prov/win32-operatingsystem">https://docs.microsoft.com/en-us/windows/win32/cimwin32prov/win32-operatingsystem</a></p>
<blockquote>
<p>The Win32_OperatingSystem WMI class represents a Windows-based operating system installed on a computer.</p>
</blockquote>
<p>Win32_OperatingSystem は WMI クラスの1つで、コンピューターにインストールされている Windows ベースの OS を扱うクラス</p>
<h2 id="buildnumber-から-windows-server-リリースを確認する">BuildNumber から Windows Server リリースを確認する</h2>
<ul>
<li>公式情報があるので BuildNumber で検索すれば OK</li>
<li>BuildNumber が <code>17763</code> なら、 OS Build カラムから <code>Windows Server 2019 (Long-Term Servicing Channel) (Datacenter, Essentials, Standard)</code> か <code>Windows Server, version 1809 (Semi-Annual Channel) (Datacenter Core, Standard Core)</code> だと分かる</li>
</ul>
<p>Windows Server のリリース情報 | Microsoft Docs<br>
<a href="https://docs.microsoft.com/ja-jp/windows-server/get-started/windows-server-release-info">https://docs.microsoft.com/ja-jp/windows-server/get-started/windows-server-release-info</a></p>
<h2 id="この記事を試した環境">この記事を試した環境</h2>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nb">PS </span><span class="n">C:</span><span class="p">\</span><span class="n">Users</span><span class="p">\</span><span class="n">Administrator</span><span class="p">&gt;</span> <span class="nb">Get-WmiObject</span> <span class="n">Win32_OperatingSystem</span>


<span class="n">SystemDirectory</span> <span class="err">:</span> <span class="n">C:</span><span class="p">\</span><span class="n">Windows</span><span class="p">\</span><span class="n">system32</span>
<span class="n">Organization</span>    <span class="err">:</span> <span class="n">Amazon</span><span class="p">.</span><span class="n">com</span>
<span class="n">BuildNumber</span>     <span class="err">:</span> <span class="n">17763</span>
<span class="n">RegisteredUser</span>  <span class="err">:</span> <span class="n">EC2</span>
<span class="n">SerialNumber</span>    <span class="err">:</span> <span class="n">00430</span><span class="p">-</span><span class="n">00000</span><span class="p">-</span><span class="n">00000-AA379</span>
<span class="n">Version</span>         <span class="err">:</span> <span class="n">10</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">17763</span>

<span class="nb">PS </span><span class="n">C:</span><span class="p">\</span><span class="n">Users</span><span class="p">\</span><span class="n">Administrator</span><span class="p">&gt;</span> <span class="nv">$PSVersionTable</span>

<span class="n">Name</span>                           <span class="n">Value</span>
<span class="p">----</span>                           <span class="p">-----</span>
<span class="n">PSVersion</span>                      <span class="n">5</span><span class="p">.</span><span class="n">1</span><span class="p">.</span><span class="n">17763</span><span class="p">.</span><span class="n">1490</span>
<span class="n">PSEdition</span>                      <span class="n">Desktop</span>
<span class="n">PSCompatibleVersions</span>           <span class="p">{</span><span class="n">1</span><span class="p">.</span><span class="n">0</span><span class="p">,</span> <span class="n">2</span><span class="p">.</span><span class="n">0</span><span class="p">,</span> <span class="n">3</span><span class="p">.</span><span class="n">0</span><span class="p">,</span> <span class="n">4</span><span class="p">.</span><span class="n">0</span><span class="p">...}</span>
<span class="n">BuildVersion</span>                   <span class="n">10</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">17763</span><span class="p">.</span><span class="n">1490</span>
<span class="n">CLRVersion</span>                     <span class="n">4</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">30319</span><span class="p">.</span><span class="n">42000</span>
<span class="n">WSManStackVersion</span>              <span class="n">3</span><span class="p">.</span><span class="n">0</span>
<span class="n">PSRemotingProtocolVersion</span>      <span class="n">2</span><span class="p">.</span><span class="n">3</span>
<span class="n">SerializationVersion</span>           <span class="n">1</span><span class="p">.</span><span class="n">1</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">1</span>
</code></pre></div>]]></content>
		</item>
		
		<item>
			<title>Kinesis Data Streams のコンシューマーとして動かす AWS Lambda 関数サンプル</title>
			<link>https://noid11.github.io/posts/lambda-kinesis-consumer-sample/</link>
			<pubDate>Tue, 19 Jan 2021 08:51:43 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/lambda-kinesis-consumer-sample/</guid>
			<description>&lt;ul&gt;
&lt;li&gt;Kinesis Data Streams に連携されるデータを確認したい場合等に使う&lt;/li&gt;
&lt;li&gt;ログの出力先等として Kinesis Data Streams に連携するサービスは結構存在するので、サクッと試す分にはマネジメントコンソールから編集可能な Python, Node.js 等を使うのが便利&lt;/li&gt;
&lt;/ul&gt;</description>
			<content type="html"><![CDATA[<ul>
<li>Kinesis Data Streams に連携されるデータを確認したい場合等に使う</li>
<li>ログの出力先等として Kinesis Data Streams に連携するサービスは結構存在するので、サクッと試す分にはマネジメントコンソールから編集可能な Python, Node.js 等を使うのが便利</li>
</ul>
<h2 id="サンプルコード">サンプルコード</h2>
<div class="highlight"><pre class="chroma"><code class="language-py" data-lang="py"><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">logging</span> <span class="kn">import</span> <span class="n">getLogger</span><span class="p">,</span> <span class="n">INFO</span><span class="p">,</span> <span class="n">DEBUG</span>
<span class="kn">import</span> <span class="nn">base64</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">INFO</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&#34;init&#34;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;base64 decorded records data&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">]:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s1">&#39;kinesis&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">event</span>
</code></pre></div><h2 id="aws-cli-を使って-kinesis-data-streams-にデータを投入するサンプル">AWS CLI を使って Kinesis Data Streams にデータを投入するサンプル</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nv">STREAM_NAME</span><span class="o">=</span>mystream
<span class="nv">PERTITION_KEY</span><span class="o">=</span>my-partition
<span class="nv">REGION</span><span class="o">=</span>ap-northeast-1
aws --region <span class="nv">$REGION</span> kinesis put-record --stream-name <span class="nv">$STREAM_NAME</span> --data <span class="k">$(</span>uuidgen<span class="p">|</span>base64<span class="k">)</span> --partition-key <span class="nv">$PERTITION_KEY</span>

<span class="c1"># ループしたい場合</span>
<span class="k">while</span> sleep 1<span class="p">;</span> <span class="k">do</span> aws --region <span class="nv">$REGION</span> kinesis put-record --stream-name <span class="nv">$STREAM_NAME</span> --data <span class="k">$(</span>uuidgen<span class="p">|</span>base64<span class="k">)</span> --partition-key <span class="nv">$PERTITION_KEY</span><span class="p">;</span> <span class="k">done</span>
</code></pre></div><ul>
<li>Kinesis Data Streams に連携されているデータは base64 エンコードされる場合が多いため、上記コマンドでも base64 エンコードしているが、必須ではない</li>
</ul>
<h2 id="この記事を試した環境">この記事を試した環境</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">% sw_vers
ProductName:	Mac OS X
ProductVersion:	10.15.7
BuildVersion:	19H114
% aws --version
aws-cli/2.1.6 Python/3.7.4 Darwin/19.6.0 exe/x86_64 prompt/off
</code></pre></div><ul>
<li>AWS Lambda ランタイム: Python 3.8</li>
</ul>]]></content>
		</item>
		
		<item>
			<title>go get コマンドのヘルプを読む</title>
			<link>https://noid11.github.io/posts/go-help-get/</link>
			<pubDate>Sat, 16 Jan 2021 12:10:06 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/go-help-get/</guid>
			<description>&lt;p&gt;&lt;code&gt;go get&lt;/code&gt; コマンドのヘルプ &lt;code&gt;go help get&lt;/code&gt; を読んだメモ&lt;/p&gt;</description>
			<content type="html"><![CDATA[<p><code>go get</code> コマンドのヘルプ <code>go help get</code> を読んだメモ</p>
<h2 id="note">Note</h2>
<pre><code>usage: go get [-d] [-t] [-u] [-v] [-insecure] [build flags] [packages]
</code></pre><hr>
<p>依存関係の解決挙動あれこれ</p>
<ul>
<li>go get は、現在の開発モジュールを、依存関係の解決して追加し、ビルドとインストールを行う</li>
<li>まず、追加するモジュールの依存関係を解決する</li>
<li>それぞれのネームドパッケージやパッケージパターンに対して get はバージョンを指定する
<ul>
<li>デフォルトでは最新のタグ付きリリースバージョンとなる
<ul>
<li><code>v0.4.5</code> や <code>v1.2.2.3</code> など</li>
</ul>
</li>
<li>タグ付けされたリリースのように、最新のタグ付きプレリリース版も検索する
<ul>
<li><code>v0.0.1-pre1</code> など</li>
</ul>
</li>
<li>タグ付けされたバージョンが全く無い場合、 get は最新のコミットを見る</li>
<li>もし、モジュールが後のバージョンで、まだ required とされていない場合、 get は調べたバージョンを使用する
<ul>
<li>最新のリリースよりも新しいプレリリースがあるとか</li>
</ul>
</li>
<li>そうでなければ get は現在の必須バージョンを指定する</li>
</ul>
</li>
<li>デフォルトのバージョン選択は <code>go get golang.org/x/text@v0.3.0</code> のように <code>@version</code> サフィックスをパッケージ引数に追加することで上書きすることが出来る
<ul>
<li>バージョンにはプレフィックスを指定することが出来る。 <code>@v1</code> は <code>v1</code> で始まる最新の利用可能なバージョンを表す</li>
<li>クエリの完全な構文については <code>go help modules</code> を参照</li>
</ul>
</li>
<li>ソース管理リポジトリに保存されているモジュールの場合、バージョンサフィックスはコミットハッシュ、ブランチ識別子、ソース管理システムが知っている他構文 (例えば <code>go get golang.org/x/text@master</code>) のような形でも OK
<ul>
<li>他モジュールのクエリ構文と重複する名前のブランチは、明示的に選択できないことに注意
<ul>
<li>例えば、 <code>@v2</code> というサフィックスは <code>v2</code> で始まる最新のバージョンを意味し、 <code>v2</code> という名前のブランチを意味しない</li>
</ul>
</li>
</ul>
</li>
<li>検討中のモジュールが既に現在の開発モジュールの依存関係にある場合、 get は必要なバージョンを更新する
<ul>
<li>現在の必須バージョンよりも前のバージョンを指定することは有効であり、依存関係をダウングレードする</li>
<li>バージョンサフィックス <code>@none</code> は、必要に応じて依存関係をダウングレードしたり、依存関係に依存するモジュールを削除したりして、依存関係を完全に削除すべきであることを示している</li>
</ul>
</li>
<li>バージョンサフィックス <code>@latest</code> は、指定されたパスで指定されたモジュールの最新マイナーリリースを明示的に要求する
<ul>
<li><code>@upgrade</code> というサフィックスは <code>@latest</code> と似ているが、モジュールが最新のリリースバージョンよりも新しいリビジョンやプレリリースバージョンで既に required とされている場合は、モジュールをダウングレードしない</li>
<li><code>@patch</code> というサフィックスは、最新のパッチリリースを要求する
<ul>
<li>現在必要とされているバージョンと同じメジャーとマイナーのバージョン番号を持つ、最新のリリースされたバージョン</li>
</ul>
</li>
<li><code>@upgrade</code> と同様に <code>@patch</code> は既に required とされているモジュールを新しいバージョンにダウングレードすることは無い</li>
<li>パスが required されていない場合、 <code>@upgrade</code>, <code>@patch</code>, <code>@latest</code> は同等</li>
</ul>
</li>
<li>get のデフォルトでは、ネームドパッケージを含むモジュールの最新バージョンを使用するが、そのモジュールの依存関係の最新バージョンは使用しない
<ul>
<li>かわりに、そのモジュールが要求した特定の依存関係バージョンを使用する
<ul>
<li>例えば、最新の A がモジュール B v1.2.3 を必要とし、一方で B v1.2.4 と v1.3.1 も利用可能である場合、 <code>go get A</code> は最新の A を使用するものの A が要求した通り B v1.2.3 を使用する</li>
</ul>
</li>
<li>特定のモジュールに対して競合する要求がある場合 <code>go get</code> は要求された最大のバージョンを使用することで、それらの要求を解決する</li>
</ul>
</li>
</ul>
<hr>
<p>コマンド実行時のフラグあれこれ</p>
<ul>
<li><code>-d</code> フラグ
<ul>
<li>指定されたパッケージのビルドに必要なソースコードをダウンロードするが、ビルドやインストールは行わない</li>
</ul>
</li>
<li><code>-t</code> フラグ
<ul>
<li>コマンドラインで指定されたパッケージのテストを構築するために必要なモジュールを考慮する</li>
</ul>
</li>
<li><code>-u</code> フラグ
<ul>
<li>コマンドラインで指定されたパッケージの依存関係を提供するモジュールを更新する</li>
<li>前の例の続きで、 <code>go get -u A</code> とした場合には B v1.3.1 の最新の A を使用する</li>
<li>B がモジュール C を必要としているが、 C が A のパッケージをビルドするのに必要なパッケージを提供していない場合、 C は更新されない</li>
</ul>
</li>
<li><code>-u=patch</code> フラグ
<ul>
<li><code>-u patch</code> では無い</li>
<li>依存関係を更新する</li>
<li>デフォルトでパッチリリースを選択するように変更</li>
<li><code>go get -u=patch A@latest</code> は B v1.2.4 の最新の A を使用するが <code>go get -u=patch A</code> は A のパッチリリースを代わりに使用する</li>
</ul>
</li>
<li><code>-t</code> と <code>-u</code> を同時に使うと get はテストの依存関係も更新する
<ul>
<li>一般的に、新しい依存関係を追加すると、ビルドを動作させるために既存の依存関係をアップグレードする必要があるかもしれないが、 <code>go get</code> はこれを自動的に行う</li>
<li>同様に、ある依存関係をダウングレードすると、他の依存関係をダウングレードする必要があるかもしれない</li>
</ul>
</li>
<li><code>-insecure</code> フラグ
<ul>
<li>HTTP のような安全ではないスキームを使って、リポジトリからの取得やカスタムドメインの解決を許可する</li>
<li>注意して使用すること</li>
<li>環境変数 <code>GOINSECURE</code> は、安全ではないスキームを使って、どのモジュールを取得するかを制御することが出来るので、一般的によりよい代替手段となる</li>
<li>詳細は <code>go help environment</code> を参照</li>
</ul>
</li>
</ul>
<hr>
<p>ネームドパッケージのダウンロード、ビルド、インストール</p>
<ul>
<li>引数にモジュールの名前があってもパッケージでは無い場合、ビルドに失敗する代わりに、その引数のインストールステップはスキップされる
<ul>
<li>パッケージではない場合にはモジュールのルートディレクトリに Go コードが無いためビルドに失敗する</li>
<li>例えば、 <code>go get golang.org/x/perf</code> は、インポートパスに対応するコードが無くても成功する</li>
</ul>
</li>
<li>パッケージパターンは許可されており、モジュールのバージョンを解決した後に展開されることに注意
<ul>
<li>例えば、 <code>go get golang.org/x/perf/cmd...</code> は最新の golang.org/x/perf を追加し、その最新バージョンのコマンドをインストールする</li>
</ul>
</li>
<li>パッケージの引数が無い場合、 <code>go get</code> はカレントディレクトリに Go パッケージがある場合には、そのパッケージに適用される
<ul>
<li>特に <code>go get -u</code> と <code>go get -u=patch</code> は、そのパッケージの全ての依存関係を更新する</li>
<li>パッケージ引数が無く、 <code>-u</code> も無い場合、 <code>go get</code> は <code>go install</code> 以上のものではなく、 <code>go get -d</code> は <code>go list</code> 以上のものでは無い</li>
</ul>
</li>
<li>モジュールの詳細については <code>go help modules</code></li>
<li>パッケージしていについては <code>go help packages</code></li>
<li>このテキストでは、ソースコードと依存関係を管理するためにモジュールを使用した get の動作について説明している
<ul>
<li>代わりに go コマンドが <code>GOPATH</code> モードで実行されている場合、 get のフラグと効果の詳細は <code>go help get</code> と同様に変更される</li>
<li>詳細については <code>go help modules</code> と <code>go help gopath-get</code> を参照</li>
</ul>
</li>
<li><code>go build</code>, <code>go install</code>, <code>go clean</code>, <code>go mod</code> も参照しよう</li>
</ul>
<h2 id="go-help-get">go help get</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">% go <span class="nb">help</span> get
usage: go get <span class="o">[</span>-d<span class="o">]</span> <span class="o">[</span>-t<span class="o">]</span> <span class="o">[</span>-u<span class="o">]</span> <span class="o">[</span>-v<span class="o">]</span> <span class="o">[</span>-insecure<span class="o">]</span> <span class="o">[</span>build flags<span class="o">]</span> <span class="o">[</span>packages<span class="o">]</span>

Get resolves and adds dependencies to the current development module and <span class="k">then</span> builds and installs them.

The first step is to resolve which dependencies to add.

For each named package or package pattern, get must decide which version of the corresponding module to use.
By default, get looks up the latest tagged release version, such as v0.4.5 or v1.2.3. If there are no tagged release versions, get looks up the latest tagged pre-release version, such as v0.0.1-pre1. 
If there are no tagged versions at all, get looks up the latest known commit. 
If the module is not already required at a later version <span class="o">(</span><span class="k">for</span> example, a pre-release newer than the latest release<span class="o">)</span>, get will use the version it looked up. 
Otherwise, get will use the currently required version.

This default version selection can be overridden by adding an @version suffix to the package argument, as in <span class="s1">&#39;go get golang.org/x/text@v0.3.0&#39;</span>.
The version may be a prefix: @v1 denotes the latest available version starting with v1. 
See <span class="s1">&#39;go help modules&#39;</span> under the heading <span class="s1">&#39;Module queries&#39;</span> <span class="k">for</span> the full query syntax.

For modules stored in <span class="nb">source</span> control repositories, the version suffix can also be a commit hash, branch identifier, or other syntax known to the <span class="nb">source</span> control system, as in <span class="s1">&#39;go get golang.org/x/text@master&#39;</span>. 
Note that branches with names that overlap with other module query syntax cannot be selected explicitly. 
For example, the suffix @v2 means the latest version starting with v2, not the branch named v2.

If a module under consideration is already a dependency of the current development module, <span class="k">then</span> get will update the required version.
Specifying a version earlier than the current required version is valid and downgrades the dependency. 
The version suffix @none indicates that the dependency should be removed entirely, downgrading or removing modules depending on it as needed.

The version suffix @latest explicitly requests the latest minor release of the module named by the given path. 
The suffix @upgrade is like @latest but will not downgrade a module <span class="k">if</span> it is already required at a revision or pre-release version newer than the latest released version. 
The suffix @patch requests the latest patch release: the latest released version with the same major and minor version numbers as the currently required version. 
Like @upgrade, @patch will not downgrade a module already required at a newer version. 
If the path is not already required, @upgrade and @patch are equivalent to @latest.

Although get defaults to using the latest version of the module containing a named package, it does not use the latest version of that module<span class="s1">&#39;s dependencies.
</span><span class="s1">Instead it prefers to use the specific dependency versions requested by that module. 
</span><span class="s1">For example, if the latest A requires module B v1.2.3, while B v1.2.4 and v1.3.1 are also available, then &#39;</span>go get A<span class="s1">&#39; will use the latest A but then use B v1.2.3, as requested by A. 
</span><span class="s1">(If there are competing requirements for a particular module, then &#39;</span>go get<span class="s1">&#39; resolves those requirements by taking the maximum requested version.)
</span><span class="s1">
</span><span class="s1">The -t flag instructs get to consider modules needed to build tests of packages specified on the command line.
</span><span class="s1">
</span><span class="s1">The -u flag instructs get to update modules providing dependencies of packages named on the command line to use newer minor or patch releases when available. 
</span><span class="s1">Continuing the previous example, &#39;</span>go get -u A<span class="s1">&#39; will use the latest A with B v1.3.1 (not B v1.2.3). 
</span><span class="s1">If B requires module C, but C does not provide any packages needed to build packages in A (not including tests), then C will not be updated.
</span><span class="s1">
</span><span class="s1">The -u=patch flag (not -u patch) also instructs get to update dependencies, but changes the default to select patch releases.
</span><span class="s1">Continuing the previous example, &#39;</span>go get -u<span class="o">=</span>patch A@latest<span class="s1">&#39; will use the latest A with B v1.2.4 (not B v1.2.3), while &#39;</span>go get -u<span class="o">=</span>patch A<span class="s1">&#39; will use a patch release of A instead.
</span><span class="s1">
</span><span class="s1">When the -t and -u flags are used together, get will update test dependencies as well.
</span><span class="s1">
</span><span class="s1">In general, adding a new dependency may require upgrading existing dependencies to keep a working build, and &#39;</span>go get<span class="s1">&#39; does this automatically. 
</span><span class="s1">Similarly, downgrading one dependency may require downgrading other dependencies, and &#39;</span>go get<span class="s1">&#39; does this automatically as well.
</span><span class="s1">
</span><span class="s1">The -insecure flag permits fetching from repositories and resolving custom domains using insecure schemes such as HTTP. 
</span><span class="s1">Use with caution. 
</span><span class="s1">The GOINSECURE environment variable is usually a better alternative, since it provides control over which modules may be retrieved using an insecure scheme. 
</span><span class="s1">See &#39;</span>go <span class="nb">help</span> environment<span class="s1">&#39; for details.
</span><span class="s1">
</span><span class="s1">The second step is to download (if needed), build, and install the named packages.
</span><span class="s1">
</span><span class="s1">If an argument names a module but not a package (because there is no Go source code in the module&#39;</span>s root directory<span class="o">)</span>, <span class="k">then</span> the install step is skipped <span class="k">for</span> that argument, instead of causing a build failure. 
For example <span class="s1">&#39;go get golang.org/x/perf&#39;</span> succeeds even though there is no code corresponding to that import path.

Note that package patterns are allowed and are expanded after resolving the module versions. 
For example, <span class="s1">&#39;go get golang.org/x/perf/cmd/...&#39;</span> adds the latest golang.org/x/perf and <span class="k">then</span> installs the commands in that latest version.

The -d flag instructs get to download the <span class="nb">source</span> code needed to build the named packages, including downloading necessary dependencies, but not to build and install them.

With no package arguments, <span class="s1">&#39;go get&#39;</span> applies to Go package in the current directory, <span class="k">if</span> any. In particular, <span class="s1">&#39;go get -u&#39;</span> and <span class="s1">&#39;go get -u=patch&#39;</span> update all the dependencies of that package.
With no package arguments and also without -u, <span class="s1">&#39;go get&#39;</span> is not much more than <span class="s1">&#39;go install&#39;</span>, and <span class="s1">&#39;go get -d&#39;</span> not much more than <span class="s1">&#39;go list&#39;</span>.

For more about modules, see <span class="s1">&#39;go help modules&#39;</span>.

For more about specifying packages, see <span class="s1">&#39;go help packages&#39;</span>.

This text describes the behavior of get using modules to manage <span class="nb">source</span> code and dependencies. If instead the go <span class="nb">command</span> is running in GOPATH mode, the details of get<span class="s1">&#39;s flags and effects change, as does &#39;</span>go <span class="nb">help</span> get<span class="s1">&#39;.
</span><span class="s1">See &#39;</span>go <span class="nb">help</span> modules<span class="s1">&#39; and &#39;</span>go <span class="nb">help</span> gopath-get<span class="err">&#39;</span>.

See also: go build, go install, go clean, go mod.
</code></pre></div><h2 id="この記事を試した環境">この記事を試した環境</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">% sw_vers
ProductName:    Mac OS X
ProductVersion: 10.15.7
BuildVersion:   19H114
% go version
go version go1.15.6 darwin/amd64
</code></pre></div>]]></content>
		</item>
		
		<item>
			<title>UUIDv4 を Go で生成する</title>
			<link>https://noid11.github.io/posts/generate-uuidv4-by-golang/</link>
			<pubDate>Sat, 16 Jan 2021 11:31:50 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/generate-uuidv4-by-golang/</guid>
			<description></description>
			<content type="html"><![CDATA[<h2 id="セットアップ">セットアップ</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">go mod init generate-uuidv4-by-golang
go get github.com/google/uuid
</code></pre></div><h2 id="実装例">実装例</h2>
<p>main.go</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;fmt&#34;</span>

	<span class="s">&#34;github.com/google/uuid&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">uuidv4</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">uuid</span><span class="p">.</span><span class="nf">NewRandom</span><span class="p">()</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
		<span class="k">return</span>
	<span class="p">}</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">uuidv4</span><span class="p">.</span><span class="nf">String</span><span class="p">())</span>
<span class="p">}</span>
</code></pre></div><h2 id="実行例">実行例</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">% go run main.go
3c85b7b7-0b11-4612-9b1d-1dab37e20c9d
</code></pre></div><h2 id="リファレンス">リファレンス</h2>
<p>uuid · pkg.go.dev<br>
<a href="https://pkg.go.dev/github.com/google/uuid#NewRandom">https://pkg.go.dev/github.com/google/uuid#NewRandom</a></p>
<p>google/uuid: Go package for UUIDs based on RFC 4122 and DCE 1.1: Authentication and Security Services.<br>
<a href="https://github.com/google/uuid">https://github.com/google/uuid</a></p>
<p>RFC 4122 - A Universally Unique IDentifier (UUID) URN Namespace<br>
<a href="https://tools.ietf.org/html/rfc4122">https://tools.ietf.org/html/rfc4122</a></p>
<p>RFC 4122 - A Universally Unique IDentifier (UUID) URN Namespace 日本語訳<br>
<a href="https://tex2e.github.io/rfc-translater/html/rfc4122.html">https://tex2e.github.io/rfc-translater/html/rfc4122.html</a></p>
<h2 id="この記事を試した環境">この記事を試した環境</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">% sw_vers
ProductName:    Mac OS X
ProductVersion: 10.15.7
BuildVersion:   19H114
% go version
go version go1.15.6 darwin/amd64
</code></pre></div><p>go.mod</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">module</span> <span class="nx">golang</span><span class="o">-</span><span class="nx">uuid</span>

<span class="k">go</span> <span class="mf">1.15</span>

<span class="nx">require</span> <span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">google</span><span class="o">/</span><span class="nx">uuid</span> <span class="nx">v1</span><span class="mf">.1.5</span> <span class="c1">// indirect
</span></code></pre></div><p>go.sum</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">google</span><span class="o">/</span><span class="nx">uuid</span> <span class="nx">v1</span><span class="mf">.1.5</span> <span class="nx">h1</span><span class="p">:</span><span class="nx">kxhtnfFVi</span><span class="o">+</span><span class="nx">rYdOALN0B3k9UT86zVJKfBimRaciULW4I</span><span class="p">=</span>
<span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">google</span><span class="o">/</span><span class="nx">uuid</span> <span class="nx">v1</span><span class="mf">.1.5</span><span class="o">/</span><span class="k">go</span><span class="p">.</span><span class="nx">mod</span> <span class="nx">h1</span><span class="p">:</span><span class="nx">TIyPZe4MgqvfeYDBFedMoGGpEw</span><span class="o">/</span><span class="nx">LqOeaOT</span><span class="o">+</span><span class="nx">nhxU</span><span class="o">+</span><span class="nx">yHo</span><span class="p">=</span>
</code></pre></div>]]></content>
		</item>
		
		<item>
			<title>mktemp コマンド</title>
			<link>https://noid11.github.io/posts/mktemp-command/</link>
			<pubDate>Sat, 16 Jan 2021 08:56:33 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/mktemp-command/</guid>
			<description>&lt;ul&gt;
&lt;li&gt;一時的なファイルやディレクトリを作成する mktemp コマンドについて調べたメモ&lt;/li&gt;
&lt;li&gt;一時的なディレクトリを作成して cd で移動しつつ作業する・・・といった事がサクッとできて便利&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;(mktemp -d)&amp;#34;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
			<content type="html"><![CDATA[<ul>
<li>一時的なファイルやディレクトリを作成する mktemp コマンドについて調べたメモ</li>
<li>一時的なディレクトリを作成して cd で移動しつつ作業する・・・といった事がサクッとできて便利</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">cd</span> <span class="s2">&#34;(mktemp -d)&#34;</span>
</code></pre></div><h2 id="一時的なファイルを作成する">一時的なファイルを作成する</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">mktemp
</code></pre></div><p>実行例</p>
<ul>
<li><code>/var/folders/</code> 配下に一時的な空のファイルが作成される</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ mktemp
/var/folders/2s/xv1nds5j2d3b795qy43yzcthb7qc6n/T/tmp.9HMytC5L 
% ls -lh /var/folders/2s/xv1nds5j2d3b795qy43yzcthb7qc6n/T/tmp.9HMytC5L 
-rw-------  <span class="m">1</span> myusername  <span class="m">1896053708</span>     0B Jan <span class="m">16</span> 09:03 /var/folders/2s/xv1nds5j2d3b795qy43yzcthb7qc6n/T/tmp.9HMytC5L
% cat /var/folders/2s/xv1nds5j2d3b795qy43yzcthb7qc6n/T/tmp.9HMytC5L
</code></pre></div><h2 id="一時的なディレクトリを作成する">一時的なディレクトリを作成する</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">mktemp -d
</code></pre></div><p>実行例</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">% mktemp -d
/var/folders/2s/xv1nds5j2d3b795qy43yzcthb7qc6n/T/tmp.t3PtNiwY
% ls -lh /var/folders/2s/xv1nds5j2d3b795qy43yzcthb7qc6n/T/ <span class="p">|</span> grep t3PtNiwY
drwx------      <span class="m">2</span> myusername  <span class="m">1896053708</span>    64B Jan <span class="m">16</span> 09:22 tmp.t3PtNiwY
</code></pre></div><h2 id="生成されるファイルやディレクトリの名前を指定する">生成されるファイルやディレクトリの名前を指定する</h2>
<ul>
<li><code>mktemp [ファイル名].XXXXX</code> といった形で、任意の X を追加することでランダムな文字列を設定できる</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">mktemp mytmp.XXXXX
mktemp -d mytmp.XXXXX
</code></pre></div><p>実行例</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">% mktemp mytmp.XXXXX
mytmp.M2wuV
% mktemp -d mytmp.XXXXX
mytmp.moGrd
</code></pre></div><h2 id="シェルスクリプト例">シェルスクリプト例</h2>
<p>安全な一時ファイルを取得できない場合にスクリプトを終了する例</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="nv">tempfoo</span><span class="o">=</span><span class="sb">`</span>basename <span class="nv">$0</span><span class="sb">`</span>
<span class="nv">TMPFILE</span><span class="o">=</span><span class="sb">`</span>mktemp /tmp/<span class="si">${</span><span class="nv">tempfoo</span><span class="si">}</span>.XXXXXX<span class="sb">`</span> <span class="o">||</span> <span class="nb">exit</span> <span class="m">1</span>
<span class="nb">echo</span> <span class="s2">&#34;program output&#34;</span> &gt;&gt; <span class="nv">$TMPFILE</span>
</code></pre></div><p>実行例</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">% sh example.sh
% cat example.sh.kZXaAa
program output
</code></pre></div><hr>
<p>$TMPDIR を使う</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="nv">tempfoo</span><span class="o">=</span><span class="sb">`</span>basename <span class="nv">$0</span><span class="sb">`</span>
<span class="nv">TMPFILE</span><span class="o">=</span><span class="sb">`</span>mktemp -t <span class="si">${</span><span class="nv">tempfoo</span><span class="si">}</span><span class="sb">`</span> <span class="o">||</span> <span class="nb">exit</span> <span class="m">1</span>
<span class="nb">echo</span>	<span class="s2">&#34;program output&#34;</span> &gt;&gt; <span class="nv">$TMPFILE</span>
</code></pre></div><p>実行例</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">% sh example.sh
% <span class="nb">echo</span> <span class="nv">$TMPDIR</span>
/var/folders/2s/xv1nds5j2d3b795qy43yzcthb7qc6n/T/
% ls -l /var/folders/2s/xv1nds5j2d3b795qy43yzcthb7qc6n/T/ <span class="p">|</span> grep example
-rw-------      <span class="m">1</span> myusername  <span class="m">1896053708</span>        <span class="m">15</span>  <span class="m">1</span> <span class="m">16</span> 09:43 example.sh.gihepulJ
</code></pre></div><hr>
<p>エラーハンドリングを考慮する</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="nv">tempfoo</span><span class="o">=</span><span class="sb">`</span>basename <span class="nv">$0</span><span class="sb">`</span>
<span class="nv">TMPFILE</span><span class="o">=</span><span class="sb">`</span>mktemp -q /tmp/<span class="si">${</span><span class="nv">tempfoo</span><span class="si">}</span>.XXXXXX<span class="sb">`</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -ne <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$0</span><span class="s2">: Can&#39;t create temp file, exiting...&#34;</span>
    <span class="nb">exit</span> <span class="m">1</span>
<span class="k">fi</span>
</code></pre></div><h2 id="オプション">オプション</h2>
<ul>
<li><code>-d</code> オプション: 一時的なファイルではなく、一時的なディレクトリを作成する</li>
<li><code>-q</code> オプション: エラーメッセージを表示しない</li>
<li><code>-t</code> オプション: 指定した prefix と、 TMPDIR が設定されている場合にはそれを使って、テンプレートを作成し、ファイル名テンプレートを作成する</li>
<li><code>-u</code> オプション: unsafe モードを使用する。一時的なファイルは mktemp コマンドが終了する前に、リンクが解除される。これは mktemp（3）よりもわずかに優れていますが、それでも競合状態が発生するため、このオプションの使用は推奨されていない</li>
</ul>
<h2 id="manual">manual</h2>
<pre><code>% man mktemp
MKTEMP(1)                 BSD General Commands Manual                MKTEMP(1)

NAME
     mktemp -- make temporary file name (unique)

SYNOPSIS
     mktemp [-d] [-q] [-t prefix] [-u] template ...
     mktemp [-d] [-q] [-u] -t prefix

DESCRIPTION
     The mktemp utility takes each of the given file name templates and overwrites a portion of it to create a file name. 
     This file name is unique and suitable for use by the application.  
     The template may be any file name with some number of `Xs' appended to it, for example /tmp/temp.XXXX. 
     The trailing `Xs' are replaced with the current process number and/or a unique letter combination. 
     The number of unique file names mktemp can return depends on the number of `Xs' provided; six `Xs' will result in mktemp selecting 1 of 56800235584 (62 ** 6) possible file names. 
     On case-insensitive file systems, the effective number of unique names is significantly less; given six `Xs', mktemp will instead select 1 of 2176782336 (36 ** 6) possible unique file names.

     If mktemp can successfully generate a unique file name, the file is created with mode 0600 (unless the -u flag is given) and the filename is printed to standard output.

     If the -t prefix option is given, mktemp will generate a template string based on the prefix and the _CS_DARWIN_USER_TEMP_DIR configuration variable if available. 
     Fallback locations if _CS_DARWIN_USER_TEMP_DIR is not available are TMPDIR and /tmp.  
     Care should be taken to ensure that it is appropriate to use an environment variable potentially supplied by the user.

     If no arguments are passed or if only the -d flag is passed mktemp behaves as if -t tmp was supplied.

     Any number of temporary files may be created in a single invocation, including one based on the internal template resulting from the -t flag.

     The mktemp utility is provided to allow shell scripts to safely use temporary files.  
     Traditionally, many shell scripts take the name of the program with the pid as a suffix and use that as a temporary file name.  
     This kind of naming scheme is predictable and the race condition it creates is easy for an attacker to win. 
     A safer, though still inferior, approach is to make a temporary directory using the same naming scheme.  
     While this does allow one to guarantee that a temporary file will not be subverted, it still allows a simple denial of service attack.  
     For these reasons it is suggested that mktemp be used instead.

OPTIONS
     The available options are as follows:

     -d      Make a directory instead of a file.

     -q      Fail silently if an error occurs.  This is useful if a script does not want error output to go to standard error.

     -t prefix
             Generate a template (using the supplied prefix and TMPDIR if set) to create a filename template.

     -u      Operate in ``unsafe'' mode.  The temp file will be unlinked before mktemp exits.  This is slightly better than mktemp(3) but still introduces
             a race condition.  Use of this option is not encouraged.

EXIT STATUS
     The mktemp utility exits 0 on success, and &gt;0 if an error occurs.

EXAMPLES
     The following sh(1) fragment illustrates a simple use of mktemp where the script should quit if it cannot get a safe temporary file.

           tempfoo=`basename $0`
           TMPFILE=`mktemp /tmp/${tempfoo}.XXXXXX` || exit 1
           echo &quot;program output&quot; &gt;&gt; $TMPFILE

     To allow the use of $TMPDIR:

           tempfoo=`basename $0`
           TMPFILE=`mktemp -t ${tempfoo}` || exit 1
           echo &quot;program output&quot; &gt;&gt; $TMPFILE

     In this case, we want the script to catch the error itself.

           tempfoo=`basename $0`
           TMPFILE=`mktemp -q /tmp/${tempfoo}.XXXXXX`
           if [ $? -ne 0 ]; then
                   echo &quot;$0: Can't create temp file, exiting...&quot;
                   exit 1
           fi

SEE ALSO
     mkdtemp(3), mkstemp(3), mktemp(3), confstr(3), environ(7)

HISTORY
     A mktemp utility appeared in OpenBSD 2.1.  This implementation was written independently based on the OpenBSD man page, and first appeared in
     FreeBSD 2.2.7.  This man page is taken from OpenBSD.

BSD                            December 30, 2005                           BSD
</code></pre><h2 id="この記事を試した環境">この記事を試した環境</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">% sw_vers
ProductName:    Mac OS X
ProductVersion: 10.15.7
BuildVersion:   19H114
</code></pre></div>]]></content>
		</item>
		
		<item>
			<title>Heroku CLI を使って Heroku Postgres をセットアップする方法</title>
			<link>https://noid11.github.io/posts/setup-heroku-postgres-by-heroku-cli/</link>
			<pubDate>Thu, 14 Jan 2021 02:29:30 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/setup-heroku-postgres-by-heroku-cli/</guid>
			<description>&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://jp.heroku.com/postgres&#34;&gt;Heroku が提供するマネージドデータベースである Heroku Postgres&lt;/a&gt; を &lt;a href=&#34;https://devcenter.heroku.com/ja/articles/heroku-cli&#34;&gt;Heroku CLI&lt;/a&gt; からセットアップして接続するまでを試す手順&lt;/li&gt;
&lt;li&gt;Pros
&lt;ul&gt;
&lt;li&gt;PostgreSQL や SQL を学習したい時にサクッと使えて便利&lt;/li&gt;
&lt;li&gt;AWS Lambda 等ローカル環境の PostgreSQL が接続できない環境から、ちょっとしたデータベース接続を試したいような場合に便利
&lt;ul&gt;
&lt;li&gt;RDS よりも立ち上がりが速いし、無料&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Cons
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://jp.heroku.com/pricing&#34;&gt;無料の Hobby Dev プラン&lt;/a&gt;だと、レコード数 10 K と同時接続数 20 といった制限があるので注意&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;</description>
			<content type="html"><![CDATA[<ul>
<li><a href="https://jp.heroku.com/postgres">Heroku が提供するマネージドデータベースである Heroku Postgres</a> を <a href="https://devcenter.heroku.com/ja/articles/heroku-cli">Heroku CLI</a> からセットアップして接続するまでを試す手順</li>
<li>Pros
<ul>
<li>PostgreSQL や SQL を学習したい時にサクッと使えて便利</li>
<li>AWS Lambda 等ローカル環境の PostgreSQL が接続できない環境から、ちょっとしたデータベース接続を試したいような場合に便利
<ul>
<li>RDS よりも立ち上がりが速いし、無料</li>
</ul>
</li>
</ul>
</li>
<li>Cons
<ul>
<li><a href="https://jp.heroku.com/pricing">無料の Hobby Dev プラン</a>だと、レコード数 10 K と同時接続数 20 といった制限があるので注意</li>
</ul>
</li>
</ul>
<h2 id="postgresql-をインストール">PostgreSQL をインストール</h2>
<p>Heroku CLI 経由で PostgreSQL に接続する際には <code>psql</code> が必要になるため、事前にインストールしておく</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">brew install postgresql

<span class="c1"># PostgreSQL のバージョンを指定したい場合 @ で指定する</span>
brew install postgresql@12

<span class="c1"># バージョン確認</span>
psql --version
</code></pre></div><p>postgresql — Homebrew Formulae<br>
<a href="https://formulae.brew.sh/formula/postgresql">https://formulae.brew.sh/formula/postgresql</a></p>
<p>PostgreSQL: Documentation: 12: psql<br>
<a href="https://www.postgresql.org/docs/12/app-psql.html">https://www.postgresql.org/docs/12/app-psql.html</a></p>
<p>psql<br>
<a href="https://www.postgresql.jp/document/12/html/app-psql.html">https://www.postgresql.jp/document/12/html/app-psql.html</a></p>
<h2 id="heroku-cli-のインストールとセットアップ">Heroku CLI のインストールとセットアップ</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">brew tap heroku/brew <span class="o">&amp;&amp;</span> brew install heroku
heroku login
</code></pre></div><p>The Heroku CLI | Heroku Dev Center<br>
<a href="https://devcenter.heroku.com/articles/heroku-cli">https://devcenter.heroku.com/articles/heroku-cli</a></p>
<h2 id="heroku-postgres-のセットアップ">Heroku Postgres のセットアップ</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">mkdir my-heroku-postgres-env <span class="o">&amp;&amp;</span> <span class="nb">cd</span> my-heroku-postgres-env

<span class="c1"># Heroku App の作成</span>
heroku create

<span class="c1"># Heroku Postgres の作成</span>
heroku addons:create heroku-postgresql:hobby-dev --app myapp

<span class="c1"># Heroku Postgres のバージョンを指定したい場合</span>
heroku addons:create heroku-postgresql:hobby-dev --version<span class="o">=</span>9.5 --app myapp

<span class="c1"># 作成した Heroku Postgres 情報の確認</span>
heroku pg:info --app myapp
</code></pre></div><p>Heroku Postgres | Heroku Dev Center<br>
<a href="https://devcenter.heroku.com/articles/heroku-postgresql#version-support">https://devcenter.heroku.com/articles/heroku-postgresql#version-support</a></p>
<hr>
<p>実行例</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">% mkdir my-heroku-postgres-env <span class="o">&amp;&amp;</span> <span class="nb">cd</span> my-heroku-postgres-env
% heroku create
Creating app... <span class="k">done</span>, ⬢ fierce-depths-xxx
https://fierce-depths-xxx.herokuapp.com/ <span class="p">|</span> https://git.heroku.com/fierce-depths-xxx.git
% heroku addons:create heroku-postgresql:hobby-dev --app fierce-depths-xxx
Creating heroku-postgresql:hobby-dev on ⬢ fierce-depths-xxx... free
Database has been created and is available
 ! This database is empty. If upgrading, you can transfer
 ! data from another database with pg:copy
Created postgresql-concave-yyy as DATABASE_URL
Use heroku addons:docs heroku-postgresql to view documentation
% heroku pg:info --app fierce-depths-xxx
<span class="o">===</span> DATABASE_URL
Plan:                  Hobby-dev
Status:                Available
Connections:           0/20
PG Version:            12.5
Created:               2021-01-13 17:48 UTC
Data Size:             7.9 MB
Tables:                <span class="m">0</span>
Rows:                  0/10000 <span class="o">(</span>In compliance<span class="o">)</span>
Fork/Follow:           Unsupported
Rollback:              Unsupported
Continuous Protection: Off
Add-on:                postgresql-concave-yyy
</code></pre></div><h2 id="heroku-postgres-への接続">Heroku Postgres への接続</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># Heroku CLI での認証情報を使った接続</span>
heroku pg:psql --app myapp

<span class="c1"># PostgreSQL のクレデンシャルを取得して普通に psql でも接続できる</span>
heroku pg:credentials --app myapp

<span class="c1"># Connection URL での指定(パスワードが含まれるので取り扱い注意)</span>
psql --dbname<span class="o">=</span>postgres://db-username:db-user-password@db-hostname:db-post/db-name

<span class="c1"># 冗長な指定(コマンド実行後にパスワードを入力する必要あり)</span>
psql --dbname<span class="o">=</span>db-name --host<span class="o">=</span>ec2-db-hostname --port<span class="o">=</span>db-post --username<span class="o">=</span>db-username --password
</code></pre></div><hr>
<p>実行例</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">% heroku pg:credentials:url --app fierce-depths-xxx
Connection information <span class="k">for</span> default credential.
Connection info string:
   <span class="s2">&#34;dbname=xxx host=ec2-xxx-xxx-xxx-xxx.compute-1.amazonaws.com port=5432 user=yyy password=zzz sslmode=require&#34;</span>
Connection URL:
   postgres://yyy:zzz@ec2-xxx-xxx-xxx-xxx.compute-1.amazonaws.com:5432/xxx

% psql --dbname<span class="o">=</span>postgres://yyy:zzz@ec2-xxx-xxx-xxx-xxx.compute-1.amazonaws.com.com:5432/xxx
% psql --dbname<span class="o">=</span>xxx --host<span class="o">=</span>ec2-xxx-xxx-xxx-xxx.compute-1.amazonaws.com --port<span class="o">=</span><span class="m">5432</span> --username<span class="o">=</span>yyy --password
</code></pre></div><h2 id="クリーンアップ">クリーンアップ</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># Heroku Postgres Add-on のみ削除したい場合</span>
heroku addons:destroy heroku-postgresql:hobby-dev --app myapp

<span class="c1"># Heroku App ごと削除したい場合</span>
heroku apps:destroy --app myapp
</code></pre></div><hr>
<p>実行例</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">% heroku addons:destroy heroku-postgresql:hobby-dev --app fierce-depths-xxx
 ▸    WARNING: Destructive Action
 ▸    This <span class="nb">command</span> will affect the app fierce-depths-xxx
 ▸    To proceed, <span class="nb">type</span> fierce-depths-xxx or re-run this <span class="nb">command</span> with --confirm fierce-depths-xxx

&gt; fierce-depths-xxx
Destroying postgresql-concave-yyy on ⬢ fierce-depths-xxx... <span class="k">done</span>

% heroku apps:destroy --app fierce-depths-xxx
 ▸    WARNING: This will delete ⬢ fierce-depths-xxx including all add-ons.
 ▸    To proceed, <span class="nb">type</span> fierce-depths-xxx or re-run this <span class="nb">command</span> with --confirm fierce-depths-xxx

&gt; fierce-depths-xxx
Destroying ⬢ fierce-depths-xxx <span class="o">(</span>including all add-ons<span class="o">)</span>... <span class="k">done</span>
</code></pre></div><h2 id="この記事を試した環境">この記事を試した環境</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">% sw_vers
ProductName:    Mac OS X
ProductVersion: 10.15.7
BuildVersion:   19H114
% psql --version
psql <span class="o">(</span>PostgreSQL<span class="o">)</span> 13.1
% heroku --version
heroku/7.47.7 darwin-x64 node-v12.16.2
</code></pre></div>]]></content>
		</item>
		
		<item>
			<title>Playwright を golang から使う</title>
			<link>https://noid11.github.io/posts/hello-playwright-with-golang/</link>
			<pubDate>Tue, 12 Jan 2021 14:51:07 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/hello-playwright-with-golang/</guid>
			<description>&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://playwright.dev/&#34;&gt;playwright&lt;/a&gt; を Go で使える &lt;a href=&#34;https://github.com/mxschmitt/playwright-go&#34;&gt;playwright-go&lt;/a&gt; を動かしたメモ&lt;/li&gt;
&lt;li&gt;build したバイナリには Chromium などのエンジンは含まれず、バイナリ実行時にダウンロードが発生する
&lt;ul&gt;
&lt;li&gt;なのでクロスコンパイルして動かしても、バイナリを動かす環境にブラウザエンジンを動かす共有ライブラリが無い場合、ブラウザの起動に失敗してエラーとなる&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;</description>
			<content type="html"><![CDATA[<ul>
<li><a href="https://playwright.dev/">playwright</a> を Go で使える <a href="https://github.com/mxschmitt/playwright-go">playwright-go</a> を動かしたメモ</li>
<li>build したバイナリには Chromium などのエンジンは含まれず、バイナリ実行時にダウンロードが発生する
<ul>
<li>なのでクロスコンパイルして動かしても、バイナリを動かす環境にブラウザエンジンを動かす共有ライブラリが無い場合、ブラウザの起動に失敗してエラーとなる</li>
</ul>
</li>
</ul>
<h2 id="プロジェクトのセットアップ">プロジェクトのセットアップ</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># directory setup</span>
mkdir my-playwright-go <span class="o">&amp;&amp;</span> <span class="nb">cd</span> my-playwright-go

<span class="c1"># go modules setup</span>
go mod init my-playwright-go
go get github.com/mxschmitt/playwright-go

<span class="c1"># コード書くファイル作成</span>
touch main.go
</code></pre></div><h2 id="コードを書く">コードを書く</h2>
<ul>
<li><a href="https://news.ycombinator.com">https://news.ycombinator.com</a> にアクセスして各記事のタイトルを出力するコード</li>
<li><a href="https://github.com/mxschmitt/playwright-go/tree/master/examples">公式サンプルがいくつかある</a>ので、参考にすると良いかも</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;log&#34;</span>

	<span class="s">&#34;github.com/mxschmitt/playwright-go&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">pw</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">playwright</span><span class="p">.</span><span class="nf">Run</span><span class="p">()</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;could not start playwright: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="nx">browser</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">pw</span><span class="p">.</span><span class="nx">Chromium</span><span class="p">.</span><span class="nf">Launch</span><span class="p">()</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;could not launch browser: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="nx">page</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">browser</span><span class="p">.</span><span class="nf">NewPage</span><span class="p">()</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;could not create page: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">page</span><span class="p">.</span><span class="nf">Goto</span><span class="p">(</span><span class="s">&#34;https://news.ycombinator.com&#34;</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;could not goto: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="nx">entries</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">page</span><span class="p">.</span><span class="nf">QuerySelectorAll</span><span class="p">(</span><span class="s">&#34;.athing&#34;</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;could not get entries: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">entry</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">entries</span> <span class="p">{</span>
		<span class="nx">titleElement</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">entry</span><span class="p">.</span><span class="nf">QuerySelector</span><span class="p">(</span><span class="s">&#34;td.title &gt; a&#34;</span><span class="p">)</span>
		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;could not get title element: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
		<span class="p">}</span>
		<span class="nx">title</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">titleElement</span><span class="p">.</span><span class="nf">TextContent</span><span class="p">()</span>
		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;could not get text content: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
		<span class="p">}</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%d: %s\n&#34;</span><span class="p">,</span> <span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">title</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">browser</span><span class="p">.</span><span class="nf">Close</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;could not close browser: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">pw</span><span class="p">.</span><span class="nf">Stop</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;could not stop Playwright: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h2 id="動かす">動かす</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">go run main.go
</code></pre></div><h2 id="実行例">実行例</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">% go run main.go
2021/01/12 13:12:19 Downloading driver to /Users/myusername/Library/Caches/ms-playwright-go/0.171.0
2021/01/12 13:12:34 Downloaded driver successfully
2021/01/12 13:12:34 Downloading browsers...
2021/01/12 13:12:36 Downloaded browsers successfully
1: Theseus: A modern experimental OS written from scratch in Rust
2: Ubiquiti Networks Breach
3: Moderna is announcing three new vaccine programs. Seasonal flu, HIV, and Nipah
4: My ISP Is Killing My Idle SSH Sessions. Yours Might Be Too
5: Two Worlds: So Much Prosperity, So Much Skepticism
6: Simple Anomaly Detection Using Plain SQL
7: Steam<span class="s1">&#39;s login method is kinda interesting
</span><span class="s1">8: Europe Is Guaranteeing Citizens the Right to Repair
</span><span class="s1">9: What Is a Gamma Squeeze in the Context of Stock Trading?
</span><span class="s1">10: My personal wishlist for a decentralized social network
</span><span class="s1">11: Show HN: Symmetrical Drawing Tool for Doodling
</span><span class="s1">12: Sirum (YC W15 Nonprofit) hiring engineers to improve healthcare for families
</span><span class="s1">13: A bit on scaling chess.com&#39;</span>s database
14: Intruder at the top of the <span class="m">20</span> meter amateur band?
15: Superintelligence cannot be contained: Lessons from Computability Theory
16: Stealing Your Private YouTube Videos, One Frame at a Time
17: Sinovac<span class="s1">&#39;s vaccine efficacy less than 60% in Brazil trial -report
</span><span class="s1">18: Getting Ready for Launch
</span><span class="s1">19: Are Experts Real?
</span><span class="s1">20: Google Sued by YouTube Rival Rumble over Search Rankings
</span><span class="s1">21: OpenSocial Specification
</span><span class="s1">22: Is the Schrödinger Equation True?
</span><span class="s1">23: A 432-year-old manual on social distancing
</span><span class="s1">24: iPhone 7 with dead NAND netbooting unmodified Ubuntu 20.04 via USB ethernet
</span><span class="s1">25: We need a new media system
</span><span class="s1">26: XTerm: It&#39;</span>s Better Than You Thought
27: Invisible Internet Project <span class="o">(</span>I2P<span class="o">)</span>
28: A Brief History of Consumer Culture
29: How to Hear the ISS
30: Show HN: Thumbnail.ai – Just paste a blog post link and get a thumbnail
</code></pre></div><h2 id="この記事を試した環境">この記事を試した環境</h2>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% sw_vers
ProductName:    Mac OS X
ProductVersion: 10.15.7
BuildVersion:   19H114
% go version
go version go1.15.6 darwin/amd64
</code></pre></div><p>go.mod</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">module</span> <span class="nx">playwright</span><span class="o">-</span><span class="k">go</span>

<span class="k">go</span> <span class="mf">1.15</span>

<span class="nf">require</span> <span class="p">(</span>
	<span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">mxschmitt</span><span class="o">/</span><span class="nx">playwright</span><span class="o">-</span><span class="k">go</span> <span class="nx">v0</span><span class="mf">.171.1</span> <span class="c1">// indirect
</span><span class="c1"></span><span class="p">)</span>
</code></pre></div><p>go.sum</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">danwakefield</span><span class="o">/</span><span class="nx">fnmatch</span> <span class="nx">v0</span><span class="mf">.0.0</span><span class="o">-</span><span class="mi">20160403171240</span><span class="o">-</span><span class="nx">cbb64ac3d964</span> <span class="nx">h1</span><span class="p">:</span><span class="nx">y5HC9v93H5EPKqaS1UYVg1uYah5Xf51mBfIoWehClUQ</span><span class="p">=</span>
<span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">danwakefield</span><span class="o">/</span><span class="nx">fnmatch</span> <span class="nx">v0</span><span class="mf">.0.0</span><span class="o">-</span><span class="mi">20160403171240</span><span class="o">-</span><span class="nx">cbb64ac3d964</span><span class="o">/</span><span class="k">go</span><span class="p">.</span><span class="nx">mod</span> <span class="nx">h1</span><span class="p">:</span><span class="nx">Xd9hchkHSWYkEqJwUGisez3G1QY8Ryz0sdWrLPMGjLk</span><span class="p">=</span>
<span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">davecgh</span><span class="o">/</span><span class="k">go</span><span class="o">-</span><span class="nx">spew</span> <span class="nx">v1</span><span class="mf">.1.0</span><span class="o">/</span><span class="k">go</span><span class="p">.</span><span class="nx">mod</span> <span class="nx">h1</span><span class="p">:</span><span class="nx">J7Y8YcW2NihsgmVo</span><span class="o">/</span><span class="nx">mv3lAwl</span><span class="o">/</span><span class="nx">skON4iLHjSsI</span><span class="o">+</span><span class="nx">c5H38</span><span class="p">=</span>
<span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">davecgh</span><span class="o">/</span><span class="k">go</span><span class="o">-</span><span class="nx">spew</span> <span class="nx">v1</span><span class="mf">.1.1</span> <span class="nx">h1</span><span class="p">:</span><span class="nx">vj9j</span><span class="o">/</span><span class="nx">u1bqnvCEfJOwUhtlOARqs3</span><span class="o">+</span><span class="nx">rkHYY13jYWTU97c</span><span class="p">=</span>
<span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">davecgh</span><span class="o">/</span><span class="k">go</span><span class="o">-</span><span class="nx">spew</span> <span class="nx">v1</span><span class="mf">.1.1</span><span class="o">/</span><span class="k">go</span><span class="p">.</span><span class="nx">mod</span> <span class="nx">h1</span><span class="p">:</span><span class="nx">J7Y8YcW2NihsgmVo</span><span class="o">/</span><span class="nx">mv3lAwl</span><span class="o">/</span><span class="nx">skON4iLHjSsI</span><span class="o">+</span><span class="nx">c5H38</span><span class="p">=</span>
<span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">gorilla</span><span class="o">/</span><span class="nx">websocket</span> <span class="nx">v1</span><span class="mf">.4.2</span><span class="o">/</span><span class="k">go</span><span class="p">.</span><span class="nx">mod</span> <span class="nx">h1</span><span class="p">:</span><span class="nx">YR8l580nyteQvAITg2hZ9XVh4b55</span><span class="o">+</span><span class="nx">EU</span><span class="o">/</span><span class="nx">adAjf1fMHhE</span><span class="p">=</span>
<span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">h2non</span><span class="o">/</span><span class="nx">filetype</span> <span class="nx">v1</span><span class="mf">.1.0</span><span class="o">/</span><span class="k">go</span><span class="p">.</span><span class="nx">mod</span> <span class="nx">h1</span><span class="p">:</span><span class="mi">319</span><span class="nx">b3zT68BvV</span><span class="o">+</span><span class="nx">WRj7cwy856M2ehB3HqNOt6sy1HndBY</span><span class="p">=</span>
<span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">mxschmitt</span><span class="o">/</span><span class="nx">playwright</span><span class="o">-</span><span class="k">go</span> <span class="nx">v0</span><span class="mf">.171.1</span> <span class="nx">h1</span><span class="p">:</span><span class="mh">0XE</span><span class="nx">OVQw8Zse</span><span class="o">+</span><span class="nx">Zue</span><span class="o">+</span><span class="nx">d7v8O</span><span class="o">+</span><span class="nx">IfQnFIilWcK</span><span class="o">/</span><span class="nx">uOGSo0U9Q</span><span class="p">=</span>
<span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">mxschmitt</span><span class="o">/</span><span class="nx">playwright</span><span class="o">-</span><span class="k">go</span> <span class="nx">v0</span><span class="mf">.171.1</span><span class="o">/</span><span class="k">go</span><span class="p">.</span><span class="nx">mod</span> <span class="nx">h1</span><span class="p">:</span><span class="nx">a3SD3v</span><span class="o">+</span><span class="mi">56</span><span class="nx">XMA0sDDxXJXy</span><span class="o">+</span><span class="nx">QGnCfXrNZ</span><span class="o">/+</span><span class="mi">4</span><span class="nx">gwR5ioSgU</span><span class="p">=</span>
<span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">pmezard</span><span class="o">/</span><span class="k">go</span><span class="o">-</span><span class="nx">difflib</span> <span class="nx">v1</span><span class="mf">.0.0</span> <span class="nx">h1</span><span class="p">:</span><span class="mi">4</span><span class="nx">DBwDE0NGyQoBHbLQYPwSUPoCMWR5BEzIk</span><span class="o">/</span><span class="nx">f1lZbAQM</span><span class="p">=</span>
<span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">pmezard</span><span class="o">/</span><span class="k">go</span><span class="o">-</span><span class="nx">difflib</span> <span class="nx">v1</span><span class="mf">.0.0</span><span class="o">/</span><span class="k">go</span><span class="p">.</span><span class="nx">mod</span> <span class="nx">h1</span><span class="p">:</span><span class="nx">iKH77koFhYxTK1pcRnkKkqfTogsbg7gZNVY4sRDYZ</span><span class="o">/</span><span class="mi">4</span><span class="p">=</span>
<span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">stretchr</span><span class="o">/</span><span class="nx">objx</span> <span class="nx">v0</span><span class="mf">.1.0</span><span class="o">/</span><span class="k">go</span><span class="p">.</span><span class="nx">mod</span> <span class="nx">h1</span><span class="p">:</span><span class="nx">HFkY916IF</span><span class="o">+</span><span class="nx">rwdDfMAkV7OtwuqBVzrE8GR6GFx</span><span class="o">+</span><span class="nx">wExME</span><span class="p">=</span>
<span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">stretchr</span><span class="o">/</span><span class="nx">testify</span> <span class="nx">v1</span><span class="mf">.6.1</span> <span class="nx">h1</span><span class="p">:</span><span class="nx">hDPOHmpOpP40lSULcqw7IrRb</span><span class="o">/</span><span class="nx">u7w6RpDC9399XyoNd0</span><span class="p">=</span>
<span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">stretchr</span><span class="o">/</span><span class="nx">testify</span> <span class="nx">v1</span><span class="mf">.6.1</span><span class="o">/</span><span class="k">go</span><span class="p">.</span><span class="nx">mod</span> <span class="nx">h1</span><span class="p">:</span><span class="mi">6</span><span class="nx">Fq8oRcR53rry900zMqJjRRixrwX3KX962</span><span class="o">/</span><span class="nx">h</span><span class="o">/</span><span class="nx">Wwjteg</span><span class="p">=</span>
<span class="nx">gopkg</span><span class="p">.</span><span class="nx">in</span><span class="o">/</span><span class="nx">check</span><span class="p">.</span><span class="nx">v1</span> <span class="nx">v0</span><span class="mf">.0.0</span><span class="o">-</span><span class="mi">20161208181325</span><span class="o">-</span><span class="mi">20</span><span class="nx">d25e280405</span><span class="o">/</span><span class="k">go</span><span class="p">.</span><span class="nx">mod</span> <span class="nx">h1</span><span class="p">:</span><span class="nx">Co6ibVJAznAaIkqp8huTwlJQCZ016jof</span><span class="o">/</span><span class="nx">cbN4VW5Yz0</span><span class="p">=</span>
<span class="nx">gopkg</span><span class="p">.</span><span class="nx">in</span><span class="o">/</span><span class="nx">square</span><span class="o">/</span><span class="k">go</span><span class="o">-</span><span class="nx">jose</span><span class="p">.</span><span class="nx">v2</span> <span class="nx">v2</span><span class="mf">.5.1</span> <span class="nx">h1</span><span class="p">:</span><span class="mi">7</span><span class="nx">odma5RETjNHWJnR32wx8t</span><span class="o">+</span><span class="nx">Io4djHE1PqxCFx3iiZ2w</span><span class="p">=</span>
<span class="nx">gopkg</span><span class="p">.</span><span class="nx">in</span><span class="o">/</span><span class="nx">square</span><span class="o">/</span><span class="k">go</span><span class="o">-</span><span class="nx">jose</span><span class="p">.</span><span class="nx">v2</span> <span class="nx">v2</span><span class="mf">.5.1</span><span class="o">/</span><span class="k">go</span><span class="p">.</span><span class="nx">mod</span> <span class="nx">h1</span><span class="p">:</span><span class="nx">M9dMgbHiYLoDGQrXy7OpJDJWiKiU</span><span class="c1">//h+vD76mk0e1AI=
</span><span class="c1"></span><span class="nx">gopkg</span><span class="p">.</span><span class="nx">in</span><span class="o">/</span><span class="nx">yaml</span><span class="p">.</span><span class="nx">v3</span> <span class="nx">v3</span><span class="mf">.0.0</span><span class="o">-</span><span class="mi">20200313102051</span><span class="o">-</span><span class="mi">9</span><span class="nx">f266ea9e77c</span><span class="o">/</span><span class="k">go</span><span class="p">.</span><span class="nx">mod</span> <span class="nx">h1</span><span class="p">:</span><span class="nx">K4uyk7z7BCEPqu6E</span><span class="o">+</span><span class="nx">C64Yfv1cQ7kz7rIZviUmN</span><span class="o">+</span><span class="nx">EgEM</span><span class="p">=</span>
</code></pre></div>]]></content>
		</item>
		
		<item>
			<title>Playwright を TypeScript で動かすまで</title>
			<link>https://noid11.github.io/posts/hello-playwright-with-typescript/</link>
			<pubDate>Tue, 12 Jan 2021 12:39:32 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/hello-playwright-with-typescript/</guid>
			<description>&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://playwright.dev/&#34;&gt;Playwright&lt;/a&gt; は Microsoft 製のブラウザ自動化ツール
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.chromium.org/&#34;&gt;Chromium&lt;/a&gt;, &lt;a href=&#34;https://www.mozilla.org/en-US/firefox/&#34;&gt;Firefox&lt;/a&gt;, &lt;a href=&#34;https://webkit.org/&#34;&gt;WebKit&lt;/a&gt; に対応している&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://playwright.dev/docs/docker/README/&#34;&gt;公式 Docker イメージ&lt;/a&gt;も提供されている&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;組み込みで TypeScript をサポートしているとあったので、最低限動かす所まで試したメモ&lt;/li&gt;
&lt;/ul&gt;</description>
			<content type="html"><![CDATA[<ul>
<li><a href="https://playwright.dev/">Playwright</a> は Microsoft 製のブラウザ自動化ツール
<ul>
<li><a href="https://www.chromium.org/">Chromium</a>, <a href="https://www.mozilla.org/en-US/firefox/">Firefox</a>, <a href="https://webkit.org/">WebKit</a> に対応している</li>
<li><a href="https://playwright.dev/docs/docker/README/">公式 Docker イメージ</a>も提供されている</li>
</ul>
</li>
<li>組み込みで TypeScript をサポートしているとあったので、最低限動かす所まで試したメモ</li>
</ul>
<h2 id="プロジェクトのセットアップ">プロジェクトのセットアップ</h2>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">mkdir my-playwright-project <span class="o">&amp;&amp;</span> <span class="nb">cd</span> my-playwright-project

<span class="c1"># npm 初期化 </span>
npm init --yes

<span class="c1"># playwright のインストール</span>
<span class="c1">#   公式では --save-dev オプションを使っているが、不要な気がする・・・と思ったが E2E などのテスト目的で使う場合には --save-dev 使うべきだった</span>
<span class="c1">#   chromium, firefox, webkit がダウンロードされ、 300 MB 程度のトラフィックが発生するので注意</span>
npm install playwright

<span class="c1"># typescript セットアップ</span>
npm install --save-dev typescript @types/node@12 ts-node
npx tsc --init

<span class="c1"># コードを書いていく</span>
touch main.ts
</code></pre></div><h2 id="ミニマムなコード実装">ミニマムなコード実装</h2>
<div class="highlight"><pre class="chroma"><code class="language-ts" data-lang="ts"><span class="kr">import</span> <span class="p">{</span> <span class="nx">webkit</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;playwright&#39;</span>

<span class="p">(</span><span class="kr">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">browser</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">webkit</span><span class="p">.</span><span class="nx">launch</span><span class="p">()</span>
  <span class="kr">const</span> <span class="nx">page</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">newPage</span><span class="p">()</span>
  <span class="k">await</span> <span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="s1">&#39;http://whatsmyuseragent.org/&#39;</span><span class="p">)</span>
  <span class="k">await</span> <span class="nx">page</span><span class="p">.</span><span class="nx">screenshot</span><span class="p">({</span> <span class="nx">path</span><span class="o">:</span> <span class="sb">`example.png`</span> <span class="p">})</span>
  <span class="k">await</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
<span class="p">})()</span>
</code></pre></div><h2 id="コード実行">コード実行</h2>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">npx ts-node main.ts
</code></pre></div><ul>
<li>同じディレクトリに <a href="http://whatsmyuseragent.org/">http://whatsmyuseragent.org/</a> にアクセスしたスクリーンショットが example.png として保存されれば OK</li>
<li>上記コードの場合 User-Agent が WebKit になる</li>
</ul>
<h2 id="useful-links">Useful Links</h2>
<p>CLI Commands | npm Docs<br>
<a href="https://docs.npmjs.com/cli/v6/commands">https://docs.npmjs.com/cli/v6/commands</a></p>
<p>Getting Started | Playwright<br>
<a href="https://playwright.dev/docs/intro">https://playwright.dev/docs/intro</a></p>
<p>TypeScript: The starting point for learning TypeScript<br>
<a href="https://www.typescriptlang.org/docs">https://www.typescriptlang.org/docs</a></p>
<h2 id="この記事を試した環境">この記事を試した環境</h2>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% sw_vers
ProductName:    Mac OS X
ProductVersion: 10.15.7
BuildVersion:   19H114
% node -v
v12.16.1
% npm -v
6.14.8
</code></pre></div><p>package.json</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;my-playwright-project&#34;</span><span class="p">,</span>
  <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1.0.0&#34;</span><span class="p">,</span>
  <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
  <span class="nt">&#34;main&#34;</span><span class="p">:</span> <span class="s2">&#34;index.js&#34;</span><span class="p">,</span>
  <span class="nt">&#34;scripts&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;test&#34;</span><span class="p">:</span> <span class="s2">&#34;echo \&#34;Error: no test specified\&#34; &amp;&amp; exit 1&#34;</span>
  <span class="p">},</span>
  <span class="nt">&#34;keywords&#34;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="nt">&#34;author&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
  <span class="nt">&#34;license&#34;</span><span class="p">:</span> <span class="s2">&#34;ISC&#34;</span><span class="p">,</span>
  <span class="nt">&#34;dependencies&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;playwright&#34;</span><span class="p">:</span> <span class="s2">&#34;^1.7.1&#34;</span>
  <span class="p">},</span>
  <span class="nt">&#34;devDependencies&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;@types/node&#34;</span><span class="p">:</span> <span class="s2">&#34;^12.19.12&#34;</span><span class="p">,</span>
    <span class="nt">&#34;ts-node&#34;</span><span class="p">:</span> <span class="s2">&#34;^9.1.1&#34;</span><span class="p">,</span>
    <span class="nt">&#34;typescript&#34;</span><span class="p">:</span> <span class="s2">&#34;^4.1.3&#34;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>package-lock.json</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;my-playwright-project&#34;</span><span class="p">,</span>
  <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1.0.0&#34;</span><span class="p">,</span>
  <span class="nt">&#34;lockfileVersion&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nt">&#34;requires&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nt">&#34;dependencies&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;@types/node&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;12.19.12&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/@types/node/-/node-12.19.12.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-UwfL2uIU9arX/+/PRcIkT08/iBadGN2z6ExOROA2Dh5mAuWTBj6iJbQX4nekiV5H8cTrEG569LeX+HRco9Cbxw==&#34;</span>
    <span class="p">},</span>
    <span class="nt">&#34;@types/yauzl&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;2.9.1&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/@types/yauzl/-/yauzl-2.9.1.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-A1b8SU4D10uoPjwb0lnHmmu8wZhR9d+9o2PKBQT2jU5YPTKsxac6M2qGAdY7VcL+dHHhARVUDmeg0rOrcd9EjA==&#34;</span><span class="p">,</span>
      <span class="nt">&#34;optional&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="nt">&#34;requires&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;@types/node&#34;</span><span class="p">:</span> <span class="s2">&#34;*&#34;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&#34;agent-base&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;6.0.2&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/agent-base/-/agent-base-6.0.2.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-RZNwNclF7+MS/8bDg70amg32dyeZGZxiDuQmZxKLAlQjr3jGyLx+4Kkk58UO7D2QdgFIQCovuSuZESne6RG6XQ==&#34;</span><span class="p">,</span>
      <span class="nt">&#34;requires&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;debug&#34;</span><span class="p">:</span> <span class="s2">&#34;4&#34;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&#34;arg&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;4.1.3&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/arg/-/arg-4.1.3.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-58S9QDqG0Xx27YwPSt9fJxivjYl432YCwfDMfZ+71RAqUrZef7LrKQZ3LHLOwCS4FLNBplP533Zx895SeOCHvA==&#34;</span><span class="p">,</span>
      <span class="nt">&#34;dev&#34;</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="nt">&#34;balanced-match&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1.0.0&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/balanced-match/-/balanced-match-1.0.0.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha1-ibTRmasr7kneFk6gK4nORi1xt2c=&#34;</span>
    <span class="p">},</span>
    <span class="nt">&#34;brace-expansion&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1.1.11&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/brace-expansion/-/brace-expansion-1.1.11.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-iCuPHDFgrHX7H2vEI/5xpz07zSHB00TpugqhmYtVmMO6518mCuRMoOYFldEBl0g187ufozdaHgWKcYFb61qGiA==&#34;</span><span class="p">,</span>
      <span class="nt">&#34;requires&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;balanced-match&#34;</span><span class="p">:</span> <span class="s2">&#34;^1.0.0&#34;</span><span class="p">,</span>
        <span class="nt">&#34;concat-map&#34;</span><span class="p">:</span> <span class="s2">&#34;0.0.1&#34;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&#34;buffer-crc32&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;0.2.13&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/buffer-crc32/-/buffer-crc32-0.2.13.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha1-DTM+PwDqxQqhRUq9MO+MKl2ackI=&#34;</span>
    <span class="p">},</span>
    <span class="nt">&#34;buffer-from&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1.1.1&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/buffer-from/-/buffer-from-1.1.1.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-MQcXEUbCKtEo7bhqEs6560Hyd4XaovZlO/k9V3hjVUF/zwW7KBVdSK4gIt/bzwS9MbR5qob+F5jusZsb0YQK2A==&#34;</span><span class="p">,</span>
      <span class="nt">&#34;dev&#34;</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="nt">&#34;concat-map&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;0.0.1&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/concat-map/-/concat-map-0.0.1.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha1-2Klr13/Wjfd5OnMDajug1UBdR3s=&#34;</span>
    <span class="p">},</span>
    <span class="nt">&#34;create-require&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1.1.1&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/create-require/-/create-require-1.1.1.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-dcKFX3jn0MpIaXjisoRvexIJVEKzaq7z2rZKxf+MSr9TkdmHmsU4m2lcLojrj/FHl8mk5VxMmYA+ftRkP/3oKQ==&#34;</span><span class="p">,</span>
      <span class="nt">&#34;dev&#34;</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="nt">&#34;debug&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;4.3.1&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/debug/-/debug-4.3.1.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-doEwdvm4PCeK4K3RQN2ZC2BYUBaxwLARCqZmMjtF8a51J2Rb0xpVloFRnCODwqjpwnAoao4pelN8l3RJdv3gRQ==&#34;</span><span class="p">,</span>
      <span class="nt">&#34;requires&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;ms&#34;</span><span class="p">:</span> <span class="s2">&#34;2.1.2&#34;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&#34;diff&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;4.0.2&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/diff/-/diff-4.0.2.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-58lmxKSA4BNyLz+HHMUzlOEpg09FV+ev6ZMe3vJihgdxzgcwZ8VoEEPmALCZG9LmqfVoNMMKpttIYTVG6uDY7A==&#34;</span><span class="p">,</span>
      <span class="nt">&#34;dev&#34;</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="nt">&#34;end-of-stream&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1.4.4&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/end-of-stream/-/end-of-stream-1.4.4.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-+uw1inIHVPQoaVuHzRyXd21icM+cnt4CzD5rW+NC1wjOUSTOs+Te7FOv7AhN7vS9x/oIyhLP5PR1H+phQAHu5Q==&#34;</span><span class="p">,</span>
      <span class="nt">&#34;requires&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;once&#34;</span><span class="p">:</span> <span class="s2">&#34;^1.4.0&#34;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&#34;extract-zip&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;2.0.1&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/extract-zip/-/extract-zip-2.0.1.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-GDhU9ntwuKyGXdZBUgTIe+vXnWj0fppUEtMDL0+idd5Sta8TGpHssn/eusA9mrPr9qNDym6SxAYZjNvCn/9RBg==&#34;</span><span class="p">,</span>
      <span class="nt">&#34;requires&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;@types/yauzl&#34;</span><span class="p">:</span> <span class="s2">&#34;^2.9.1&#34;</span><span class="p">,</span>
        <span class="nt">&#34;debug&#34;</span><span class="p">:</span> <span class="s2">&#34;^4.1.1&#34;</span><span class="p">,</span>
        <span class="nt">&#34;get-stream&#34;</span><span class="p">:</span> <span class="s2">&#34;^5.1.0&#34;</span><span class="p">,</span>
        <span class="nt">&#34;yauzl&#34;</span><span class="p">:</span> <span class="s2">&#34;^2.10.0&#34;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&#34;fd-slicer&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1.1.0&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/fd-slicer/-/fd-slicer-1.1.0.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha1-JcfInLH5B3+IkbvmHY85Dq4lbx4=&#34;</span><span class="p">,</span>
      <span class="nt">&#34;requires&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;pend&#34;</span><span class="p">:</span> <span class="s2">&#34;~1.2.0&#34;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&#34;fs.realpath&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1.0.0&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/fs.realpath/-/fs.realpath-1.0.0.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha1-FQStJSMVjKpA20onh8sBQRmU6k8=&#34;</span>
    <span class="p">},</span>
    <span class="nt">&#34;get-stream&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;5.2.0&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/get-stream/-/get-stream-5.2.0.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-nBF+F1rAZVCu/p7rjzgA+Yb4lfYXrpl7a6VmJrU8wF9I1CKvP/QwPNZHnOlwbTkY6dvtFIzFMSyQXbLoTQPRpA==&#34;</span><span class="p">,</span>
      <span class="nt">&#34;requires&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;pump&#34;</span><span class="p">:</span> <span class="s2">&#34;^3.0.0&#34;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&#34;glob&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;7.1.6&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/glob/-/glob-7.1.6.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-LwaxwyZ72Lk7vZINtNNrywX0ZuLyStrdDtabefZKAY5ZGJhVtgdznluResxNmPitE0SAO+O26sWTHeKSI2wMBA==&#34;</span><span class="p">,</span>
      <span class="nt">&#34;requires&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;fs.realpath&#34;</span><span class="p">:</span> <span class="s2">&#34;^1.0.0&#34;</span><span class="p">,</span>
        <span class="nt">&#34;inflight&#34;</span><span class="p">:</span> <span class="s2">&#34;^1.0.4&#34;</span><span class="p">,</span>
        <span class="nt">&#34;inherits&#34;</span><span class="p">:</span> <span class="s2">&#34;2&#34;</span><span class="p">,</span>
        <span class="nt">&#34;minimatch&#34;</span><span class="p">:</span> <span class="s2">&#34;^3.0.4&#34;</span><span class="p">,</span>
        <span class="nt">&#34;once&#34;</span><span class="p">:</span> <span class="s2">&#34;^1.3.0&#34;</span><span class="p">,</span>
        <span class="nt">&#34;path-is-absolute&#34;</span><span class="p">:</span> <span class="s2">&#34;^1.0.0&#34;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&#34;graceful-fs&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;4.2.4&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/graceful-fs/-/graceful-fs-4.2.4.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-WjKPNJF79dtJAVniUlGGWHYGz2jWxT6VhN/4m1NdkbZ2nOsEF+cI1Edgql5zCRhs/VsQYRvrXctxktVXZUkixw==&#34;</span>
    <span class="p">},</span>
    <span class="nt">&#34;https-proxy-agent&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;5.0.0&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/https-proxy-agent/-/https-proxy-agent-5.0.0.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-EkYm5BcKUGiduxzSt3Eppko+PiNWNEpa4ySk9vTC6wDsQJW9rHSa+UhGNJoRYp7bz6Ht1eaRIa6QaJqO5rCFbA==&#34;</span><span class="p">,</span>
      <span class="nt">&#34;requires&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;agent-base&#34;</span><span class="p">:</span> <span class="s2">&#34;6&#34;</span><span class="p">,</span>
        <span class="nt">&#34;debug&#34;</span><span class="p">:</span> <span class="s2">&#34;4&#34;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&#34;inflight&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1.0.6&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/inflight/-/inflight-1.0.6.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha1-Sb1jMdfQLQwJvJEKEHW6gWW1bfk=&#34;</span><span class="p">,</span>
      <span class="nt">&#34;requires&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;once&#34;</span><span class="p">:</span> <span class="s2">&#34;^1.3.0&#34;</span><span class="p">,</span>
        <span class="nt">&#34;wrappy&#34;</span><span class="p">:</span> <span class="s2">&#34;1&#34;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&#34;inherits&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;2.0.4&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/inherits/-/inherits-2.0.4.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-k/vGaX4/Yla3WzyMCvTQOXYeIHvqOKtnqBduzTHpzpQZzAskKMhZ2K+EnBiSM9zGSoIFeMpXKxa4dYeZIQqewQ==&#34;</span>
    <span class="p">},</span>
    <span class="nt">&#34;jpeg-js&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;0.4.3&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/jpeg-js/-/jpeg-js-0.4.3.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-ru1HWKek8octvUHFHvE5ZzQ1yAsJmIvRdGWvSoKV52XKyuyYA437QWDttXT8eZXDSbuMpHlLzPDZUPd6idIz+Q==&#34;</span>
    <span class="p">},</span>
    <span class="nt">&#34;make-error&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1.3.6&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/make-error/-/make-error-1.3.6.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-s8UhlNe7vPKomQhC1qFelMokr/Sc3AgNbso3n74mVPA5LTZwkB9NlXf4XPamLxJE8h0gh73rM94xvwRT2CVInw==&#34;</span><span class="p">,</span>
      <span class="nt">&#34;dev&#34;</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="nt">&#34;mime&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;2.4.7&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/mime/-/mime-2.4.7.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-dhNd1uA2u397uQk3Nv5LM4lm93WYDUXFn3Fu291FJerns4jyTudqhIWe4W04YLy7Uk1tm1Ore04NpjRvQp/NPA==&#34;</span>
    <span class="p">},</span>
    <span class="nt">&#34;minimatch&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;3.0.4&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/minimatch/-/minimatch-3.0.4.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-yJHVQEhyqPLUTgt9B83PXu6W3rx4MvvHvSUvToogpwoGDOUQ+yDrR0HRot+yOCdCO7u4hX3pWft6kWBBcqh0UA==&#34;</span><span class="p">,</span>
      <span class="nt">&#34;requires&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;brace-expansion&#34;</span><span class="p">:</span> <span class="s2">&#34;^1.1.7&#34;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&#34;ms&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;2.1.2&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/ms/-/ms-2.1.2.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-sGkPx+VjMtmA6MX27oA4FBFELFCZZ4S4XqeGOXCv68tT+jb3vk/RyaKWP0PTKyWtmLSM0b+adUTEvbs1PEaH2w==&#34;</span>
    <span class="p">},</span>
    <span class="nt">&#34;once&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1.4.0&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/once/-/once-1.4.0.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha1-WDsap3WWHUsROsF9nFC6753Xa9E=&#34;</span><span class="p">,</span>
      <span class="nt">&#34;requires&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;wrappy&#34;</span><span class="p">:</span> <span class="s2">&#34;1&#34;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&#34;path-is-absolute&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1.0.1&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/path-is-absolute/-/path-is-absolute-1.0.1.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha1-F0uSaHNVNP+8es5r9TpanhtcX18=&#34;</span>
    <span class="p">},</span>
    <span class="nt">&#34;pend&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1.2.0&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/pend/-/pend-1.2.0.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha1-elfrVQpng/kRUzH89GY9XI4AelA=&#34;</span>
    <span class="p">},</span>
    <span class="nt">&#34;playwright&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1.7.1&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/playwright/-/playwright-1.7.1.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-dOSWME42wDedJ/PXv8k0zG0Kxd6d6R2OKA51/05++Z2ISdA4N58gHlWqlVKPDkBog1MI6lu/KNt7QDn19AybWQ==&#34;</span><span class="p">,</span>
      <span class="nt">&#34;requires&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;debug&#34;</span><span class="p">:</span> <span class="s2">&#34;^4.1.1&#34;</span><span class="p">,</span>
        <span class="nt">&#34;extract-zip&#34;</span><span class="p">:</span> <span class="s2">&#34;^2.0.1&#34;</span><span class="p">,</span>
        <span class="nt">&#34;https-proxy-agent&#34;</span><span class="p">:</span> <span class="s2">&#34;^5.0.0&#34;</span><span class="p">,</span>
        <span class="nt">&#34;jpeg-js&#34;</span><span class="p">:</span> <span class="s2">&#34;^0.4.2&#34;</span><span class="p">,</span>
        <span class="nt">&#34;mime&#34;</span><span class="p">:</span> <span class="s2">&#34;^2.4.6&#34;</span><span class="p">,</span>
        <span class="nt">&#34;pngjs&#34;</span><span class="p">:</span> <span class="s2">&#34;^5.0.0&#34;</span><span class="p">,</span>
        <span class="nt">&#34;progress&#34;</span><span class="p">:</span> <span class="s2">&#34;^2.0.3&#34;</span><span class="p">,</span>
        <span class="nt">&#34;proper-lockfile&#34;</span><span class="p">:</span> <span class="s2">&#34;^4.1.1&#34;</span><span class="p">,</span>
        <span class="nt">&#34;proxy-from-env&#34;</span><span class="p">:</span> <span class="s2">&#34;^1.1.0&#34;</span><span class="p">,</span>
        <span class="nt">&#34;rimraf&#34;</span><span class="p">:</span> <span class="s2">&#34;^3.0.2&#34;</span><span class="p">,</span>
        <span class="nt">&#34;ws&#34;</span><span class="p">:</span> <span class="s2">&#34;^7.3.1&#34;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&#34;pngjs&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;5.0.0&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/pngjs/-/pngjs-5.0.0.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-40QW5YalBNfQo5yRYmiw7Yz6TKKVr3h6970B2YE+3fQpsWcrbj1PzJgxeJ19DRQjhMbKPIuMY8rFaXc8moolVw==&#34;</span>
    <span class="p">},</span>
    <span class="nt">&#34;progress&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;2.0.3&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/progress/-/progress-2.0.3.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-7PiHtLll5LdnKIMw100I+8xJXR5gW2QwWYkT6iJva0bXitZKa/XMrSbdmg3r2Xnaidz9Qumd0VPaMrZlF9V9sA==&#34;</span>
    <span class="p">},</span>
    <span class="nt">&#34;proper-lockfile&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;4.1.1&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/proper-lockfile/-/proper-lockfile-4.1.1.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-1w6rxXodisVpn7QYvLk706mzprPTAPCYAqxMvctmPN3ekuRk/kuGkGc82pangZiAt4R3lwSuUzheTTn0/Yb7Zg==&#34;</span><span class="p">,</span>
      <span class="nt">&#34;requires&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;graceful-fs&#34;</span><span class="p">:</span> <span class="s2">&#34;^4.1.11&#34;</span><span class="p">,</span>
        <span class="nt">&#34;retry&#34;</span><span class="p">:</span> <span class="s2">&#34;^0.12.0&#34;</span><span class="p">,</span>
        <span class="nt">&#34;signal-exit&#34;</span><span class="p">:</span> <span class="s2">&#34;^3.0.2&#34;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&#34;proxy-from-env&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1.1.0&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/proxy-from-env/-/proxy-from-env-1.1.0.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-D+zkORCbA9f1tdWRK0RaCR3GPv50cMxcrz4X8k5LTSUD1Dkw47mKJEZQNunItRTkWwgtaUSo1RVFRIG9ZXiFYg==&#34;</span>
    <span class="p">},</span>
    <span class="nt">&#34;pump&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;3.0.0&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/pump/-/pump-3.0.0.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-LwZy+p3SFs1Pytd/jYct4wpv49HiYCqd9Rlc5ZVdk0V+8Yzv6jR5Blk3TRmPL1ft69TxP0IMZGJ+WPFU2BFhww==&#34;</span><span class="p">,</span>
      <span class="nt">&#34;requires&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;end-of-stream&#34;</span><span class="p">:</span> <span class="s2">&#34;^1.1.0&#34;</span><span class="p">,</span>
        <span class="nt">&#34;once&#34;</span><span class="p">:</span> <span class="s2">&#34;^1.3.1&#34;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&#34;retry&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;0.12.0&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/retry/-/retry-0.12.0.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha1-G0KmJmoh8HQh0bC1S33BZ7AcATs=&#34;</span>
    <span class="p">},</span>
    <span class="nt">&#34;rimraf&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;3.0.2&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/rimraf/-/rimraf-3.0.2.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-JZkJMZkAGFFPP2YqXZXPbMlMBgsxzE8ILs4lMIX/2o0L9UBw9O/Y3o6wFw/i9YLapcUJWwqbi3kdxIPdC62TIA==&#34;</span><span class="p">,</span>
      <span class="nt">&#34;requires&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;glob&#34;</span><span class="p">:</span> <span class="s2">&#34;^7.1.3&#34;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&#34;signal-exit&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;3.0.3&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/signal-exit/-/signal-exit-3.0.3.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-VUJ49FC8U1OxwZLxIbTTrDvLnf/6TDgxZcK8wxR8zs13xpx7xbG60ndBlhNrFi2EMuFRoeDoJO7wthSLq42EjA==&#34;</span>
    <span class="p">},</span>
    <span class="nt">&#34;source-map&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;0.6.1&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/source-map/-/source-map-0.6.1.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-UjgapumWlbMhkBgzT7Ykc5YXUT46F0iKu8SGXq0bcwP5dz/h0Plj6enJqjz1Zbq2l5WaqYnrVbwWOWMyF3F47g==&#34;</span><span class="p">,</span>
      <span class="nt">&#34;dev&#34;</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="nt">&#34;source-map-support&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;0.5.19&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/source-map-support/-/source-map-support-0.5.19.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-Wonm7zOCIJzBGQdB+thsPar0kYuCIzYvxZwlBa87yi/Mdjv7Tip2cyVbLj5o0cFPN4EVkuTwb3GDDyUx2DGnGw==&#34;</span><span class="p">,</span>
      <span class="nt">&#34;dev&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="nt">&#34;requires&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;buffer-from&#34;</span><span class="p">:</span> <span class="s2">&#34;^1.0.0&#34;</span><span class="p">,</span>
        <span class="nt">&#34;source-map&#34;</span><span class="p">:</span> <span class="s2">&#34;^0.6.0&#34;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&#34;ts-node&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;9.1.1&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/ts-node/-/ts-node-9.1.1.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-hPlt7ZACERQGf03M253ytLY3dHbGNGrAq9qIHWUY9XHYl1z7wYngSr3OQ5xmui8o2AaxsONxIzjafLUiWBo1Fg==&#34;</span><span class="p">,</span>
      <span class="nt">&#34;dev&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="nt">&#34;requires&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;arg&#34;</span><span class="p">:</span> <span class="s2">&#34;^4.1.0&#34;</span><span class="p">,</span>
        <span class="nt">&#34;create-require&#34;</span><span class="p">:</span> <span class="s2">&#34;^1.1.0&#34;</span><span class="p">,</span>
        <span class="nt">&#34;diff&#34;</span><span class="p">:</span> <span class="s2">&#34;^4.0.1&#34;</span><span class="p">,</span>
        <span class="nt">&#34;make-error&#34;</span><span class="p">:</span> <span class="s2">&#34;^1.1.1&#34;</span><span class="p">,</span>
        <span class="nt">&#34;source-map-support&#34;</span><span class="p">:</span> <span class="s2">&#34;^0.5.17&#34;</span><span class="p">,</span>
        <span class="nt">&#34;yn&#34;</span><span class="p">:</span> <span class="s2">&#34;3.1.1&#34;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&#34;typescript&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;4.1.3&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/typescript/-/typescript-4.1.3.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-B3ZIOf1IKeH2ixgHhj6la6xdwR9QrLC5d1VKeCSY4tvkqhF2eqd9O7txNlS0PO3GrBAFIdr3L1ndNwteUbZLYg==&#34;</span><span class="p">,</span>
      <span class="nt">&#34;dev&#34;</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="nt">&#34;wrappy&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1.0.2&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/wrappy/-/wrappy-1.0.2.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha1-tSQ9jz7BqjXxNkYFvA0QNuMKtp8=&#34;</span>
    <span class="p">},</span>
    <span class="nt">&#34;ws&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;7.4.2&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/ws/-/ws-7.4.2.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-T4tewALS3+qsrpGI/8dqNMLIVdq/g/85U98HPMa6F0m6xTbvhXU6RCQLqPH3+SlomNV/LdY6RXEbBpMH6EOJnA==&#34;</span>
    <span class="p">},</span>
    <span class="nt">&#34;yauzl&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;2.10.0&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/yauzl/-/yauzl-2.10.0.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha1-x+sXyT4RLLEIb6bY5R+wZnt5pfk=&#34;</span><span class="p">,</span>
      <span class="nt">&#34;requires&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;buffer-crc32&#34;</span><span class="p">:</span> <span class="s2">&#34;~0.2.3&#34;</span><span class="p">,</span>
        <span class="nt">&#34;fd-slicer&#34;</span><span class="p">:</span> <span class="s2">&#34;~1.1.0&#34;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&#34;yn&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;3.1.1&#34;</span><span class="p">,</span>
      <span class="nt">&#34;resolved&#34;</span><span class="p">:</span> <span class="s2">&#34;https://registry.npmjs.org/yn/-/yn-3.1.1.tgz&#34;</span><span class="p">,</span>
      <span class="nt">&#34;integrity&#34;</span><span class="p">:</span> <span class="s2">&#34;sha512-Ux4ygGWsu2c7isFWe8Yu1YluJmqVhxqK2cLXNQA5AcC3QfbGNpM7fu0Y8b/z16pXLnFxZYvWhd3fhBY9DLmC6Q==&#34;</span><span class="p">,</span>
      <span class="nt">&#34;dev&#34;</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>]]></content>
		</item>
		
		<item>
			<title>セキュリティを学ぶことでトラブルシューティング能力が向上する・・・気がする</title>
			<link>https://noid11.github.io/posts/learning-security-will-improve-troubleshooting-skills/</link>
			<pubDate>Sat, 09 Jan 2021 12:31:00 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/learning-security-will-improve-troubleshooting-skills/</guid>
			<description>&lt;p&gt;ポエム。&lt;/p&gt;</description>
			<content type="html"><![CDATA[<p>ポエム。</p>
<ul>
<li>セキュリティを学ぶということは、各種コンポーネントの役割や機能を把握しつつ、それらに関連してどのような問題が発生するのか把握することだと思う</li>
<li>何か問題が発生してトラブルシューティングをする際には、エスパー能力と言われたりする謎の原因推測能力によって仮説を立てて、検証を行うといった能力が重要になる場面がある
<ul>
<li>このエスパー能力はベテランエンジニア等が当たり前のように備えていたりするものの、具体的にどう取得すればよいのかは謎が多い</li>
<li>個人的には以下の2つがエスパー能力の下地になっていると思う
<ol>
<li>経験</li>
<li>引き出しの多さ</li>
</ol>
</li>
<li>経験については、どんな問題に遭遇して経験を積めるかは運だと思うので、あまり個人の努力によって得られるものではないと思う
<ul>
<li>色んな仕事や問題が体験出来そうな職場やチームに身を投じる・・・みたいなものはあるかもしれない</li>
</ul>
</li>
<li>引き出しの多さについては、わりかし個人の努力でカバーできる範囲のように思える
<ul>
<li>引き出しの多さというのは、ざっくばらんに言うと、関連する技術や機能の把握だと思う</li>
<li>セキュリティを学習する場合、同じように関連技術や機能把握といったことが必要になるため、セキュリティの学習とは効率の良い「引き出し増やし」になる</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>なので、もしトラブルシューティング能力を上げたいなぁと思う場面があったら、トラブルシューティングが必要になりそうな分野のセキュリティについて学ぶと良いかもしれない。</p>]]></content>
		</item>
		
		<item>
			<title>curl で外部 json ファイルを元に POST リクエストする方法</title>
			<link>https://noid11.github.io/posts/how-to-curl-with-json/</link>
			<pubDate>Thu, 07 Jan 2021 08:00:34 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/how-to-curl-with-json/</guid>
			<description>&lt;p&gt;&lt;code&gt;--data&lt;/code&gt;, &lt;code&gt;-d&lt;/code&gt; オプションで &lt;code&gt;@/file/to/path&lt;/code&gt; という感じで指定すれば良い。&lt;/p&gt;</description>
			<content type="html"><![CDATA[<p><code>--data</code>, <code>-d</code> オプションで <code>@/file/to/path</code> という感じで指定すれば良い。</p>
<h2 id="実行例">実行例</h2>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh"><span class="nv">ENDPOINT</span><span class="o">=</span>https://www.example.com

<span class="c1"># ミニマムなリクエスト</span>
<span class="c1"># -d, --data オプションを使用する場合、自動で POST リクエストになるので -X POST は不要</span>
curl --data @./request.json <span class="nv">$ENDPOINT</span>

<span class="c1"># Content-Type として application/json を指定</span>
<span class="c1"># 明示的に Content-Type を指定しない場合、 Content-Type は application/x-www-form-urlencoded になる</span>
curl --data @./request.json -H <span class="s2">&#34;Content-Type: application/json&#34;</span> <span class="nv">$ENDPOINT</span>

<span class="c1"># 標準出力の json を受け取ってリクエスト</span>
<span class="nb">echo</span> <span class="s1">&#39;{ &#34;hoge&#34;: &#34;fuga&#34;}&#39;</span> <span class="p">|</span> curl --data @- <span class="nv">$ENDPOINT</span>
</code></pre></div><p>動作検証には <a href="http://httpdump.io/">http://httpdump.io/</a> が便利</p>
<h2 id="requestjson-サンプル">request.json サンプル</h2>
<p>JSON 形式であれば何でも良いが、以下の URL にサンプルがあるので試してみると良いかも</p>
<p>JSON Example<br>
<a href="https://json.org/example.html">https://json.org/example.html</a></p>
<h2 id="curl-の-manual-を読む">curl の manual を読む</h2>
<p>curl - How To Use<br>
<a href="https://curl.se/docs/manpage.html">https://curl.se/docs/manpage.html</a></p>
<blockquote>
<p>-d, &ndash;data <!-- raw HTML omitted --><br>
(HTTP MQTT) Sends the specified data in a POST request to the HTTP server, in the same way that a browser does when a user has filled in an HTML form and presses the submit button. This will cause curl to pass the data to the server using the content-type application/x-www-form-urlencoded. Compare to -F, &ndash;form.<br>
&ndash;data-raw is almost the same but does not have a special interpretation of the @ character. To post data purely binary, you should instead use the &ndash;data-binary option. To URL-encode the value of a form field you may use &ndash;data-urlencode.
If any of these options is used more than once on the same command line, the data pieces specified will be merged together with a separating &amp;-symbol. Thus, using &lsquo;-d name=daniel -d skill=lousy&rsquo; would generate a post chunk that looks like &lsquo;name=daniel&amp;skill=lousy&rsquo;.<br>
If you start the data with the letter @, the rest should be a file name to read the data from, or - if you want curl to read the data from stdin. Posting data from a file named &lsquo;foobar&rsquo; would thus be done with -d, &ndash;data @foobar. When -d, &ndash;data is told to read from a file like that, carriage returns and newlines will be stripped out. If you don&rsquo;t want the @ character to have a special interpretation use &ndash;data-raw instead.<br>
See also &ndash;data-binary, &ndash;data-urlencode and &ndash;data-raw. This option overrides -F, &ndash;form and -I, &ndash;head and -T, &ndash;upload-file.</p>
</blockquote>
<ul>
<li><code>-d</code>, <code>--data</code> オプションは POST リクエストで指定されたデータを HTTP サーバーに送信する
<ul>
<li><code>content-type</code> として <code>application/x-www-form-urlencoded</code> を使用する</li>
</ul>
</li>
<li><code>--data-raw</code> は殆ど同じだが、 <code>@</code> 文字の特別な解釈が無い
<ul>
<li>データを純粋にバイナリで送信する場合には <code>--data-binary</code> オプションを使用する必要がある</li>
<li>フォームフィールドの値を URL エンコードするには <code>--data-urlencode</code> を使用できる</li>
</ul>
</li>
<li>これらのオプションのいずれかが同じコマンドラインで複数回使用される場合、指定されたデータ部分は区切り文字と一緒にマージされる
<ul>
<li><code>-d name=daniel -d skill=lousy</code> と指定をすると <code>name=daniel&amp;skill=lousy</code> という post chunk が生成される</li>
</ul>
</li>
<li>データを <code>@</code> で始める場合、残りはデータを読み取るためのファイル名である必要がある
<ul>
<li>curl で stdin からデータを読み取る場合は <code>-</code></li>
<li>foobar というファイルからのデータ投稿をする場合 <code>-d, --data @foobar</code> のように指定する</li>
<li><code>-d</code>, <code>--data</code> がファイル読み取りを指示されると、キャリッジリターンと改行が削除される</li>
<li>純粋に <code>@</code> を文字として使用したい場合、 <code>--data-raw</code> を使用する</li>
</ul>
</li>
<li><code>--data-binary</code>, <code>--data-urlencode</code>, <code>--data-raw</code> も参照すると良い
<ul>
<li>これらのオプションは <code>-F</code>, <code>--form</code>, <code>-I</code>, <code>--head</code>, <code>-T</code>, <code>--upload-file</code> を上書きする</li>
</ul>
</li>
</ul>
<h2 id="この記事を試した環境">この記事を試した環境</h2>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% uname -v
Darwin Kernel Version 19.6.0: Tue Nov <span class="m">10</span> 00:10:30 PST 2020<span class="p">;</span> root:xnu-6153.141.10~1/RELEASE_X86_64
% sw_vers
ProductName:    Mac OS X
ProductVersion: 10.15.7
BuildVersion:   19H114
% curl --version
curl 7.64.1 <span class="o">(</span>x86_64-apple-darwin19.0<span class="o">)</span> libcurl/7.64.1 <span class="o">(</span>SecureTransport<span class="o">)</span> LibreSSL/2.8.3 zlib/1.2.11 nghttp2/1.39.2
Release-Date: 2019-03-27
Protocols: dict file ftp ftps gopher http https imap imaps ldap ldaps pop3 pop3s rtsp smb smbs smtp smtps telnet tftp 
Features: AsynchDNS GSS-API HTTP2 HTTPS-proxy IPv6 Kerberos Largefile libz MultiSSL NTLM NTLM_WB SPNEGO SSL UnixSockets
</code></pre></div>]]></content>
		</item>
		
		<item>
			<title>Cognito User Pool の CSV インポート機能</title>
			<link>https://noid11.github.io/posts/cognito-user-pool-csv-import-feature/</link>
			<pubDate>Tue, 05 Jan 2021 20:18:51 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/cognito-user-pool-csv-import-feature/</guid>
			<description>&lt;p&gt;Cognito User Pool における CSV インポート機能についてのメモ&lt;/p&gt;</description>
			<content type="html"><![CDATA[<p>Cognito User Pool における CSV インポート機能についてのメモ</p>
<h2 id="ユーザーインポート機能の概要">ユーザーインポート機能の概要</h2>
<ul>
<li>Cognito User Pool におけるユーザーインポート機能は2種類ある<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>
<ol>
<li>ユーザー移行 Lambda トリガーを用いたユーザーインポート
<ul>
<li>ユーザーが既存のパスワードを使用して移行可能</li>
<li>ユーザーのサインインアクションが行われたタイミングで移行が行われるため、移行のためにユーザーアクションが必要
<ul>
<li>つまり非アクティブなユーザーについては移行されない</li>
</ul>
</li>
</ul>
</li>
<li>CSV ファイルを用いたユーザーインポート
<ul>
<li>CSV ファイルを用意することでバルクでユーザー移行が可能
<ul>
<li>非アクティブなユーザーについても CSV ファイルに含めれば移行されるので、ある程度まとまった単位でユーザー移行したい場合に適している</li>
</ul>
</li>
<li>ユーザーのパスワードは CSV で指定できないため、インポート後各ユーザーのパスワードリセットが必要</li>
</ul>
</li>
</ol>
</li>
</ul>
<h2 id="csv-インポート機能とは">CSV インポート機能とは？</h2>
<ul>
<li>先述の Cognito User Pool にユーザーをインポートする機能の1つ</li>
<li>ユーザー情報を記述した CSV ファイルを元に、 Cognito User Pool にユーザーをインポートする機能<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>
<ul>
<li>CSV ファイルでユーザーパスワードの設定はサポートされていないため、この方法でインポートされたユーザーは  RESET_REQUIRED ステータスとなり、パスワードリセットが必要となる<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup></li>
</ul>
</li>
</ul>
<p>Cognito User Pool におけるユーザーステータスの遷移図</p>
<blockquote>
<p><img src="/images/cognito-user-pool-import-feature/amazon-cognito-sign-in-confirm-user.png" alt="user-status"></p>
</blockquote>
<p><a href="https://docs.aws.amazon.com/cognito/latest/developerguide/signing-up-users-in-your-app.html">https://docs.aws.amazon.com/cognito/latest/developerguide/signing-up-users-in-your-app.html</a> より引用</p>
<h2 id="ユーザーインポートの流れ">ユーザーインポートの流れ</h2>
<ol>
<li>IAM ロールを作成する
<ul>
<li>これは Cognito User Pool が CSV インポートする際に CloudWatch Logs にログ出力を行うため必要となるもの</li>
</ul>
</li>
<li>CSV ファイルを作成
<ul>
<li>ユーザー情報を記述した CSV ファイルを作成する</li>
</ul>
</li>
<li>ユーザーインポートジョブを作成
<ul>
<li>CSV ファイルをインポートするためのジョブを作成</li>
<li>ジョブは非同期に実行されるようになっており、ジョブを作成するだけではインポートは行われず、明示的にジョブの開始を行う必要がある</li>
</ul>
</li>
<li>CSV ファイルをアップロード
<ul>
<li>ジョブを作成した際に、 CSV ファイルをアップロードするための URL が発行されるので <code>curl</code> コマンド等を用いて CSV ファイルのアップロードを行う</li>
</ul>
</li>
<li>ユーザーインポートジョブを開始</li>
<li>インポートジョブのログを確認
<ul>
<li>CloudWatch Logs に出力される</li>
</ul>
</li>
<li>インポートユーザーがパスワードをリセットするように要求
<ul>
<li>これはアプリケーション実装側のトピックとなるので、この記事では省略する</li>
</ul>
</li>
</ol>
<h2 id="aws-cli-を使ってインポートを試す">AWS CLI を使ってインポートを試す</h2>
<h3 id="iam-ロール">IAM ロール</h3>
<ul>
<li>IAM ロールについてはマネジメントコンソールからインポートを試した際に作成されるサービスロールを使用する<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup></li>
</ul>
<p><code>get-role</code> 結果</p>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% aws iam get-role --role-name Cognito-UserImport-Role   
<span class="o">{</span>
    <span class="s2">&#34;Role&#34;</span>: <span class="o">{</span>
        <span class="s2">&#34;Path&#34;</span>: <span class="s2">&#34;/service-role/&#34;</span>,
        <span class="s2">&#34;RoleName&#34;</span>: <span class="s2">&#34;Cognito-UserImport-Role&#34;</span>,
        <span class="s2">&#34;RoleId&#34;</span>: <span class="s2">&#34;AROAIQGN5YPP2UMLFTJVM&#34;</span>,
        <span class="s2">&#34;Arn&#34;</span>: <span class="s2">&#34;arn:aws:iam::123456789012:role/service-role/Cognito-UserImport-Role&#34;</span>,
        <span class="s2">&#34;CreateDate&#34;</span>: <span class="s2">&#34;2018-06-30T09:54:58+00:00&#34;</span>,
        <span class="s2">&#34;AssumeRolePolicyDocument&#34;</span>: <span class="o">{</span>
            <span class="s2">&#34;Version&#34;</span>: <span class="s2">&#34;2012-10-17&#34;</span>,
            <span class="s2">&#34;Statement&#34;</span>: <span class="o">[</span>
                <span class="o">{</span>
                    <span class="s2">&#34;Effect&#34;</span>: <span class="s2">&#34;Allow&#34;</span>,
                    <span class="s2">&#34;Principal&#34;</span>: <span class="o">{</span>
                        <span class="s2">&#34;Service&#34;</span>: <span class="s2">&#34;cognito-idp.amazonaws.com&#34;</span>
                    <span class="o">}</span>,
                    <span class="s2">&#34;Action&#34;</span>: <span class="s2">&#34;sts:AssumeRole&#34;</span>
                <span class="o">}</span>
            <span class="o">]</span>
        <span class="o">}</span>,
        <span class="s2">&#34;MaxSessionDuration&#34;</span>: 3600,
        <span class="s2">&#34;RoleLastUsed&#34;</span>: <span class="o">{</span>
            <span class="s2">&#34;LastUsedDate&#34;</span>: <span class="s2">&#34;2021-01-05T18:35:15+00:00&#34;</span>,
            <span class="s2">&#34;Region&#34;</span>: <span class="s2">&#34;ap-northeast-1&#34;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>自分の環境では、以下のようなマネージドポリシー <code>Cognito-1530352497476</code> がアタッチされた</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&#34;Version&#34;</span><span class="p">:</span> <span class="s2">&#34;2012-10-17&#34;</span><span class="p">,</span>
    <span class="nt">&#34;Statement&#34;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&#34;Sid&#34;</span><span class="p">:</span> <span class="s2">&#34;Stmt1467314338000&#34;</span><span class="p">,</span>
            <span class="nt">&#34;Effect&#34;</span><span class="p">:</span> <span class="s2">&#34;Allow&#34;</span><span class="p">,</span>
            <span class="nt">&#34;Action&#34;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&#34;logs:CreateLogGroup&#34;</span><span class="p">,</span>
                <span class="s2">&#34;logs:CreateLogStream&#34;</span><span class="p">,</span>
                <span class="s2">&#34;logs:DescribeLogStreams&#34;</span><span class="p">,</span>
                <span class="s2">&#34;logs:PutLogEvents&#34;</span>
            <span class="p">],</span>
            <span class="nt">&#34;Resource&#34;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&#34;arn:aws:logs:ap-northeast-1:123456789012:log-group:/aws/cognito/*&#34;</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div><h3 id="csv-ファイルを用意">CSV ファイルを用意</h3>
<p>get-csv-header コマンドで CSV に必要となるヘッダーを取得できる<sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup></p>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh"><span class="nv">USER_POOL_ID</span><span class="o">=</span>ap-northeast-1_xxx
aws cognito-idp get-csv-header --user-pool-id <span class="nv">$USER_POOL_ID</span>
aws cognito-idp get-csv-header --user-pool-id <span class="nv">$USER_POOL_ID</span> --query CSVHeader
</code></pre></div><p>実行例</p>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% aws cognito-idp get-csv-header --user-pool-id <span class="nv">$USER_POOL_ID</span> --query CSVHeader --output text
<span class="o">[</span>
    <span class="s2">&#34;name&#34;</span>,
    <span class="s2">&#34;given_name&#34;</span>,
    <span class="s2">&#34;family_name&#34;</span>,
    <span class="s2">&#34;middle_name&#34;</span>,
    <span class="s2">&#34;nickname&#34;</span>,
    <span class="s2">&#34;preferred_username&#34;</span>,
    <span class="s2">&#34;profile&#34;</span>,
    <span class="s2">&#34;picture&#34;</span>,
    <span class="s2">&#34;website&#34;</span>,
    <span class="s2">&#34;email&#34;</span>,
    <span class="s2">&#34;email_verified&#34;</span>,
    <span class="s2">&#34;gender&#34;</span>,
    <span class="s2">&#34;birthdate&#34;</span>,
    <span class="s2">&#34;zoneinfo&#34;</span>,
    <span class="s2">&#34;locale&#34;</span>,
    <span class="s2">&#34;phone_number&#34;</span>,
    <span class="s2">&#34;phone_number_verified&#34;</span>,
    <span class="s2">&#34;address&#34;</span>,
    <span class="s2">&#34;updated_at&#34;</span>,
    <span class="s2">&#34;cognito:mfa_enabled&#34;</span>,
    <span class="s2">&#34;cognito:username&#34;</span>
<span class="o">]</span>
</code></pre></div><p><code>--output</code> を <code>text</code> とするとコマンドを使って加工しやすいかもしれない</p>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% aws cognito-idp get-csv-header --user-pool-id <span class="nv">$USER_POOL_ID</span> --query CSVHeader --output text
name    given_name      family_name     middle_name     nickname        preferred_username      profile picture website email   email_verified  gender  birthdate       zoneinfo        locale  phone_number       phone_number_verified   address updated_at      cognito:mfa_enabled     cognito:username
</code></pre></div><p>これで取得したヘッダーを元に CSV ファイルを作成する</p>
<pre><code class="language-csv" data-lang="csv">name,given_name,family_name,middle_name,nickname,preferred_username,profile,picture,website,email,email_verified,gender,birthdate,zoneinfo,locale,phone_number,phone_number_verified,address,updated_at,cognito:mfa_enabled,cognito:username
</code></pre><p>サンプル CSV (User Pool 設定によって必要となる header や属性が異なるので注意)</p>
<pre><code class="language-csv" data-lang="csv">name,given_name,family_name,middle_name,nickname,preferred_username,profile,picture,website,email,email_verified,gender,birthdate,zoneinfo,locale,phone_number,phone_number_verified,address,updated_at,cognito:mfa_enabled,cognito:username
johndoe,,,,,,,,,johndoe@example.com,TRUE,,,,,,FALSE,,,FALSE,johndoe
janeroe,,,,,,,,,janeroe@example.com,TRUE,,,,,,FALSE,,,FALSE,janeroe
</code></pre><h3 id="ジョブを作成">ジョブを作成</h3>
<p><code>create-user-import-job</code> コマンドでインポートジョブを作成<sup id="fnref:6"><a href="#fn:6" class="footnote-ref" role="doc-noteref">6</a></sup></p>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh"><span class="nv">JOB_NAME</span><span class="o">=</span>myjob
<span class="nv">CLOUD_WATCH_LOGS_ROLE_ARN</span><span class="o">=</span>arn:aws:iam::123456789012:role/service-role/Cognito-UserImport-Role
aws cognito-idp create-user-import-job --job-name <span class="nv">$JOB_NAME</span> --user-pool-id <span class="nv">$USER_POOL_ID</span> --cloud-watch-logs-role-arn <span class="nv">$CLOUD_WATCH_LOGS_ROLE_ARN</span>
</code></pre></div><p>実行例</p>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% aws cognito-idp create-user-import-job --job-name <span class="nv">$JOB_NAME</span> --user-pool-id <span class="nv">$USER_POOL_ID</span> --cloud-watch-logs-role-arn <span class="nv">$CLOUD_WATCH_LOGS_ROLE_ARN</span>
<span class="o">{</span>
    <span class="s2">&#34;UserImportJob&#34;</span>: <span class="o">{</span>
        <span class="s2">&#34;JobName&#34;</span>: <span class="s2">&#34;myjob&#34;</span>,
        <span class="s2">&#34;JobId&#34;</span>: <span class="s2">&#34;import-xxx&#34;</span>,
        <span class="s2">&#34;UserPoolId&#34;</span>: <span class="s2">&#34;ap-northeast-1_xxx&#34;</span>,
        <span class="s2">&#34;PreSignedUrl&#34;</span>: <span class="s2">&#34;https://aws-cognito-idp-user-import-nrt.s3.ap-northeast-1.amazonaws.com/123456789012/ap-northeast-1_xxx/import-xxx?...&#34;</span>,
        <span class="s2">&#34;CreationDate&#34;</span>: <span class="s2">&#34;2021-01-05T21:06:37.381000+09:00&#34;</span>,
        <span class="s2">&#34;Status&#34;</span>: <span class="s2">&#34;Created&#34;</span>,
        <span class="s2">&#34;CloudWatchLogsRoleArn&#34;</span>: <span class="s2">&#34;arn:aws:iam::123456789012:role/service-role/Cognito-UserImport-Role&#34;</span>,
        <span class="s2">&#34;ImportedUsers&#34;</span>: 0,
        <span class="s2">&#34;SkippedUsers&#34;</span>: 0,
        <span class="s2">&#34;FailedUsers&#34;</span>: <span class="m">0</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>CSV ファイルのアップロード</p>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh"><span class="nv">PRE_SIGNED_URL</span><span class="o">=</span><span class="s2">&#34;https://aws-cognito-idp-user-import-nrt.s3.ap-northeast-1.amazonaws.com/123456789012/ap-northeast-1_xxx/import-xxx?...&#34;</span>
curl -v -T ./user-import-csv-template.csv -H <span class="s2">&#34;x-amz-server-side-encryption:aws:kms&#34;</span> <span class="nv">$PRE_SIGNED_URL</span>
</code></pre></div><h3 id="作成したジョブを開始">作成したジョブを開始</h3>
<p><code>start-user-import-job</code> でジョブを開始<sup id="fnref:7"><a href="#fn:7" class="footnote-ref" role="doc-noteref">7</a></sup></p>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh"><span class="nv">JOB_ID</span><span class="o">=</span>import-xxx
aws cognito-idp start-user-import-job --user-pool-id <span class="nv">$USER_POOL_ID</span> --job-id <span class="nv">$JOB_ID</span>
</code></pre></div><p>実行例</p>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% aws cognito-idp start-user-import-job --user-pool-id <span class="nv">$USER_POOL_ID</span> --job-id <span class="nv">$JOB_ID</span>
<span class="o">{</span>
    <span class="s2">&#34;UserImportJob&#34;</span>: <span class="o">{</span>
        <span class="s2">&#34;JobName&#34;</span>: <span class="s2">&#34;myjob&#34;</span>,
        <span class="s2">&#34;JobId&#34;</span>: <span class="s2">&#34;import-xxx&#34;</span>,
        <span class="s2">&#34;UserPoolId&#34;</span>: <span class="s2">&#34;ap-northeast-1_xxx&#34;</span>,
        <span class="s2">&#34;PreSignedUrl&#34;</span>: <span class="s2">&#34;https://aws-cognito-idp-user-import-nrt.s3.ap-northeast-1.amazonaws.com/123456789012/ap-northeast-1_xxx/import-xxx?...&#34;</span>,
        <span class="s2">&#34;CreationDate&#34;</span>: <span class="s2">&#34;2021-01-06T03:49:04.035000+09:00&#34;</span>,
        <span class="s2">&#34;StartDate&#34;</span>: <span class="s2">&#34;2021-01-06T03:50:45.478000+09:00&#34;</span>,
        <span class="s2">&#34;Status&#34;</span>: <span class="s2">&#34;Pending&#34;</span>,
        <span class="s2">&#34;CloudWatchLogsRoleArn&#34;</span>: <span class="s2">&#34;arn:aws:iam::123456789012:role/service-role/Cognito-UserImport-Role&#34;</span>,
        <span class="s2">&#34;ImportedUsers&#34;</span>: 0,
        <span class="s2">&#34;SkippedUsers&#34;</span>: 0,
        <span class="s2">&#34;FailedUsers&#34;</span>: <span class="m">0</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h3 id="インポートジョブのステータス確認">インポートジョブのステータス確認</h3>
<p><code>describe-user-import-job</code> コマンドでインポートジョブのステータスを確認可能<sup id="fnref:8"><a href="#fn:8" class="footnote-ref" role="doc-noteref">8</a></sup></p>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">aws cognito-idp describe-user-import-job --user-pool-id <span class="nv">$USER_POOL_ID</span> --job-id <span class="nv">$JOB_ID</span>
</code></pre></div><p>実行例</p>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% aws cognito-idp describe-user-import-job --user-pool-id <span class="nv">$USER_POOL_ID</span> --job-id <span class="nv">$JOB_ID</span>
<span class="o">{</span>
    <span class="s2">&#34;UserImportJob&#34;</span>: <span class="o">{</span>
        <span class="s2">&#34;JobName&#34;</span>: <span class="s2">&#34;myjob&#34;</span>,
        <span class="s2">&#34;JobId&#34;</span>: <span class="s2">&#34;import-xxx&#34;</span>,
        <span class="s2">&#34;UserPoolId&#34;</span>: <span class="s2">&#34;ap-northeast-1_xxx&#34;</span>,
        <span class="s2">&#34;PreSignedUrl&#34;</span>: <span class="s2">&#34;https://aws-cognito-idp-user-import-nrt.s3.ap-northeast-1.amazonaws.com/123456789012/ap-northeast-1_xxx/import-xxx?...&#34;</span>,
        <span class="s2">&#34;CreationDate&#34;</span>: <span class="s2">&#34;2021-01-06T03:49:04.035000+09:00&#34;</span>,
        <span class="s2">&#34;StartDate&#34;</span>: <span class="s2">&#34;2021-01-06T03:50:47.752000+09:00&#34;</span>,
        <span class="s2">&#34;CompletionDate&#34;</span>: <span class="s2">&#34;2021-01-06T03:50:48.531000+09:00&#34;</span>,
        <span class="s2">&#34;Status&#34;</span>: <span class="s2">&#34;Succeeded&#34;</span>,
        <span class="s2">&#34;CloudWatchLogsRoleArn&#34;</span>: <span class="s2">&#34;arn:aws:iam::123456789012:role/service-role/Cognito-UserImport-Role&#34;</span>,
        <span class="s2">&#34;ImportedUsers&#34;</span>: 2,
        <span class="s2">&#34;SkippedUsers&#34;</span>: 0,
        <span class="s2">&#34;FailedUsers&#34;</span>: 0,
        <span class="s2">&#34;CompletionMessage&#34;</span>: <span class="s2">&#34;Import Job Completed Successfully.&#34;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h3 id="ユーザーが追加されたか確認">ユーザーが追加されたか確認</h3>
<p><code>list-users</code> コマンドで確認<sup id="fnref:9"><a href="#fn:9" class="footnote-ref" role="doc-noteref">9</a></sup></p>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">aws cognito-idp list-users --user-pool-id <span class="nv">$USER_POOL_ID</span>
</code></pre></div><p>実行例</p>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% aws cognito-idp list-users --user-pool-id <span class="nv">$USER_POOL_ID</span>
<span class="o">{</span>
    <span class="s2">&#34;Users&#34;</span>: <span class="o">[</span>
        <span class="o">{</span>
            <span class="s2">&#34;Username&#34;</span>: <span class="s2">&#34;janeroe&#34;</span>,
            <span class="s2">&#34;Attributes&#34;</span>: <span class="o">[</span>
                <span class="o">{</span>
                    <span class="s2">&#34;Name&#34;</span>: <span class="s2">&#34;sub&#34;</span>,
                    <span class="s2">&#34;Value&#34;</span>: <span class="s2">&#34;c754c8af-55e4-413f-afdb-895bd17e8078&#34;</span>
                <span class="o">}</span>,
                <span class="o">{</span>
                    <span class="s2">&#34;Name&#34;</span>: <span class="s2">&#34;email_verified&#34;</span>,
                    <span class="s2">&#34;Value&#34;</span>: <span class="s2">&#34;true&#34;</span>
                <span class="o">}</span>,
                <span class="o">{</span>
                    <span class="s2">&#34;Name&#34;</span>: <span class="s2">&#34;name&#34;</span>,
                    <span class="s2">&#34;Value&#34;</span>: <span class="s2">&#34;janeroe&#34;</span>
                <span class="o">}</span>,
                <span class="o">{</span>
                    <span class="s2">&#34;Name&#34;</span>: <span class="s2">&#34;phone_number_verified&#34;</span>,
                    <span class="s2">&#34;Value&#34;</span>: <span class="s2">&#34;false&#34;</span>
                <span class="o">}</span>,
                <span class="o">{</span>
                    <span class="s2">&#34;Name&#34;</span>: <span class="s2">&#34;email&#34;</span>,
                    <span class="s2">&#34;Value&#34;</span>: <span class="s2">&#34;janeroe@example.com&#34;</span>
                <span class="o">}</span>
            <span class="o">]</span>,
            <span class="s2">&#34;UserCreateDate&#34;</span>: <span class="s2">&#34;2021-01-06T03:50:48.369000+09:00&#34;</span>,
            <span class="s2">&#34;UserLastModifiedDate&#34;</span>: <span class="s2">&#34;2021-01-06T03:50:48.369000+09:00&#34;</span>,
            <span class="s2">&#34;Enabled&#34;</span>: true,
            <span class="s2">&#34;UserStatus&#34;</span>: <span class="s2">&#34;RESET_REQUIRED&#34;</span>
        <span class="o">}</span>,
        <span class="o">{</span>
            <span class="s2">&#34;Username&#34;</span>: <span class="s2">&#34;johndoe&#34;</span>,
            <span class="s2">&#34;Attributes&#34;</span>: <span class="o">[</span>
                <span class="o">{</span>
                    <span class="s2">&#34;Name&#34;</span>: <span class="s2">&#34;sub&#34;</span>,
                    <span class="s2">&#34;Value&#34;</span>: <span class="s2">&#34;556cdeca-59af-49e2-903c-8d2452ff1cae&#34;</span>
                <span class="o">}</span>,
                <span class="o">{</span>
                    <span class="s2">&#34;Name&#34;</span>: <span class="s2">&#34;email_verified&#34;</span>,
                    <span class="s2">&#34;Value&#34;</span>: <span class="s2">&#34;true&#34;</span>
                <span class="o">}</span>,
                <span class="o">{</span>
                    <span class="s2">&#34;Name&#34;</span>: <span class="s2">&#34;name&#34;</span>,
                    <span class="s2">&#34;Value&#34;</span>: <span class="s2">&#34;johndoe&#34;</span>
                <span class="o">}</span>,
                <span class="o">{</span>
                    <span class="s2">&#34;Name&#34;</span>: <span class="s2">&#34;phone_number_verified&#34;</span>,
                    <span class="s2">&#34;Value&#34;</span>: <span class="s2">&#34;false&#34;</span>
                <span class="o">}</span>,
                <span class="o">{</span>
                    <span class="s2">&#34;Name&#34;</span>: <span class="s2">&#34;email&#34;</span>,
                    <span class="s2">&#34;Value&#34;</span>: <span class="s2">&#34;johndoe@example.com&#34;</span>
                <span class="o">}</span>
            <span class="o">]</span>,
            <span class="s2">&#34;UserCreateDate&#34;</span>: <span class="s2">&#34;2021-01-06T03:50:48.363000+09:00&#34;</span>,
            <span class="s2">&#34;UserLastModifiedDate&#34;</span>: <span class="s2">&#34;2021-01-06T03:50:48.363000+09:00&#34;</span>,
            <span class="s2">&#34;Enabled&#34;</span>: true,
            <span class="s2">&#34;UserStatus&#34;</span>: <span class="s2">&#34;RESET_REQUIRED&#34;</span>
        <span class="o">}</span>
    <span class="o">]</span>
<span class="o">}</span>
</code></pre></div><h2 id="ジョブのステータス">ジョブのステータス</h2>
<ul>
<li>API Reference の DataType に定義がある<sup id="fnref:10"><a href="#fn:10" class="footnote-ref" role="doc-noteref">10</a></sup>
<ul>
<li><code>Created</code>: ジョブが作成されたものの未開始</li>
<li><code>Pending</code>: ジョブが開始されたもののユーザーはインポートしていない遷移状態</li>
<li><code>InProgress</code>: ジョブが開始されユーザーをインポート中</li>
<li><code>Stopping</code>: ジョブの停止をリクエストしたが、ジョブがユーザーインポートを停止していない</li>
<li><code>Stopped</code>: ジョブがユーザーインポートを停止した</li>
<li><code>Succeeded</code>: ジョブが正常に完了した</li>
<li><code>Faild</code>: エラーのためジョブが失敗した</li>
<li><code>Expired</code>: ジョブを作成したが 24 - 48 時間の間にジョブを開始しなかった。ジョブに関連付けられているデータは全て削除され、ジョブは開始できない</li>
</ul>
</li>
</ul>
<h2 id="トラブルシュート-tips">トラブルシュート Tips</h2>
<ul>
<li>CSV のインポートが失敗する
<ul>
<li>CloudWatch Logs に出力されるログを見るとヒントがあるかも</li>
<li>以下のようなフォーマットで CloudWatch Logs に出力が行われる
<ul>
<li>Log Group: <code>/aws/cognito/userpools/ap-northeast-1_xxx/my-user-pool-name</code></li>
<li>Log Stream: <code>import-job-id/import-job-name</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="この記事を試した環境">この記事を試した環境</h2>
<div class="highlight"><pre class="chroma"><code class="language-zsh" data-lang="zsh">% uname -v
Darwin Kernel Version 19.6.0: Tue Nov <span class="m">10</span> 00:10:30 PST 2020<span class="p">;</span> root:xnu-6153.141.10~1/RELEASE_X86_64
% sw_vers
ProductName:    Mac OS X
ProductVersion: 10.15.7
BuildVersion:   19H114
% aws --version
aws-cli/2.1.6 Python/3.7.4 Darwin/19.6.0 exe/x86_64 prompt/off
</code></pre></div><section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>Importing Users into a User Pool - Amazon Cognito<br>
<a href="https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-import-users.html">https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-import-users.html</a> <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p>Importing Users into User Pools From a CSV File - Amazon Cognito<br>
<a href="https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-using-import-tool.html">https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-using-import-tool.html</a> <a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3" role="doc-endnote">
<p>UserType - Amazon Cognito Identity Provider<br>
<a href="https://docs.aws.amazon.com/cognito-user-identity-pools/latest/APIReference/API_UserType.html">https://docs.aws.amazon.com/cognito-user-identity-pools/latest/APIReference/API_UserType.html</a> <a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4" role="doc-endnote">
<p>Creating the CloudWatch Logs IAM Role (AWS CLI, API) - Amazon Cognito<br>
<a href="https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-using-import-tool-cli-cloudwatch-iam-role.html">https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-using-import-tool-cli-cloudwatch-iam-role.html</a> <a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5" role="doc-endnote">
<p><a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/cognito-idp/get-csv-header.html">https://awscli.amazonaws.com/v2/documentation/api/latest/reference/cognito-idp/get-csv-header.html</a> <a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:6" role="doc-endnote">
<p><a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/cognito-idp/create-user-import-job.html">https://awscli.amazonaws.com/v2/documentation/api/latest/reference/cognito-idp/create-user-import-job.html</a> <a href="#fnref:6" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:7" role="doc-endnote">
<p><a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/cognito-idp/start-user-import-job.html">https://awscli.amazonaws.com/v2/documentation/api/latest/reference/cognito-idp/start-user-import-job.html</a> <a href="#fnref:7" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:8" role="doc-endnote">
<p><a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/cognito-idp/describe-user-import-job.html">https://awscli.amazonaws.com/v2/documentation/api/latest/reference/cognito-idp/describe-user-import-job.html</a> <a href="#fnref:8" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:9" role="doc-endnote">
<p><a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/cognito-idp/list-users.html">https://awscli.amazonaws.com/v2/documentation/api/latest/reference/cognito-idp/list-users.html</a> <a href="#fnref:9" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:10" role="doc-endnote">
<p>UserImportJobType - Amazon Cognito Identity Provider
<a href="https://docs.aws.amazon.com/cognito-user-identity-pools/latest/APIReference/API_UserImportJobType.html">https://docs.aws.amazon.com/cognito-user-identity-pools/latest/APIReference/API_UserImportJobType.html</a> <a href="#fnref:10" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>]]></content>
		</item>
		
		<item>
			<title>AWS Lambda で Go ランタイムを使うのが良いと思っている理由</title>
			<link>https://noid11.github.io/posts/aws-lambda-love-golang/</link>
			<pubDate>Fri, 01 Jan 2021 15:05:18 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/aws-lambda-love-golang/</guid>
			<description>&lt;p&gt;個人的に AWS Lambda では zip 形式で golang ランタイム使うのがコスパ最強な気がしているので、根拠をまとめておくメモ&lt;/p&gt;</description>
			<content type="html"><![CDATA[<p>個人的に AWS Lambda では zip 形式で golang ランタイム使うのがコスパ最強な気がしているので、根拠をまとめておくメモ</p>
<h2 id="パフォーマンス">パフォーマンス</h2>
<ul>
<li>コールドスタートの影響が少ない
<ul>
<li>JVM 相当のコンポーネントが存在しないためコールドスタートの影響が少ない</li>
</ul>
</li>
<li>マルチコアを活かしやすい
<ul>
<li>AWS Lambda では Lambda 関数に設定したメモリサイズに応じて割り当てられる CPU パワーが変化する<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>
<ul>
<li>今後変化する可能性もあるものの、現状メモリサイズを最低値である 128 MB としても利用コア数は 2 となる<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup></li>
<li>1,769 MB のメモリ割り当てで 1vCPU 相当になるらしい</li>
<li>2020/12/01 にメモリ 10GB vCPU 6 コアまでサポートされるようになった<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup></li>
</ul>
</li>
<li>goroutine との相性が良い</li>
</ul>
</li>
</ul>
<h2 id="開発体験">開発体験</h2>
<ul>
<li>公式の型定義が使える
<ul>
<li>AWS 公式から Lambda 関数が受け取る event の型が定義されている<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup></li>
<li>TypeScript でもあったりするものの、良くも悪くも DefinitelyTyped による型定義なので公式ではなくコミュニティによるもの<sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup></li>
</ul>
</li>
</ul>
<h2 id="料金">料金</h2>
<ul>
<li>goroutine を使って concurrent な処理を実装しやすいため Lambda 関数の実行時間短縮が期待できる
<ul>
<li>AWS Lambda の料金はリクエスト数と実行時間を元に算出される<sup id="fnref:6"><a href="#fn:6" class="footnote-ref" role="doc-noteref">6</a></sup>
<ul>
<li>さらに 2020/12/01 に AWS Lambda の課金単位が 1ms になった<sup id="fnref:7"><a href="#fn:7" class="footnote-ref" role="doc-noteref">7</a></sup></li>
</ul>
</li>
<li>そのため基本的に短い時間で処理を完了できるほうがお得</li>
</ul>
</li>
<li>基本的にコンテナイメージより zip 形式の方が安く使える
<ul>
<li>従来の zip 形式ではなく、コンテナイメージ形式でコードをデプロイすることが可能になった<sup id="fnref:8"><a href="#fn:8" class="footnote-ref" role="doc-noteref">8</a></sup>
<ul>
<li>コンテナイメージとカスタムランタイムは Lambda 関数の初期化時にも課金が発生するため、 zip 形式では実現できない要件がある場合にコンテナイメージを検討するのが良さそう<sup id="fnref:9"><a href="#fn:9" class="footnote-ref" role="doc-noteref">9</a></sup></li>
<li>数 GB に渡るような巨大なライブラリやコードを動かしたい場合とか</li>
</ul>
</li>
</ul>
</li>
</ul>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>Configuring Lambda function memory - AWS Lambda<br>
<a href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-memory.html">https://docs.aws.amazon.com/lambda/latest/dg/configuration-memory.html</a> <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p>Serverless連載2: AWS Lambda×Goの開発Tips | フューチャー技術ブログ<br>
<a href="https://future-architect.github.io/articles/20200326/">https://future-architect.github.io/articles/20200326/</a> <a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3" role="doc-endnote">
<p>AWS Lambda now supports up to 10 GB of memory and 6 vCPU cores for Lambda Functions<br>
<a href="https://aws.amazon.com/jp/about-aws/whats-new/2020/12/aws-lambda-supports-10gb-memory-6-vcpu-cores-lambda-functions/">https://aws.amazon.com/jp/about-aws/whats-new/2020/12/aws-lambda-supports-10gb-memory-6-vcpu-cores-lambda-functions/</a> <a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4" role="doc-endnote">
<p>aws-lambda-go/events at master · aws/aws-lambda-go<br>
<a href="https://github.com/aws/aws-lambda-go/tree/master/events">https://github.com/aws/aws-lambda-go/tree/master/events</a> <a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5" role="doc-endnote">
<p>DefinitelyTyped/types/aws-lambda at master · DefinitelyTyped/DefinitelyTyped<br>
<a href="https://github.com/DefinitelyTyped/DefinitelyTyped/tree/master/types/aws-lambda">https://github.com/DefinitelyTyped/DefinitelyTyped/tree/master/types/aws-lambda</a> <a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:6" role="doc-endnote">
<p>料金 - AWS Lambda ｜AWS<br>
<a href="https://aws.amazon.com/jp/lambda/pricing/">https://aws.amazon.com/jp/lambda/pricing/</a> <a href="#fnref:6" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:7" role="doc-endnote">
<p>AWS Lambda changes duration billing granularity from 100ms down to 1ms<br>
<a href="https://aws.amazon.com/jp/about-aws/whats-new/2020/12/aws-lambda-changes-duration-billing-granularity-from-100ms-to-1ms/">https://aws.amazon.com/jp/about-aws/whats-new/2020/12/aws-lambda-changes-duration-billing-granularity-from-100ms-to-1ms/</a> <a href="#fnref:7" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:8" role="doc-endnote">
<p>AWS Lambda の新機能 – コンテナイメージのサポート | Amazon Web Services ブログ<br>
<a href="https://aws.amazon.com/jp/blogs/news/new-for-aws-lambda-container-image-support/">https://aws.amazon.com/jp/blogs/news/new-for-aws-lambda-container-image-support/</a> <a href="#fnref:8" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:9" role="doc-endnote">
<p>AWS Lambda のカスタムランタイム - AWS Lambda<br>
<a href="https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/runtimes-custom.html#runtimes-custom-build">https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/runtimes-custom.html#runtimes-custom-build</a> <a href="#fnref:9" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>]]></content>
		</item>
		
		<item>
			<title>2021 年の目標</title>
			<link>https://noid11.github.io/posts/2021-goals/</link>
			<pubDate>Thu, 31 Dec 2020 22:49:26 +0900</pubDate>
			
			<guid>https://noid11.github.io/posts/2021-goals/</guid>
			<description></description>
			<content type="html"><![CDATA[<h1 id="技術">技術</h1>
<ul>
<li>コーディングスキルにコンプレックスがあるので、もっと書けるようになりたい &amp; 自信をつけたい
<ul>
<li>プログラミング言語としては <a href="https://golang.org/">Golang</a>, <a href="https://www.typescriptlang.org/">TypeScript</a>, <a href="https://developer.mozilla.org/ja/docs/Web/JavaScript">JavaScript</a>, <a href="https://www.python.org/">Python</a> あたりにモチベがある</li>
<li>何か OSS にコントリビュートしてみたい</li>
<li>RFC 等の仕様を読んで実装してみる・・・みたいなやつもやってみたい</li>
</ul>
</li>
</ul>
<h1 id="英語">英語</h1>
<ul>
<li>コツコツやる
<ul>
<li><a href="https://ja.duolingo.com/">Duolingo</a> と <a href="https://ankiweb.net/decks/">Anki Web</a> が良い感じに継続できているので大丈夫そうではある</li>
<li>スピーキングがお仕事上必要になるようであれば英会話教室とか検討した方が良いかもしれない</li>
</ul>
</li>
</ul>
<h1 id="仕事">仕事</h1>
<ul>
<li>常にキャパシティに余裕を持てるように働きたい
<ul>
<li>1日の仕事を7時間程度で終わらせて、1時間は自分への投資に使いたい</li>
</ul>
</li>
</ul>
<h1 id="健康">健康</h1>
<ul>
<li>有酸素運動を習慣化したい
<ul>
<li>エアロバイクを腐らせているので毎日やっていきたい</li>
<li>エアロバイクを漕ぐだけだと継続できない実績があるので、並行してできる良さげなものを探したい</li>
</ul>
</li>
</ul>
<h1 id="趣味">趣味</h1>
<ul>
<li>やりたいことは色々あるけど、目標は無しで自由にやっていきたい</li>
</ul>]]></content>
		</item>
		
	</channel>
</rss>
